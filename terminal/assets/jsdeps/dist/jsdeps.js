(()=>{var e={169:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var r=null;"undefined"!=typeof WebSocket?r=WebSocket:"undefined"!=typeof MozWebSocket?r=MozWebSocket:void 0!==i.g?r=i.g.WebSocket||i.g.MozWebSocket:"undefined"!=typeof window?r=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(r=self.WebSocket||self.MozWebSocket);const s=r},328:(e,t,i)=>{i(8624),e.exports=self.fetch.bind(self)},372:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProtocolNotificationType=t.ProtocolNotificationType0=t.ProtocolRequestType=t.ProtocolRequestType0=t.RegistrationType=t.MessageDirection=void 0;const r=i(6439);var s;!function(e){e.clientToServer="clientToServer",e.serverToClient="serverToClient",e.both="both"}(s||(t.MessageDirection=s={})),t.RegistrationType=class{constructor(e){this.method=e}};class n extends r.RequestType0{constructor(e){super(e)}}t.ProtocolRequestType0=n;class o extends r.RequestType{constructor(e){super(e,r.ParameterStructures.byName)}}t.ProtocolRequestType=o;class a extends r.NotificationType0{constructor(e){super(e)}}t.ProtocolNotificationType0=a;class l extends r.NotificationType{constructor(e){super(e,r.ParameterStructures.byName)}}t.ProtocolNotificationType=l},577:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageConnection=t.ConnectionOptions=t.MessageStrategy=t.CancellationStrategy=t.CancellationSenderStrategy=t.CancellationReceiverStrategy=t.RequestCancellationReceiverStrategy=t.IdCancellationReceiverStrategy=t.ConnectionStrategy=t.ConnectionError=t.ConnectionErrors=t.LogTraceNotification=t.SetTraceNotification=t.TraceFormat=t.TraceValues=t.Trace=t.NullLogger=t.ProgressType=t.ProgressToken=void 0;const r=i(9590),s=i(8585),n=i(6177),o=i(3352),a=i(2676),l=i(9850);var c,h,u,d,f,p,g,m,v,_,y,b,w,S,C,k,x,R,E;!function(e){e.type=new n.NotificationType("$/cancelRequest")}(c||(c={})),function(e){e.is=function(e){return"string"==typeof e||"number"==typeof e}}(h||(t.ProgressToken=h={})),function(e){e.type=new n.NotificationType("$/progress")}(u||(u={})),t.ProgressType=class{constructor(){}},function(e){e.is=function(e){return s.func(e)}}(d||(d={})),t.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}}),function(e){e[e.Off=0]="Off",e[e.Messages=1]="Messages",e[e.Compact=2]="Compact",e[e.Verbose=3]="Verbose"}(f||(t.Trace=f={})),function(e){e.Off="off",e.Messages="messages",e.Compact="compact",e.Verbose="verbose"}(p||(t.TraceValues=p={})),function(e){e.fromString=function(t){if(!s.string(t))return e.Off;switch(t=t.toLowerCase()){case"off":default:return e.Off;case"messages":return e.Messages;case"compact":return e.Compact;case"verbose":return e.Verbose}},e.toString=function(t){switch(t){case e.Off:return"off";case e.Messages:return"messages";case e.Compact:return"compact";case e.Verbose:return"verbose";default:return"off"}}}(f||(t.Trace=f={})),function(e){e.Text="text",e.JSON="json"}(g||(t.TraceFormat=g={})),function(e){e.fromString=function(t){return s.string(t)&&"json"===(t=t.toLowerCase())?e.JSON:e.Text}}(g||(t.TraceFormat=g={})),function(e){e.type=new n.NotificationType("$/setTrace")}(m||(t.SetTraceNotification=m={})),function(e){e.type=new n.NotificationType("$/logTrace")}(v||(t.LogTraceNotification=v={})),function(e){e[e.Closed=1]="Closed",e[e.Disposed=2]="Disposed",e[e.AlreadyListening=3]="AlreadyListening"}(_||(t.ConnectionErrors=_={}));class D extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,D.prototype)}}t.ConnectionError=D,function(e){e.is=function(e){const t=e;return t&&s.func(t.cancelUndispatched)}}(y||(t.ConnectionStrategy=y={})),function(e){e.is=function(e){const t=e;return t&&(void 0===t.kind||"id"===t.kind)&&s.func(t.createCancellationTokenSource)&&(void 0===t.dispose||s.func(t.dispose))}}(b||(t.IdCancellationReceiverStrategy=b={})),function(e){e.is=function(e){const t=e;return t&&"request"===t.kind&&s.func(t.createCancellationTokenSource)&&(void 0===t.dispose||s.func(t.dispose))}}(w||(t.RequestCancellationReceiverStrategy=w={})),function(e){e.Message=Object.freeze({createCancellationTokenSource:e=>new l.CancellationTokenSource}),e.is=function(e){return b.is(e)||w.is(e)}}(S||(t.CancellationReceiverStrategy=S={})),function(e){e.Message=Object.freeze({sendCancellation:(e,t)=>e.sendNotification(c.type,{id:t}),cleanup(e){}}),e.is=function(e){const t=e;return t&&s.func(t.sendCancellation)&&s.func(t.cleanup)}}(C||(t.CancellationSenderStrategy=C={})),function(e){e.Message=Object.freeze({receiver:S.Message,sender:C.Message}),e.is=function(e){const t=e;return t&&S.is(t.receiver)&&C.is(t.sender)}}(k||(t.CancellationStrategy=k={})),function(e){e.is=function(e){const t=e;return t&&s.func(t.handleMessage)}}(x||(t.MessageStrategy=x={})),function(e){e.is=function(e){const t=e;return t&&(k.is(t.cancellationStrategy)||y.is(t.connectionStrategy)||x.is(t.messageStrategy))}}(R||(t.ConnectionOptions=R={})),function(e){e[e.New=1]="New",e[e.Listening=2]="Listening",e[e.Closed=3]="Closed",e[e.Disposed=4]="Disposed"}(E||(E={})),t.createMessageConnection=function(e,i,p,y){const w=void 0!==p?p:t.NullLogger;let S=0,C=0,R=0;const T="2.0";let M;const A=new Map;let O;const L=new Map,P=new Map;let B,I,N=new o.LinkedMap,q=new Map,H=new Set,F=new Map,W=f.Off,j=g.Text,$=E.New;const z=new a.Emitter,U=new a.Emitter,V=new a.Emitter,K=new a.Emitter,G=new a.Emitter,J=y&&y.cancellationStrategy?y.cancellationStrategy:k.Message;function X(e){if(null===e)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+e.toString()}function Y(e){}function Z(){return $===E.Listening}function Q(){return $===E.Closed}function ee(){return $===E.Disposed}function te(){$!==E.New&&$!==E.Listening||($=E.Closed,U.fire(void 0))}function ie(){B||0===N.size||(B=(0,r.default)().timer.setImmediate((()=>{B=void 0,function(){if(0===N.size)return;const e=N.shift();try{const t=y?.messageStrategy;x.is(t)?t.handleMessage(e,re):re(e)}finally{ie()}}()})))}function re(e){n.Message.isRequest(e)?function(e){if(ee())return;function t(t,r,s){const o={jsonrpc:T,id:e.id};t instanceof n.ResponseError?o.error=t.toJson():o.result=void 0===t?null:t,oe(o,r,s),i.write(o).catch((()=>w.error("Sending response failed.")))}function r(t,r,s){const n={jsonrpc:T,id:e.id,error:t.toJson()};oe(n,r,s),i.write(n).catch((()=>w.error("Sending response failed.")))}!function(e){if(W!==f.Off&&I)if(j===g.Text){let t;W!==f.Verbose&&W!==f.Compact||!e.params||(t=`Params: ${ne(e.params)}\n\n`),I.log(`Received request '${e.method} - (${e.id})'.`,t)}else le("receive-request",e)}(e);const o=A.get(e.method);let a,l;o&&(a=o.type,l=o.handler);const c=Date.now();if(l||M){const o=e.id??String(Date.now()),h=b.is(J.receiver)?J.receiver.createCancellationTokenSource(o):J.receiver.createCancellationTokenSource(e);null!==e.id&&H.has(e.id)&&h.cancel(),null!==e.id&&F.set(o,h);try{let u;if(l)if(void 0===e.params){if(void 0!==a&&0!==a.numberOfParams)return void r(new n.ResponseError(n.ErrorCodes.InvalidParams,`Request ${e.method} defines ${a.numberOfParams} params but received none.`),e.method,c);u=l(h.token)}else if(Array.isArray(e.params)){if(void 0!==a&&a.parameterStructures===n.ParameterStructures.byName)return void r(new n.ResponseError(n.ErrorCodes.InvalidParams,`Request ${e.method} defines parameters by name but received parameters by position`),e.method,c);u=l(...e.params,h.token)}else{if(void 0!==a&&a.parameterStructures===n.ParameterStructures.byPosition)return void r(new n.ResponseError(n.ErrorCodes.InvalidParams,`Request ${e.method} defines parameters by position but received parameters by name`),e.method,c);u=l(e.params,h.token)}else M&&(u=M(e.method,e.params,h.token));const d=u;u?d.then?d.then((i=>{F.delete(o),t(i,e.method,c)}),(t=>{F.delete(o),t instanceof n.ResponseError?r(t,e.method,c):t&&s.string(t.message)?r(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${t.message}`),e.method,c):r(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,c)})):(F.delete(o),t(u,e.method,c)):(F.delete(o),function(t,r,s){void 0===t&&(t=null);const n={jsonrpc:T,id:e.id,result:t};oe(n,r,s),i.write(n).catch((()=>w.error("Sending response failed.")))}(u,e.method,c))}catch(i){F.delete(o),i instanceof n.ResponseError?t(i,e.method,c):i&&s.string(i.message)?r(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${i.message}`),e.method,c):r(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,c)}}else r(new n.ResponseError(n.ErrorCodes.MethodNotFound,`Unhandled method ${e.method}`),e.method,c)}(e):n.Message.isNotification(e)?function(e){if(ee())return;let t,i;if(e.method===c.type.method){const t=e.params.id;return H.delete(t),void ae(e)}{const r=L.get(e.method);r&&(i=r.handler,t=r.type)}if(i||O)try{if(ae(e),i)if(void 0===e.params)void 0!==t&&0!==t.numberOfParams&&t.parameterStructures!==n.ParameterStructures.byName&&w.error(`Notification ${e.method} defines ${t.numberOfParams} params but received none.`),i();else if(Array.isArray(e.params)){const r=e.params;e.method===u.type.method&&2===r.length&&h.is(r[0])?i({token:r[0],value:r[1]}):(void 0!==t&&(t.parameterStructures===n.ParameterStructures.byName&&w.error(`Notification ${e.method} defines parameters by name but received parameters by position`),t.numberOfParams!==e.params.length&&w.error(`Notification ${e.method} defines ${t.numberOfParams} params but received ${r.length} arguments`)),i(...r))}else void 0!==t&&t.parameterStructures===n.ParameterStructures.byPosition&&w.error(`Notification ${e.method} defines parameters by position but received parameters by name`),i(e.params);else O&&O(e.method,e.params)}catch(t){t.message?w.error(`Notification handler '${e.method}' failed with message: ${t.message}`):w.error(`Notification handler '${e.method}' failed unexpectedly.`)}else V.fire(e)}(e):n.Message.isResponse(e)?function(e){if(!ee())if(null===e.id)e.error?w.error(`Received response message without id: Error is: \n${JSON.stringify(e.error,void 0,4)}`):w.error("Received response message without id. No further error information provided.");else{const t=e.id,i=q.get(t);if(function(e,t){if(W!==f.Off&&I)if(j===g.Text){let i;if(W!==f.Verbose&&W!==f.Compact||(e.error&&e.error.data?i=`Error data: ${ne(e.error.data)}\n\n`:e.result?i=`Result: ${ne(e.result)}\n\n`:void 0===e.error&&(i="No result returned.\n\n")),t){const r=e.error?` Request failed: ${e.error.message} (${e.error.code}).`:"";I.log(`Received response '${t.method} - (${e.id})' in ${Date.now()-t.timerStart}ms.${r}`,i)}else I.log(`Received response ${e.id} without active response promise.`,i)}else le("receive-response",e)}(e,i),void 0!==i){q.delete(t);try{if(e.error){const t=e.error;i.reject(new n.ResponseError(t.code,t.message,t.data))}else{if(void 0===e.result)throw new Error("Should never happen.");i.resolve(e.result)}}catch(e){e.message?w.error(`Response handler '${i.method}' failed with message: ${e.message}`):w.error(`Response handler '${i.method}' failed unexpectedly.`)}}}}(e):function(e){if(!e)return void w.error("Received empty message.");w.error(`Received message which is neither a response nor a notification message:\n${JSON.stringify(e,null,4)}`);const t=e;if(s.string(t.id)||s.number(t.id)){const e=t.id,i=q.get(e);i&&i.reject(new Error("The received response has neither a result nor an error property."))}}(e)}e.onClose(te),e.onError((function(e){z.fire([e,void 0,void 0])})),i.onClose(te),i.onError((function(e){z.fire(e)}));const se=e=>{try{if(n.Message.isNotification(e)&&e.method===c.type.method){const t=e.params.id,r=X(t),s=N.get(r);if(n.Message.isRequest(s)){const n=y?.connectionStrategy,o=n&&n.cancelUndispatched?n.cancelUndispatched(s,Y):void 0;if(o&&(void 0!==o.error||void 0!==o.result))return N.delete(r),F.delete(t),o.id=s.id,oe(o,e.method,Date.now()),void i.write(o).catch((()=>w.error("Sending response for canceled message failed.")))}const o=F.get(t);if(void 0!==o)return o.cancel(),void ae(e);H.add(t)}!function(e,t){var i;n.Message.isRequest(t)?e.set(X(t.id),t):n.Message.isResponse(t)?e.set(null===(i=t.id)?"res-unknown-"+(++R).toString():"res-"+i.toString(),t):e.set("not-"+(++C).toString(),t)}(N,e)}finally{ie()}};function ne(e){if(null!=e)switch(W){case f.Verbose:return JSON.stringify(e,null,4);case f.Compact:return JSON.stringify(e);default:return}}function oe(e,t,i){if(W!==f.Off&&I)if(j===g.Text){let r;W!==f.Verbose&&W!==f.Compact||(e.error&&e.error.data?r=`Error data: ${ne(e.error.data)}\n\n`:e.result?r=`Result: ${ne(e.result)}\n\n`:void 0===e.error&&(r="No result returned.\n\n")),I.log(`Sending response '${t} - (${e.id})'. Processing request took ${Date.now()-i}ms`,r)}else le("send-response",e)}function ae(e){if(W!==f.Off&&I&&e.method!==v.type.method)if(j===g.Text){let t;W!==f.Verbose&&W!==f.Compact||(t=e.params?`Params: ${ne(e.params)}\n\n`:"No parameters provided.\n\n"),I.log(`Received notification '${e.method}'.`,t)}else le("receive-notification",e)}function le(e,t){if(!I||W===f.Off)return;const i={isLSPMessage:!0,type:e,message:t,timestamp:Date.now()};I.log(i)}function ce(){if(Q())throw new D(_.Closed,"Connection is closed.");if(ee())throw new D(_.Disposed,"Connection is disposed.")}function he(e){return void 0===e?null:e}function ue(e){return null===e?void 0:e}function de(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function fe(e,t){switch(e){case n.ParameterStructures.auto:return de(t)?ue(t):[he(t)];case n.ParameterStructures.byName:if(!de(t))throw new Error("Received parameters by name but param is not an object literal.");return ue(t);case n.ParameterStructures.byPosition:return[he(t)];default:throw new Error(`Unknown parameter structure ${e.toString()}`)}}function pe(e,t){let i;const r=e.numberOfParams;switch(r){case 0:i=void 0;break;case 1:i=fe(e.parameterStructures,t[0]);break;default:i=[];for(let e=0;e<t.length&&e<r;e++)i.push(he(t[e]));if(t.length<r)for(let e=t.length;e<r;e++)i.push(null)}return i}const ge={sendNotification:(e,...t)=>{let r,o;if(ce(),s.string(e)){r=e;const i=t[0];let s=0,a=n.ParameterStructures.auto;n.ParameterStructures.is(i)&&(s=1,a=i);let l=t.length;const c=l-s;switch(c){case 0:o=void 0;break;case 1:o=fe(a,t[s]);break;default:if(a===n.ParameterStructures.byName)throw new Error(`Received ${c} parameters for 'by Name' notification parameter structure.`);o=t.slice(s,l).map((e=>he(e)))}}else{const i=t;r=e.method,o=pe(e,i)}const a={jsonrpc:T,method:r,params:o};return function(e){if(W!==f.Off&&I)if(j===g.Text){let t;W!==f.Verbose&&W!==f.Compact||(t=e.params?`Params: ${ne(e.params)}\n\n`:"No parameters provided.\n\n"),I.log(`Sending notification '${e.method}'.`,t)}else le("send-notification",e)}(a),i.write(a).catch((e=>{throw w.error("Sending notification failed."),e}))},onNotification:(e,t)=>{let i;return ce(),s.func(e)?O=e:t&&(s.string(e)?(i=e,L.set(e,{type:void 0,handler:t})):(i=e.method,L.set(e.method,{type:e,handler:t}))),{dispose:()=>{void 0!==i?L.delete(i):O=void 0}}},onProgress:(e,t,i)=>{if(P.has(t))throw new Error(`Progress handler for token ${t} already registered`);return P.set(t,i),{dispose:()=>{P.delete(t)}}},sendProgress:(e,t,i)=>ge.sendNotification(u.type,{token:t,value:i}),onUnhandledProgress:K.event,sendRequest:(e,...t)=>{let r,o,a;if(ce(),function(){if(!Z())throw new Error("Call listen() first.")}(),s.string(e)){r=e;const i=t[0],s=t[t.length-1];let c=0,h=n.ParameterStructures.auto;n.ParameterStructures.is(i)&&(c=1,h=i);let u=t.length;l.CancellationToken.is(s)&&(u-=1,a=s);const d=u-c;switch(d){case 0:o=void 0;break;case 1:o=fe(h,t[c]);break;default:if(h===n.ParameterStructures.byName)throw new Error(`Received ${d} parameters for 'by Name' request parameter structure.`);o=t.slice(c,u).map((e=>he(e)))}}else{const i=t;r=e.method,o=pe(e,i);const s=e.numberOfParams;a=l.CancellationToken.is(i[s])?i[s]:void 0}const c=S++;let h;a&&(h=a.onCancellationRequested((()=>{const e=J.sender.sendCancellation(ge,c);return void 0===e?(w.log(`Received no promise from cancellation strategy when cancelling id ${c}`),Promise.resolve()):e.catch((()=>{w.log(`Sending cancellation messages for id ${c} failed`)}))})));const u={jsonrpc:T,id:c,method:r,params:o};return function(e){if(W!==f.Off&&I)if(j===g.Text){let t;W!==f.Verbose&&W!==f.Compact||!e.params||(t=`Params: ${ne(e.params)}\n\n`),I.log(`Sending request '${e.method} - (${e.id})'.`,t)}else le("send-request",e)}(u),"function"==typeof J.sender.enableCancellation&&J.sender.enableCancellation(u),new Promise((async(e,t)=>{const s={method:r,timerStart:Date.now(),resolve:t=>{e(t),J.sender.cleanup(c),h?.dispose()},reject:e=>{t(e),J.sender.cleanup(c),h?.dispose()}};try{await i.write(u),q.set(c,s)}catch(e){throw w.error("Sending request failed."),s.reject(new n.ResponseError(n.ErrorCodes.MessageWriteError,e.message?e.message:"Unknown reason")),e}}))},onRequest:(e,t)=>{ce();let i=null;return d.is(e)?(i=void 0,M=e):s.string(e)?(i=null,void 0!==t&&(i=e,A.set(e,{handler:t,type:void 0}))):void 0!==t&&(i=e.method,A.set(e.method,{type:e,handler:t})),{dispose:()=>{null!==i&&(void 0!==i?A.delete(i):M=void 0)}}},hasPendingResponse:()=>q.size>0,trace:async(e,t,i)=>{let r=!1,n=g.Text;void 0!==i&&(s.boolean(i)?r=i:(r=i.sendNotification||!1,n=i.traceFormat||g.Text)),W=e,j=n,I=W===f.Off?void 0:t,!r||Q()||ee()||await ge.sendNotification(m.type,{value:f.toString(e)})},onError:z.event,onClose:U.event,onUnhandledNotification:V.event,onDispose:G.event,end:()=>{i.end()},dispose:()=>{if(ee())return;$=E.Disposed,G.fire(void 0);const t=new n.ResponseError(n.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(const e of q.values())e.reject(t);q=new Map,F=new Map,H=new Set,N=new o.LinkedMap,s.func(i.dispose)&&i.dispose(),s.func(e.dispose)&&e.dispose()},listen:()=>{ce(),function(){if(Z())throw new D(_.AlreadyListening,"Connection is already listening")}(),$=E.Listening,e.listen(se)},inspect:()=>{(0,r.default)().console.log("inspect")}};return ge.onNotification(v.type,(e=>{if(W===f.Off||!I)return;const t=W===f.Verbose||W===f.Compact;I.log(e.message,t?e.verbose:void 0)})),ge.onNotification(u.type,(e=>{const t=P.get(e.token);t?t(e.value):K.fire(e)})),ge}},645:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeHierarchySubtypesRequest=t.TypeHierarchySupertypesRequest=t.TypeHierarchyPrepareRequest=void 0;const r=i(372);var s,n,o;!function(e){e.method="textDocument/prepareTypeHierarchy",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.TypeHierarchyPrepareRequest=s={})),function(e){e.method="typeHierarchy/supertypes",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(n||(t.TypeHierarchySupertypesRequest=n={})),function(e){e.method="typeHierarchy/subtypes",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(o||(t.TypeHierarchySubtypesRequest=o={}))},908:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShowDocumentRequest=void 0;const r=i(372);var s;!function(e){e.method="window/showDocument",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType(e.method)}(s||(t.ShowDocumentRequest=s={}))},1560:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceSymbolRequest=t.CodeActionResolveRequest=t.CodeActionRequest=t.DocumentSymbolRequest=t.DocumentHighlightRequest=t.ReferencesRequest=t.DefinitionRequest=t.SignatureHelpRequest=t.SignatureHelpTriggerKind=t.HoverRequest=t.CompletionResolveRequest=t.CompletionRequest=t.CompletionTriggerKind=t.PublishDiagnosticsNotification=t.WatchKind=t.RelativePattern=t.FileChangeType=t.DidChangeWatchedFilesNotification=t.WillSaveTextDocumentWaitUntilRequest=t.WillSaveTextDocumentNotification=t.TextDocumentSaveReason=t.DidSaveTextDocumentNotification=t.DidCloseTextDocumentNotification=t.DidChangeTextDocumentNotification=t.TextDocumentContentChangeEvent=t.DidOpenTextDocumentNotification=t.TextDocumentSyncKind=t.TelemetryEventNotification=t.LogMessageNotification=t.ShowMessageRequest=t.ShowMessageNotification=t.MessageType=t.DidChangeConfigurationNotification=t.ExitNotification=t.ShutdownRequest=t.InitializedNotification=t.InitializeErrorCodes=t.InitializeRequest=t.WorkDoneProgressOptions=t.TextDocumentRegistrationOptions=t.StaticRegistrationOptions=t.PositionEncodingKind=t.FailureHandlingKind=t.ResourceOperationKind=t.UnregistrationRequest=t.RegistrationRequest=t.DocumentSelector=t.NotebookCellTextDocumentFilter=t.NotebookDocumentFilter=t.TextDocumentFilter=void 0,t.MonikerRequest=t.MonikerKind=t.UniquenessLevel=t.WillDeleteFilesRequest=t.DidDeleteFilesNotification=t.WillRenameFilesRequest=t.DidRenameFilesNotification=t.WillCreateFilesRequest=t.DidCreateFilesNotification=t.FileOperationPatternKind=t.LinkedEditingRangeRequest=t.ShowDocumentRequest=t.SemanticTokensRegistrationType=t.SemanticTokensRefreshRequest=t.SemanticTokensRangeRequest=t.SemanticTokensDeltaRequest=t.SemanticTokensRequest=t.TokenFormat=t.CallHierarchyPrepareRequest=t.CallHierarchyOutgoingCallsRequest=t.CallHierarchyIncomingCallsRequest=t.WorkDoneProgressCancelNotification=t.WorkDoneProgressCreateRequest=t.WorkDoneProgress=t.SelectionRangeRequest=t.DeclarationRequest=t.FoldingRangeRefreshRequest=t.FoldingRangeRequest=t.ColorPresentationRequest=t.DocumentColorRequest=t.ConfigurationRequest=t.DidChangeWorkspaceFoldersNotification=t.WorkspaceFoldersRequest=t.TypeDefinitionRequest=t.ImplementationRequest=t.ApplyWorkspaceEditRequest=t.ExecuteCommandRequest=t.PrepareRenameRequest=t.RenameRequest=t.PrepareSupportDefaultBehavior=t.DocumentOnTypeFormattingRequest=t.DocumentRangesFormattingRequest=t.DocumentRangeFormattingRequest=t.DocumentFormattingRequest=t.DocumentLinkResolveRequest=t.DocumentLinkRequest=t.CodeLensRefreshRequest=t.CodeLensResolveRequest=t.CodeLensRequest=t.WorkspaceSymbolResolveRequest=void 0,t.InlineCompletionRequest=t.DidCloseNotebookDocumentNotification=t.DidSaveNotebookDocumentNotification=t.DidChangeNotebookDocumentNotification=t.NotebookCellArrayChange=t.DidOpenNotebookDocumentNotification=t.NotebookDocumentSyncRegistrationType=t.NotebookDocument=t.NotebookCell=t.ExecutionSummary=t.NotebookCellKind=t.DiagnosticRefreshRequest=t.WorkspaceDiagnosticRequest=t.DocumentDiagnosticRequest=t.DocumentDiagnosticReportKind=t.DiagnosticServerCancellationData=t.InlayHintRefreshRequest=t.InlayHintResolveRequest=t.InlayHintRequest=t.InlineValueRefreshRequest=t.InlineValueRequest=t.TypeHierarchySupertypesRequest=t.TypeHierarchySubtypesRequest=t.TypeHierarchyPrepareRequest=void 0;const r=i(372),s=i(6203),n=i(8598),o=i(9574);Object.defineProperty(t,"ImplementationRequest",{enumerable:!0,get:function(){return o.ImplementationRequest}});const a=i(8461);Object.defineProperty(t,"TypeDefinitionRequest",{enumerable:!0,get:function(){return a.TypeDefinitionRequest}});const l=i(9935);Object.defineProperty(t,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return l.WorkspaceFoldersRequest}}),Object.defineProperty(t,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return l.DidChangeWorkspaceFoldersNotification}});const c=i(1660);Object.defineProperty(t,"ConfigurationRequest",{enumerable:!0,get:function(){return c.ConfigurationRequest}});const h=i(7672);Object.defineProperty(t,"DocumentColorRequest",{enumerable:!0,get:function(){return h.DocumentColorRequest}}),Object.defineProperty(t,"ColorPresentationRequest",{enumerable:!0,get:function(){return h.ColorPresentationRequest}});const u=i(2874);Object.defineProperty(t,"FoldingRangeRequest",{enumerable:!0,get:function(){return u.FoldingRangeRequest}}),Object.defineProperty(t,"FoldingRangeRefreshRequest",{enumerable:!0,get:function(){return u.FoldingRangeRefreshRequest}});const d=i(6914);Object.defineProperty(t,"DeclarationRequest",{enumerable:!0,get:function(){return d.DeclarationRequest}});const f=i(3487);Object.defineProperty(t,"SelectionRangeRequest",{enumerable:!0,get:function(){return f.SelectionRangeRequest}});const p=i(2687);Object.defineProperty(t,"WorkDoneProgress",{enumerable:!0,get:function(){return p.WorkDoneProgress}}),Object.defineProperty(t,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return p.WorkDoneProgressCreateRequest}}),Object.defineProperty(t,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return p.WorkDoneProgressCancelNotification}});const g=i(8765);Object.defineProperty(t,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return g.CallHierarchyIncomingCallsRequest}}),Object.defineProperty(t,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return g.CallHierarchyOutgoingCallsRequest}}),Object.defineProperty(t,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return g.CallHierarchyPrepareRequest}});const m=i(2478);Object.defineProperty(t,"TokenFormat",{enumerable:!0,get:function(){return m.TokenFormat}}),Object.defineProperty(t,"SemanticTokensRequest",{enumerable:!0,get:function(){return m.SemanticTokensRequest}}),Object.defineProperty(t,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return m.SemanticTokensDeltaRequest}}),Object.defineProperty(t,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return m.SemanticTokensRangeRequest}}),Object.defineProperty(t,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return m.SemanticTokensRefreshRequest}}),Object.defineProperty(t,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return m.SemanticTokensRegistrationType}});const v=i(908);Object.defineProperty(t,"ShowDocumentRequest",{enumerable:!0,get:function(){return v.ShowDocumentRequest}});const _=i(5316);Object.defineProperty(t,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return _.LinkedEditingRangeRequest}});const y=i(9840);Object.defineProperty(t,"FileOperationPatternKind",{enumerable:!0,get:function(){return y.FileOperationPatternKind}}),Object.defineProperty(t,"DidCreateFilesNotification",{enumerable:!0,get:function(){return y.DidCreateFilesNotification}}),Object.defineProperty(t,"WillCreateFilesRequest",{enumerable:!0,get:function(){return y.WillCreateFilesRequest}}),Object.defineProperty(t,"DidRenameFilesNotification",{enumerable:!0,get:function(){return y.DidRenameFilesNotification}}),Object.defineProperty(t,"WillRenameFilesRequest",{enumerable:!0,get:function(){return y.WillRenameFilesRequest}}),Object.defineProperty(t,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return y.DidDeleteFilesNotification}}),Object.defineProperty(t,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return y.WillDeleteFilesRequest}});const b=i(9047);Object.defineProperty(t,"UniquenessLevel",{enumerable:!0,get:function(){return b.UniquenessLevel}}),Object.defineProperty(t,"MonikerKind",{enumerable:!0,get:function(){return b.MonikerKind}}),Object.defineProperty(t,"MonikerRequest",{enumerable:!0,get:function(){return b.MonikerRequest}});const w=i(645);Object.defineProperty(t,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return w.TypeHierarchyPrepareRequest}}),Object.defineProperty(t,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return w.TypeHierarchySubtypesRequest}}),Object.defineProperty(t,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return w.TypeHierarchySupertypesRequest}});const S=i(3124);Object.defineProperty(t,"InlineValueRequest",{enumerable:!0,get:function(){return S.InlineValueRequest}}),Object.defineProperty(t,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return S.InlineValueRefreshRequest}});const C=i(7752);Object.defineProperty(t,"InlayHintRequest",{enumerable:!0,get:function(){return C.InlayHintRequest}}),Object.defineProperty(t,"InlayHintResolveRequest",{enumerable:!0,get:function(){return C.InlayHintResolveRequest}}),Object.defineProperty(t,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return C.InlayHintRefreshRequest}});const k=i(6011);Object.defineProperty(t,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return k.DiagnosticServerCancellationData}}),Object.defineProperty(t,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return k.DocumentDiagnosticReportKind}}),Object.defineProperty(t,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return k.DocumentDiagnosticRequest}}),Object.defineProperty(t,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return k.WorkspaceDiagnosticRequest}}),Object.defineProperty(t,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return k.DiagnosticRefreshRequest}});const x=i(3557);Object.defineProperty(t,"NotebookCellKind",{enumerable:!0,get:function(){return x.NotebookCellKind}}),Object.defineProperty(t,"ExecutionSummary",{enumerable:!0,get:function(){return x.ExecutionSummary}}),Object.defineProperty(t,"NotebookCell",{enumerable:!0,get:function(){return x.NotebookCell}}),Object.defineProperty(t,"NotebookDocument",{enumerable:!0,get:function(){return x.NotebookDocument}}),Object.defineProperty(t,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return x.NotebookDocumentSyncRegistrationType}}),Object.defineProperty(t,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return x.DidOpenNotebookDocumentNotification}}),Object.defineProperty(t,"NotebookCellArrayChange",{enumerable:!0,get:function(){return x.NotebookCellArrayChange}}),Object.defineProperty(t,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return x.DidChangeNotebookDocumentNotification}}),Object.defineProperty(t,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return x.DidSaveNotebookDocumentNotification}}),Object.defineProperty(t,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return x.DidCloseNotebookDocumentNotification}});const R=i(3307);var E,D,T,M,A,O,L,P,B,I,N,q,H,F,W,j,$,z,U,V,K,G,J,X,Y,Z,Q,ee,te,ie,re,se,ne,oe,ae,le,ce,he,ue,de,fe,pe,ge,me,ve,_e,ye,be,we,Se,Ce,ke,xe,Re,Ee,De,Te,Me,Ae,Oe,Le,Pe,Be,Ie,Ne;Object.defineProperty(t,"InlineCompletionRequest",{enumerable:!0,get:function(){return R.InlineCompletionRequest}}),function(e){e.is=function(e){const t=e;return n.string(t)||n.string(t.language)||n.string(t.scheme)||n.string(t.pattern)}}(E||(t.TextDocumentFilter=E={})),function(e){e.is=function(e){const t=e;return n.objectLiteral(t)&&(n.string(t.notebookType)||n.string(t.scheme)||n.string(t.pattern))}}(D||(t.NotebookDocumentFilter=D={})),function(e){e.is=function(e){const t=e;return n.objectLiteral(t)&&(n.string(t.notebook)||D.is(t.notebook))&&(void 0===t.language||n.string(t.language))}}(T||(t.NotebookCellTextDocumentFilter=T={})),function(e){e.is=function(e){if(!Array.isArray(e))return!1;for(let t of e)if(!n.string(t)&&!E.is(t)&&!T.is(t))return!1;return!0}}(M||(t.DocumentSelector=M={})),function(e){e.method="client/registerCapability",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType(e.method)}(A||(t.RegistrationRequest=A={})),function(e){e.method="client/unregisterCapability",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType(e.method)}(O||(t.UnregistrationRequest=O={})),function(e){e.Create="create",e.Rename="rename",e.Delete="delete"}(L||(t.ResourceOperationKind=L={})),function(e){e.Abort="abort",e.Transactional="transactional",e.TextOnlyTransactional="textOnlyTransactional",e.Undo="undo"}(P||(t.FailureHandlingKind=P={})),function(e){e.UTF8="utf-8",e.UTF16="utf-16",e.UTF32="utf-32"}(B||(t.PositionEncodingKind=B={})),function(e){e.hasId=function(e){const t=e;return t&&n.string(t.id)&&t.id.length>0}}(I||(t.StaticRegistrationOptions=I={})),function(e){e.is=function(e){const t=e;return t&&(null===t.documentSelector||M.is(t.documentSelector))}}(N||(t.TextDocumentRegistrationOptions=N={})),function(e){e.is=function(e){const t=e;return n.objectLiteral(t)&&(void 0===t.workDoneProgress||n.boolean(t.workDoneProgress))},e.hasWorkDoneProgress=function(e){const t=e;return t&&n.boolean(t.workDoneProgress)}}(q||(t.WorkDoneProgressOptions=q={})),function(e){e.method="initialize",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(H||(t.InitializeRequest=H={})),function(e){e.unknownProtocolVersion=1}(F||(t.InitializeErrorCodes=F={})),function(e){e.method="initialized",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(W||(t.InitializedNotification=W={})),function(e){e.method="shutdown",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType0(e.method)}(j||(t.ShutdownRequest=j={})),function(e){e.method="exit",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType0(e.method)}($||(t.ExitNotification=$={})),function(e){e.method="workspace/didChangeConfiguration",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(z||(t.DidChangeConfigurationNotification=z={})),function(e){e.Error=1,e.Warning=2,e.Info=3,e.Log=4,e.Debug=5}(U||(t.MessageType=U={})),function(e){e.method="window/showMessage",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolNotificationType(e.method)}(V||(t.ShowMessageNotification=V={})),function(e){e.method="window/showMessageRequest",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType(e.method)}(K||(t.ShowMessageRequest=K={})),function(e){e.method="window/logMessage",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolNotificationType(e.method)}(G||(t.LogMessageNotification=G={})),function(e){e.method="telemetry/event",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolNotificationType(e.method)}(J||(t.TelemetryEventNotification=J={})),function(e){e.None=0,e.Full=1,e.Incremental=2}(X||(t.TextDocumentSyncKind=X={})),function(e){e.method="textDocument/didOpen",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(Y||(t.DidOpenTextDocumentNotification=Y={})),function(e){e.isIncremental=function(e){let t=e;return null!=t&&"string"==typeof t.text&&void 0!==t.range&&(void 0===t.rangeLength||"number"==typeof t.rangeLength)},e.isFull=function(e){let t=e;return null!=t&&"string"==typeof t.text&&void 0===t.range&&void 0===t.rangeLength}}(Z||(t.TextDocumentContentChangeEvent=Z={})),function(e){e.method="textDocument/didChange",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(Q||(t.DidChangeTextDocumentNotification=Q={})),function(e){e.method="textDocument/didClose",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(ee||(t.DidCloseTextDocumentNotification=ee={})),function(e){e.method="textDocument/didSave",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(te||(t.DidSaveTextDocumentNotification=te={})),function(e){e.Manual=1,e.AfterDelay=2,e.FocusOut=3}(ie||(t.TextDocumentSaveReason=ie={})),function(e){e.method="textDocument/willSave",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(re||(t.WillSaveTextDocumentNotification=re={})),function(e){e.method="textDocument/willSaveWaitUntil",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(se||(t.WillSaveTextDocumentWaitUntilRequest=se={})),function(e){e.method="workspace/didChangeWatchedFiles",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(ne||(t.DidChangeWatchedFilesNotification=ne={})),function(e){e.Created=1,e.Changed=2,e.Deleted=3}(oe||(t.FileChangeType=oe={})),function(e){e.is=function(e){const t=e;return n.objectLiteral(t)&&(s.URI.is(t.baseUri)||s.WorkspaceFolder.is(t.baseUri))&&n.string(t.pattern)}}(ae||(t.RelativePattern=ae={})),function(e){e.Create=1,e.Change=2,e.Delete=4}(le||(t.WatchKind=le={})),function(e){e.method="textDocument/publishDiagnostics",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolNotificationType(e.method)}(ce||(t.PublishDiagnosticsNotification=ce={})),function(e){e.Invoked=1,e.TriggerCharacter=2,e.TriggerForIncompleteCompletions=3}(he||(t.CompletionTriggerKind=he={})),function(e){e.method="textDocument/completion",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(ue||(t.CompletionRequest=ue={})),function(e){e.method="completionItem/resolve",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(de||(t.CompletionResolveRequest=de={})),function(e){e.method="textDocument/hover",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(fe||(t.HoverRequest=fe={})),function(e){e.Invoked=1,e.TriggerCharacter=2,e.ContentChange=3}(pe||(t.SignatureHelpTriggerKind=pe={})),function(e){e.method="textDocument/signatureHelp",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(ge||(t.SignatureHelpRequest=ge={})),function(e){e.method="textDocument/definition",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(me||(t.DefinitionRequest=me={})),function(e){e.method="textDocument/references",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(ve||(t.ReferencesRequest=ve={})),function(e){e.method="textDocument/documentHighlight",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(_e||(t.DocumentHighlightRequest=_e={})),function(e){e.method="textDocument/documentSymbol",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(ye||(t.DocumentSymbolRequest=ye={})),function(e){e.method="textDocument/codeAction",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(be||(t.CodeActionRequest=be={})),function(e){e.method="codeAction/resolve",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(we||(t.CodeActionResolveRequest=we={})),function(e){e.method="workspace/symbol",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Se||(t.WorkspaceSymbolRequest=Se={})),function(e){e.method="workspaceSymbol/resolve",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Ce||(t.WorkspaceSymbolResolveRequest=Ce={})),function(e){e.method="textDocument/codeLens",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(ke||(t.CodeLensRequest=ke={})),function(e){e.method="codeLens/resolve",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(xe||(t.CodeLensResolveRequest=xe={})),function(e){e.method="workspace/codeLens/refresh",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType0(e.method)}(Re||(t.CodeLensRefreshRequest=Re={})),function(e){e.method="textDocument/documentLink",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Ee||(t.DocumentLinkRequest=Ee={})),function(e){e.method="documentLink/resolve",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(De||(t.DocumentLinkResolveRequest=De={})),function(e){e.method="textDocument/formatting",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Te||(t.DocumentFormattingRequest=Te={})),function(e){e.method="textDocument/rangeFormatting",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Me||(t.DocumentRangeFormattingRequest=Me={})),function(e){e.method="textDocument/rangesFormatting",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Ae||(t.DocumentRangesFormattingRequest=Ae={})),function(e){e.method="textDocument/onTypeFormatting",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Oe||(t.DocumentOnTypeFormattingRequest=Oe={})),function(e){e.Identifier=1}(Le||(t.PrepareSupportDefaultBehavior=Le={})),function(e){e.method="textDocument/rename",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Pe||(t.RenameRequest=Pe={})),function(e){e.method="textDocument/prepareRename",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Be||(t.PrepareRenameRequest=Be={})),function(e){e.method="workspace/executeCommand",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(Ie||(t.ExecuteCommandRequest=Ie={})),function(e){e.method="workspace/applyEdit",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType("workspace/applyEdit")}(Ne||(t.ApplyWorkspaceEditRequest=Ne={}))},1580:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createProtocolConnection=void 0;const r=i(6439);t.createProtocolConnection=function(e,t,i,s){return r.ConnectionStrategy.is(s)&&(s={connectionStrategy:s}),(0,r.createMessageConnection)(e,t,i,s)}},1660:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationRequest=void 0;const r=i(372);var s;!function(e){e.method="workspace/configuration",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType(e.method)}(s||(t.ConfigurationRequest=s={}))},1832:e=>{var t;self,t=()=>(()=>{"use strict";var e={6:(e,t)=>{function i(e){try{const t=new URL(e),i=t.password&&t.username?`${t.protocol}//${t.username}:${t.password}@${t.host}`:t.username?`${t.protocol}//${t.username}@${t.host}`:`${t.protocol}//${t.host}`;return e.toLocaleLowerCase().startsWith(i.toLocaleLowerCase())}catch(e){return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.LinkComputer=t.WebLinkProvider=void 0,t.WebLinkProvider=class{constructor(e,t,i,r={}){this._terminal=e,this._regex=t,this._handler=i,this._options=r}provideLinks(e,t){const i=r.computeLink(e,this._regex,this._terminal,this._handler);t(this._addCallbacks(i))}_addCallbacks(e){return e.map((e=>(e.leave=this._options.leave,e.hover=(t,i)=>{if(this._options.hover){const{range:r}=e;this._options.hover(t,i,r)}},e)))}};class r{static computeLink(e,t,s,n){const o=new RegExp(t.source,(t.flags||"")+"g"),[a,l]=r._getWindowedLineStrings(e-1,s),c=a.join("");let h;const u=[];for(;h=o.exec(c);){const e=h[0];if(!i(e))continue;const[t,o]=r._mapStrIdx(s,l,0,h.index),[a,c]=r._mapStrIdx(s,t,o,e.length);if(-1===t||-1===o||-1===a||-1===c)continue;const d={start:{x:o+1,y:t+1},end:{x:c,y:a+1}};u.push({range:d,text:e,activate:n})}return u}static _getWindowedLineStrings(e,t){let i,r=e,s=e,n=0,o="";const a=[];if(i=t.buffer.active.getLine(e)){const e=i.translateToString(!0);if(i.isWrapped&&" "!==e[0]){for(n=0;(i=t.buffer.active.getLine(--r))&&n<2048&&(o=i.translateToString(!0),n+=o.length,a.push(o),i.isWrapped&&-1===o.indexOf(" ")););a.reverse()}for(a.push(e),n=0;(i=t.buffer.active.getLine(++s))&&i.isWrapped&&n<2048&&(o=i.translateToString(!0),n+=o.length,a.push(o),-1===o.indexOf(" ")););}return[a,r]}static _mapStrIdx(e,t,i,r){const s=e.buffer.active,n=s.getNullCell();let o=i;for(;r;){const e=s.getLine(t);if(!e)return[-1,-1];for(let i=o;i<e.length;++i){e.getCell(i,n);const o=n.getChars();if(n.getWidth()&&(r-=o.length||1,i===e.length-1&&""===o)){const e=s.getLine(t+1);e&&e.isWrapped&&(e.getCell(0,n),2===n.getWidth()&&(r+=1))}if(r<0)return[t,i]}t++,o=0}return[t,o]}}t.LinkComputer=r}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}var r={};return(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.WebLinksAddon=void 0;const t=i(6),s=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function n(e,t){const i=window.open();if(i){try{i.opener=null}catch{}i.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}e.WebLinksAddon=class{constructor(e=n,t={}){this._handler=e,this._options=t}activate(e){this._terminal=e;const i=this._options,r=i.urlRegex||s;this._linkProvider=this._terminal.registerLinkProvider(new t.WebLinkProvider(this._terminal,r,this._handler,i))}dispose(){this._linkProvider?.dispose()}}})(),r})(),e.exports=t()},1917:function(e,t){"use strict";var i=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var i,r,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.requestManager=e}return e.prototype.startBatch=function(){return this.requestManager.startBatch()},e.prototype.stopBatch=function(){return this.requestManager.stopBatch()},e.prototype.request=function(e,t){return i(this,void 0,void 0,(function(){return r(this,(function(i){switch(i.label){case 0:return this.requestManager.connectPromise?[4,this.requestManager.connectPromise]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2,this.requestManager.request(e,!1,t)]}}))}))},e.prototype.notify=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return this.requestManager.connectPromise?[4,this.requestManager.connectPromise]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2,this.requestManager.request(e,!0,null)]}}))}))},e.prototype.onNotification=function(e){this.requestManager.requestChannel.addListener("notification",e)},e.prototype.onError=function(e){this.requestManager.requestChannel.addListener("error",e)},e.prototype.close=function(){this.requestManager.close()},e}();t.default=s},1924:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostMessageIframeTransport=t.PostMessageWindowTransport=t.JSONRPCError=t.WebSocketTransport=t.EventEmitterTransport=t.HTTPTransport=t.RequestManager=t.Client=void 0;var s=r(i(9222));t.RequestManager=s.default;var n=r(i(3344));t.EventEmitterTransport=n.default;var o=r(i(2638));t.HTTPTransport=o.default;var a=r(i(6499));t.WebSocketTransport=a.default;var l=r(i(3465));t.PostMessageWindowTransport=l.default;var c=r(i(3933));t.PostMessageIframeTransport=c.default;var h=i(8014);Object.defineProperty(t,"JSONRPCError",{enumerable:!0,get:function(){return h.JSONRPCError}});var u=r(i(1917));t.Client=u.default,t.default=u.default},2478:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SemanticTokensRefreshRequest=t.SemanticTokensRangeRequest=t.SemanticTokensDeltaRequest=t.SemanticTokensRequest=t.SemanticTokensRegistrationType=t.TokenFormat=void 0;const r=i(372);var s,n,o,a,l,c;!function(e){e.Relative="relative"}(s||(t.TokenFormat=s={})),function(e){e.method="textDocument/semanticTokens",e.type=new r.RegistrationType(e.method)}(n||(t.SemanticTokensRegistrationType=n={})),function(e){e.method="textDocument/semanticTokens/full",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method),e.registrationMethod=n.method}(o||(t.SemanticTokensRequest=o={})),function(e){e.method="textDocument/semanticTokens/full/delta",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method),e.registrationMethod=n.method}(a||(t.SemanticTokensDeltaRequest=a={})),function(e){e.method="textDocument/semanticTokens/range",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method),e.registrationMethod=n.method}(l||(t.SemanticTokensRangeRequest=l={})),function(e){e.method="workspace/semanticTokens/refresh",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType0(e.method)}(c||(t.SemanticTokensRefreshRequest=c={}))},2638:function(e,t,i){"use strict";var r,s=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},r(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var i,r,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HTTPTransport=void 0;var l=a(i(328)),c=i(7902),h=i(8297),u=i(8014),d=function(e){function t(i,r){var s=e.call(this)||this;return s.onlyNotifications=function(e){return e instanceof Array?e.every((function(e){return null===e.request.request.id||void 0===e.request.request.id})):null===e.request.id||void 0===e.request.id},s.uri=i,s.credentials=r&&r.credentials,s.headers=t.setupHeaders(r&&r.headers),s.injectedFetcher=null==r?void 0:r.fetcher,s}return s(t,e),t.prototype.connect=function(){return Promise.resolve()},t.prototype.sendData=function(e,t){return void 0===t&&(t=null),n(this,void 0,void 0,(function(){var i,r,s,n,a,c,d,f;return o(this,(function(o){switch(o.label){case 0:i=this.transportRequestManager.addRequest(e,t),r=h.getNotifications(e),s=h.getBatchRequests(e),n=this.injectedFetcher||l.default,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,n(this.uri,{method:"POST",headers:this.headers,body:JSON.stringify(this.parseData(e)),credentials:this.credentials})];case 2:return a=o.sent(),this.transportRequestManager.settlePendingRequest(r),this.onlyNotifications(e)?[2,Promise.resolve()]:[4,a.text()];case 3:return c=o.sent(),(f=this.transportRequestManager.resolveResponse(c))?(this.transportRequestManager.settlePendingRequest(s,f),[2,Promise.reject(f)]):[3,5];case 4:return d=o.sent(),f=new u.JSONRPCError(d.message,u.ERR_UNKNOWN,d),this.transportRequestManager.settlePendingRequest(r,f),this.transportRequestManager.settlePendingRequest(h.getBatchRequests(e),f),[2,Promise.reject(f)];case 5:return[2,i]}}))}))},t.prototype.close=function(){},t.setupHeaders=function(e){var t=new Headers(e);return t.set("Content-Type","application/json"),t},t}(c.Transport);t.HTTPTransport=d,t.default=d},2676:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Emitter=t.Event=void 0;const r=i(9590);var s;!function(e){const t={dispose(){}};e.None=function(){return t}}(s||(t.Event=s={}));class n{add(e,t=null,i){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(i)&&i.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let i=!1;for(let r=0,s=this._callbacks.length;r<s;r++)if(this._callbacks[r]===e){if(this._contexts[r]===t)return this._callbacks.splice(r,1),void this._contexts.splice(r,1);i=!0}if(i)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];const t=[],i=this._callbacks.slice(0),s=this._contexts.slice(0);for(let n=0,o=i.length;n<o;n++)try{t.push(i[n].apply(s[n],e))}catch(e){(0,r.default)().console.error(e)}return t}isEmpty(){return!this._callbacks||0===this._callbacks.length}dispose(){this._callbacks=void 0,this._contexts=void 0}}class o{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,i)=>{this._callbacks||(this._callbacks=new n),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);const r={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),r.dispose=o._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(i)&&i.push(r),r}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}t.Emitter=o,o._noop=function(){}},2687:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkDoneProgressCancelNotification=t.WorkDoneProgressCreateRequest=t.WorkDoneProgress=void 0;const r=i(6439),s=i(372);var n,o,a;!function(e){e.type=new r.ProgressType,e.is=function(t){return t===e.type}}(n||(t.WorkDoneProgress=n={})),function(e){e.method="window/workDoneProgress/create",e.messageDirection=s.MessageDirection.serverToClient,e.type=new s.ProtocolRequestType(e.method)}(o||(t.WorkDoneProgressCreateRequest=o={})),function(e){e.method="window/workDoneProgress/cancel",e.messageDirection=s.MessageDirection.clientToServer,e.type=new s.ProtocolNotificationType(e.method)}(a||(t.WorkDoneProgressCancelNotification=a={}))},2874:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FoldingRangeRefreshRequest=t.FoldingRangeRequest=void 0;const r=i(372);var s,n;!function(e){e.method="textDocument/foldingRange",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.FoldingRangeRequest=s={})),function(e){e.method="workspace/foldingRange/refresh",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType0(e.method)}(n||(t.FoldingRangeRefreshRequest=n={}))},3124:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InlineValueRefreshRequest=t.InlineValueRequest=void 0;const r=i(372);var s,n;!function(e){e.method="textDocument/inlineValue",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.InlineValueRequest=s={})),function(e){e.method="workspace/inlineValue/refresh",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType0(e.method)}(n||(t.InlineValueRefreshRequest=n={}))},3193:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WriteableStreamMessageWriter=t.AbstractMessageWriter=t.MessageWriter=void 0;const r=i(9590),s=i(8585),n=i(4323),o=i(2676);var a,l;!function(e){e.is=function(e){let t=e;return t&&s.func(t.dispose)&&s.func(t.onClose)&&s.func(t.onError)&&s.func(t.write)}}(a||(t.MessageWriter=a={}));class c{constructor(){this.errorEmitter=new o.Emitter,this.closeEmitter=new o.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,i){this.errorEmitter.fire([this.asError(e),t,i])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${s.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageWriter=c,function(e){e.fromOptions=function(e){return void 0===e||"string"==typeof e?{charset:e??"utf-8",contentTypeEncoder:(0,r.default)().applicationJson.encoder}:{charset:e.charset??"utf-8",contentEncoder:e.contentEncoder,contentTypeEncoder:e.contentTypeEncoder??(0,r.default)().applicationJson.encoder}}}(l||(l={})),t.WriteableStreamMessageWriter=class extends c{constructor(e,t){super(),this.writable=e,this.options=l.fromOptions(t),this.errorCount=0,this.writeSemaphore=new n.Semaphore(1),this.writable.onError((e=>this.fireError(e))),this.writable.onClose((()=>this.fireClose()))}async write(e){return this.writeSemaphore.lock((async()=>this.options.contentTypeEncoder.encode(e,this.options).then((e=>void 0!==this.options.contentEncoder?this.options.contentEncoder.encode(e):e)).then((t=>{const i=[];return i.push("Content-Length: ",t.byteLength.toString(),"\r\n"),i.push("\r\n"),this.doWrite(e,i,t)}),(e=>{throw this.fireError(e),e}))))}async doWrite(e,t,i){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(i)}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}}},3281:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressType=t.ProgressToken=t.createMessageConnection=t.NullLogger=t.ConnectionOptions=t.ConnectionStrategy=t.AbstractMessageBuffer=t.WriteableStreamMessageWriter=t.AbstractMessageWriter=t.MessageWriter=t.ReadableStreamMessageReader=t.AbstractMessageReader=t.MessageReader=t.SharedArrayReceiverStrategy=t.SharedArraySenderStrategy=t.CancellationToken=t.CancellationTokenSource=t.Emitter=t.Event=t.Disposable=t.LRUCache=t.Touch=t.LinkedMap=t.ParameterStructures=t.NotificationType9=t.NotificationType8=t.NotificationType7=t.NotificationType6=t.NotificationType5=t.NotificationType4=t.NotificationType3=t.NotificationType2=t.NotificationType1=t.NotificationType0=t.NotificationType=t.ErrorCodes=t.ResponseError=t.RequestType9=t.RequestType8=t.RequestType7=t.RequestType6=t.RequestType5=t.RequestType4=t.RequestType3=t.RequestType2=t.RequestType1=t.RequestType0=t.RequestType=t.Message=t.RAL=void 0,t.MessageStrategy=t.CancellationStrategy=t.CancellationSenderStrategy=t.CancellationReceiverStrategy=t.ConnectionError=t.ConnectionErrors=t.LogTraceNotification=t.SetTraceNotification=t.TraceFormat=t.TraceValues=t.Trace=void 0;const r=i(6177);Object.defineProperty(t,"Message",{enumerable:!0,get:function(){return r.Message}}),Object.defineProperty(t,"RequestType",{enumerable:!0,get:function(){return r.RequestType}}),Object.defineProperty(t,"RequestType0",{enumerable:!0,get:function(){return r.RequestType0}}),Object.defineProperty(t,"RequestType1",{enumerable:!0,get:function(){return r.RequestType1}}),Object.defineProperty(t,"RequestType2",{enumerable:!0,get:function(){return r.RequestType2}}),Object.defineProperty(t,"RequestType3",{enumerable:!0,get:function(){return r.RequestType3}}),Object.defineProperty(t,"RequestType4",{enumerable:!0,get:function(){return r.RequestType4}}),Object.defineProperty(t,"RequestType5",{enumerable:!0,get:function(){return r.RequestType5}}),Object.defineProperty(t,"RequestType6",{enumerable:!0,get:function(){return r.RequestType6}}),Object.defineProperty(t,"RequestType7",{enumerable:!0,get:function(){return r.RequestType7}}),Object.defineProperty(t,"RequestType8",{enumerable:!0,get:function(){return r.RequestType8}}),Object.defineProperty(t,"RequestType9",{enumerable:!0,get:function(){return r.RequestType9}}),Object.defineProperty(t,"ResponseError",{enumerable:!0,get:function(){return r.ResponseError}}),Object.defineProperty(t,"ErrorCodes",{enumerable:!0,get:function(){return r.ErrorCodes}}),Object.defineProperty(t,"NotificationType",{enumerable:!0,get:function(){return r.NotificationType}}),Object.defineProperty(t,"NotificationType0",{enumerable:!0,get:function(){return r.NotificationType0}}),Object.defineProperty(t,"NotificationType1",{enumerable:!0,get:function(){return r.NotificationType1}}),Object.defineProperty(t,"NotificationType2",{enumerable:!0,get:function(){return r.NotificationType2}}),Object.defineProperty(t,"NotificationType3",{enumerable:!0,get:function(){return r.NotificationType3}}),Object.defineProperty(t,"NotificationType4",{enumerable:!0,get:function(){return r.NotificationType4}}),Object.defineProperty(t,"NotificationType5",{enumerable:!0,get:function(){return r.NotificationType5}}),Object.defineProperty(t,"NotificationType6",{enumerable:!0,get:function(){return r.NotificationType6}}),Object.defineProperty(t,"NotificationType7",{enumerable:!0,get:function(){return r.NotificationType7}}),Object.defineProperty(t,"NotificationType8",{enumerable:!0,get:function(){return r.NotificationType8}}),Object.defineProperty(t,"NotificationType9",{enumerable:!0,get:function(){return r.NotificationType9}}),Object.defineProperty(t,"ParameterStructures",{enumerable:!0,get:function(){return r.ParameterStructures}});const s=i(3352);Object.defineProperty(t,"LinkedMap",{enumerable:!0,get:function(){return s.LinkedMap}}),Object.defineProperty(t,"LRUCache",{enumerable:!0,get:function(){return s.LRUCache}}),Object.defineProperty(t,"Touch",{enumerable:!0,get:function(){return s.Touch}});const n=i(4019);Object.defineProperty(t,"Disposable",{enumerable:!0,get:function(){return n.Disposable}});const o=i(2676);Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return o.Event}}),Object.defineProperty(t,"Emitter",{enumerable:!0,get:function(){return o.Emitter}});const a=i(9850);Object.defineProperty(t,"CancellationTokenSource",{enumerable:!0,get:function(){return a.CancellationTokenSource}}),Object.defineProperty(t,"CancellationToken",{enumerable:!0,get:function(){return a.CancellationToken}});const l=i(4996);Object.defineProperty(t,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return l.SharedArraySenderStrategy}}),Object.defineProperty(t,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return l.SharedArrayReceiverStrategy}});const c=i(9085);Object.defineProperty(t,"MessageReader",{enumerable:!0,get:function(){return c.MessageReader}}),Object.defineProperty(t,"AbstractMessageReader",{enumerable:!0,get:function(){return c.AbstractMessageReader}}),Object.defineProperty(t,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return c.ReadableStreamMessageReader}});const h=i(3193);Object.defineProperty(t,"MessageWriter",{enumerable:!0,get:function(){return h.MessageWriter}}),Object.defineProperty(t,"AbstractMessageWriter",{enumerable:!0,get:function(){return h.AbstractMessageWriter}}),Object.defineProperty(t,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return h.WriteableStreamMessageWriter}});const u=i(9244);Object.defineProperty(t,"AbstractMessageBuffer",{enumerable:!0,get:function(){return u.AbstractMessageBuffer}});const d=i(577);Object.defineProperty(t,"ConnectionStrategy",{enumerable:!0,get:function(){return d.ConnectionStrategy}}),Object.defineProperty(t,"ConnectionOptions",{enumerable:!0,get:function(){return d.ConnectionOptions}}),Object.defineProperty(t,"NullLogger",{enumerable:!0,get:function(){return d.NullLogger}}),Object.defineProperty(t,"createMessageConnection",{enumerable:!0,get:function(){return d.createMessageConnection}}),Object.defineProperty(t,"ProgressToken",{enumerable:!0,get:function(){return d.ProgressToken}}),Object.defineProperty(t,"ProgressType",{enumerable:!0,get:function(){return d.ProgressType}}),Object.defineProperty(t,"Trace",{enumerable:!0,get:function(){return d.Trace}}),Object.defineProperty(t,"TraceValues",{enumerable:!0,get:function(){return d.TraceValues}}),Object.defineProperty(t,"TraceFormat",{enumerable:!0,get:function(){return d.TraceFormat}}),Object.defineProperty(t,"SetTraceNotification",{enumerable:!0,get:function(){return d.SetTraceNotification}}),Object.defineProperty(t,"LogTraceNotification",{enumerable:!0,get:function(){return d.LogTraceNotification}}),Object.defineProperty(t,"ConnectionErrors",{enumerable:!0,get:function(){return d.ConnectionErrors}}),Object.defineProperty(t,"ConnectionError",{enumerable:!0,get:function(){return d.ConnectionError}}),Object.defineProperty(t,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return d.CancellationReceiverStrategy}}),Object.defineProperty(t,"CancellationSenderStrategy",{enumerable:!0,get:function(){return d.CancellationSenderStrategy}}),Object.defineProperty(t,"CancellationStrategy",{enumerable:!0,get:function(){return d.CancellationStrategy}}),Object.defineProperty(t,"MessageStrategy",{enumerable:!0,get:function(){return d.MessageStrategy}});const f=i(9590);t.RAL=f.default},3307:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InlineCompletionRequest=void 0;const r=i(372);var s;!function(e){e.method="textDocument/inlineCompletion",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.InlineCompletionRequest=s={}))},3344:function(e,t,i){"use strict";var r,s=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},r(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var n=i(7902),o=i(8297),a=i(8014),l=function(e){function t(t,i,r){var s=e.call(this)||this;return s.connection=t,s.reqUri=i,s.resUri=r,s}return s(t,e),t.prototype.connect=function(){var e=this;return this.connection.on(this.resUri,(function(t){e.transportRequestManager.resolveResponse(t)})),Promise.resolve()},t.prototype.sendData=function(e,t){void 0===t&&(t=null);var i=this.transportRequestManager.addRequest(e,t),r=o.getNotifications(e),s=this.parseData(e);try{return this.connection.emit(this.reqUri,s),this.transportRequestManager.settlePendingRequest(r),i}catch(e){var n=new a.JSONRPCError(e.message,a.ERR_UNKNOWN,e);return this.transportRequestManager.settlePendingRequest(r,n),Promise.reject(n)}},t.prototype.close=function(){this.connection.removeAllListeners()},t}(n.Transport);t.default=l},3352:(e,t)=>{"use strict";var i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=t.LinkedMap=t.Touch=void 0,function(e){e.None=0,e.First=1,e.AsOld=e.First,e.Last=2,e.AsNew=e.Last}(r||(t.Touch=r={}));class s{constructor(){this[i]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=r.None){const i=this._map.get(e);if(i)return t!==r.None&&this.touch(i,t),i.value}set(e,t,i=r.None){let s=this._map.get(e);if(s)s.value=t,i!==r.None&&this.touch(s,i);else{switch(s={key:e,value:t,next:void 0,previous:void 0},i){case r.None:this.addItemLast(s);break;case r.First:this.addItemFirst(s);break;case r.Last:default:this.addItemLast(s)}this._map.set(e,s),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){const t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){const i=this._state;let r=this._head;for(;r;){if(t?e.bind(t)(r.value,r.key,this):e(r.value,r.key,this),this._state!==i)throw new Error("LinkedMap got modified during iteration.");r=r.next}}keys(){const e=this._state;let t=this._head;const i={[Symbol.iterator]:()=>i,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){const e={value:t.key,done:!1};return t=t.next,e}return{value:void 0,done:!0}}};return i}values(){const e=this._state;let t=this._head;const i={[Symbol.iterator]:()=>i,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){const e={value:t.value,done:!1};return t=t.next,e}return{value:void 0,done:!0}}};return i}entries(){const e=this._state;let t=this._head;const i={[Symbol.iterator]:()=>i,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){const e={value:[t.key,t.value],done:!1};return t=t.next,e}return{value:void 0,done:!0}}};return i}[(i=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(0===e)return void this.clear();let t=this._head,i=this.size;for(;t&&i>e;)this._map.delete(t.key),t=t.next,i--;this._head=t,this._size=i,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e,this._state++}addItemLast(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const t=e.next,i=e.previous;if(!t||!i)throw new Error("Invalid list");t.previous=i,i.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(t===r.First||t===r.Last)if(t===r.First){if(e===this._head)return;const t=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(t.previous=i,i.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===r.Last){if(e===this._tail)return;const t=e.next,i=e.previous;e===this._head?(t.previous=void 0,this._head=t):(t.previous=i,i.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}toJSON(){const e=[];return this.forEach(((t,i)=>{e.push([i,t])})),e}fromJSON(e){this.clear();for(const[t,i]of e)this.set(t,i)}}t.LinkedMap=s,t.LRUCache=class extends s{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=r.AsNew){return super.get(e,t)}peek(e){return super.get(e,r.None)}set(e,t){return super.set(e,t,r.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}},3465:function(e,t,i){"use strict";var r,s=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},r(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var i,r,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=i(7902),l=i(8297),c=function(e){function t(t){var i=e.call(this)||this;return i.messageHandler=function(e){i.transportRequestManager.resolveResponse(JSON.stringify(e.data))},i.uri=t,i.postMessageID="post-message-transport-"+Math.random(),i}return s(t,e),t.prototype.createWindow=function(e){return new Promise((function(t,i){var r,s,n;s=e,n=window.screen.height,r=window.open(s,"inspector:popup","left=0,top=0,width=400,height="+n+",resizable,scrollbars=yes,status=1"),setTimeout((function(){t(r)}),3e3)}))},t.prototype.connect=function(){var e=this,t=/^(http|https):\/\/.*$/;return new Promise((function(i,r){return n(e,void 0,void 0,(function(){var e;return o(this,(function(s){switch(s.label){case 0:return t.test(this.uri)||r(new Error("Bad URI")),e=this,[4,this.createWindow(this.uri)];case 1:return e.frame=s.sent(),window.addEventListener("message",this.messageHandler),i(),[2]}}))}))}))},t.prototype.sendData=function(e,t){return void 0===t&&(t=5e3),n(this,void 0,void 0,(function(){var t,i;return o(this,(function(r){return t=this.transportRequestManager.addRequest(e,null),i=l.getNotifications(e),this.frame&&(this.frame.postMessage(e.request,this.uri),this.transportRequestManager.settlePendingRequest(i)),[2,t]}))}))},t.prototype.close=function(){this.frame&&(window.removeEventListener("message",this.messageHandler),this.frame.close())},t}(a.Transport);t.default=c},3487:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionRangeRequest=void 0;const r=i(372);var s;!function(e){e.method="textDocument/selectionRange",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.SelectionRangeRequest=s={}))},3557:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DidCloseNotebookDocumentNotification=t.DidSaveNotebookDocumentNotification=t.DidChangeNotebookDocumentNotification=t.NotebookCellArrayChange=t.DidOpenNotebookDocumentNotification=t.NotebookDocumentSyncRegistrationType=t.NotebookDocument=t.NotebookCell=t.ExecutionSummary=t.NotebookCellKind=void 0;const r=i(6203),s=i(8598),n=i(372);var o,a,l,c,h,u,d,f,p,g;!function(e){e.Markup=1,e.Code=2,e.is=function(e){return 1===e||2===e}}(o||(t.NotebookCellKind=o={})),function(e){e.create=function(e,t){const i={executionOrder:e};return!0!==t&&!1!==t||(i.success=t),i},e.is=function(e){const t=e;return s.objectLiteral(t)&&r.uinteger.is(t.executionOrder)&&(void 0===t.success||s.boolean(t.success))},e.equals=function(e,t){return e===t||null!=e&&null!=t&&e.executionOrder===t.executionOrder&&e.success===t.success}}(a||(t.ExecutionSummary=a={})),function(e){function t(e,i){if(e===i)return!0;if(null==e||null==i)return!1;if(typeof e!=typeof i)return!1;if("object"!=typeof e)return!1;const r=Array.isArray(e),n=Array.isArray(i);if(r!==n)return!1;if(r&&n){if(e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],i[r]))return!1}if(s.objectLiteral(e)&&s.objectLiteral(i)){const r=Object.keys(e),s=Object.keys(i);if(r.length!==s.length)return!1;if(r.sort(),s.sort(),!t(r,s))return!1;for(let s=0;s<r.length;s++){const n=r[s];if(!t(e[n],i[n]))return!1}}return!0}e.create=function(e,t){return{kind:e,document:t}},e.is=function(e){const t=e;return s.objectLiteral(t)&&o.is(t.kind)&&r.DocumentUri.is(t.document)&&(void 0===t.metadata||s.objectLiteral(t.metadata))},e.diff=function(e,i){const r=new Set;return e.document!==i.document&&r.add("document"),e.kind!==i.kind&&r.add("kind"),e.executionSummary!==i.executionSummary&&r.add("executionSummary"),void 0===e.metadata&&void 0===i.metadata||t(e.metadata,i.metadata)||r.add("metadata"),void 0===e.executionSummary&&void 0===i.executionSummary||a.equals(e.executionSummary,i.executionSummary)||r.add("executionSummary"),r}}(l||(t.NotebookCell=l={})),function(e){e.create=function(e,t,i,r){return{uri:e,notebookType:t,version:i,cells:r}},e.is=function(e){const t=e;return s.objectLiteral(t)&&s.string(t.uri)&&r.integer.is(t.version)&&s.typedArray(t.cells,l.is)}}(c||(t.NotebookDocument=c={})),function(e){e.method="notebookDocument/sync",e.messageDirection=n.MessageDirection.clientToServer,e.type=new n.RegistrationType(e.method)}(h||(t.NotebookDocumentSyncRegistrationType=h={})),function(e){e.method="notebookDocument/didOpen",e.messageDirection=n.MessageDirection.clientToServer,e.type=new n.ProtocolNotificationType(e.method),e.registrationMethod=h.method}(u||(t.DidOpenNotebookDocumentNotification=u={})),function(e){e.is=function(e){const t=e;return s.objectLiteral(t)&&r.uinteger.is(t.start)&&r.uinteger.is(t.deleteCount)&&(void 0===t.cells||s.typedArray(t.cells,l.is))},e.create=function(e,t,i){const r={start:e,deleteCount:t};return void 0!==i&&(r.cells=i),r}}(d||(t.NotebookCellArrayChange=d={})),function(e){e.method="notebookDocument/didChange",e.messageDirection=n.MessageDirection.clientToServer,e.type=new n.ProtocolNotificationType(e.method),e.registrationMethod=h.method}(f||(t.DidChangeNotebookDocumentNotification=f={})),function(e){e.method="notebookDocument/didSave",e.messageDirection=n.MessageDirection.clientToServer,e.type=new n.ProtocolNotificationType(e.method),e.registrationMethod=h.method}(p||(t.DidSaveNotebookDocumentNotification=p={})),function(e){e.method="notebookDocument/didClose",e.messageDirection=n.MessageDirection.clientToServer,e.type=new n.ProtocolNotificationType(e.method),e.registrationMethod=h.method}(g||(t.DidCloseNotebookDocumentNotification=g={}))},3616:e=>{var t;self,t=()=>(()=>{"use strict";var e,t={};return e=t,Object.defineProperty(e,"__esModule",{value:!0}),e.FitAddon=void 0,e.FitAddon=class{activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const i=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,r=window.getComputedStyle(this._terminal.element.parentElement),s=parseInt(r.getPropertyValue("height")),n=Math.max(0,parseInt(r.getPropertyValue("width"))),o=window.getComputedStyle(this._terminal.element),a=s-(parseInt(o.getPropertyValue("padding-top"))+parseInt(o.getPropertyValue("padding-bottom"))),l=n-(parseInt(o.getPropertyValue("padding-right"))+parseInt(o.getPropertyValue("padding-left")))-i;return{cols:Math.max(2,Math.floor(l/t.css.cell.width)),rows:Math.max(1,Math.floor(a/t.css.cell.height))}}},t})(),e.exports=t()},3933:function(e,t,i){"use strict";var r,s=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},r(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var i,r,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=i(7902),l=i(8297),c=function(e){function t(t){var i=e.call(this)||this;return i.messageHandler=function(e){i.transportRequestManager.resolveResponse(JSON.stringify(e.data))},i.uri=t,i.postMessageID="post-message-transport-"+Math.random(),i}return s(t,e),t.prototype.createWindow=function(e){var t=this;return new Promise((function(i,r){var s,n=document.createElement("iframe");n.setAttribute("id",t.postMessageID),n.setAttribute("width","0px"),n.setAttribute("height","0px"),n.setAttribute("style","visiblity:hidden;border:none;outline:none;"),n.addEventListener("load",(function(){i(s)})),n.setAttribute("src",e),window.document.body.appendChild(n),s=n.contentWindow}))},t.prototype.connect=function(){var e=this,t=/^(http|https):\/\/.*$/;return new Promise((function(i,r){return n(e,void 0,void 0,(function(){var e;return o(this,(function(s){switch(s.label){case 0:return t.test(this.uri)||r(new Error("Bad URI")),e=this,[4,this.createWindow(this.uri)];case 1:return e.frame=s.sent(),window.addEventListener("message",this.messageHandler),i(),[2]}}))}))}))},t.prototype.sendData=function(e,t){return void 0===t&&(t=5e3),n(this,void 0,void 0,(function(){var t,i;return o(this,(function(r){return t=this.transportRequestManager.addRequest(e,null),i=l.getNotifications(e),this.frame&&(this.frame.postMessage(e.request,"*"),this.transportRequestManager.settlePendingRequest(i)),[2,t]}))}))},t.prototype.close=function(){var e=document.getElementById(this.postMessageID);null==e||e.remove(),window.removeEventListener("message",this.messageHandler)},t}(a.Transport);t.default=c},4019:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Disposable=void 0,function(e){e.create=function(e){return{dispose:e}}}(i||(t.Disposable=i={}))},4323:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Semaphore=void 0;const r=i(9590);t.Semaphore=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise(((t,i)=>{this._waiting.push({thunk:e,resolve:t,reject:i}),this.runNext()}))}get active(){return this._active}runNext(){0!==this._waiting.length&&this._active!==this._capacity&&(0,r.default)().timer.setImmediate((()=>this.doRunNext()))}doRunNext(){if(0===this._waiting.length||this._active===this._capacity)return;const e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{const t=e.thunk();t instanceof Promise?t.then((t=>{this._active--,e.resolve(t),this.runNext()}),(t=>{this._active--,e.reject(t),this.runNext()})):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}}},4512:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,s)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.createProtocolConnection=void 0;const n=i(6087);s(i(6087),t),s(i(8766),t),t.createProtocolConnection=function(e,t,i,r){return(0,n.createMessageConnection)(e,t,i,r)}},4615:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3281);class s extends r.AbstractMessageBuffer{constructor(e="utf-8"){super(e),this.asciiDecoder=new TextDecoder("ascii")}emptyBuffer(){return s.emptyBuffer}fromString(e,t){return(new TextEncoder).encode(e)}toString(e,t){return"ascii"===t?this.asciiDecoder.decode(e):new TextDecoder(t).decode(e)}asNative(e,t){return void 0===t?e:e.slice(0,t)}allocNative(e){return new Uint8Array(e)}}s.emptyBuffer=new Uint8Array(0);class n{constructor(e){this.socket=e,this._onData=new r.Emitter,this._messageListener=e=>{e.data.arrayBuffer().then((e=>{this._onData.fire(new Uint8Array(e))}),(()=>{(0,r.RAL)().console.error("Converting blob to array buffer failed.")}))},this.socket.addEventListener("message",this._messageListener)}onClose(e){return this.socket.addEventListener("close",e),r.Disposable.create((()=>this.socket.removeEventListener("close",e)))}onError(e){return this.socket.addEventListener("error",e),r.Disposable.create((()=>this.socket.removeEventListener("error",e)))}onEnd(e){return this.socket.addEventListener("end",e),r.Disposable.create((()=>this.socket.removeEventListener("end",e)))}onData(e){return this._onData.event(e)}}class o{constructor(e){this.socket=e}onClose(e){return this.socket.addEventListener("close",e),r.Disposable.create((()=>this.socket.removeEventListener("close",e)))}onError(e){return this.socket.addEventListener("error",e),r.Disposable.create((()=>this.socket.removeEventListener("error",e)))}onEnd(e){return this.socket.addEventListener("end",e),r.Disposable.create((()=>this.socket.removeEventListener("end",e)))}write(e,t){if("string"==typeof e){if(void 0!==t&&"utf-8"!==t)throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${t}`);this.socket.send(e)}else this.socket.send(e);return Promise.resolve()}end(){this.socket.close()}}const a=new TextEncoder,l=Object.freeze({messageBuffer:Object.freeze({create:e=>new s(e)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(e,t)=>{if("utf-8"!==t.charset)throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${t.charset}`);return Promise.resolve(a.encode(JSON.stringify(e,void 0,0)))}}),decoder:Object.freeze({name:"application/json",decode:(e,t)=>{if(!(e instanceof Uint8Array))throw new Error("In a Browser environments only Uint8Arrays are supported.");return Promise.resolve(JSON.parse(new TextDecoder(t.charset).decode(e)))}})}),stream:Object.freeze({asReadableStream:e=>new n(e),asWritableStream:e=>new o(e)}),console,timer:Object.freeze({setTimeout(e,t,...i){const r=setTimeout(e,t,...i);return{dispose:()=>clearTimeout(r)}},setImmediate(e,...t){const i=setTimeout(e,0,...t);return{dispose:()=>clearTimeout(i)}},setInterval(e,t,...i){const r=setInterval(e,t,...i);return{dispose:()=>clearInterval(r)}}})});function c(){return l}!function(e){e.install=function(){r.RAL.install(l)}}(c||(c={})),t.default=c},4996:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharedArrayReceiverStrategy=t.SharedArraySenderStrategy=void 0;const r=i(9850);var s;!function(e){e.Continue=0,e.Cancelled=1}(s||(s={})),t.SharedArraySenderStrategy=class{constructor(){this.buffers=new Map}enableCancellation(e){if(null===e.id)return;const t=new SharedArrayBuffer(4);new Int32Array(t,0,1)[0]=s.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){const i=this.buffers.get(t);if(void 0===i)return;const r=new Int32Array(i,0,1);Atomics.store(r,0,s.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};class n{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===s.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}}class o{constructor(e){this.token=new n(e)}cancel(){}dispose(){}}t.SharedArrayReceiverStrategy=class{constructor(){this.kind="request"}createCancellationTokenSource(e){const t=e.$cancellationData;return void 0===t?new r.CancellationTokenSource:new o(t)}}},5316:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedEditingRangeRequest=void 0;const r=i(372);var s;!function(e){e.method="textDocument/linkedEditingRange",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.LinkedEditingRangeRequest=s={}))},6011:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DiagnosticRefreshRequest=t.WorkspaceDiagnosticRequest=t.DocumentDiagnosticRequest=t.DocumentDiagnosticReportKind=t.DiagnosticServerCancellationData=void 0;const r=i(6439),s=i(8598),n=i(372);var o,a,l,c,h;!function(e){e.is=function(e){const t=e;return t&&s.boolean(t.retriggerRequest)}}(o||(t.DiagnosticServerCancellationData=o={})),function(e){e.Full="full",e.Unchanged="unchanged"}(a||(t.DocumentDiagnosticReportKind=a={})),function(e){e.method="textDocument/diagnostic",e.messageDirection=n.MessageDirection.clientToServer,e.type=new n.ProtocolRequestType(e.method),e.partialResult=new r.ProgressType}(l||(t.DocumentDiagnosticRequest=l={})),function(e){e.method="workspace/diagnostic",e.messageDirection=n.MessageDirection.clientToServer,e.type=new n.ProtocolRequestType(e.method),e.partialResult=new r.ProgressType}(c||(t.WorkspaceDiagnosticRequest=c={})),function(e){e.method="workspace/diagnostic/refresh",e.messageDirection=n.MessageDirection.serverToClient,e.type=new n.ProtocolRequestType0(e.method)}(h||(t.DiagnosticRefreshRequest=h={}))},6087:(e,t,i)=>{"use strict";e.exports=i(6439)},6177:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Message=t.NotificationType9=t.NotificationType8=t.NotificationType7=t.NotificationType6=t.NotificationType5=t.NotificationType4=t.NotificationType3=t.NotificationType2=t.NotificationType1=t.NotificationType0=t.NotificationType=t.RequestType9=t.RequestType8=t.RequestType7=t.RequestType6=t.RequestType5=t.RequestType4=t.RequestType3=t.RequestType2=t.RequestType1=t.RequestType=t.RequestType0=t.AbstractMessageSignature=t.ParameterStructures=t.ResponseError=t.ErrorCodes=void 0;const r=i(8585);var s,n;!function(e){e.ParseError=-32700,e.InvalidRequest=-32600,e.MethodNotFound=-32601,e.InvalidParams=-32602,e.InternalError=-32603,e.jsonrpcReservedErrorRangeStart=-32099,e.serverErrorStart=-32099,e.MessageWriteError=-32099,e.MessageReadError=-32098,e.PendingResponseRejected=-32097,e.ConnectionInactive=-32096,e.ServerNotInitialized=-32002,e.UnknownErrorCode=-32001,e.jsonrpcReservedErrorRangeEnd=-32e3,e.serverErrorEnd=-32e3}(s||(t.ErrorCodes=s={}));class o extends Error{constructor(e,t,i){super(t),this.code=r.number(e)?e:s.UnknownErrorCode,this.data=i,Object.setPrototypeOf(this,o.prototype)}toJson(){const e={code:this.code,message:this.message};return void 0!==this.data&&(e.data=this.data),e}}t.ResponseError=o;class a{constructor(e){this.kind=e}static is(e){return e===a.auto||e===a.byName||e===a.byPosition}toString(){return this.kind}}t.ParameterStructures=a,a.auto=new a("auto"),a.byPosition=new a("byPosition"),a.byName=new a("byName");class l{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return a.auto}}t.AbstractMessageSignature=l,t.RequestType0=class extends l{constructor(e){super(e,0)}},t.RequestType=class extends l{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.RequestType1=class extends l{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.RequestType2=class extends l{constructor(e){super(e,2)}},t.RequestType3=class extends l{constructor(e){super(e,3)}},t.RequestType4=class extends l{constructor(e){super(e,4)}},t.RequestType5=class extends l{constructor(e){super(e,5)}},t.RequestType6=class extends l{constructor(e){super(e,6)}},t.RequestType7=class extends l{constructor(e){super(e,7)}},t.RequestType8=class extends l{constructor(e){super(e,8)}},t.RequestType9=class extends l{constructor(e){super(e,9)}},t.NotificationType=class extends l{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.NotificationType0=class extends l{constructor(e){super(e,0)}},t.NotificationType1=class extends l{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.NotificationType2=class extends l{constructor(e){super(e,2)}},t.NotificationType3=class extends l{constructor(e){super(e,3)}},t.NotificationType4=class extends l{constructor(e){super(e,4)}},t.NotificationType5=class extends l{constructor(e){super(e,5)}},t.NotificationType6=class extends l{constructor(e){super(e,6)}},t.NotificationType7=class extends l{constructor(e){super(e,7)}},t.NotificationType8=class extends l{constructor(e){super(e,8)}},t.NotificationType9=class extends l{constructor(e){super(e,9)}},function(e){e.isRequest=function(e){const t=e;return t&&r.string(t.method)&&(r.string(t.id)||r.number(t.id))},e.isNotification=function(e){const t=e;return t&&r.string(t.method)&&void 0===e.id},e.isResponse=function(e){const t=e;return t&&(void 0!==t.result||!!t.error)&&(r.string(t.id)||r.number(t.id)||null===t.id)}}(n||(t.Message=n={}))},6203:(e,t,i)=>{"use strict";var r,s,n,o,a,l,c,h,u,d,f,p,g,m,v,_,y,b,w,S,C,k,x,R,E,D,T,M,A,O,L,P,B,I,N,q,H,F,W,j,$,z,U,V,K,G,J,X,Y,Z,Q,ee,te,ie,re,se,ne,oe,ae,le,ce,he,ue,de,fe,pe,ge,me,ve,_e,ye,be,we,Se,Ce,ke,xe,Re;i.r(t),i.d(t,{AnnotatedTextEdit:()=>x,ChangeAnnotation:()=>C,ChangeAnnotationIdentifier:()=>k,CodeAction:()=>ne,CodeActionContext:()=>se,CodeActionKind:()=>ie,CodeActionTriggerKind:()=>re,CodeDescription:()=>y,CodeLens:()=>oe,Color:()=>u,ColorInformation:()=>d,ColorPresentation:()=>f,Command:()=>w,CompletionItem:()=>$,CompletionItemKind:()=>N,CompletionItemLabelDetails:()=>j,CompletionItemTag:()=>H,CompletionList:()=>z,CreateFile:()=>E,DeleteFile:()=>T,Diagnostic:()=>b,DiagnosticRelatedInformation:()=>m,DiagnosticSeverity:()=>v,DiagnosticTag:()=>_,DocumentHighlight:()=>X,DocumentHighlightKind:()=>J,DocumentLink:()=>le,DocumentSymbol:()=>te,DocumentUri:()=>r,EOL:()=>Me,FoldingRange:()=>g,FoldingRangeKind:()=>p,FormattingOptions:()=>ae,Hover:()=>V,InlayHint:()=>ye,InlayHintKind:()=>ve,InlayHintLabelPart:()=>_e,InlineCompletionContext:()=>xe,InlineCompletionItem:()=>we,InlineCompletionList:()=>Se,InlineCompletionTriggerKind:()=>Ce,InlineValueContext:()=>me,InlineValueEvaluatableExpression:()=>ge,InlineValueText:()=>fe,InlineValueVariableLookup:()=>pe,InsertReplaceEdit:()=>F,InsertTextFormat:()=>q,InsertTextMode:()=>W,Location:()=>c,LocationLink:()=>h,MarkedString:()=>U,MarkupContent:()=>I,MarkupKind:()=>B,OptionalVersionedTextDocumentIdentifier:()=>L,ParameterInformation:()=>K,Position:()=>a,Range:()=>l,RenameFile:()=>D,SelectedCompletionInfo:()=>ke,SelectionRange:()=>ce,SemanticTokenModifiers:()=>ue,SemanticTokenTypes:()=>he,SemanticTokens:()=>de,SignatureInformation:()=>G,StringValue:()=>be,SymbolInformation:()=>Q,SymbolKind:()=>Y,SymbolTag:()=>Z,TextDocument:()=>Ae,TextDocumentEdit:()=>R,TextDocumentIdentifier:()=>A,TextDocumentItem:()=>P,TextEdit:()=>S,URI:()=>s,VersionedTextDocumentIdentifier:()=>O,WorkspaceChange:()=>Te,WorkspaceEdit:()=>M,WorkspaceFolder:()=>Re,WorkspaceSymbol:()=>ee,integer:()=>n,uinteger:()=>o}),function(e){e.is=function(e){return"string"==typeof e}}(r||(r={})),function(e){e.is=function(e){return"string"==typeof e}}(s||(s={})),function(e){e.MIN_VALUE=-2147483648,e.MAX_VALUE=2147483647,e.is=function(t){return"number"==typeof t&&e.MIN_VALUE<=t&&t<=e.MAX_VALUE}}(n||(n={})),function(e){e.MIN_VALUE=0,e.MAX_VALUE=2147483647,e.is=function(t){return"number"==typeof t&&e.MIN_VALUE<=t&&t<=e.MAX_VALUE}}(o||(o={})),function(e){e.create=function(e,t){return e===Number.MAX_VALUE&&(e=o.MAX_VALUE),t===Number.MAX_VALUE&&(t=o.MAX_VALUE),{line:e,character:t}},e.is=function(e){let t=e;return Oe.objectLiteral(t)&&Oe.uinteger(t.line)&&Oe.uinteger(t.character)}}(a||(a={})),function(e){e.create=function(e,t,i,r){if(Oe.uinteger(e)&&Oe.uinteger(t)&&Oe.uinteger(i)&&Oe.uinteger(r))return{start:a.create(e,t),end:a.create(i,r)};if(a.is(e)&&a.is(t))return{start:e,end:t};throw new Error(`Range#create called with invalid arguments[${e}, ${t}, ${i}, ${r}]`)},e.is=function(e){let t=e;return Oe.objectLiteral(t)&&a.is(t.start)&&a.is(t.end)}}(l||(l={})),function(e){e.create=function(e,t){return{uri:e,range:t}},e.is=function(e){let t=e;return Oe.objectLiteral(t)&&l.is(t.range)&&(Oe.string(t.uri)||Oe.undefined(t.uri))}}(c||(c={})),function(e){e.create=function(e,t,i,r){return{targetUri:e,targetRange:t,targetSelectionRange:i,originSelectionRange:r}},e.is=function(e){let t=e;return Oe.objectLiteral(t)&&l.is(t.targetRange)&&Oe.string(t.targetUri)&&l.is(t.targetSelectionRange)&&(l.is(t.originSelectionRange)||Oe.undefined(t.originSelectionRange))}}(h||(h={})),function(e){e.create=function(e,t,i,r){return{red:e,green:t,blue:i,alpha:r}},e.is=function(e){const t=e;return Oe.objectLiteral(t)&&Oe.numberRange(t.red,0,1)&&Oe.numberRange(t.green,0,1)&&Oe.numberRange(t.blue,0,1)&&Oe.numberRange(t.alpha,0,1)}}(u||(u={})),function(e){e.create=function(e,t){return{range:e,color:t}},e.is=function(e){const t=e;return Oe.objectLiteral(t)&&l.is(t.range)&&u.is(t.color)}}(d||(d={})),function(e){e.create=function(e,t,i){return{label:e,textEdit:t,additionalTextEdits:i}},e.is=function(e){const t=e;return Oe.objectLiteral(t)&&Oe.string(t.label)&&(Oe.undefined(t.textEdit)||S.is(t))&&(Oe.undefined(t.additionalTextEdits)||Oe.typedArray(t.additionalTextEdits,S.is))}}(f||(f={})),function(e){e.Comment="comment",e.Imports="imports",e.Region="region"}(p||(p={})),function(e){e.create=function(e,t,i,r,s,n){const o={startLine:e,endLine:t};return Oe.defined(i)&&(o.startCharacter=i),Oe.defined(r)&&(o.endCharacter=r),Oe.defined(s)&&(o.kind=s),Oe.defined(n)&&(o.collapsedText=n),o},e.is=function(e){const t=e;return Oe.objectLiteral(t)&&Oe.uinteger(t.startLine)&&Oe.uinteger(t.startLine)&&(Oe.undefined(t.startCharacter)||Oe.uinteger(t.startCharacter))&&(Oe.undefined(t.endCharacter)||Oe.uinteger(t.endCharacter))&&(Oe.undefined(t.kind)||Oe.string(t.kind))}}(g||(g={})),function(e){e.create=function(e,t){return{location:e,message:t}},e.is=function(e){let t=e;return Oe.defined(t)&&c.is(t.location)&&Oe.string(t.message)}}(m||(m={})),function(e){e.Error=1,e.Warning=2,e.Information=3,e.Hint=4}(v||(v={})),function(e){e.Unnecessary=1,e.Deprecated=2}(_||(_={})),function(e){e.is=function(e){const t=e;return Oe.objectLiteral(t)&&Oe.string(t.href)}}(y||(y={})),function(e){e.create=function(e,t,i,r,s,n){let o={range:e,message:t};return Oe.defined(i)&&(o.severity=i),Oe.defined(r)&&(o.code=r),Oe.defined(s)&&(o.source=s),Oe.defined(n)&&(o.relatedInformation=n),o},e.is=function(e){var t;let i=e;return Oe.defined(i)&&l.is(i.range)&&Oe.string(i.message)&&(Oe.number(i.severity)||Oe.undefined(i.severity))&&(Oe.integer(i.code)||Oe.string(i.code)||Oe.undefined(i.code))&&(Oe.undefined(i.codeDescription)||Oe.string(null===(t=i.codeDescription)||void 0===t?void 0:t.href))&&(Oe.string(i.source)||Oe.undefined(i.source))&&(Oe.undefined(i.relatedInformation)||Oe.typedArray(i.relatedInformation,m.is))}}(b||(b={})),function(e){e.create=function(e,t,...i){let r={title:e,command:t};return Oe.defined(i)&&i.length>0&&(r.arguments=i),r},e.is=function(e){let t=e;return Oe.defined(t)&&Oe.string(t.title)&&Oe.string(t.command)}}(w||(w={})),function(e){e.replace=function(e,t){return{range:e,newText:t}},e.insert=function(e,t){return{range:{start:e,end:e},newText:t}},e.del=function(e){return{range:e,newText:""}},e.is=function(e){const t=e;return Oe.objectLiteral(t)&&Oe.string(t.newText)&&l.is(t.range)}}(S||(S={})),function(e){e.create=function(e,t,i){const r={label:e};return void 0!==t&&(r.needsConfirmation=t),void 0!==i&&(r.description=i),r},e.is=function(e){const t=e;return Oe.objectLiteral(t)&&Oe.string(t.label)&&(Oe.boolean(t.needsConfirmation)||void 0===t.needsConfirmation)&&(Oe.string(t.description)||void 0===t.description)}}(C||(C={})),function(e){e.is=function(e){const t=e;return Oe.string(t)}}(k||(k={})),function(e){e.replace=function(e,t,i){return{range:e,newText:t,annotationId:i}},e.insert=function(e,t,i){return{range:{start:e,end:e},newText:t,annotationId:i}},e.del=function(e,t){return{range:e,newText:"",annotationId:t}},e.is=function(e){const t=e;return S.is(t)&&(C.is(t.annotationId)||k.is(t.annotationId))}}(x||(x={})),function(e){e.create=function(e,t){return{textDocument:e,edits:t}},e.is=function(e){let t=e;return Oe.defined(t)&&L.is(t.textDocument)&&Array.isArray(t.edits)}}(R||(R={})),function(e){e.create=function(e,t,i){let r={kind:"create",uri:e};return void 0===t||void 0===t.overwrite&&void 0===t.ignoreIfExists||(r.options=t),void 0!==i&&(r.annotationId=i),r},e.is=function(e){let t=e;return t&&"create"===t.kind&&Oe.string(t.uri)&&(void 0===t.options||(void 0===t.options.overwrite||Oe.boolean(t.options.overwrite))&&(void 0===t.options.ignoreIfExists||Oe.boolean(t.options.ignoreIfExists)))&&(void 0===t.annotationId||k.is(t.annotationId))}}(E||(E={})),function(e){e.create=function(e,t,i,r){let s={kind:"rename",oldUri:e,newUri:t};return void 0===i||void 0===i.overwrite&&void 0===i.ignoreIfExists||(s.options=i),void 0!==r&&(s.annotationId=r),s},e.is=function(e){let t=e;return t&&"rename"===t.kind&&Oe.string(t.oldUri)&&Oe.string(t.newUri)&&(void 0===t.options||(void 0===t.options.overwrite||Oe.boolean(t.options.overwrite))&&(void 0===t.options.ignoreIfExists||Oe.boolean(t.options.ignoreIfExists)))&&(void 0===t.annotationId||k.is(t.annotationId))}}(D||(D={})),function(e){e.create=function(e,t,i){let r={kind:"delete",uri:e};return void 0===t||void 0===t.recursive&&void 0===t.ignoreIfNotExists||(r.options=t),void 0!==i&&(r.annotationId=i),r},e.is=function(e){let t=e;return t&&"delete"===t.kind&&Oe.string(t.uri)&&(void 0===t.options||(void 0===t.options.recursive||Oe.boolean(t.options.recursive))&&(void 0===t.options.ignoreIfNotExists||Oe.boolean(t.options.ignoreIfNotExists)))&&(void 0===t.annotationId||k.is(t.annotationId))}}(T||(T={})),function(e){e.is=function(e){let t=e;return t&&(void 0!==t.changes||void 0!==t.documentChanges)&&(void 0===t.documentChanges||t.documentChanges.every((e=>Oe.string(e.kind)?E.is(e)||D.is(e)||T.is(e):R.is(e))))}}(M||(M={}));class Ee{constructor(e,t){this.edits=e,this.changeAnnotations=t}insert(e,t,i){let r,s;if(void 0===i?r=S.insert(e,t):k.is(i)?(s=i,r=x.insert(e,t,i)):(this.assertChangeAnnotations(this.changeAnnotations),s=this.changeAnnotations.manage(i),r=x.insert(e,t,s)),this.edits.push(r),void 0!==s)return s}replace(e,t,i){let r,s;if(void 0===i?r=S.replace(e,t):k.is(i)?(s=i,r=x.replace(e,t,i)):(this.assertChangeAnnotations(this.changeAnnotations),s=this.changeAnnotations.manage(i),r=x.replace(e,t,s)),this.edits.push(r),void 0!==s)return s}delete(e,t){let i,r;if(void 0===t?i=S.del(e):k.is(t)?(r=t,i=x.del(e,t)):(this.assertChangeAnnotations(this.changeAnnotations),r=this.changeAnnotations.manage(t),i=x.del(e,r)),this.edits.push(i),void 0!==r)return r}add(e){this.edits.push(e)}all(){return this.edits}clear(){this.edits.splice(0,this.edits.length)}assertChangeAnnotations(e){if(void 0===e)throw new Error("Text edit change is not configured to manage change annotations.")}}class De{constructor(e){this._annotations=void 0===e?Object.create(null):e,this._counter=0,this._size=0}all(){return this._annotations}get size(){return this._size}manage(e,t){let i;if(k.is(e)?i=e:(i=this.nextId(),t=e),void 0!==this._annotations[i])throw new Error(`Id ${i} is already in use.`);if(void 0===t)throw new Error(`No annotation provided for id ${i}`);return this._annotations[i]=t,this._size++,i}nextId(){return this._counter++,this._counter.toString()}}class Te{constructor(e){this._textEditChanges=Object.create(null),void 0!==e?(this._workspaceEdit=e,e.documentChanges?(this._changeAnnotations=new De(e.changeAnnotations),e.changeAnnotations=this._changeAnnotations.all(),e.documentChanges.forEach((e=>{if(R.is(e)){const t=new Ee(e.edits,this._changeAnnotations);this._textEditChanges[e.textDocument.uri]=t}}))):e.changes&&Object.keys(e.changes).forEach((t=>{const i=new Ee(e.changes[t]);this._textEditChanges[t]=i}))):this._workspaceEdit={}}get edit(){return this.initDocumentChanges(),void 0!==this._changeAnnotations&&(0===this._changeAnnotations.size?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit}getTextEditChange(e){if(L.is(e)){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");const t={uri:e.uri,version:e.version};let i=this._textEditChanges[t.uri];if(!i){const e=[],r={textDocument:t,edits:e};this._workspaceEdit.documentChanges.push(r),i=new Ee(e,this._changeAnnotations),this._textEditChanges[t.uri]=i}return i}{if(this.initChanges(),void 0===this._workspaceEdit.changes)throw new Error("Workspace edit is not configured for normal text edit changes.");let t=this._textEditChanges[e];if(!t){let i=[];this._workspaceEdit.changes[e]=i,t=new Ee(i),this._textEditChanges[e]=t}return t}}initDocumentChanges(){void 0===this._workspaceEdit.documentChanges&&void 0===this._workspaceEdit.changes&&(this._changeAnnotations=new De,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())}initChanges(){void 0===this._workspaceEdit.documentChanges&&void 0===this._workspaceEdit.changes&&(this._workspaceEdit.changes=Object.create(null))}createFile(e,t,i){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");let r,s,n;if(C.is(t)||k.is(t)?r=t:i=t,void 0===r?s=E.create(e,i):(n=k.is(r)?r:this._changeAnnotations.manage(r),s=E.create(e,i,n)),this._workspaceEdit.documentChanges.push(s),void 0!==n)return n}renameFile(e,t,i,r){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");let s,n,o;if(C.is(i)||k.is(i)?s=i:r=i,void 0===s?n=D.create(e,t,r):(o=k.is(s)?s:this._changeAnnotations.manage(s),n=D.create(e,t,r,o)),this._workspaceEdit.documentChanges.push(n),void 0!==o)return o}deleteFile(e,t,i){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");let r,s,n;if(C.is(t)||k.is(t)?r=t:i=t,void 0===r?s=T.create(e,i):(n=k.is(r)?r:this._changeAnnotations.manage(r),s=T.create(e,i,n)),this._workspaceEdit.documentChanges.push(s),void 0!==n)return n}}!function(e){e.create=function(e){return{uri:e}},e.is=function(e){let t=e;return Oe.defined(t)&&Oe.string(t.uri)}}(A||(A={})),function(e){e.create=function(e,t){return{uri:e,version:t}},e.is=function(e){let t=e;return Oe.defined(t)&&Oe.string(t.uri)&&Oe.integer(t.version)}}(O||(O={})),function(e){e.create=function(e,t){return{uri:e,version:t}},e.is=function(e){let t=e;return Oe.defined(t)&&Oe.string(t.uri)&&(null===t.version||Oe.integer(t.version))}}(L||(L={})),function(e){e.create=function(e,t,i,r){return{uri:e,languageId:t,version:i,text:r}},e.is=function(e){let t=e;return Oe.defined(t)&&Oe.string(t.uri)&&Oe.string(t.languageId)&&Oe.integer(t.version)&&Oe.string(t.text)}}(P||(P={})),function(e){e.PlainText="plaintext",e.Markdown="markdown",e.is=function(t){const i=t;return i===e.PlainText||i===e.Markdown}}(B||(B={})),function(e){e.is=function(e){const t=e;return Oe.objectLiteral(e)&&B.is(t.kind)&&Oe.string(t.value)}}(I||(I={})),function(e){e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25}(N||(N={})),function(e){e.PlainText=1,e.Snippet=2}(q||(q={})),function(e){e.Deprecated=1}(H||(H={})),function(e){e.create=function(e,t,i){return{newText:e,insert:t,replace:i}},e.is=function(e){const t=e;return t&&Oe.string(t.newText)&&l.is(t.insert)&&l.is(t.replace)}}(F||(F={})),function(e){e.asIs=1,e.adjustIndentation=2}(W||(W={})),function(e){e.is=function(e){const t=e;return t&&(Oe.string(t.detail)||void 0===t.detail)&&(Oe.string(t.description)||void 0===t.description)}}(j||(j={})),function(e){e.create=function(e){return{label:e}}}($||($={})),function(e){e.create=function(e,t){return{items:e||[],isIncomplete:!!t}}}(z||(z={})),function(e){e.fromPlainText=function(e){return e.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")},e.is=function(e){const t=e;return Oe.string(t)||Oe.objectLiteral(t)&&Oe.string(t.language)&&Oe.string(t.value)}}(U||(U={})),function(e){e.is=function(e){let t=e;return!!t&&Oe.objectLiteral(t)&&(I.is(t.contents)||U.is(t.contents)||Oe.typedArray(t.contents,U.is))&&(void 0===e.range||l.is(e.range))}}(V||(V={})),function(e){e.create=function(e,t){return t?{label:e,documentation:t}:{label:e}}}(K||(K={})),function(e){e.create=function(e,t,...i){let r={label:e};return Oe.defined(t)&&(r.documentation=t),Oe.defined(i)?r.parameters=i:r.parameters=[],r}}(G||(G={})),function(e){e.Text=1,e.Read=2,e.Write=3}(J||(J={})),function(e){e.create=function(e,t){let i={range:e};return Oe.number(t)&&(i.kind=t),i}}(X||(X={})),function(e){e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26}(Y||(Y={})),function(e){e.Deprecated=1}(Z||(Z={})),function(e){e.create=function(e,t,i,r,s){let n={name:e,kind:t,location:{uri:r,range:i}};return s&&(n.containerName=s),n}}(Q||(Q={})),function(e){e.create=function(e,t,i,r){return void 0!==r?{name:e,kind:t,location:{uri:i,range:r}}:{name:e,kind:t,location:{uri:i}}}}(ee||(ee={})),function(e){e.create=function(e,t,i,r,s,n){let o={name:e,detail:t,kind:i,range:r,selectionRange:s};return void 0!==n&&(o.children=n),o},e.is=function(e){let t=e;return t&&Oe.string(t.name)&&Oe.number(t.kind)&&l.is(t.range)&&l.is(t.selectionRange)&&(void 0===t.detail||Oe.string(t.detail))&&(void 0===t.deprecated||Oe.boolean(t.deprecated))&&(void 0===t.children||Array.isArray(t.children))&&(void 0===t.tags||Array.isArray(t.tags))}}(te||(te={})),function(e){e.Empty="",e.QuickFix="quickfix",e.Refactor="refactor",e.RefactorExtract="refactor.extract",e.RefactorInline="refactor.inline",e.RefactorRewrite="refactor.rewrite",e.Source="source",e.SourceOrganizeImports="source.organizeImports",e.SourceFixAll="source.fixAll"}(ie||(ie={})),function(e){e.Invoked=1,e.Automatic=2}(re||(re={})),function(e){e.create=function(e,t,i){let r={diagnostics:e};return null!=t&&(r.only=t),null!=i&&(r.triggerKind=i),r},e.is=function(e){let t=e;return Oe.defined(t)&&Oe.typedArray(t.diagnostics,b.is)&&(void 0===t.only||Oe.typedArray(t.only,Oe.string))&&(void 0===t.triggerKind||t.triggerKind===re.Invoked||t.triggerKind===re.Automatic)}}(se||(se={})),function(e){e.create=function(e,t,i){let r={title:e},s=!0;return"string"==typeof t?(s=!1,r.kind=t):w.is(t)?r.command=t:r.edit=t,s&&void 0!==i&&(r.kind=i),r},e.is=function(e){let t=e;return t&&Oe.string(t.title)&&(void 0===t.diagnostics||Oe.typedArray(t.diagnostics,b.is))&&(void 0===t.kind||Oe.string(t.kind))&&(void 0!==t.edit||void 0!==t.command)&&(void 0===t.command||w.is(t.command))&&(void 0===t.isPreferred||Oe.boolean(t.isPreferred))&&(void 0===t.edit||M.is(t.edit))}}(ne||(ne={})),function(e){e.create=function(e,t){let i={range:e};return Oe.defined(t)&&(i.data=t),i},e.is=function(e){let t=e;return Oe.defined(t)&&l.is(t.range)&&(Oe.undefined(t.command)||w.is(t.command))}}(oe||(oe={})),function(e){e.create=function(e,t){return{tabSize:e,insertSpaces:t}},e.is=function(e){let t=e;return Oe.defined(t)&&Oe.uinteger(t.tabSize)&&Oe.boolean(t.insertSpaces)}}(ae||(ae={})),function(e){e.create=function(e,t,i){return{range:e,target:t,data:i}},e.is=function(e){let t=e;return Oe.defined(t)&&l.is(t.range)&&(Oe.undefined(t.target)||Oe.string(t.target))}}(le||(le={})),function(e){e.create=function(e,t){return{range:e,parent:t}},e.is=function(t){let i=t;return Oe.objectLiteral(i)&&l.is(i.range)&&(void 0===i.parent||e.is(i.parent))}}(ce||(ce={})),function(e){e.namespace="namespace",e.type="type",e.class="class",e.enum="enum",e.interface="interface",e.struct="struct",e.typeParameter="typeParameter",e.parameter="parameter",e.variable="variable",e.property="property",e.enumMember="enumMember",e.event="event",e.function="function",e.method="method",e.macro="macro",e.keyword="keyword",e.modifier="modifier",e.comment="comment",e.string="string",e.number="number",e.regexp="regexp",e.operator="operator",e.decorator="decorator"}(he||(he={})),function(e){e.declaration="declaration",e.definition="definition",e.readonly="readonly",e.static="static",e.deprecated="deprecated",e.abstract="abstract",e.async="async",e.modification="modification",e.documentation="documentation",e.defaultLibrary="defaultLibrary"}(ue||(ue={})),function(e){e.is=function(e){const t=e;return Oe.objectLiteral(t)&&(void 0===t.resultId||"string"==typeof t.resultId)&&Array.isArray(t.data)&&(0===t.data.length||"number"==typeof t.data[0])}}(de||(de={})),function(e){e.create=function(e,t){return{range:e,text:t}},e.is=function(e){const t=e;return null!=t&&l.is(t.range)&&Oe.string(t.text)}}(fe||(fe={})),function(e){e.create=function(e,t,i){return{range:e,variableName:t,caseSensitiveLookup:i}},e.is=function(e){const t=e;return null!=t&&l.is(t.range)&&Oe.boolean(t.caseSensitiveLookup)&&(Oe.string(t.variableName)||void 0===t.variableName)}}(pe||(pe={})),function(e){e.create=function(e,t){return{range:e,expression:t}},e.is=function(e){const t=e;return null!=t&&l.is(t.range)&&(Oe.string(t.expression)||void 0===t.expression)}}(ge||(ge={})),function(e){e.create=function(e,t){return{frameId:e,stoppedLocation:t}},e.is=function(e){const t=e;return Oe.defined(t)&&l.is(e.stoppedLocation)}}(me||(me={})),function(e){e.Type=1,e.Parameter=2,e.is=function(e){return 1===e||2===e}}(ve||(ve={})),function(e){e.create=function(e){return{value:e}},e.is=function(e){const t=e;return Oe.objectLiteral(t)&&(void 0===t.tooltip||Oe.string(t.tooltip)||I.is(t.tooltip))&&(void 0===t.location||c.is(t.location))&&(void 0===t.command||w.is(t.command))}}(_e||(_e={})),function(e){e.create=function(e,t,i){const r={position:e,label:t};return void 0!==i&&(r.kind=i),r},e.is=function(e){const t=e;return Oe.objectLiteral(t)&&a.is(t.position)&&(Oe.string(t.label)||Oe.typedArray(t.label,_e.is))&&(void 0===t.kind||ve.is(t.kind))&&void 0===t.textEdits||Oe.typedArray(t.textEdits,S.is)&&(void 0===t.tooltip||Oe.string(t.tooltip)||I.is(t.tooltip))&&(void 0===t.paddingLeft||Oe.boolean(t.paddingLeft))&&(void 0===t.paddingRight||Oe.boolean(t.paddingRight))}}(ye||(ye={})),function(e){e.createSnippet=function(e){return{kind:"snippet",value:e}}}(be||(be={})),function(e){e.create=function(e,t,i,r){return{insertText:e,filterText:t,range:i,command:r}}}(we||(we={})),function(e){e.create=function(e){return{items:e}}}(Se||(Se={})),function(e){e.Invoked=0,e.Automatic=1}(Ce||(Ce={})),function(e){e.create=function(e,t){return{range:e,text:t}}}(ke||(ke={})),function(e){e.create=function(e,t){return{triggerKind:e,selectedCompletionInfo:t}}}(xe||(xe={})),function(e){e.is=function(e){const t=e;return Oe.objectLiteral(t)&&s.is(t.uri)&&Oe.string(t.name)}}(Re||(Re={}));const Me=["\n","\r\n","\r"];var Ae,Oe;!function(e){function t(e,i){if(e.length<=1)return e;const r=e.length/2|0,s=e.slice(0,r),n=e.slice(r);t(s,i),t(n,i);let o=0,a=0,l=0;for(;o<s.length&&a<n.length;){let t=i(s[o],n[a]);e[l++]=t<=0?s[o++]:n[a++]}for(;o<s.length;)e[l++]=s[o++];for(;a<n.length;)e[l++]=n[a++];return e}e.create=function(e,t,i,r){return new Le(e,t,i,r)},e.is=function(e){let t=e;return!!(Oe.defined(t)&&Oe.string(t.uri)&&(Oe.undefined(t.languageId)||Oe.string(t.languageId))&&Oe.uinteger(t.lineCount)&&Oe.func(t.getText)&&Oe.func(t.positionAt)&&Oe.func(t.offsetAt))},e.applyEdits=function(e,i){let r=e.getText(),s=t(i,((e,t)=>{let i=e.range.start.line-t.range.start.line;return 0===i?e.range.start.character-t.range.start.character:i})),n=r.length;for(let t=s.length-1;t>=0;t--){let i=s[t],o=e.offsetAt(i.range.start),a=e.offsetAt(i.range.end);if(!(a<=n))throw new Error("Overlapping edit");r=r.substring(0,o)+i.newText+r.substring(a,r.length),n=o}return r}}(Ae||(Ae={}));class Le{constructor(e,t,i,r){this._uri=e,this._languageId=t,this._version=i,this._content=r,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(e){if(e){let t=this.offsetAt(e.start),i=this.offsetAt(e.end);return this._content.substring(t,i)}return this._content}update(e,t){this._content=e.text,this._version=t,this._lineOffsets=void 0}getLineOffsets(){if(void 0===this._lineOffsets){let e=[],t=this._content,i=!0;for(let r=0;r<t.length;r++){i&&(e.push(r),i=!1);let s=t.charAt(r);i="\r"===s||"\n"===s,"\r"===s&&r+1<t.length&&"\n"===t.charAt(r+1)&&r++}i&&t.length>0&&e.push(t.length),this._lineOffsets=e}return this._lineOffsets}positionAt(e){e=Math.max(Math.min(e,this._content.length),0);let t=this.getLineOffsets(),i=0,r=t.length;if(0===r)return a.create(0,e);for(;i<r;){let s=Math.floor((i+r)/2);t[s]>e?r=s:i=s+1}let s=i-1;return a.create(s,e-t[s])}offsetAt(e){let t=this.getLineOffsets();if(e.line>=t.length)return this._content.length;if(e.line<0)return 0;let i=t[e.line],r=e.line+1<t.length?t[e.line+1]:this._content.length;return Math.max(Math.min(i+e.character,r),i)}get lineCount(){return this.getLineOffsets().length}}!function(e){const t=Object.prototype.toString;e.defined=function(e){return void 0!==e},e.undefined=function(e){return void 0===e},e.boolean=function(e){return!0===e||!1===e},e.string=function(e){return"[object String]"===t.call(e)},e.number=function(e){return"[object Number]"===t.call(e)},e.numberRange=function(e,i,r){return"[object Number]"===t.call(e)&&i<=e&&e<=r},e.integer=function(e){return"[object Number]"===t.call(e)&&-2147483648<=e&&e<=2147483647},e.uinteger=function(e){return"[object Number]"===t.call(e)&&0<=e&&e<=2147483647},e.func=function(e){return"[object Function]"===t.call(e)},e.objectLiteral=function(e){return null!==e&&"object"==typeof e},e.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)}}(Oe||(Oe={}))},6439:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,s)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageConnection=t.BrowserMessageWriter=t.BrowserMessageReader=void 0,i(4615).default.install();const n=i(3281);s(i(3281),t);class o extends n.AbstractMessageReader{constructor(e){super(),this._onData=new n.Emitter,this._messageListener=e=>{this._onData.fire(e.data)},e.addEventListener("error",(e=>this.fireError(e))),e.onmessage=this._messageListener}listen(e){return this._onData.event(e)}}t.BrowserMessageReader=o;class a extends n.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.addEventListener("error",(e=>this.fireError(e)))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}}t.BrowserMessageWriter=a,t.createMessageConnection=function(e,t,i,r){return void 0===i&&(i=n.NullLogger),n.ConnectionStrategy.is(r)&&(r={connectionStrategy:r}),(0,n.createMessageConnection)(e,t,i,r)}},6499:function(e,t,i){"use strict";var r,s=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},r(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var i,r,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=a(i(169)),c=i(7902),h=i(8297),u=i(8014),d=function(e){function t(t){var i=e.call(this)||this;return i.uri=t,i.connection=new l.default(t),i}return s(t,e),t.prototype.connect=function(){var e=this;return new Promise((function(t,i){var r=function(){e.connection.removeEventListener("open",r),t()};e.connection.addEventListener("open",r),e.connection.addEventListener("message",(function(t){var i=t.data;e.transportRequestManager.resolveResponse(i)}))}))},t.prototype.sendData=function(e,t){return void 0===t&&(t=5e3),n(this,void 0,void 0,(function(){var i,r,s;return o(this,(function(n){i=this.transportRequestManager.addRequest(e,t),r=h.getNotifications(e);try{this.connection.send(JSON.stringify(this.parseData(e))),this.transportRequestManager.settlePendingRequest(r)}catch(t){s=new u.JSONRPCError(t.message,u.ERR_UNKNOWN,t),this.transportRequestManager.settlePendingRequest(r,s),this.transportRequestManager.settlePendingRequest(h.getBatchRequests(e),s),i=Promise.reject(s)}return[2,i]}))}))},t.prototype.close=function(){this.connection.close()},t}(c.Transport);t.default=d},6914:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeclarationRequest=void 0;const r=i(372);var s;!function(e){e.method="textDocument/declaration",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.DeclarationRequest=s={}))},7007:e=>{"use strict";var t,i="object"==typeof Reflect?Reflect:null,r=i&&"function"==typeof i.apply?i.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};t=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function n(){n.init.call(this)}e.exports=n,e.exports.once=function(e,t){return new Promise((function(i,r){function s(i){e.removeListener(t,n),r(i)}function n(){"function"==typeof e.removeListener&&e.removeListener("error",s),i([].slice.call(arguments))}g(e,t,n,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,s)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function c(e,t,i,r){var s,n,o,c;if(a(i),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),n=e._events),o=n[t]),void 0===o)o=n[t]=i,++e._eventsCount;else if("function"==typeof o?o=n[t]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),(s=l(e))>0&&o.length>s&&!o.warned){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=o.length,c=h,console&&console.warn&&console.warn(c)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},s=h.bind(r);return s.listener=i,r.wrapFn=s,s}function d(e,t,i){var r=e._events;if(void 0===r)return[];var s=r[t];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(s):p(s,s.length)}function f(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}function g(e,t,i,r){if("function"==typeof e.on)r.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(n){r.once&&e.removeEventListener(t,s),i(n)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var s="error"===e,n=this._events;if(void 0!==n)s=s&&void 0===n.error;else if(!s)return!1;if(s){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=n[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var c=l.length,h=p(l,c);for(i=0;i<c;++i)r(h[i],this,t)}return!0},n.prototype.addListener=function(e,t){return c(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return c(this,e,t,!0)},n.prototype.once=function(e,t){return a(t),this.on(e,u(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,u(this,e,t)),this},n.prototype.removeListener=function(e,t){var i,r,s,n,o;if(a(t),void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(s=-1,n=i.length-1;n>=0;n--)if(i[n]===t||i[n].listener===t){o=i[n].listener,s=n;break}if(s<0)return this;0===s?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,s),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var s,n=Object.keys(i);for(r=0;r<n.length;++r)"removeListener"!==(s=n[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},n.prototype.listeners=function(e){return d(this,e,!0)},n.prototype.rawListeners=function(e){return d(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},n.prototype.listenerCount=f,n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7672:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorPresentationRequest=t.DocumentColorRequest=void 0;const r=i(372);var s,n;!function(e){e.method="textDocument/documentColor",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.DocumentColorRequest=s={})),function(e){e.method="textDocument/colorPresentation",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(n||(t.ColorPresentationRequest=n={}))},7752:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InlayHintRefreshRequest=t.InlayHintResolveRequest=t.InlayHintRequest=void 0;const r=i(372);var s,n,o;!function(e){e.method="textDocument/inlayHint",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.InlayHintRequest=s={})),function(e){e.method="inlayHint/resolve",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(n||(t.InlayHintResolveRequest=n={})),function(e){e.method="workspace/inlayHint/refresh",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType0(e.method)}(o||(t.InlayHintRefreshRequest=o={}))},7856:e=>{var t;globalThis,t=()=>(()=>{"use strict";var e={4567:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;const n=i(9042),o=i(9924),a=i(844),l=i(4725),c=i(2585),h=i(3656);let u=t.AccessibilityManager=class extends a.Disposable{constructor(e,t,i,r){super(),this._terminal=e,this._coreBrowserService=i,this._renderService=r,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let e=0;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);if(this._topBoundaryFocusListener=e=>this._handleBoundaryFocus(e,0),this._bottomBoundaryFocusListener=e=>this._handleBoundaryFocus(e,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new o.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((e=>this._handleResize(e.rows)))),this.register(this._terminal.onRender((e=>this._refreshRows(e.start,e.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((e=>this._handleChar(e)))),this.register(this._terminal.onLineFeed((()=>this._handleChar("\n")))),this.register(this._terminal.onA11yTab((e=>this._handleTab(e)))),this.register(this._terminal.onKey((e=>this._handleKey(e.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,h.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,a.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,"\n"===e&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=n.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),/\p{Control}/u.test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){const i=this._terminal.buffer,r=i.lines.length.toString();for(let s=e;s<=t;s++){const e=i.lines.get(i.ydisp+s),t=[],n=e?.translateToString(!0,void 0,void 0,t)||"",o=(i.ydisp+s+1).toString(),a=this._rowElements[s];a&&(0===n.length?(a.innerText="",this._rowColumns.set(a,[0,1])):(a.textContent=n,this._rowColumns.set(a,t)),a.setAttribute("aria-posinset",o),a.setAttribute("aria-setsize",r))}this._announceCharacters()}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){const i=e.target,r=this._rowElements[0===t?1:this._rowElements.length-2];if(i.getAttribute("aria-posinset")===(0===t?"1":`${this._terminal.buffer.lines.length}`))return;if(e.relatedTarget!==r)return;let s,n;if(0===t?(s=i,n=this._rowElements.pop(),this._rowContainer.removeChild(n)):(s=this._rowElements.shift(),n=i,this._rowContainer.removeChild(s)),s.removeEventListener("focus",this._topBoundaryFocusListener),n.removeEventListener("focus",this._bottomBoundaryFocusListener),0===t){const e=this._createAccessibilityTreeNode();this._rowElements.unshift(e),this._rowContainer.insertAdjacentElement("afterbegin",e)}else{const e=this._createAccessibilityTreeNode();this._rowElements.push(e),this._rowContainer.appendChild(e)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===t?-1:1),this._rowElements[0===t?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){if(0===this._rowElements.length)return;const e=document.getSelection();if(!e)return;if(e.isCollapsed)return void(this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection());if(!e.anchorNode||!e.focusNode)return void console.error("anchorNode and/or focusNode are null");let t={node:e.anchorNode,offset:e.anchorOffset},i={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(i.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===i.node&&t.offset>i.offset)&&([t,i]=[i,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;const r=this._rowElements.slice(-1)[0];if(i.node.compareDocumentPosition(r)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(i={node:r,offset:r.textContent?.length??0}),!this._rowContainer.contains(i.node))return;const s=({node:e,offset:t})=>{const i=e instanceof Text?e.parentNode:e;let r=parseInt(i?.getAttribute("aria-posinset"),10)-1;if(isNaN(r))return console.warn("row is invalid. Race condition?"),null;const s=this._rowColumns.get(i);if(!s)return console.warn("columns is null. Race condition?"),null;let n=t<s.length?s[t]:s.slice(-1)[0]+1;return n>=this._terminal.cols&&(++r,n=0),{row:r,column:n}},n=s(t),o=s(i);if(n&&o){if(n.row>o.row||n.row===o.row&&n.column>=o.column)throw new Error("invalid range");this._terminal.select(n.column,n.row,(o.row-n.row)*this._terminal.cols-n.column+o.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let e=this._rowContainer.children.length;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}};t.AccessibilityManager=u=r([s(1,c.IInstantiationService),s(2,l.ICoreBrowserService),s(3,l.IRenderService)],u)},3614:(e,t)=>{function i(e){return e.replace(/\r?\n/g,"\r")}function r(e,t){return t?"[200~"+e+"[201~":e}function s(e,t,s,n){e=r(e=i(e),s.decPrivateModes.bracketedPasteMode&&!0!==n.rawOptions.ignoreBracketedPasteMode),s.triggerDataEvent(e,!0),t.value=""}function n(e,t,i){const r=i.getBoundingClientRect(),s=e.clientX-r.left-10,n=e.clientY-r.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${s}px`,t.style.top=`${n}px`,t.style.zIndex="1000",t.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=i,t.bracketTextForPaste=r,t.copyHandler=function(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()},t.handlePasteEvent=function(e,t,i,r){e.stopPropagation(),e.clipboardData&&s(e.clipboardData.getData("text/plain"),t,i,r)},t.paste=s,t.moveTextAreaUnderMouseCursor=n,t.rightClickHandler=function(e,t,i,r,s){n(e,t,i),s&&r.rightClickSelect(e),t.value=r.selectionText,t.select()}},7239:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;const r=i(1505);t.ColorContrastCache=class{constructor(){this._color=new r.TwoKeyMap,this._css=new r.TwoKeyMap}setCss(e,t,i){this._css.set(e,t,i)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,i){this._color.set(e,t,i)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}}},3656:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(e,t,i,r){e.addEventListener(t,i,r);let s=!1;return{dispose:()=>{s||(s=!0,e.removeEventListener(t,i,r))}}}},3551:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier=void 0;const n=i(3656),o=i(8460),a=i(844),l=i(2585),c=i(4725);let h=t.Linkifier=class extends a.Disposable{get currentLink(){return this._currentLink}constructor(e,t,i,r,s){super(),this._element=e,this._mouseService=t,this._renderService=i,this._bufferService=r,this._linkProviderService=s,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new o.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new o.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,a.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,a.toDisposable)((()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,n.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,n.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){this._lastMouseEvent=e;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;const i=e.composedPath();for(let e=0;e<i.length;e++){const t=i[e];if(t.classList.contains("xterm"))break;if(t.classList.contains("xterm-hover"))return}this._lastBufferCell&&t.x===this._lastBufferCell.x&&t.y===this._lastBufferCell.y||(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(e,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){this._activeProviderReplies&&t||(this._activeProviderReplies?.forEach((e=>{e?.forEach((e=>{e.link.dispose&&e.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=e.y);let i=!1;for(const[r,s]of this._linkProviderService.linkProviders.entries())if(t){const t=this._activeProviderReplies?.get(r);t&&(i=this._checkLinkProviderResult(r,e,i))}else s.provideLinks(e.y,(t=>{if(this._isMouseOut)return;const s=t?.map((e=>({link:e})));this._activeProviderReplies?.set(r,s),i=this._checkLinkProviderResult(r,e,i),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)}))}_removeIntersectingLinks(e,t){const i=new Set;for(let r=0;r<t.size;r++){const s=t.get(r);if(s)for(let t=0;t<s.length;t++){const r=s[t],n=r.link.range.start.y<e?0:r.link.range.start.x,o=r.link.range.end.y>e?this._bufferService.cols:r.link.range.end.x;for(let e=n;e<=o;e++){if(i.has(e)){s.splice(t--,1);break}i.add(e)}}}}_checkLinkProviderResult(e,t,i){if(!this._activeProviderReplies)return i;const r=this._activeProviderReplies.get(e);let s=!1;for(let t=0;t<e;t++)this._activeProviderReplies.has(t)&&!this._activeProviderReplies.get(t)||(s=!0);if(!s&&r){const e=r.find((e=>this._linkAtPosition(e.link,t)));e&&(i=!0,this._handleNewLink(e))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!i)for(let e=0;e<this._activeProviderReplies.size;e++){const r=this._activeProviderReplies.get(e)?.find((e=>this._linkAtPosition(e.link,t)));if(r){i=!0,this._handleNewLink(r);break}}return i}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._currentLink)return;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){this._currentLink&&this._lastMouseEvent&&(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,a.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._lastMouseEvent)return;const t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:void 0===e.link.decorations||e.link.decorations.underline,pointerCursor:void 0===e.link.decorations||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:e=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==e&&(this._currentLink.state.decorations.pointerCursor=e,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",e))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:t=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,t))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((e=>{if(!this._currentLink)return;const t=0===e.start?0:e.start+1+this._bufferService.buffer.ydisp,i=this._bufferService.buffer.ydisp+1+e.end;if(this._currentLink.link.range.start.y>=t&&this._currentLink.link.range.end.y<=i&&(this._clearCurrentLink(t,i),this._lastMouseEvent)){const e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._askForLink(e,!1)}}))))}_linkHover(e,t,i){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(i,t.text)}_fireUnderlineEvent(e,t){const i=e.range,r=this._bufferService.buffer.ydisp,s=this._createLinkUnderlineEvent(i.start.x-1,i.start.y-r-1,i.end.x,i.end.y-r-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(s)}_linkLeave(e,t,i){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(i,t.text)}_linkAtPosition(e,t){const i=e.range.start.y*this._bufferService.cols+e.range.start.x,r=e.range.end.y*this._bufferService.cols+e.range.end.x,s=t.y*this._bufferService.cols+t.x;return i<=s&&s<=r}_positionFromMouseEvent(e,t,i){const r=i.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(r)return{x:r[0],y:r[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,i,r,s){return{x1:e,y1:t,x2:i,y2:r,cols:this._bufferService.cols,fg:s}}};t.Linkifier=h=r([s(1,c.IMouseService),s(2,c.IRenderService),s(3,l.IBufferService),s(4,c.ILinkProviderService)],h)},9042:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;const n=i(511),o=i(2585);let a=t.OscLinkProvider=class{constructor(e,t,i){this._bufferService=e,this._optionsService=t,this._oscLinkService=i}provideLinks(e,t){const i=this._bufferService.buffer.lines.get(e-1);if(!i)return void t(void 0);const r=[],s=this._optionsService.rawOptions.linkHandler,o=new n.CellData,a=i.getTrimmedLength();let c=-1,h=-1,u=!1;for(let t=0;t<a;t++)if(-1!==h||i.hasContent(t)){if(i.loadCell(t,o),o.hasExtendedAttrs()&&o.extended.urlId){if(-1===h){h=t,c=o.extended.urlId;continue}u=o.extended.urlId!==c}else-1!==h&&(u=!0);if(u||-1!==h&&t===a-1){const i=this._oscLinkService.getLinkData(c)?.uri;if(i){const n={start:{x:h+1,y:e},end:{x:t+(u||t!==a-1?0:1),y:e}};let o=!1;if(!s?.allowNonHttpProtocols)try{const e=new URL(i);["http:","https:"].includes(e.protocol)||(o=!0)}catch(e){o=!0}o||r.push({text:i,range:n,activate:(e,t)=>s?s.activate(e,t,n):l(0,t),hover:(e,t)=>s?.hover?.(e,t,n),leave:(e,t)=>s?.leave?.(e,t,n)})}u=!1,o.hasExtendedAttrs()&&o.extended.urlId?(h=t,c=o.extended.urlId):(h=-1,c=-1)}}t(r)}};function l(e,t){if(confirm(`Do you want to navigate to ${t}?\n\nWARNING: This link could potentially be dangerous`)){const e=window.open();if(e){try{e.opener=null}catch{}e.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}t.OscLinkProvider=a=r([s(0,o.IBufferService),s(1,o.IOptionsService),s(2,o.IOscLinkService)],a)},6193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(e,t,i){this._rowCount=i,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}}},3236:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const r=i(3614),s=i(3656),n=i(3551),o=i(9042),a=i(3730),l=i(1680),c=i(3107),h=i(5744),u=i(2950),d=i(1296),f=i(428),p=i(4269),g=i(5114),m=i(8934),v=i(3230),_=i(9312),y=i(4725),b=i(6731),w=i(8055),S=i(8969),C=i(8460),k=i(844),x=i(6114),R=i(8437),E=i(2584),D=i(7399),T=i(5941),M=i(9074),A=i(2585),O=i(5435),L=i(4567),P=i(779);class B extends S.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(e={}){super(e),this.browser=x,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new k.MutableDisposable),this._onCursorMove=this.register(new C.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new C.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new C.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new C.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new C.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new C.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new C.EventEmitter),this._onBlur=this.register(new C.EventEmitter),this._onA11yCharEmitter=this.register(new C.EventEmitter),this._onA11yTabEmitter=this.register(new C.EventEmitter),this._onWillOpen=this.register(new C.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(M.DecorationService),this._instantiationService.setService(A.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(P.LinkProviderService),this._instantiationService.setService(y.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(a.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((e,t)=>this.refresh(e,t)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((e=>this._reportWindowsOptions(e)))),this.register(this._inputHandler.onColor((e=>this._handleColorEvent(e)))),this.register((0,C.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,C.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,C.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,C.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((e=>this._afterResize(e.cols,e.rows)))),this.register((0,k.toDisposable)((()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)})))}_handleColorEvent(e){if(this._themeService)for(const t of e){let e,i="";switch(t.index){case 256:e="foreground",i="10";break;case 257:e="background",i="11";break;case 258:e="cursor",i="12";break;default:e="ansi",i="4;"+t.index}switch(t.type){case 0:const r=w.color.toColorRGB("ansi"===e?this._themeService.colors.ansi[t.index]:this._themeService.colors[e]);this.coreService.triggerDataEvent(`${E.C0.ESC}]${i};${(0,T.toRgbString)(r)}${E.C1_ESCAPED.ST}`);break;case 1:if("ansi"===e)this._themeService.modifyColors((e=>e.ansi[t.index]=w.channels.toColor(...t.color)));else{const i=e;this._themeService.modifyColors((e=>e[i]=w.channels.toColor(...t.color)))}break;case 2:this._themeService.restoreColor(t.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(L.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(E.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(E.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;const i=Math.min(this.buffer.x,this.cols-1),r=this._renderService.dimensions.css.cell.height,s=t.getWidth(i),n=this._renderService.dimensions.css.cell.width*s,o=this.buffer.y*this._renderService.dimensions.css.cell.height,a=i*this._renderService.dimensions.css.cell.width;this.textarea.style.left=a+"px",this.textarea.style.top=o+"px",this.textarea.style.width=n+"px",this.textarea.style.height=r+"px",this.textarea.style.lineHeight=r+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,s.addDisposableDomListener)(this.element,"copy",(e=>{this.hasSelection()&&(0,r.copyHandler)(e,this._selectionService)})));const e=e=>(0,r.handlePasteEvent)(e,this.textarea,this.coreService,this.optionsService);this.register((0,s.addDisposableDomListener)(this.textarea,"paste",e)),this.register((0,s.addDisposableDomListener)(this.element,"paste",e)),x.isFirefox?this.register((0,s.addDisposableDomListener)(this.element,"mousedown",(e=>{2===e.button&&(0,r.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,s.addDisposableDomListener)(this.element,"contextmenu",(e=>{(0,r.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),x.isLinux&&this.register((0,s.addDisposableDomListener)(this.element,"auxclick",(e=>{1===e.button&&(0,r.moveTextAreaUnderMouseCursor)(e,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,s.addDisposableDomListener)(this.textarea,"keyup",(e=>this._keyUp(e)),!0)),this.register((0,s.addDisposableDomListener)(this.textarea,"keydown",(e=>this._keyDown(e)),!0)),this.register((0,s.addDisposableDomListener)(this.textarea,"keypress",(e=>this._keyPress(e)),!0)),this.register((0,s.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,s.addDisposableDomListener)(this.textarea,"compositionupdate",(e=>this._compositionHelper.compositionupdate(e)))),this.register((0,s.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,s.addDisposableDomListener)(this.textarea,"input",(e=>this._inputEvent(e)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(e){if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);const t=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),t.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,s.addDisposableDomListener)(this.screenElement,"mousemove",(e=>this.updateCursorStyle(e)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),t.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",o.promptLabel),x.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(g.CoreBrowserService,this.textarea,e.ownerDocument.defaultView??window,this._document??"undefined"!=typeof window?window.document:null)),this._instantiationService.setService(y.ICoreBrowserService,this._coreBrowserService),this.register((0,s.addDisposableDomListener)(this.textarea,"focus",(e=>this._handleTextAreaFocus(e)))),this.register((0,s.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(f.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(y.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(b.ThemeService),this._instantiationService.setService(y.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(p.CharacterJoinerService),this._instantiationService.setService(y.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(v.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(y.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((e=>this._onRender.fire(e)))),this.onResize((e=>this._renderService.resize(e.cols,e.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(u.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(m.MouseService),this._instantiationService.setService(y.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(n.Linkifier,this.screenElement)),this.element.appendChild(t);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(l.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((e=>this.scrollLines(e.amount,e.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(_.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(y.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((e=>this.scrollLines(e.amount,e.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((e=>this._renderService.handleSelectionChanged(e.start,e.end,e.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((e=>{this.textarea.value=e,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((e=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,s.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(c.BufferDecorationRenderer,this.screenElement)),this.register((0,s.addDisposableDomListener)(this.element,"mousedown",(e=>this._selectionService.handleMouseDown(e)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(L.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(e=>this._handleScreenReaderModeOptionChange(e)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(h.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(e=>{!this._overviewRulerRenderer&&e&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(h.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(d.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const e=this,t=this.element;function i(t){const i=e._mouseService.getMouseReportCoords(t,e.screenElement);if(!i)return!1;let r,s;switch(t.overrideType||t.type){case"mousemove":s=32,void 0===t.buttons?(r=3,void 0!==t.button&&(r=t.button<3?t.button:3)):r=1&t.buttons?0:4&t.buttons?1:2&t.buttons?2:3;break;case"mouseup":s=0,r=t.button<3?t.button:3;break;case"mousedown":s=1,r=t.button<3?t.button:3;break;case"wheel":if(e._customWheelEventHandler&&!1===e._customWheelEventHandler(t))return!1;if(0===e.viewport.getLinesScrolled(t))return!1;s=t.deltaY<0?0:1,r=4;break;default:return!1}return!(void 0===s||void 0===r||r>4)&&e.coreMouseService.triggerMouseEvent({col:i.col,row:i.row,x:i.x,y:i.y,button:r,action:s,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey})}const r={mouseup:null,wheel:null,mousedrag:null,mousemove:null},n={mouseup:e=>(i(e),e.buttons||(this._document.removeEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.removeEventListener("mousemove",r.mousedrag)),this.cancel(e)),wheel:e=>(i(e),this.cancel(e,!0)),mousedrag:e=>{e.buttons&&i(e)},mousemove:e=>{e.buttons||i(e)}};this.register(this.coreMouseService.onProtocolChange((e=>{e?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(e)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&e?r.mousemove||(t.addEventListener("mousemove",n.mousemove),r.mousemove=n.mousemove):(t.removeEventListener("mousemove",r.mousemove),r.mousemove=null),16&e?r.wheel||(t.addEventListener("wheel",n.wheel,{passive:!1}),r.wheel=n.wheel):(t.removeEventListener("wheel",r.wheel),r.wheel=null),2&e?r.mouseup||(r.mouseup=n.mouseup):(this._document.removeEventListener("mouseup",r.mouseup),r.mouseup=null),4&e?r.mousedrag||(r.mousedrag=n.mousedrag):(this._document.removeEventListener("mousemove",r.mousedrag),r.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,s.addDisposableDomListener)(t,"mousedown",(e=>{if(e.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(e))return i(e),r.mouseup&&this._document.addEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.addEventListener("mousemove",r.mousedrag),this.cancel(e)}))),this.register((0,s.addDisposableDomListener)(t,"wheel",(e=>{if(!r.wheel){if(this._customWheelEventHandler&&!1===this._customWheelEventHandler(e))return!1;if(!this.buffer.hasScrollback){const t=this.viewport.getLinesScrolled(e);if(0===t)return;const i=E.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(e.deltaY<0?"A":"B");let r="";for(let e=0;e<Math.abs(t);e++)r+=i;return this.coreService.triggerDataEvent(r,!0),this.cancel(e,!0)}return this.viewport.handleWheel(e)?this.cancel(e):void 0}}),{passive:!1})),this.register((0,s.addDisposableDomListener)(t,"touchstart",(e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(e),this.cancel(e)}),{passive:!0})),this.register((0,s.addDisposableDomListener)(t,"touchmove",(e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(e)?void 0:this.cancel(e)}),{passive:!1}))}refresh(e,t){this._renderService?.refreshRows(e,t)}updateCursorStyle(e){this._selectionService?.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t,i=0){1===i?(super.scrollLines(e,t,i),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(e)}paste(e){(0,r.paste)(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(e,t,i){this._selectionService.setSelection(e,t,i)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(e,t){this._selectionService?.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;const t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;t||"Dead"!==e.key&&"AltGraph"!==e.key||(this._unprocessedDeadKey=!0);const i=(0,D.evaluateKeyboardEvent)(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),3===i.type||2===i.type){const t=this.rows-1;return this.scrollLines(2===i.type?-t:t),this.cancel(e,!0)}return 1===i.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,e)||(i.cancel&&this.cancel(e,!0),!i.key||!!(e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&1===e.key.length&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(i.key!==E.C0.ETX&&i.key!==E.C0.CR||(this.textarea.value=""),this._onKey.fire({key:i.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(i.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey?this.cancel(e,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(e,t){const i=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return"keypress"===t.type?i:i&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e)||(function(e){return 16===e.keyCode||17===e.keyCode||18===e.keyCode}(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(null===e.which||void 0===e.which)t=e.keyCode;else{if(0===e.which||0===e.charCode)return!1;t=e.which}return!(!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)||(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(e){if(e.data&&"insertText"===e.inputType&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){e!==this.cols||t!==this.rows?super.resize(e,t):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(e,t){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(R.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const e=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(E.C0.ESC+"[I"):this.coreService.triggerDataEvent(E.C0.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case O.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const e=this._renderService.dimensions.css.canvas.width.toFixed(0),t=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${E.C0.ESC}[4;${t};${e}t`);break;case O.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const i=this._renderService.dimensions.css.cell.width.toFixed(0),r=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${E.C0.ESC}[6;${r};${i}t`)}}cancel(e,t){if(this.options.cancelEvents||t)return e.preventDefault(),e.stopPropagation(),!1}}t.Terminal=B},9924:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(e,t=1e3){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,i){this._rowCount=i,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t;const r=Date.now();if(r-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=r,this._innerRefresh();else if(!this._additionalRefreshRequested){const e=r-this._lastRefreshMs,t=this._debounceThresholdMS-e;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),t)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}}},1680:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const n=i(3656),o=i(4725),a=i(8460),l=i(844),c=i(2585);let h=t.Viewport=class extends l.Disposable{constructor(e,t,i,r,s,o,l,c){super(),this._viewportElement=e,this._scrollArea=t,this._bufferService=i,this._optionsService=r,this._charSizeService=s,this._renderService=o,this._coreBrowserService=l,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new a.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,n.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((e=>this._activeBuffer=e.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((e=>this._renderDimensions=e))),this._handleThemeChange(c.colors),this.register(c.onChangeColors((e=>this._handleThemeChange(e)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(e){this._viewportElement.style.backgroundColor=e.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(e){if(e)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const e=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==e&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=e),this._refreshAnimationFrame=null}syncScrollArea(e=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(e);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(e)}_handleScroll(e){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const t=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:t,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||-1===this._smoothScrollState.origin||-1===this._smoothScrollState.target)return;const e=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(e*(this._smoothScrollState.target-this._smoothScrollState.origin)),e<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(e,t){const i=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(t<0&&0!==this._viewportElement.scrollTop||t>0&&i<this._lastRecordedBufferHeight)||(e.cancelable&&e.preventDefault(),!1)}handleWheel(e){const t=this._getPixelsScrolled(e);return 0!==t&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,-1===this._smoothScrollState.target?this._smoothScrollState.target=this._viewportElement.scrollTop+t:this._smoothScrollState.target+=t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}scrollLines(e){if(0!==e)if(this._optionsService.rawOptions.smoothScrollDuration){const t=e*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:e,suppressScrollEvent:!1})}_getPixelsScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_LINE?t*=this._currentRowHeight:e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._currentRowHeight*this._bufferService.rows),t}getBufferElements(e,t){let i,r="";const s=[],n=t??this._bufferService.buffer.lines.length,o=this._bufferService.buffer.lines;for(let t=e;t<n;t++){const e=o.get(t);if(!e)continue;const n=o.get(t+1)?.isWrapped;if(r+=e.translateToString(!n),!n||t===o.length-1){const e=document.createElement("div");e.textContent=r,s.push(e),r.length>0&&(i=e),r=""}}return{bufferElements:s,cursorElement:i}}getLinesScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(t/=this._currentRowHeight+0,this._wheelPartialScroll+=t,t=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._bufferService.rows),t}_applyScrollModifier(e,t){const i=this._optionsService.rawOptions.fastScrollModifier;return"alt"===i&&t.altKey||"ctrl"===i&&t.ctrlKey||"shift"===i&&t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(e){this._lastTouchY=e.touches[0].pageY}handleTouchMove(e){const t=this._lastTouchY-e.touches[0].pageY;return this._lastTouchY=e.touches[0].pageY,0!==t&&(this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}};t.Viewport=h=r([s(2,c.IBufferService),s(3,c.IOptionsService),s(4,o.ICharSizeService),s(5,o.IRenderService),s(6,o.ICoreBrowserService),s(7,o.IThemeService)],h)},3107:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;const n=i(4725),o=i(844),a=i(2585);let l=t.BufferDecorationRenderer=class extends o.Disposable{constructor(e,t,i,r,s){super(),this._screenElement=e,this._bufferService=t,this._coreBrowserService=i,this._decorationService=r,this._renderService=s,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((e=>this._removeDecoration(e)))),this.register((0,o.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){const t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer","top"===e?.options?.layer),t.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",t.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const i=e.options.x??0;return i&&i>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(e,t),t}_refreshStyle(e){const t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let i=this._decorationElements.get(e);i||(i=this._createElement(e),e.element=i,this._decorationElements.set(e,i),this._container.appendChild(i),e.onDispose((()=>{this._decorationElements.delete(e),i.remove()}))),i.style.top=t*this._renderService.dimensions.css.cell.height+"px",i.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(i)}}_refreshXPosition(e,t=e.element){if(!t)return;const i=e.options.x??0;"right"===(e.options.anchor||"left")?t.style.right=i?i*this._renderService.dimensions.css.cell.width+"px":"":t.style.left=i?i*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){this._decorationElements.get(e)?.remove(),this._decorationElements.delete(e),e.dispose()}};t.BufferDecorationRenderer=l=r([s(1,a.IBufferService),s(2,n.ICoreBrowserService),s(3,a.IDecorationService),s(4,n.IRenderService)],l)},5871:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(const t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position))return void this._addLineToZone(t,e.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,i){return t>=e.startBufferLine-this._linePadding[i||"full"]&&t<=e.endBufferLine+this._linePadding[i||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}}},5744:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;const n=i(5871),o=i(4725),a=i(844),l=i(2585),c={full:0,left:0,center:0,right:0},h={full:0,left:0,center:0,right:0},u={full:0,left:0,center:0,right:0};let d=t.OverviewRulerRenderer=class extends a.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(e,t,i,r,s,o,l){super(),this._viewportElement=e,this._screenElement=t,this._bufferService=i,this._decorationService=r,this._renderService=s,this._optionsService=o,this._coreBrowserService=l,this._colorZoneStore=new n.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const c=this._canvas.getContext("2d");if(!c)throw new Error("Ctx cannot be null");this._ctx=c,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,a.toDisposable)((()=>{this._canvas?.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const e=Math.floor(this._canvas.width/3),t=Math.ceil(this._canvas.width/3);h.full=this._canvas.width,h.left=e,h.center=t,h.right=e,this._refreshDrawHeightConstants(),u.full=0,u.left=0,u.center=h.left,u.right=h.left+h.center}_refreshDrawHeightConstants(){c.full=Math.round(2*this._coreBrowserService.dpr);const e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);c.left=t,c.center=t,c.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const e of this._decorationService.decorations)this._colorZoneStore.addDecoration(e);this._ctx.lineWidth=1;const e=this._colorZoneStore.zones;for(const t of e)"full"!==t.position&&this._renderColorZone(t);for(const t of e)"full"===t.position&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(u[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-c[e.position||"full"]/2),h[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+c[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};t.OverviewRulerRenderer=d=r([s(2,l.IBufferService),s(3,l.IDecorationService),s(4,o.IRenderService),s(5,l.IOptionsService),s(6,o.ICoreBrowserService)],d)},2950:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;const n=i(4725),o=i(2585),a=i(2584);let l=t.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(e,t,i,r,s,n){this._textarea=e,this._compositionView=t,this._bufferService=i,this._optionsService=r,this._coreService=s,this._renderService=n,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(229===e.keyCode)return!1;if(16===e.keyCode||17===e.keyCode||18===e.keyCode)return!1;this._finalizeComposition(!1)}return 229!==e.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){const e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let t;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,t=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),t.length>0&&this._coreService.triggerDataEvent(t,!0)}}),0)}else{this._isSendingComposition=!1;const e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){const e=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const t=this._textarea.value,i=t.replace(e,"");this._dataAlreadySent=i,t.length>e.length?this._coreService.triggerDataEvent(i,!0):t.length<e.length?this._coreService.triggerDataEvent(`${a.C0.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}}),0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),t=this._renderService.dimensions.css.cell.height,i=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,r=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=r+"px",this._compositionView.style.top=i+"px",this._compositionView.style.height=t+"px",this._compositionView.style.lineHeight=t+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const s=this._compositionView.getBoundingClientRect();this._textarea.style.left=r+"px",this._textarea.style.top=i+"px",this._textarea.style.width=Math.max(s.width,1)+"px",this._textarea.style.height=Math.max(s.height,1)+"px",this._textarea.style.lineHeight=s.height+"px"}e||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};t.CompositionHelper=l=r([s(2,o.IBufferService),s(3,o.IOptionsService),s(4,o.ICoreService),s(5,n.IRenderService)],l)},9806:(e,t)=>{function i(e,t,i){const r=i.getBoundingClientRect(),s=e.getComputedStyle(i),n=parseInt(s.getPropertyValue("padding-left")),o=parseInt(s.getPropertyValue("padding-top"));return[t.clientX-r.left-n,t.clientY-r.top-o]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=i,t.getCoords=function(e,t,r,s,n,o,a,l,c){if(!o)return;const h=i(e,t,r);return h?(h[0]=Math.ceil((h[0]+(c?a/2:0))/a),h[1]=Math.ceil(h[1]/l),h[0]=Math.min(Math.max(h[0],1),s+(c?1:0)),h[1]=Math.min(Math.max(h[1],1),n),h):void 0}},9504:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;const r=i(2584);function s(e,t,i,r){const s=e-n(e,i),a=t-n(t,i),h=Math.abs(s-a)-function(e,t,i){let r=0;const s=e-n(e,i),a=t-n(t,i);for(let n=0;n<Math.abs(s-a);n++){const a="A"===o(e,t)?-1:1,l=i.buffer.lines.get(s+a*n);l?.isWrapped&&r++}return r}(e,t,i);return c(h,l(o(e,t),r))}function n(e,t){let i=0,r=t.buffer.lines.get(e),s=r?.isWrapped;for(;s&&e>=0&&e<t.rows;)i++,r=t.buffer.lines.get(--e),s=r?.isWrapped;return i}function o(e,t){return e>t?"A":"B"}function a(e,t,i,r,s,n){let o=e,a=t,l="";for(;o!==i||a!==r;)o+=s?1:-1,s&&o>n.cols-1?(l+=n.buffer.translateBufferLineToString(a,!1,e,o),o=0,e=0,a++):!s&&o<0&&(l+=n.buffer.translateBufferLineToString(a,!1,0,e+1),o=n.cols-1,e=o,a--);return l+n.buffer.translateBufferLineToString(a,!1,e,o)}function l(e,t){const i=t?"O":"[";return r.C0.ESC+i+e}function c(e,t){e=Math.floor(e);let i="";for(let r=0;r<e;r++)i+=t;return i}t.moveToCellSequence=function(e,t,i,r){const o=i.buffer.x,h=i.buffer.y;if(!i.buffer.hasScrollback)return function(e,t,i,r,o,h){return 0===s(t,r,o,h).length?"":c(a(e,t,e,t-n(t,o),!1,o).length,l("D",h))}(o,h,0,t,i,r)+s(h,t,i,r)+function(e,t,i,r,o,h){let u;u=s(t,r,o,h).length>0?r-n(r,o):t;const d=r,f=function(e,t,i,r,o,a){let l;return l=s(i,r,o,a).length>0?r-n(r,o):t,e<i&&l<=r||e>=i&&l<r?"C":"D"}(e,t,i,r,o,h);return c(a(e,u,i,d,"C"===f,o).length,l(f,h))}(o,h,e,t,i,r);let u;if(h===t)return u=o>e?"D":"C",c(Math.abs(o-e),l(u,r));u=h>t?"D":"C";const d=Math.abs(h-t);return c(function(e,t){return t.cols-e}(h>t?e:o,i)+(d-1)*i.cols+1+((h>t?o:e)-1),l(u,r))}},1296:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;const n=i(3787),o=i(2550),a=i(2223),l=i(6171),c=i(6052),h=i(4725),u=i(8055),d=i(8460),f=i(844),p=i(2585),g="xterm-dom-renderer-owner-",m="xterm-rows",v="xterm-fg-",_="xterm-bg-",y="xterm-focus",b="xterm-selection";let w=1,S=t.DomRenderer=class extends f.Disposable{constructor(e,t,i,r,s,a,h,u,p,v,_,y,S){super(),this._terminal=e,this._document=t,this._element=i,this._screenElement=r,this._viewportElement=s,this._helperContainer=a,this._linkifier2=h,this._charSizeService=p,this._optionsService=v,this._bufferService=_,this._coreBrowserService=y,this._themeService=S,this._terminalClass=w++,this._rowElements=[],this._selectionRenderModel=(0,c.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new d.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(m),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(b),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,l.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((e=>this._injectCss(e)))),this._injectCss(this._themeService.colors),this._rowFactory=u.createInstance(n.DomRendererRowFactory,document),this._element.classList.add(g+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((e=>this._handleLinkHover(e)))),this.register(this._linkifier2.onHideLinkUnderline((e=>this._handleLinkLeave(e)))),this.register((0,f.toDisposable)((()=>{this._element.classList.remove(g+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new o.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const e of this._rowElements)e.style.width=`${this.dimensions.css.canvas.width}px`,e.style.height=`${this.dimensions.css.cell.height}px`,e.style.lineHeight=`${this.dimensions.css.cell.height}px`,e.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const t=`${this._terminalSelector} .${m} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${m} { color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${m} .xterm-dim { color: ${u.color.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const i=`blink_underline_${this._terminalClass}`,r=`blink_bar_${this._terminalClass}`,s=`blink_block_${this._terminalClass}`;t+=`@keyframes ${i} { 50% {  border-bottom-style: hidden; }}`,t+=`@keyframes ${r} { 50% {  box-shadow: none; }}`,t+=`@keyframes ${s} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${m}.${y} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${m}.${y} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${m}.${y} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${s} 1s step-end infinite;}${this._terminalSelector} .${m} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${m} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${m} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${m} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${m} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${b} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${b} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${b} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(const[i,r]of e.ansi.entries())t+=`${this._terminalSelector} .${v}${i} { color: ${r.css}; }${this._terminalSelector} .${v}${i}.xterm-dim { color: ${u.color.multiplyOpacity(r,.5).css}; }${this._terminalSelector} .${_}${i} { background-color: ${r.css}; }`;t+=`${this._terminalSelector} .${v}${a.INVERTED_DEFAULT_COLOR} { color: ${u.color.opaque(e.background).css}; }${this._terminalSelector} .${v}${a.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${u.color.multiplyOpacity(u.color.opaque(e.background),.5).css}; }${this._terminalSelector} .${_}${a.INVERTED_DEFAULT_COLOR} { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){const e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let e=this._rowElements.length;e<=t;e++){const e=this._document.createElement("div");this._rowContainer.appendChild(e),this._rowElements.push(e)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(y),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(y),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,i){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,i),this.renderRows(0,this._bufferService.rows-1),!e||!t)return;this._selectionRenderModel.update(this._terminal,e,t,i);const r=this._selectionRenderModel.viewportStartRow,s=this._selectionRenderModel.viewportEndRow,n=this._selectionRenderModel.viewportCappedStartRow,o=this._selectionRenderModel.viewportCappedEndRow;if(n>=this._bufferService.rows||o<0)return;const a=this._document.createDocumentFragment();if(i){const i=e[0]>t[0];a.appendChild(this._createSelectionElement(n,i?t[0]:e[0],i?e[0]:t[0],o-n+1))}else{const i=r===n?e[0]:0,l=n===s?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(n,i,l));const c=o-n-1;if(a.appendChild(this._createSelectionElement(n+1,0,this._bufferService.cols,c)),n!==o){const e=s===o?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(o,0,e))}}this._selectionContainer.appendChild(a)}_createSelectionElement(e,t,i,r=1){const s=this._document.createElement("div"),n=t*this.dimensions.css.cell.width;let o=this.dimensions.css.cell.width*(i-t);return n+o>this.dimensions.css.canvas.width&&(o=this.dimensions.css.canvas.width-n),s.style.height=r*this.dimensions.css.cell.height+"px",s.style.top=e*this.dimensions.css.cell.height+"px",s.style.left=`${n}px`,s.style.width=`${o}px`,s}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const e of this._rowElements)e.replaceChildren()}renderRows(e,t){const i=this._bufferService.buffer,r=i.ybase+i.y,s=Math.min(i.x,this._bufferService.cols-1),n=this._optionsService.rawOptions.cursorBlink,o=this._optionsService.rawOptions.cursorStyle,a=this._optionsService.rawOptions.cursorInactiveStyle;for(let l=e;l<=t;l++){const e=l+i.ydisp,t=this._rowElements[l],c=i.lines.get(e);if(!t||!c)break;t.replaceChildren(...this._rowFactory.createRow(c,e,e===r,o,a,s,n,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${g}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,i,r,s,n){i<0&&(e=0),r<0&&(t=0);const o=this._bufferService.rows-1;i=Math.max(Math.min(i,o),0),r=Math.max(Math.min(r,o),0),s=Math.min(s,this._bufferService.cols);const a=this._bufferService.buffer,l=a.ybase+a.y,c=Math.min(a.x,s-1),h=this._optionsService.rawOptions.cursorBlink,u=this._optionsService.rawOptions.cursorStyle,d=this._optionsService.rawOptions.cursorInactiveStyle;for(let o=i;o<=r;++o){const f=o+a.ydisp,p=this._rowElements[o],g=a.lines.get(f);if(!p||!g)break;p.replaceChildren(...this._rowFactory.createRow(g,f,f===l,u,d,c,h,this.dimensions.css.cell.width,this._widthCache,n?o===i?e:0:-1,n?(o===r?t:s)-1:-1))}}};t.DomRenderer=S=r([s(7,p.IInstantiationService),s(8,h.ICharSizeService),s(9,p.IOptionsService),s(10,p.IBufferService),s(11,h.ICoreBrowserService),s(12,h.IThemeService)],S)},3787:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=void 0;const n=i(2223),o=i(643),a=i(511),l=i(2585),c=i(8055),h=i(4725),u=i(4269),d=i(6171),f=i(3734);let p=t.DomRendererRowFactory=class{constructor(e,t,i,r,s,n,o){this._document=e,this._characterJoinerService=t,this._optionsService=i,this._coreBrowserService=r,this._coreService=s,this._decorationService=n,this._themeService=o,this._workCell=new a.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,i){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=i}createRow(e,t,i,r,s,a,l,h,d,p,m){const v=[],_=this._characterJoinerService.getJoinedCharacters(t),y=this._themeService.colors;let b,w=e.getNoBgTrimmedLength();i&&w<a+1&&(w=a+1);let S=0,C="",k=0,x=0,R=0,E=!1,D=0,T=!1,M=0;const A=[],O=-1!==p&&-1!==m;for(let L=0;L<w;L++){e.loadCell(L,this._workCell);let w=this._workCell.getWidth();if(0===w)continue;let P=!1,B=L,I=this._workCell;if(_.length>0&&L===_[0][0]){P=!0;const t=_.shift();I=new u.JoinedCellData(this._workCell,e.translateToString(!0,t[0],t[1]),t[1]-t[0]),B=t[1]-1,w=I.getWidth()}const N=this._isCellInSelection(L,t),q=i&&L===a,H=O&&L>=p&&L<=m;let F=!1;this._decorationService.forEachDecorationAtCell(L,t,void 0,(e=>{F=!0}));let W=I.getChars()||o.WHITESPACE_CELL_CHAR;if(" "===W&&(I.isUnderline()||I.isOverline())&&(W=""),M=w*h-d.get(W,I.isBold(),I.isItalic()),b){if(S&&(N&&T||!N&&!T&&I.bg===k)&&(N&&T&&y.selectionForeground||I.fg===x)&&I.extended.ext===R&&H===E&&M===D&&!q&&!P&&!F){I.isInvisible()?C+=o.WHITESPACE_CELL_CHAR:C+=W,S++;continue}S&&(b.textContent=C),b=this._document.createElement("span"),S=0,C=""}else b=this._document.createElement("span");if(k=I.bg,x=I.fg,R=I.extended.ext,E=H,D=M,T=N,P&&a>=L&&a<=B&&(a=L),!this._coreService.isCursorHidden&&q&&this._coreService.isCursorInitialized)if(A.push("xterm-cursor"),this._coreBrowserService.isFocused)l&&A.push("xterm-cursor-blink"),A.push("bar"===r?"xterm-cursor-bar":"underline"===r?"xterm-cursor-underline":"xterm-cursor-block");else if(s)switch(s){case"outline":A.push("xterm-cursor-outline");break;case"block":A.push("xterm-cursor-block");break;case"bar":A.push("xterm-cursor-bar");break;case"underline":A.push("xterm-cursor-underline")}if(I.isBold()&&A.push("xterm-bold"),I.isItalic()&&A.push("xterm-italic"),I.isDim()&&A.push("xterm-dim"),C=I.isInvisible()?o.WHITESPACE_CELL_CHAR:I.getChars()||o.WHITESPACE_CELL_CHAR,I.isUnderline()&&(A.push(`xterm-underline-${I.extended.underlineStyle}`)," "===C&&(C=""),!I.isUnderlineColorDefault()))if(I.isUnderlineColorRGB())b.style.textDecorationColor=`rgb(${f.AttributeData.toColorRGB(I.getUnderlineColor()).join(",")})`;else{let e=I.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&I.isBold()&&e<8&&(e+=8),b.style.textDecorationColor=y.ansi[e].css}I.isOverline()&&(A.push("xterm-overline")," "===C&&(C="")),I.isStrikethrough()&&A.push("xterm-strikethrough"),H&&(b.style.textDecoration="underline");let j=I.getFgColor(),$=I.getFgColorMode(),z=I.getBgColor(),U=I.getBgColorMode();const V=!!I.isInverse();if(V){const e=j;j=z,z=e;const t=$;$=U,U=t}let K,G,J,X=!1;switch(this._decorationService.forEachDecorationAtCell(L,t,void 0,(e=>{"top"!==e.options.layer&&X||(e.backgroundColorRGB&&(U=50331648,z=e.backgroundColorRGB.rgba>>8&16777215,K=e.backgroundColorRGB),e.foregroundColorRGB&&($=50331648,j=e.foregroundColorRGB.rgba>>8&16777215,G=e.foregroundColorRGB),X="top"===e.options.layer)})),!X&&N&&(K=this._coreBrowserService.isFocused?y.selectionBackgroundOpaque:y.selectionInactiveBackgroundOpaque,z=K.rgba>>8&16777215,U=50331648,X=!0,y.selectionForeground&&($=50331648,j=y.selectionForeground.rgba>>8&16777215,G=y.selectionForeground)),X&&A.push("xterm-decoration-top"),U){case 16777216:case 33554432:J=y.ansi[z],A.push(`xterm-bg-${z}`);break;case 50331648:J=c.channels.toColor(z>>16,z>>8&255,255&z),this._addStyle(b,`background-color:#${g((z>>>0).toString(16),"0",6)}`);break;default:V?(J=y.foreground,A.push(`xterm-bg-${n.INVERTED_DEFAULT_COLOR}`)):J=y.background}switch(K||I.isDim()&&(K=c.color.multiplyOpacity(J,.5)),$){case 16777216:case 33554432:I.isBold()&&j<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(j+=8),this._applyMinimumContrast(b,J,y.ansi[j],I,K,void 0)||A.push(`xterm-fg-${j}`);break;case 50331648:const e=c.channels.toColor(j>>16&255,j>>8&255,255&j);this._applyMinimumContrast(b,J,e,I,K,G)||this._addStyle(b,`color:#${g(j.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(b,J,y.foreground,I,K,G)||V&&A.push(`xterm-fg-${n.INVERTED_DEFAULT_COLOR}`)}A.length&&(b.className=A.join(" "),A.length=0),q||P||F?b.textContent=C:S++,M!==this.defaultSpacing&&(b.style.letterSpacing=`${M}px`),v.push(b),L=B}return b&&S&&(b.textContent=C),v}_applyMinimumContrast(e,t,i,r,s,n){if(1===this._optionsService.rawOptions.minimumContrastRatio||(0,d.treatGlyphAsBackgroundColor)(r.getCode()))return!1;const o=this._getContrastCache(r);let a;if(s||n||(a=o.getColor(t.rgba,i.rgba)),void 0===a){const e=this._optionsService.rawOptions.minimumContrastRatio/(r.isDim()?2:1);a=c.color.ensureContrastRatio(s||t,n||i,e),o.setColor((s||t).rgba,(n||i).rgba,a??null)}return!!a&&(this._addStyle(e,`color:${a.css}`),!0)}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){const i=this._selectionStart,r=this._selectionEnd;return!(!i||!r)&&(this._columnSelectMode?i[0]<=r[0]?e>=i[0]&&t>=i[1]&&e<r[0]&&t<=r[1]:e<i[0]&&t>=i[1]&&e>=r[0]&&t<=r[1]:t>i[1]&&t<r[1]||i[1]===r[1]&&t===i[1]&&e>=i[0]&&e<r[0]||i[1]<r[1]&&t===r[1]&&e<r[0]||i[1]<r[1]&&t===i[1]&&e>=i[0])}};function g(e,t,i){for(;e.length<i;)e=t+e;return e}t.DomRendererRowFactory=p=r([s(1,h.ICharacterJoinerService),s(2,l.IOptionsService),s(3,h.ICoreBrowserService),s(4,l.ICoreService),s(5,l.IDecorationService),s(6,h.IThemeService)],p)},2550:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WidthCache=void 0,t.WidthCache=class{constructor(e,t){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const i=e.createElement("span");i.classList.add("xterm-char-measure-element");const r=e.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontWeight="bold";const s=e.createElement("span");s.classList.add("xterm-char-measure-element"),s.style.fontStyle="italic";const n=e.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold",n.style.fontStyle="italic",this._measureElements=[i,r,s,n],this._container.appendChild(i),this._container.appendChild(r),this._container.appendChild(s),this._container.appendChild(n),t.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,t,i,r){e===this._font&&t===this._fontSize&&i===this._weight&&r===this._weightBold||(this._font=e,this._fontSize=t,this._weight=i,this._weightBold=r,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${i}`,this._measureElements[1].style.fontWeight=`${r}`,this._measureElements[2].style.fontWeight=`${i}`,this._measureElements[3].style.fontWeight=`${r}`,this.clear())}get(e,t,i){let r=0;if(!t&&!i&&1===e.length&&(r=e.charCodeAt(0))<256){if(-9999!==this._flat[r])return this._flat[r];const t=this._measure(e,0);return t>0&&(this._flat[r]=t),t}let s=e;t&&(s+="B"),i&&(s+="I");let n=this._holey.get(s);if(void 0===n){let r=0;t&&(r|=1),i&&(r|=2),n=this._measure(e,r),n>0&&this._holey.set(s,n)}return n}_measure(e,t){const i=this._measureElements[t];return i.textContent=e.repeat(32),i.offsetWidth/32}}},2223:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;const r=i(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=r.isFirefox||r.isLegacyEdge?"bottom":"ideographic"},6171:(e,t)=>{function i(e){return 57508<=e&&e<=57558}function r(e){return e>=128512&&e<=128591||e>=127744&&e<=128511||e>=128640&&e<=128767||e>=9728&&e<=9983||e>=9984&&e<=10175||e>=65024&&e<=65039||e>=129280&&e<=129535||e>=127462&&e<=127487}Object.defineProperty(t,"__esModule",{value:!0}),t.computeNextVariantOffset=t.createRenderDimensions=t.treatGlyphAsBackgroundColor=t.allowRescaling=t.isEmoji=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(e){if(!e)throw new Error("value must not be falsy");return e},t.isPowerlineGlyph=i,t.isRestrictedPowerlineGlyph=function(e){return 57520<=e&&e<=57527},t.isEmoji=r,t.allowRescaling=function(e,t,s,n){return 1===t&&s>Math.ceil(1.5*n)&&void 0!==e&&e>255&&!r(e)&&!i(e)&&!function(e){return 57344<=e&&e<=63743}(e)},t.treatGlyphAsBackgroundColor=function(e){return i(e)||function(e){return 9472<=e&&e<=9631}(e)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},t.computeNextVariantOffset=function(e,t,i=0){return(e-(2*Math.round(t)-i))%(2*Math.round(t))}},6052:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSelectionRenderModel=void 0;class i{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,i,r=!1){if(this.selectionStart=t,this.selectionEnd=i,!t||!i||t[0]===i[0]&&t[1]===i[1])return void this.clear();const s=e.buffers.active.ydisp,n=t[1]-s,o=i[1]-s,a=Math.max(n,0),l=Math.min(o,e.rows-1);a>=e.rows||l<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=r,this.viewportStartRow=n,this.viewportEndRow=o,this.viewportCappedStartRow=a,this.viewportCappedEndRow=l,this.startCol=t[0],this.endCol=i[0])}isCellSelected(e,t,i){return!!this.hasSelection&&(i-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&i>=this.viewportCappedStartRow&&t<this.endCol&&i<=this.viewportCappedEndRow:t<this.startCol&&i>=this.viewportCappedStartRow&&t>=this.endCol&&i<=this.viewportCappedEndRow:i>this.viewportStartRow&&i<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol)}}t.createSelectionRenderModel=function(){return new i}},456:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const e=this.selectionStart,t=this.selectionEnd;return!(!e||!t)&&(e[1]>t[1]||e[1]===t[1]&&e[0]>t[0])}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;const n=i(2585),o=i(8460),a=i(844);let l=t.CharSizeService=class extends a.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,t,i){super(),this._optionsService=i,this.width=0,this.height=0,this._onCharSizeChange=this.register(new o.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new u(this._optionsService))}catch{this._measureStrategy=this.register(new h(e,t,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};t.CharSizeService=l=r([s(2,n.IOptionsService)],l);class c extends a.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,t){void 0!==e&&e>0&&void 0!==t&&t>0&&(this._result.width=e,this._result.height=t)}}class h extends c{constructor(e,t,i){super(),this._document=e,this._parentElement=t,this._optionsService=i,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class u extends c{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const t=this._ctx.measureText("W");if(!("width"in t&&"fontBoundingBoxAscent"in t&&"fontBoundingBoxDescent"in t))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}}},4269:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;const n=i(3734),o=i(643),a=i(511),l=i(2585);class c extends n.AttributeData{constructor(e,t,i){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=i}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=c;let h=t.CharacterJoinerService=class e{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new a.CellData}register(e){const t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(0===this._characterJoiners.length)return[];const t=this._bufferService.buffer.lines.get(e);if(!t||0===t.length)return[];const i=[],r=t.translateToString(!0);let s=0,n=0,a=0,l=t.getFg(0),c=t.getBg(0);for(let e=0;e<t.getTrimmedLength();e++)if(t.loadCell(e,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==l||this._workCell.bg!==c){if(e-s>1){const e=this._getJoinedRanges(r,a,n,t,s);for(let t=0;t<e.length;t++)i.push(e[t])}s=e,a=n,l=this._workCell.fg,c=this._workCell.bg}n+=this._workCell.getChars().length||o.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-s>1){const e=this._getJoinedRanges(r,a,n,t,s);for(let t=0;t<e.length;t++)i.push(e[t])}return i}_getJoinedRanges(t,i,r,s,n){const o=t.substring(i,r);let a=[];try{a=this._characterJoiners[0].handler(o)}catch(e){console.error(e)}for(let t=1;t<this._characterJoiners.length;t++)try{const i=this._characterJoiners[t].handler(o);for(let t=0;t<i.length;t++)e._mergeRanges(a,i[t])}catch(e){console.error(e)}return this._stringRangesToCellRanges(a,s,n),a}_stringRangesToCellRanges(e,t,i){let r=0,s=!1,n=0,a=e[r];if(a){for(let l=i;l<this._bufferService.cols;l++){const i=t.getWidth(l),c=t.getString(l).length||o.WHITESPACE_CELL_CHAR.length;if(0!==i){if(!s&&a[0]<=n&&(a[0]=l,s=!0),a[1]<=n){if(a[1]=l,a=e[++r],!a)break;a[0]<=n?(a[0]=l,s=!0):s=!1}n+=c}}a&&(a[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let i=!1;for(let r=0;r<e.length;r++){const s=e[r];if(i){if(t[1]<=s[0])return e[r-1][1]=t[1],e;if(t[1]<=s[1])return e[r-1][1]=Math.max(t[1],s[1]),e.splice(r,1),e;e.splice(r,1),r--}else{if(t[1]<=s[0])return e.splice(r,0,t),e;if(t[1]<=s[1])return s[0]=Math.min(t[0],s[0]),e;t[0]<s[1]&&(s[0]=Math.min(t[0],s[0]),i=!0)}}return i?e[e.length-1][1]=t[1]:e.push(t),e}};t.CharacterJoinerService=h=r([s(0,l.IBufferService)],h)},5114:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0;const r=i(844),s=i(8460),n=i(3656);class o extends r.Disposable{constructor(e,t,i){super(),this._textarea=e,this._window=t,this.mainDocument=i,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new a(this._window),this._onDprChange=this.register(new s.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new s.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((e=>this._screenDprMonitor.setWindow(e)))),this.register((0,s.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}t.CoreBrowserService=o;class a extends r.Disposable{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this.register(new r.MutableDisposable),this._onDprChange=this.register(new s.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,r.toDisposable)((()=>this.clearListener())))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,n.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkProviderService=void 0;const r=i(844);class s extends r.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,r.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{const t=this.linkProviders.indexOf(e);-1!==t&&this.linkProviders.splice(t,1)}}}}t.LinkProviderService=s},8934:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;const n=i(4725),o=i(9806);let a=t.MouseService=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,i,r,s){return(0,o.getCoords)(window,e,t,i,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,s)}getMouseReportCoords(e,t){const i=(0,o.getCoordsRelativeToElement)(window,e,t);if(this._charSizeService.hasValidSize)return i[0]=Math.min(Math.max(i[0],0),this._renderService.dimensions.css.canvas.width-1),i[1]=Math.min(Math.max(i[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(i[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(i[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(i[0]),y:Math.floor(i[1])}}};t.MouseService=a=r([s(0,n.IRenderService),s(1,n.ICharSizeService)],a)},3230:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;const n=i(6193),o=i(4725),a=i(8460),l=i(844),c=i(7226),h=i(2585);let u=t.RenderService=class extends l.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(e,t,i,r,s,o,h,u){super(),this._rowCount=e,this._charSizeService=r,this._renderer=this.register(new l.MutableDisposable),this._pausedResizeTask=new c.DebouncedIdleTask,this._observerDisposable=this.register(new l.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new a.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new a.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new a.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new a.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new n.RenderDebouncer(((e,t)=>this._renderRows(e,t)),h),this.register(this._renderDebouncer),this.register(h.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(o.onResize((()=>this._fullRefresh()))),this.register(o.buffers.onBufferActivate((()=>this._renderer.value?.clear()))),this.register(i.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(s.onDecorationRegistered((()=>this._fullRefresh()))),this.register(s.onDecorationRemoved((()=>this._fullRefresh()))),this.register(i.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(o.cols,o.rows),this._fullRefresh()}))),this.register(i.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(o.buffer.y,o.buffer.y,!0)))),this.register(u.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(h.window,t),this.register(h.onWindowChange((e=>this._registerIntersectionObserver(e,t))))}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){const i=new e.IntersectionObserver((e=>this._handleIntersectionChange(e[e.length-1])),{threshold:0});i.observe(t),this._observerDisposable.value=(0,l.toDisposable)((()=>i.disconnect()))}}_handleIntersectionChange(e){this._isPaused=void 0===e.isIntersecting?0===e.intersectionRatio:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,i=!1){this._isPaused?this._needsFullRefresh=!0:(i||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount))}_renderRows(e,t){this._renderer.value&&(e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0)}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw((e=>this.refreshRows(e.start,e.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.value?.handleResize(e,t))):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(e,t,i){this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=i,this._renderer.value?.handleSelectionChanged(e,t,i)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};t.RenderService=u=r([s(2,h.IOptionsService),s(3,o.ICharSizeService),s(4,h.IDecorationService),s(5,h.IBufferService),s(6,o.ICoreBrowserService),s(7,o.IThemeService)],u)},9312:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;const n=i(9806),o=i(9504),a=i(456),l=i(4725),c=i(8460),h=i(844),u=i(6114),d=i(4841),f=i(511),p=i(2585),g=String.fromCharCode(160),m=new RegExp(g,"g");let v=t.SelectionService=class extends h.Disposable{constructor(e,t,i,r,s,n,o,l,u){super(),this._element=e,this._screenElement=t,this._linkifier=i,this._bufferService=r,this._coreService=s,this._mouseService=n,this._optionsService=o,this._renderService=l,this._coreBrowserService=u,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new f.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new c.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new c.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new c.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new c.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=e=>this._handleMouseMove(e),this._mouseUpListener=e=>this._handleMouseUp(e),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((e=>this._handleTrim(e))),this.register(this._bufferService.buffers.onBufferActivate((e=>this._handleBufferActivate(e)))),this.enable(),this._model=new a.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,h.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!(!e||!t||e[0]===t[0]&&e[1]===t[1])}get selectionText(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";const i=this._bufferService.buffer,r=[];if(3===this._activeSelectionMode){if(e[0]===t[0])return"";const s=e[0]<t[0]?e[0]:t[0],n=e[0]<t[0]?t[0]:e[0];for(let o=e[1];o<=t[1];o++){const e=i.translateBufferLineToString(o,!0,s,n);r.push(e)}}else{const s=e[1]===t[1]?t[0]:void 0;r.push(i.translateBufferLineToString(e[1],!0,e[0],s));for(let s=e[1]+1;s<=t[1]-1;s++){const e=i.lines.get(s),t=i.translateBufferLineToString(s,!0);e?.isWrapped?r[r.length-1]+=t:r.push(t)}if(e[1]!==t[1]){const e=i.lines.get(t[1]),s=i.translateBufferLineToString(t[1],!0,0,t[0]);e&&e.isWrapped?r[r.length-1]+=s:r.push(s)}}return r.map((e=>e.replace(m," "))).join(u.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),u.isLinux&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(e){const t=this._getMouseBufferCoords(e),i=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!!(i&&r&&t)&&this._areCoordsInSelection(t,i,r)}isCellInSelection(e,t){const i=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!(!i||!r)&&this._areCoordsInSelection([e,t],i,r)}_areCoordsInSelection(e,t,i){return e[1]>t[1]&&e[1]<i[1]||t[1]===i[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<i[0]||t[1]<i[1]&&e[1]===i[1]&&e[0]<i[0]||t[1]<i[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){const i=this._linkifier.currentLink?.link?.range;if(i)return this._model.selectionStart=[i.start.x-1,i.start.y-1],this._model.selectionStartLength=(0,d.getRangeLength)(i,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const r=this._getMouseBufferCoords(e);return!!r&&(this._selectWordAt(r,t),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){const t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=(0,n.getCoordsRelativeToElement)(this._coreBrowserService.window,e,this._screenElement)[1];const i=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=i?0:(t>i&&(t-=i),t=Math.min(Math.max(t,-50),50),t/=50,t/Math.abs(t)+Math.round(14*t))}shouldForceSelection(e){return u.isMac?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,(2!==e.button||!this.hasSelection)&&0===e.button){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):1===e.detail?this._handleSingleClick(e):2===e.detail?this._handleDoubleClick(e):3===e.detail&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&0===t.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){const t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(u.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;const t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const i=this._bufferService.buffer;if(this._model.selectionEnd[1]<i.lines.length){const e=i.lines.get(this._model.selectionEnd[1]);e&&0===e.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}t&&t[0]===this._model.selectionEnd[0]&&t[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const e=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){const t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<500&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const t=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(t&&void 0!==t[0]&&void 0!==t[1]){const e=(0,o.moveToCellSequence)(t[0]-1,t[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(e,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,i=!(!e||!t||e[0]===t[0]&&e[1]===t[1]);i?e&&t&&(this._oldSelectionStart&&this._oldSelectionEnd&&e[0]===this._oldSelectionStart[0]&&e[1]===this._oldSelectionStart[1]&&t[0]===this._oldSelectionEnd[0]&&t[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(e,t,i)):this._oldHasSelection&&this._fireOnSelectionChange(e,t,i)}_fireOnSelectionChange(e,t,i){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=i,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim((e=>this._handleTrim(e)))}_convertViewportColToCharacterIndex(e,t){let i=t;for(let r=0;t>=r;r++){const s=e.loadCell(r,this._workCell).getChars().length;0===this._workCell.getWidth()?i--:s>1&&t!==r&&(i+=s-1)}return i}setSelection(e,t,i){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=i,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,i=!0,r=!0){if(e[0]>=this._bufferService.cols)return;const s=this._bufferService.buffer,n=s.lines.get(e[1]);if(!n)return;const o=s.translateBufferLineToString(e[1],!1);let a=this._convertViewportColToCharacterIndex(n,e[0]),l=a;const c=e[0]-a;let h=0,u=0,d=0,f=0;if(" "===o.charAt(a)){for(;a>0&&" "===o.charAt(a-1);)a--;for(;l<o.length&&" "===o.charAt(l+1);)l++}else{let t=e[0],i=e[0];0===n.getWidth(t)&&(h++,t--),2===n.getWidth(i)&&(u++,i++);const r=n.getString(i).length;for(r>1&&(f+=r-1,l+=r-1);t>0&&a>0&&!this._isCharWordSeparator(n.loadCell(t-1,this._workCell));){n.loadCell(t-1,this._workCell);const e=this._workCell.getChars().length;0===this._workCell.getWidth()?(h++,t--):e>1&&(d+=e-1,a-=e-1),a--,t--}for(;i<n.length&&l+1<o.length&&!this._isCharWordSeparator(n.loadCell(i+1,this._workCell));){n.loadCell(i+1,this._workCell);const e=this._workCell.getChars().length;2===this._workCell.getWidth()?(u++,i++):e>1&&(f+=e-1,l+=e-1),l++,i++}}l++;let p=a+c-h+d,g=Math.min(this._bufferService.cols,l-a+h+u-d-f);if(t||""!==o.slice(a,l).trim()){if(i&&0===p&&32!==n.getCodePoint(0)){const t=s.lines.get(e[1]-1);if(t&&n.isWrapped&&32!==t.getCodePoint(this._bufferService.cols-1)){const t=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(t){const e=this._bufferService.cols-t.start;p-=e,g+=e}}}if(r&&p+g===this._bufferService.cols&&32!==n.getCodePoint(this._bufferService.cols-1)){const t=s.lines.get(e[1]+1);if(t?.isWrapped&&32!==t.getCodePoint(0)){const t=this._getWordAt([0,e[1]+1],!1,!1,!0);t&&(g+=t.length)}}return{start:p,length:g}}}_selectWordAt(e,t){const i=this._getWordAt(e,t);if(i){for(;i.start<0;)i.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[i.start,e[1]],this._model.selectionStartLength=i.length}}_selectToWordAt(e){const t=this._getWordAt(e,!0);if(t){let i=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,i--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,i++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,i]}}_isCharWordSeparator(e){return 0!==e.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){const t=this._bufferService.buffer.getWrappedRangeForLine(e),i={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,d.getRangeLength)(i,this._bufferService.cols)}};t.SelectionService=v=r([s(3,p.IBufferService),s(4,p.ICoreService),s(5,l.IMouseService),s(6,p.IOptionsService),s(7,l.IRenderService),s(8,l.ICoreBrowserService)],v)},4725:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ILinkProviderService=t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;const r=i(8343);t.ICharSizeService=(0,r.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,r.createDecorator)("CoreBrowserService"),t.IMouseService=(0,r.createDecorator)("MouseService"),t.IRenderService=(0,r.createDecorator)("RenderService"),t.ISelectionService=(0,r.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,r.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,r.createDecorator)("ThemeService"),t.ILinkProviderService=(0,r.createDecorator)("LinkProviderService")},6731:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;const n=i(7239),o=i(8055),a=i(8460),l=i(844),c=i(2585),h=o.css.toColor("#ffffff"),u=o.css.toColor("#000000"),d=o.css.toColor("#ffffff"),f=o.css.toColor("#000000"),p={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const e=[o.css.toColor("#2e3436"),o.css.toColor("#cc0000"),o.css.toColor("#4e9a06"),o.css.toColor("#c4a000"),o.css.toColor("#3465a4"),o.css.toColor("#75507b"),o.css.toColor("#06989a"),o.css.toColor("#d3d7cf"),o.css.toColor("#555753"),o.css.toColor("#ef2929"),o.css.toColor("#8ae234"),o.css.toColor("#fce94f"),o.css.toColor("#729fcf"),o.css.toColor("#ad7fa8"),o.css.toColor("#34e2e2"),o.css.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let i=0;i<216;i++){const r=t[i/36%6|0],s=t[i/6%6|0],n=t[i%6];e.push({css:o.channels.toCss(r,s,n),rgba:o.channels.toRgba(r,s,n)})}for(let t=0;t<24;t++){const i=8+10*t;e.push({css:o.channels.toCss(i,i,i),rgba:o.channels.toRgba(i,i,i)})}return e})());let g=t.ThemeService=class extends l.Disposable{get colors(){return this._colors}constructor(e){super(),this._optionsService=e,this._contrastCache=new n.ColorContrastCache,this._halfContrastCache=new n.ColorContrastCache,this._onChangeColors=this.register(new a.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:h,background:u,cursor:d,cursorAccent:f,selectionForeground:void 0,selectionBackgroundTransparent:p,selectionBackgroundOpaque:o.color.blend(u,p),selectionInactiveBackgroundTransparent:p,selectionInactiveBackgroundOpaque:o.color.blend(u,p),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(e={}){const i=this._colors;if(i.foreground=m(e.foreground,h),i.background=m(e.background,u),i.cursor=m(e.cursor,d),i.cursorAccent=m(e.cursorAccent,f),i.selectionBackgroundTransparent=m(e.selectionBackground,p),i.selectionBackgroundOpaque=o.color.blend(i.background,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundTransparent=m(e.selectionInactiveBackground,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundOpaque=o.color.blend(i.background,i.selectionInactiveBackgroundTransparent),i.selectionForeground=e.selectionForeground?m(e.selectionForeground,o.NULL_COLOR):void 0,i.selectionForeground===o.NULL_COLOR&&(i.selectionForeground=void 0),o.color.isOpaque(i.selectionBackgroundTransparent)){const e=.3;i.selectionBackgroundTransparent=o.color.opacity(i.selectionBackgroundTransparent,e)}if(o.color.isOpaque(i.selectionInactiveBackgroundTransparent)){const e=.3;i.selectionInactiveBackgroundTransparent=o.color.opacity(i.selectionInactiveBackgroundTransparent,e)}if(i.ansi=t.DEFAULT_ANSI_COLORS.slice(),i.ansi[0]=m(e.black,t.DEFAULT_ANSI_COLORS[0]),i.ansi[1]=m(e.red,t.DEFAULT_ANSI_COLORS[1]),i.ansi[2]=m(e.green,t.DEFAULT_ANSI_COLORS[2]),i.ansi[3]=m(e.yellow,t.DEFAULT_ANSI_COLORS[3]),i.ansi[4]=m(e.blue,t.DEFAULT_ANSI_COLORS[4]),i.ansi[5]=m(e.magenta,t.DEFAULT_ANSI_COLORS[5]),i.ansi[6]=m(e.cyan,t.DEFAULT_ANSI_COLORS[6]),i.ansi[7]=m(e.white,t.DEFAULT_ANSI_COLORS[7]),i.ansi[8]=m(e.brightBlack,t.DEFAULT_ANSI_COLORS[8]),i.ansi[9]=m(e.brightRed,t.DEFAULT_ANSI_COLORS[9]),i.ansi[10]=m(e.brightGreen,t.DEFAULT_ANSI_COLORS[10]),i.ansi[11]=m(e.brightYellow,t.DEFAULT_ANSI_COLORS[11]),i.ansi[12]=m(e.brightBlue,t.DEFAULT_ANSI_COLORS[12]),i.ansi[13]=m(e.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),i.ansi[14]=m(e.brightCyan,t.DEFAULT_ANSI_COLORS[14]),i.ansi[15]=m(e.brightWhite,t.DEFAULT_ANSI_COLORS[15]),e.extendedAnsi){const r=Math.min(i.ansi.length-16,e.extendedAnsi.length);for(let s=0;s<r;s++)i.ansi[s+16]=m(e.extendedAnsi[s],t.DEFAULT_ANSI_COLORS[s+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(void 0!==e)switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}else for(let e=0;e<this._restoreColors.ansi.length;++e)this._colors.ansi[e]=this._restoreColors.ansi[e]}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function m(e,t){if(void 0!==e)try{return o.css.toColor(e)}catch{}return t}t.ThemeService=g=r([s(0,c.IOptionsService)],g)},6349:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;const r=i(8460),s=i(844);class n extends s.Disposable{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this.register(new r.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new r.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new r.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;const t=new Array(e);for(let i=0;i<Math.min(e,this.length);i++)t[i]=this._array[this._getCyclicIndex(i)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...i){if(t){for(let i=e;i<this._length-t;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let t=this._length-1;t>=e;t--)this._array[this._getCyclicIndex(t+i.length)]=this._array[this._getCyclicIndex(t)];for(let t=0;t<i.length;t++)this._array[this._getCyclicIndex(e+t)]=i[t];if(i.length&&this.onInsertEmitter.fire({index:e,amount:i.length}),this._length+i.length>this._maxLength){const e=this._length+i.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=i.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,i){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+i<0)throw new Error("Cannot shift elements in list beyond index 0");if(i>0){for(let r=t-1;r>=0;r--)this.set(e+r+i,this.get(e+r));const r=e+t+i-this._length;if(r>0)for(this._length+=r;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let r=0;r<t;r++)this.set(e+r+i,this.get(e+r))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}}t.CircularList=n},1439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function e(t,i=5){if("object"!=typeof t)return t;const r=Array.isArray(t)?[]:{};for(const s in t)r[s]=i<=1?t[s]:t[s]&&e(t[s],i-1);return r}},8055:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;let i=0,r=0,s=0,n=0;var o,a,l,c,h;function u(e){const t=e.toString(16);return t.length<2?"0"+t:t}function d(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},function(e){e.toCss=function(e,t,i,r){return void 0!==r?`#${u(e)}${u(t)}${u(i)}${u(r)}`:`#${u(e)}${u(t)}${u(i)}`},e.toRgba=function(e,t,i,r=255){return(e<<24|t<<16|i<<8|r)>>>0},e.toColor=function(t,i,r,s){return{css:e.toCss(t,i,r,s),rgba:e.toRgba(t,i,r,s)}}}(o||(t.channels=o={})),function(e){function t(e,t){return n=Math.round(255*t),[i,r,s]=h.toChannels(e.rgba),{css:o.toCss(i,r,s,n),rgba:o.toRgba(i,r,s,n)}}e.blend=function(e,t){if(n=(255&t.rgba)/255,1===n)return{css:t.css,rgba:t.rgba};const a=t.rgba>>24&255,l=t.rgba>>16&255,c=t.rgba>>8&255,h=e.rgba>>24&255,u=e.rgba>>16&255,d=e.rgba>>8&255;return i=h+Math.round((a-h)*n),r=u+Math.round((l-u)*n),s=d+Math.round((c-d)*n),{css:o.toCss(i,r,s),rgba:o.toRgba(i,r,s)}},e.isOpaque=function(e){return!(255&~e.rgba)},e.ensureContrastRatio=function(e,t,i){const r=h.ensureContrastRatio(e.rgba,t.rgba,i);if(r)return o.toColor(r>>24&255,r>>16&255,r>>8&255)},e.opaque=function(e){const t=(255|e.rgba)>>>0;return[i,r,s]=h.toChannels(t),{css:o.toCss(i,r,s),rgba:t}},e.opacity=t,e.multiplyOpacity=function(e,i){return n=255&e.rgba,t(e,n*i/255)},e.toColorRGB=function(e){return[e.rgba>>24&255,e.rgba>>16&255,e.rgba>>8&255]}}(a||(t.color=a={})),function(e){let t,a;try{const e=document.createElement("canvas");e.width=1,e.height=1;const i=e.getContext("2d",{willReadFrequently:!0});i&&(t=i,t.globalCompositeOperation="copy",a=t.createLinearGradient(0,0,1,1))}catch{}e.toColor=function(e){if(e.match(/#[\da-f]{3,8}/i))switch(e.length){case 4:return i=parseInt(e.slice(1,2).repeat(2),16),r=parseInt(e.slice(2,3).repeat(2),16),s=parseInt(e.slice(3,4).repeat(2),16),o.toColor(i,r,s);case 5:return i=parseInt(e.slice(1,2).repeat(2),16),r=parseInt(e.slice(2,3).repeat(2),16),s=parseInt(e.slice(3,4).repeat(2),16),n=parseInt(e.slice(4,5).repeat(2),16),o.toColor(i,r,s,n);case 7:return{css:e,rgba:(parseInt(e.slice(1),16)<<8|255)>>>0};case 9:return{css:e,rgba:parseInt(e.slice(1),16)>>>0}}const l=e.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(l)return i=parseInt(l[1]),r=parseInt(l[2]),s=parseInt(l[3]),n=Math.round(255*(void 0===l[5]?1:parseFloat(l[5]))),o.toColor(i,r,s,n);if(!t||!a)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=a,t.fillStyle=e,"string"!=typeof t.fillStyle)throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[i,r,s,n]=t.getImageData(0,0,1,1).data,255!==n)throw new Error("css.toColor: Unsupported css format");return{rgba:o.toRgba(i,r,s,n),css:e}}}(l||(t.css=l={})),function(e){function t(e,t,i){const r=e/255,s=t/255,n=i/255;return.2126*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.7152*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))}e.relativeLuminance=function(e){return t(e>>16&255,e>>8&255,255&e)},e.relativeLuminance2=t}(c||(t.rgb=c={})),function(e){function t(e,t,i){const r=e>>24&255,s=e>>16&255,n=e>>8&255;let o=t>>24&255,a=t>>16&255,l=t>>8&255,h=d(c.relativeLuminance2(o,a,l),c.relativeLuminance2(r,s,n));for(;h<i&&(o>0||a>0||l>0);)o-=Math.max(0,Math.ceil(.1*o)),a-=Math.max(0,Math.ceil(.1*a)),l-=Math.max(0,Math.ceil(.1*l)),h=d(c.relativeLuminance2(o,a,l),c.relativeLuminance2(r,s,n));return(o<<24|a<<16|l<<8|255)>>>0}function a(e,t,i){const r=e>>24&255,s=e>>16&255,n=e>>8&255;let o=t>>24&255,a=t>>16&255,l=t>>8&255,h=d(c.relativeLuminance2(o,a,l),c.relativeLuminance2(r,s,n));for(;h<i&&(o<255||a<255||l<255);)o=Math.min(255,o+Math.ceil(.1*(255-o))),a=Math.min(255,a+Math.ceil(.1*(255-a))),l=Math.min(255,l+Math.ceil(.1*(255-l))),h=d(c.relativeLuminance2(o,a,l),c.relativeLuminance2(r,s,n));return(o<<24|a<<16|l<<8|255)>>>0}e.blend=function(e,t){if(n=(255&t)/255,1===n)return t;const a=t>>24&255,l=t>>16&255,c=t>>8&255,h=e>>24&255,u=e>>16&255,d=e>>8&255;return i=h+Math.round((a-h)*n),r=u+Math.round((l-u)*n),s=d+Math.round((c-d)*n),o.toRgba(i,r,s)},e.ensureContrastRatio=function(e,i,r){const s=c.relativeLuminance(e>>8),n=c.relativeLuminance(i>>8);if(d(s,n)<r){if(n<s){const n=t(e,i,r),o=d(s,c.relativeLuminance(n>>8));if(o<r){const t=a(e,i,r);return o>d(s,c.relativeLuminance(t>>8))?n:t}return n}const o=a(e,i,r),l=d(s,c.relativeLuminance(o>>8));if(l<r){const n=t(e,i,r);return l>d(s,c.relativeLuminance(n>>8))?o:n}return o}},e.reduceLuminance=t,e.increaseLuminance=a,e.toChannels=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}}(h||(t.rgba=h={})),t.toPaddedHex=u,t.contrastRatio=d},8969:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;const r=i(844),s=i(2585),n=i(4348),o=i(7866),a=i(744),l=i(7302),c=i(6975),h=i(8460),u=i(1753),d=i(1480),f=i(7994),p=i(9282),g=i(5435),m=i(5981),v=i(2660);let _=!1;class y extends r.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new h.EventEmitter),this._onScroll.event((e=>{this._onScrollApi?.fire(e.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(const t in e)this.optionsService.options[t]=e[t]}constructor(e){super(),this._windowsWrappingHeuristics=this.register(new r.MutableDisposable),this._onBinary=this.register(new h.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new h.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new h.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new h.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new h.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new h.EventEmitter),this._instantiationService=new n.InstantiationService,this.optionsService=this.register(new l.OptionsService(e)),this._instantiationService.setService(s.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(a.BufferService)),this._instantiationService.setService(s.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(o.LogService)),this._instantiationService.setService(s.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(c.CoreService)),this._instantiationService.setService(s.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(u.CoreMouseService)),this._instantiationService.setService(s.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(d.UnicodeService)),this._instantiationService.setService(s.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(f.CharsetService),this._instantiationService.setService(s.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(v.OscLinkService),this._instantiationService.setService(s.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new g.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,h.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,h.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,h.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,h.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new m.WriteBuffer(((e,t)=>this._inputHandler.parse(e,t)))),this.register((0,h.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=s.LogLevelEnum.WARN&&!_&&(this._logService.warn("writeSync is unreliable and will be removed soon."),_=!0),this._writeBuffer.writeSync(e,t)}input(e,t=!0){this.coreService.triggerDataEvent(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,a.MINIMUM_COLS),t=Math.max(t,a.MINIMUM_ROWS),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t,i){this._bufferService.scrollLines(e,t,i)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){const t=e-this._bufferService.buffer.ydisp;0!==t&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1;const t=this.optionsService.rawOptions.windowsPty;t&&void 0!==t.buildNumber&&void 0!==t.buildNumber?e=!!("conpty"===t.backend&&t.buildNumber<21376):this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const e=[];e.push(this.onLineFeed(p.updateWindowsModeWrappedState.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},(()=>((0,p.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,r.toDisposable)((()=>{for(const t of e)t.dispose()}))}}}t.CoreTerminal=y},8460:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>(this._listeners.push(e),{dispose:()=>{if(!this._disposed)for(let t=0;t<this._listeners.length;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)}})),this._event}fire(e,t){const i=[];for(let e=0;e<this._listeners.length;e++)i.push(this._listeners[e]);for(let r=0;r<i.length;r++)i[r].call(void 0,e,t)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(e,t){return e((e=>t.fire(e)))},t.runAndSubscribe=function(e,t){return t(void 0),e((e=>t(e)))}},5435:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;const n=i(2584),o=i(7116),a=i(2015),l=i(844),c=i(482),h=i(8437),u=i(8460),d=i(643),f=i(511),p=i(3734),g=i(2585),m=i(1480),v=i(6242),_=i(6351),y=i(5941),b={"(":0,")":1,"*":2,"+":3,"-":1,".":2},w=131072;function S(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var C;!function(e){e[e.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",e[e.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"}(C||(t.WindowsOptionsReportType=C={}));let k=0;class x extends l.Disposable{getAttrData(){return this._curAttrData}constructor(e,t,i,r,s,l,d,p,g=new a.EscapeSequenceParser){super(),this._bufferService=e,this._charsetService=t,this._coreService=i,this._logService=r,this._optionsService=s,this._oscLinkService=l,this._coreMouseService=d,this._unicodeService=p,this._parser=g,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new c.StringToUtf32,this._utf8Decoder=new c.Utf8ToUtf32,this._workCell=new f.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=h.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=h.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new u.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new u.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new u.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new u.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new u.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new u.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new u.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new u.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new u.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new u.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new u.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new u.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new u.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new R(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((e=>this._activeBuffer=e.activeBuffer))),this._parser.setCsiHandlerFallback(((e,t)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(e),params:t.toArray()})})),this._parser.setEscHandlerFallback((e=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(e)})})),this._parser.setExecuteHandlerFallback((e=>{this._logService.debug("Unknown EXECUTE code: ",{code:e})})),this._parser.setOscHandlerFallback(((e,t,i)=>{this._logService.debug("Unknown OSC code: ",{identifier:e,action:t,data:i})})),this._parser.setDcsHandlerFallback(((e,t,i)=>{"HOOK"===t&&(i=i.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(e),action:t,payload:i})})),this._parser.setPrintHandler(((e,t,i)=>this.print(e,t,i))),this._parser.registerCsiHandler({final:"@"},(e=>this.insertChars(e))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(e=>this.scrollLeft(e))),this._parser.registerCsiHandler({final:"A"},(e=>this.cursorUp(e))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(e=>this.scrollRight(e))),this._parser.registerCsiHandler({final:"B"},(e=>this.cursorDown(e))),this._parser.registerCsiHandler({final:"C"},(e=>this.cursorForward(e))),this._parser.registerCsiHandler({final:"D"},(e=>this.cursorBackward(e))),this._parser.registerCsiHandler({final:"E"},(e=>this.cursorNextLine(e))),this._parser.registerCsiHandler({final:"F"},(e=>this.cursorPrecedingLine(e))),this._parser.registerCsiHandler({final:"G"},(e=>this.cursorCharAbsolute(e))),this._parser.registerCsiHandler({final:"H"},(e=>this.cursorPosition(e))),this._parser.registerCsiHandler({final:"I"},(e=>this.cursorForwardTab(e))),this._parser.registerCsiHandler({final:"J"},(e=>this.eraseInDisplay(e,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(e=>this.eraseInDisplay(e,!0))),this._parser.registerCsiHandler({final:"K"},(e=>this.eraseInLine(e,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(e=>this.eraseInLine(e,!0))),this._parser.registerCsiHandler({final:"L"},(e=>this.insertLines(e))),this._parser.registerCsiHandler({final:"M"},(e=>this.deleteLines(e))),this._parser.registerCsiHandler({final:"P"},(e=>this.deleteChars(e))),this._parser.registerCsiHandler({final:"S"},(e=>this.scrollUp(e))),this._parser.registerCsiHandler({final:"T"},(e=>this.scrollDown(e))),this._parser.registerCsiHandler({final:"X"},(e=>this.eraseChars(e))),this._parser.registerCsiHandler({final:"Z"},(e=>this.cursorBackwardTab(e))),this._parser.registerCsiHandler({final:"`"},(e=>this.charPosAbsolute(e))),this._parser.registerCsiHandler({final:"a"},(e=>this.hPositionRelative(e))),this._parser.registerCsiHandler({final:"b"},(e=>this.repeatPrecedingCharacter(e))),this._parser.registerCsiHandler({final:"c"},(e=>this.sendDeviceAttributesPrimary(e))),this._parser.registerCsiHandler({prefix:">",final:"c"},(e=>this.sendDeviceAttributesSecondary(e))),this._parser.registerCsiHandler({final:"d"},(e=>this.linePosAbsolute(e))),this._parser.registerCsiHandler({final:"e"},(e=>this.vPositionRelative(e))),this._parser.registerCsiHandler({final:"f"},(e=>this.hVPosition(e))),this._parser.registerCsiHandler({final:"g"},(e=>this.tabClear(e))),this._parser.registerCsiHandler({final:"h"},(e=>this.setMode(e))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(e=>this.setModePrivate(e))),this._parser.registerCsiHandler({final:"l"},(e=>this.resetMode(e))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(e=>this.resetModePrivate(e))),this._parser.registerCsiHandler({final:"m"},(e=>this.charAttributes(e))),this._parser.registerCsiHandler({final:"n"},(e=>this.deviceStatus(e))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(e=>this.deviceStatusPrivate(e))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(e=>this.softReset(e))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(e=>this.setCursorStyle(e))),this._parser.registerCsiHandler({final:"r"},(e=>this.setScrollRegion(e))),this._parser.registerCsiHandler({final:"s"},(e=>this.saveCursor(e))),this._parser.registerCsiHandler({final:"t"},(e=>this.windowOptions(e))),this._parser.registerCsiHandler({final:"u"},(e=>this.restoreCursor(e))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(e=>this.insertColumns(e))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(e=>this.deleteColumns(e))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(e=>this.selectProtected(e))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(e=>this.requestMode(e,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(e=>this.requestMode(e,!1))),this._parser.setExecuteHandler(n.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(n.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(n.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(n.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(n.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(n.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(n.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(n.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(n.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(n.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(n.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(n.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new v.OscHandler((e=>(this.setTitle(e),this.setIconName(e),!0)))),this._parser.registerOscHandler(1,new v.OscHandler((e=>this.setIconName(e)))),this._parser.registerOscHandler(2,new v.OscHandler((e=>this.setTitle(e)))),this._parser.registerOscHandler(4,new v.OscHandler((e=>this.setOrReportIndexedColor(e)))),this._parser.registerOscHandler(8,new v.OscHandler((e=>this.setHyperlink(e)))),this._parser.registerOscHandler(10,new v.OscHandler((e=>this.setOrReportFgColor(e)))),this._parser.registerOscHandler(11,new v.OscHandler((e=>this.setOrReportBgColor(e)))),this._parser.registerOscHandler(12,new v.OscHandler((e=>this.setOrReportCursorColor(e)))),this._parser.registerOscHandler(104,new v.OscHandler((e=>this.restoreIndexedColor(e)))),this._parser.registerOscHandler(110,new v.OscHandler((e=>this.restoreFgColor(e)))),this._parser.registerOscHandler(111,new v.OscHandler((e=>this.restoreBgColor(e)))),this._parser.registerOscHandler(112,new v.OscHandler((e=>this.restoreCursorColor(e)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const e in o.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:e},(()=>this.selectCharset("("+e))),this._parser.registerEscHandler({intermediates:")",final:e},(()=>this.selectCharset(")"+e))),this._parser.registerEscHandler({intermediates:"*",final:e},(()=>this.selectCharset("*"+e))),this._parser.registerEscHandler({intermediates:"+",final:e},(()=>this.selectCharset("+"+e))),this._parser.registerEscHandler({intermediates:"-",final:e},(()=>this.selectCharset("-"+e))),this._parser.registerEscHandler({intermediates:".",final:e},(()=>this.selectCharset("."+e))),this._parser.registerEscHandler({intermediates:"/",final:e},(()=>this.selectCharset("/"+e)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((e=>(this._logService.error("Parsing error: ",e),e))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new _.DcsHandler(((e,t)=>this.requestStatusString(e,t))))}_preserveStack(e,t,i,r){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=i,this._parseStack.position=r}_logSlowResolvingAsync(e){this._logService.logLevel<=g.LogLevelEnum.WARN&&Promise.race([e,new Promise(((e,t)=>setTimeout((()=>t("#SLOW_TIMEOUT")),5e3)))]).catch((e=>{if("#SLOW_TIMEOUT"!==e)throw e;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let i,r=this._activeBuffer.x,s=this._activeBuffer.y,n=0;const o=this._parseStack.paused;if(o){if(i=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(i),i;r=this._parseStack.cursorStartX,s=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>w&&(n=this._parseStack.position+w)}if(this._logService.logLevel<=g.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+("string"==typeof e?` "${e}"`:` "${Array.prototype.map.call(e,(e=>String.fromCharCode(e))).join("")}"`),"string"==typeof e?e.split("").map((e=>e.charCodeAt(0))):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<w&&(this._parseBuffer=new Uint32Array(Math.min(e.length,w))),o||this._dirtyRowTracker.clearRange(),e.length>w)for(let t=n;t<e.length;t+=w){const n=t+w<e.length?t+w:e.length,o="string"==typeof e?this._stringDecoder.decode(e.substring(t,n),this._parseBuffer):this._utf8Decoder.decode(e.subarray(t,n),this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,o))return this._preserveStack(r,s,o,t),this._logSlowResolvingAsync(i),i}else if(!o){const t="string"==typeof e?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,t))return this._preserveStack(r,s,t,0),this._logSlowResolvingAsync(i),i}this._activeBuffer.x===r&&this._activeBuffer.y===s||this._onCursorMove.fire();const a=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),l=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);l<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(l,this._bufferService.rows-1),Math.min(a,this._bufferService.rows-1))}print(e,t,i){let r,s;const n=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,a=this._bufferService.cols,l=this._coreService.decPrivateModes.wraparound,u=this._coreService.modes.insertMode,f=this._curAttrData;let p=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&i-t>0&&2===p.getWidth(this._activeBuffer.x-1)&&p.setCellFromCodepoint(this._activeBuffer.x-1,0,1,f);let g=this._parser.precedingJoinState;for(let v=t;v<i;++v){if(r=e[v],r<127&&n){const e=n[String.fromCharCode(r)];e&&(r=e.charCodeAt(0))}const t=this._unicodeService.charProperties(r,g);s=m.UnicodeService.extractWidth(t);const i=m.UnicodeService.extractShouldJoin(t),_=i?m.UnicodeService.extractWidth(g):0;if(g=t,o&&this._onA11yChar.fire((0,c.stringFromCodePoint)(r)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+s-_>a)if(l){const e=p;let t=this._activeBuffer.x-_;for(this._activeBuffer.x=_,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),p=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),_>0&&p instanceof h.BufferLine&&p.copyCellsFrom(e,t,0,_,!1);t<a;)e.setCellFromCodepoint(t++,0,1,f)}else if(this._activeBuffer.x=a-1,2===s)continue;if(i&&this._activeBuffer.x){const e=p.getWidth(this._activeBuffer.x-1)?1:2;p.addCodepointToCell(this._activeBuffer.x-e,r,s);for(let e=s-_;--e>=0;)p.setCellFromCodepoint(this._activeBuffer.x++,0,0,f)}else if(u&&(p.insertCells(this._activeBuffer.x,s-_,this._activeBuffer.getNullCell(f)),2===p.getWidth(a-1)&&p.setCellFromCodepoint(a-1,d.NULL_CELL_CODE,d.NULL_CELL_WIDTH,f)),p.setCellFromCodepoint(this._activeBuffer.x++,r,s,f),s>0)for(;--s;)p.setCellFromCodepoint(this._activeBuffer.x++,0,0,f)}this._parser.precedingJoinState=g,this._activeBuffer.x<a&&i-t>0&&0===p.getWidth(this._activeBuffer.x)&&!p.hasContent(this._activeBuffer.x)&&p.setCellFromCodepoint(this._activeBuffer.x,0,1,f),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return"t"!==e.final||e.prefix||e.intermediates?this._parser.registerCsiHandler(e,t):this._parser.registerCsiHandler(e,(e=>!S(e.params[0],this._optionsService.rawOptions.windowOptions)||t(e)))}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new _.DcsHandler(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new v.OscHandler(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){const t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){const t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){const t=e.params[0];return 0===t?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===t&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){const t=e.params[0];return 1===t&&(this._curAttrData.bg|=536870912),2!==t&&0!==t||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,i,r=!1,s=!1){const n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.replaceCells(t,i,this._activeBuffer.getNullCell(this._eraseAttrData()),s),r&&(n.isWrapped=!1)}_resetBufferLine(e,t=!1){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i&&(i.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),i.isWrapped=!1)}eraseInDisplay(e,t=!1){let i;switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);i<this._bufferService.rows;i++)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(i);break;case 1:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(i+1).isWrapped=!1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0);break;case 2:for(i=this._bufferService.rows,this._dirtyRowTracker.markDirty(i-1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0);break;case 3:const e=this._activeBuffer.lines.length-this._bufferService.rows;e>0&&(this._activeBuffer.lines.trimStart(e),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-e,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-e,0),this._onScroll.fire(0))}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const i=this._activeBuffer.ybase+this._activeBuffer.y,r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,s=this._bufferService.rows-1+this._activeBuffer.ybase-r+1;for(;t--;)this._activeBuffer.lines.splice(s-1,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const i=this._activeBuffer.ybase+this._activeBuffer.y;let r;for(r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-r;t--;)this._activeBuffer.lines.splice(i,1),this._activeBuffer.lines.splice(r,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(h.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){const t=this._parser.precedingJoinState;if(!t)return!0;const i=e.params[0]||1,r=m.UnicodeService.extractWidth(t),s=this._activeBuffer.x-r,n=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(s),o=new Uint32Array(n.length*i);let a=0;for(let e=0;e<n.length;){const t=n.codePointAt(e)||0;o[a++]=t,e+=t>65535?2:1}let l=a;for(let e=1;e<i;++e)o.copyWithin(l,0,a),l+=a;return this.print(o,0,l),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(n.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(n.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(n.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(n.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(n.C0.ESC+"[>83;40003;0c")),!0}_is(e){return 0===(this._optionsService.rawOptions.termName+"").indexOf(e)}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,o.DEFAULT_CHARSET),this._charsetService.setgCharset(1,o.DEFAULT_CHARSET),this._charsetService.setgCharset(2,o.DEFAULT_CHARSET),this._charsetService.setgCharset(3,o.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===e.params[t]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(e,t){const i=this._coreService.decPrivateModes,{activeProtocol:r,activeEncoding:s}=this._coreMouseService,o=this._coreService,{buffers:a,cols:l}=this._bufferService,{active:c,alt:h}=a,u=this._optionsService.rawOptions,d=e=>e?1:2,f=e.params[0];return p=f,g=t?2===f?4:4===f?d(o.modes.insertMode):12===f?3:20===f?d(u.convertEol):0:1===f?d(i.applicationCursorKeys):3===f?u.windowOptions.setWinLines?80===l?2:132===l?1:0:0:6===f?d(i.origin):7===f?d(i.wraparound):8===f?3:9===f?d("X10"===r):12===f?d(u.cursorBlink):25===f?d(!o.isCursorHidden):45===f?d(i.reverseWraparound):66===f?d(i.applicationKeypad):67===f?4:1e3===f?d("VT200"===r):1002===f?d("DRAG"===r):1003===f?d("ANY"===r):1004===f?d(i.sendFocus):1005===f?4:1006===f?d("SGR"===s):1015===f?4:1016===f?d("SGR_PIXELS"===s):1048===f?1:47===f||1047===f||1049===f?d(c===h):2004===f?d(i.bracketedPasteMode):0,o.triggerDataEvent(`${n.C0.ESC}[${t?"":"?"}${p};${g}$y`),!0;var p,g}_updateAttrColor(e,t,i,r,s){return 2===t?(e|=50331648,e&=-16777216,e|=p.AttributeData.fromColorRGB([i,r,s])):5===t&&(e&=-50331904,e|=33554432|255&i),e}_extractColor(e,t,i){const r=[0,0,-1,0,0,0];let s=0,n=0;do{if(r[n+s]=e.params[t+n],e.hasSubParams(t+n)){const i=e.getSubParams(t+n);let o=0;do{5===r[1]&&(s=1),r[n+o+1+s]=i[o]}while(++o<i.length&&o+n+1+s<r.length);break}if(5===r[1]&&n+s>=2||2===r[1]&&n+s>=5)break;r[1]&&(s=1)}while(++n+t<e.length&&n+s<r.length);for(let e=2;e<r.length;++e)-1===r[e]&&(r[e]=0);switch(r[0]){case 38:i.fg=this._updateAttrColor(i.fg,r[1],r[3],r[4],r[5]);break;case 48:i.bg=this._updateAttrColor(i.bg,r[1],r[3],r[4],r[5]);break;case 58:i.extended=i.extended.clone(),i.extended.underlineColor=this._updateAttrColor(i.extended.underlineColor,r[1],r[3],r[4],r[5])}return n}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,0===e&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=h.DEFAULT_ATTR_DATA.fg,e.bg=h.DEFAULT_ATTR_DATA.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(1===e.length&&0===e.params[0])return this._processSGR0(this._curAttrData),!0;const t=e.length;let i;const r=this._curAttrData;for(let s=0;s<t;s++)i=e.params[s],i>=30&&i<=37?(r.fg&=-50331904,r.fg|=16777216|i-30):i>=40&&i<=47?(r.bg&=-50331904,r.bg|=16777216|i-40):i>=90&&i<=97?(r.fg&=-50331904,r.fg|=16777224|i-90):i>=100&&i<=107?(r.bg&=-50331904,r.bg|=16777224|i-100):0===i?this._processSGR0(r):1===i?r.fg|=134217728:3===i?r.bg|=67108864:4===i?(r.fg|=268435456,this._processUnderline(e.hasSubParams(s)?e.getSubParams(s)[0]:1,r)):5===i?r.fg|=536870912:7===i?r.fg|=67108864:8===i?r.fg|=1073741824:9===i?r.fg|=2147483648:2===i?r.bg|=134217728:21===i?this._processUnderline(2,r):22===i?(r.fg&=-134217729,r.bg&=-134217729):23===i?r.bg&=-67108865:24===i?(r.fg&=-268435457,this._processUnderline(0,r)):25===i?r.fg&=-536870913:27===i?r.fg&=-67108865:28===i?r.fg&=-1073741825:29===i?r.fg&=2147483647:39===i?(r.fg&=-67108864,r.fg|=16777215&h.DEFAULT_ATTR_DATA.fg):49===i?(r.bg&=-67108864,r.bg|=16777215&h.DEFAULT_ATTR_DATA.bg):38===i||48===i||58===i?s+=this._extractColor(e,s,r):53===i?r.bg|=1073741824:55===i?r.bg&=-1073741825:59===i?(r.extended=r.extended.clone(),r.extended.underlineColor=-1,r.updateExtended()):100===i?(r.fg&=-67108864,r.fg|=16777215&h.DEFAULT_ATTR_DATA.fg,r.bg&=-67108864,r.bg|=16777215&h.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",i);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${n.C0.ESC}[0n`);break;case 6:const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[${e};${t}R`)}return!0}deviceStatusPrivate(e){if(6===e.params[0]){const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[?${e};${t}R`)}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=h.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){const t=e.params[0]||1;switch(t){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const i=t%2==1;return this._optionsService.options.cursorBlink=i,!0}setScrollRegion(e){const t=e.params[0]||1;let i;return(e.length<2||(i=e.params[1])>this._bufferService.rows||0===i)&&(i=this._bufferService.rows),i>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=i-1,this._setCursor(0,0)),!0}windowOptions(e){if(!S(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;const t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:2!==t&&this._onRequestWindowsOptionsReport.fire(C.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(C.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${n.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:0!==t&&2!==t||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),0!==t&&1!==t||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:0!==t&&2!==t||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),0!==t&&1!==t||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){const t=[],i=e.split(";");for(;i.length>1;){const e=i.shift(),r=i.shift();if(/^\d+$/.exec(e)){const i=parseInt(e);if(E(i))if("?"===r)t.push({type:0,index:i});else{const e=(0,y.parseColor)(r);e&&t.push({type:1,index:i,color:e})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){const t=e.split(";");return!(t.length<2)&&(t[1]?this._createHyperlink(t[0],t[1]):!t[0]&&this._finishHyperlink())}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();const i=e.split(":");let r;const s=i.findIndex((e=>e.startsWith("id=")));return-1!==s&&(r=i[s].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:r,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){const i=e.split(";");for(let e=0;e<i.length&&!(t>=this._specialColors.length);++e,++t)if("?"===i[e])this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{const r=(0,y.parseColor)(i[e]);r&&this._onColor.fire([{type:1,index:this._specialColors[t],color:r}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;const t=[],i=e.split(";");for(let e=0;e<i.length;++e)if(/^\d+$/.exec(i[e])){const r=parseInt(i[e]);E(r)&&t.push({type:2,index:r})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,o.DEFAULT_CHARSET),!0}selectCharset(e){return 2!==e.length?(this.selectDefaultCharset(),!0):("/"===e[0]||this._charsetService.setgCharset(b[e[0]],o.CHARSETS[e[1]]||o.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=h.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=h.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){const e=new f.CellData;e.content=1<<22|"E".charCodeAt(0),e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){const i=this._activeBuffer.ybase+this._activeBuffer.y+t,r=this._activeBuffer.lines.get(i);r&&(r.fill(e),r.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){const i=this._bufferService.buffer,r=this._optionsService.rawOptions;return(e=>(this._coreService.triggerDataEvent(`${n.C0.ESC}${e}${n.C0.ESC}\\`),!0))('"q'===e?`P1$r${this._curAttrData.isProtected()?1:0}"q`:'"p'===e?'P1$r61;1"p':"r"===e?`P1$r${i.scrollTop+1};${i.scrollBottom+1}r`:"m"===e?"P1$r0m":" q"===e?`P1$r${{block:2,underline:4,bar:6}[r.cursorStyle]-(r.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}}t.InputHandler=x;let R=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(k=e,e=t,t=k),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function E(e){return 0<=e&&e<256}R=r([s(0,g.IBufferService)],R)},844:(e,t)=>{function i(e){for(const t of e)t.dispose();e.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const e of this._disposables)e.dispose();this._disposables.length=0}register(e){return this._disposables.push(e),e}unregister(e){const t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},t.toDisposable=function(e){return{dispose:e}},t.disposeArray=i,t.getDisposeArrayDisposable=function(e){return{dispose:()=>i(e)}}},1505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class i{constructor(){this._data={}}set(e,t,i){this._data[e]||(this._data[e]={}),this._data[e][t]=i}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}}t.TwoKeyMap=i,t.FourKeyMap=class{constructor(){this._data=new i}set(e,t,r,s,n){this._data.get(e,t)||this._data.set(e,t,new i),this._data.get(e,t).set(r,s,n)}get(e,t,i,r){return this._data.get(e,t)?.get(i,r)}clear(){this._data.clear()}}},6114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode="undefined"!=typeof process&&"title"in process;const i=t.isNode?"node":navigator.userAgent,r=t.isNode?"node":navigator.platform;t.isFirefox=i.includes("Firefox"),t.isLegacyEdge=i.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(i),t.getSafariVersion=function(){if(!t.isSafari)return 0;const e=i.match(/Version\/(\d+)/);return null===e||e.length<2?0:parseInt(e[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(r),t.isIpad="iPad"===r,t.isIphone="iPhone"===r,t.isWindows=["Windows","Win16","Win32","WinCE"].includes(r),t.isLinux=r.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(i)},6106:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let i=0;t.SortedList=class{constructor(e){this._getKey=e,this._array=[]}clear(){this._array.length=0}insert(e){0!==this._array.length?(i=this._search(this._getKey(e)),this._array.splice(i,0,e)):this._array.push(e)}delete(e){if(0===this._array.length)return!1;const t=this._getKey(e);if(void 0===t)return!1;if(i=this._search(t),-1===i)return!1;if(this._getKey(this._array[i])!==t)return!1;do{if(this._array[i]===e)return this._array.splice(i,1),!0}while(++i<this._array.length&&this._getKey(this._array[i])===t);return!1}*getKeyIterator(e){if(0!==this._array.length&&(i=this._search(e),!(i<0||i>=this._array.length)&&this._getKey(this._array[i])===e))do{yield this._array[i]}while(++i<this._array.length&&this._getKey(this._array[i])===e)}forEachByKey(e,t){if(0!==this._array.length&&(i=this._search(e),!(i<0||i>=this._array.length)&&this._getKey(this._array[i])===e))do{t(this._array[i])}while(++i<this._array.length&&this._getKey(this._array[i])===e)}values(){return[...this._array].values()}_search(e){let t=0,i=this._array.length-1;for(;i>=t;){let r=t+i>>1;const s=this._getKey(this._array[r]);if(s>e)i=r-1;else{if(!(s<e)){for(;r>0&&this._getKey(this._array[r-1])===e;)r--;return r}t=r+1}}return t}}},7226:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;const r=i(6114);class s{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,i=0,r=e.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(t=Date.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,Date.now()-t),i=Math.max(t,i),s=e.timeRemaining(),1.5*i>s)return r-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-t))}ms`),void this._start();r=s}this.clear()}}class n extends s{_requestCallback(e){return setTimeout((()=>e(this._createDeadline(16))))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){const t=Date.now()+e;return{timeRemaining:()=>Math.max(0,t-Date.now())}}}t.PriorityTaskQueue=n,t.IdleTaskQueue=!r.isNode&&"requestIdleCallback"in window?class extends s{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}}:n,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}}},9282:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;const r=i(643);t.updateWindowsModeWrappedState=function(e){const t=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1),i=t?.get(e.cols-1),s=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);s&&i&&(s.isWrapped=i[r.CHAR_DATA_CODE_INDEX]!==r.NULL_CELL_CODE&&i[r.CHAR_DATA_CODE_INDEX]!==r.WHITESPACE_CELL_CODE)}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class i{constructor(){this.fg=0,this.bg=0,this.extended=new r}static toColorRGB(e){return[e>>>16&255,e>>>8&255,255&e]}static fromColorRGB(e){return(255&e[0])<<16|(255&e[1])<<8|255&e[2]}clone(){const e=new i;return e.fg=this.fg,e.bg=this.bg,e.extended=this.extended.clone(),e}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return!(50331648&~this.fg)}isBgRGB(){return!(50331648&~this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return!(50331648&this.fg)}isBgDefault(){return!(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?!(50331648&~this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?!(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}t.AttributeData=i;class r{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(e){this._ext=e}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(e){this._ext&=-469762049,this._ext|=e<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(e){this._ext&=-67108864,this._ext|=67108863&e}get urlId(){return this._urlId}set urlId(e){this._urlId=e}get underlineVariantOffset(){const e=(3758096384&this._ext)>>29;return e<0?4294967288^e:e}set underlineVariantOffset(e){this._ext&=536870911,this._ext|=e<<29&3758096384}constructor(e=0,t=0){this._ext=0,this._urlId=0,this._ext=e,this._urlId=t}clone(){return new r(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}}t.ExtendedAttrs=r},9092:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.MAX_BUFFER_SIZE=void 0;const r=i(6349),s=i(7226),n=i(3734),o=i(8437),a=i(4634),l=i(511),c=i(643),h=i(4863),u=i(7116);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(e,t,i){this._hasScrollback=e,this._optionsService=t,this._bufferService=i,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=o.DEFAULT_ATTR_DATA.clone(),this.savedCharset=u.DEFAULT_CHARSET,this.markers=[],this._nullCell=l.CellData.fromCharData([0,c.NULL_CELL_CHAR,c.NULL_CELL_WIDTH,c.NULL_CELL_CODE]),this._whitespaceCell=l.CellData.fromCharData([0,c.WHITESPACE_CELL_CHAR,c.WHITESPACE_CELL_WIDTH,c.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new s.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new r.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new n.ExtendedAttrs),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new n.ExtendedAttrs),this._whitespaceCell}getBlankLine(e,t){return new o.BufferLine(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;const i=e+this._optionsService.rawOptions.scrollback;return i>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:i}fillViewportRows(e){if(0===this.lines.length){void 0===e&&(e=o.DEFAULT_ATTR_DATA);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new r.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){const i=this.getNullCell(o.DEFAULT_ATTR_DATA);let r=0;const s=this._getCorrectBufferLength(t);if(s>this.lines.maxLength&&(this.lines.maxLength=s),this.lines.length>0){if(this._cols<e)for(let t=0;t<this.lines.length;t++)r+=+this.lines.get(t).resize(e,i);let n=0;if(this._rows<t)for(let r=this._rows;r<t;r++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||void 0!==this._optionsService.rawOptions.windowsPty.backend||void 0!==this._optionsService.rawOptions.windowsPty.buildNumber?this.lines.push(new o.BufferLine(e,i)):this.ybase>0&&this.lines.length<=this.ybase+this.y+n+1?(this.ybase--,n++,this.ydisp>0&&this.ydisp--):this.lines.push(new o.BufferLine(e,i)));else for(let e=this._rows;e>t;e--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(s<this.lines.maxLength){const e=this.lines.length-s;e>0&&(this.lines.trimStart(e),this.ybase=Math.max(this.ybase-e,0),this.ydisp=Math.max(this.ydisp-e,0),this.savedY=Math.max(this.savedY-e,0)),this.lines.maxLength=s}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),n&&(this.y+=n),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let t=0;t<this.lines.length;t++)r+=+this.lines.get(t).resize(e,i);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),r>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){const e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&"conpty"===e.backend&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){const i=(0,a.reflowLargerGetLinesToRemove)(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(o.DEFAULT_ATTR_DATA));if(i.length>0){const r=(0,a.reflowLargerCreateNewLayout)(this.lines,i);(0,a.reflowLargerApplyNewLayout)(this.lines,r.layout),this._reflowLargerAdjustViewport(e,t,r.countRemoved)}}_reflowLargerAdjustViewport(e,t,i){const r=this.getNullCell(o.DEFAULT_ATTR_DATA);let s=i;for(;s-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new o.BufferLine(e,r))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-i,0)}_reflowSmaller(e,t){const i=this.getNullCell(o.DEFAULT_ATTR_DATA),r=[];let s=0;for(let n=this.lines.length-1;n>=0;n--){let l=this.lines.get(n);if(!l||!l.isWrapped&&l.getTrimmedLength()<=e)continue;const c=[l];for(;l.isWrapped&&n>0;)l=this.lines.get(--n),c.unshift(l);const h=this.ybase+this.y;if(h>=n&&h<n+c.length)continue;const u=c[c.length-1].getTrimmedLength(),d=(0,a.reflowSmallerGetNewLineLengths)(c,this._cols,e),f=d.length-c.length;let p;p=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+f):Math.max(0,this.lines.length-this.lines.maxLength+f);const g=[];for(let e=0;e<f;e++){const e=this.getBlankLine(o.DEFAULT_ATTR_DATA,!0);g.push(e)}g.length>0&&(r.push({start:n+c.length+s,newLines:g}),s+=g.length),c.push(...g);let m=d.length-1,v=d[m];0===v&&(m--,v=d[m]);let _=c.length-f-1,y=u;for(;_>=0;){const e=Math.min(y,v);if(void 0===c[m])break;if(c[m].copyCellsFrom(c[_],y-e,v-e,e,!0),v-=e,0===v&&(m--,v=d[m]),y-=e,0===y){_--;const e=Math.max(_,0);y=(0,a.getWrappedLineTrimmedLength)(c,e,this._cols)}}for(let t=0;t<c.length;t++)d[t]<e&&c[t].setCell(d[t],i);let b=f-p;for(;b-- >0;)0===this.ybase?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+s)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+f,this.ybase+t-1)}if(r.length>0){const e=[],t=[];for(let e=0;e<this.lines.length;e++)t.push(this.lines.get(e));const i=this.lines.length;let n=i-1,o=0,a=r[o];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+s);let l=0;for(let c=Math.min(this.lines.maxLength-1,i+s-1);c>=0;c--)if(a&&a.start>n+l){for(let e=a.newLines.length-1;e>=0;e--)this.lines.set(c--,a.newLines[e]);c++,e.push({index:n+1,amount:a.newLines.length}),l+=a.newLines.length,a=r[++o]}else this.lines.set(c,t[n--]);let c=0;for(let t=e.length-1;t>=0;t--)e[t].index+=c,this.lines.onInsertEmitter.fire(e[t]),c+=e[t].amount;const h=Math.max(0,i+s-this.lines.maxLength);h>0&&this.lines.onTrimEmitter.fire(h)}}translateBufferLineToString(e,t,i=0,r){const s=this.lines.get(e);return s?s.translateToString(t,i,r):""}getWrappedRangeForLine(e){let t=e,i=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;i+1<this.lines.length&&this.lines.get(i+1).isWrapped;)i++;return{first:t,last:i}}setupTabStops(e){for(null!=e?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(null==e&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(null==e&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose(),this.markers.splice(e--,1);this._isClearing=!1}addMarker(e){const t=new h.Marker(e);return this.markers.push(t),t.register(this.lines.onTrim((e=>{t.line-=e,t.line<0&&t.dispose()}))),t.register(this.lines.onInsert((e=>{t.line>=e.index&&(t.line+=e.amount)}))),t.register(this.lines.onDelete((e=>{t.line>=e.index&&t.line<e.index+e.amount&&t.dispose(),t.line>e.index&&(t.line-=e.amount)}))),t.register(t.onDispose((()=>this._removeMarker(t)))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}}},8437:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;const r=i(3734),s=i(511),n=i(643),o=i(482);t.DEFAULT_ATTR_DATA=Object.freeze(new r.AttributeData);let a=0;class l{constructor(e,t,i=!1){this.isWrapped=i,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);const r=t||s.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]);for(let t=0;t<e;++t)this.setCell(t,r);this.length=e}get(e){const t=this._data[3*e+0],i=2097151&t;return[this._data[3*e+1],2097152&t?this._combined[e]:i?(0,o.stringFromCodePoint)(i):"",t>>22,2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):i]}set(e,t){this._data[3*e+1]=t[n.CHAR_DATA_ATTR_INDEX],t[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=t[1],this._data[3*e+0]=2097152|e|t[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=t[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[n.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&t}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e]:2097151&t?(0,o.stringFromCodePoint)(2097151&t):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,t){return a=3*e,t.content=this._data[a+0],t.fg=this._data[a+1],t.bg=this._data[a+2],2097152&t.content&&(t.combinedData=this._combined[e]),268435456&t.bg&&(t.extended=this._extendedAttrs[e]),t}setCell(e,t){2097152&t.content&&(this._combined[e]=t.combinedData),268435456&t.bg&&(this._extendedAttrs[e]=t.extended),this._data[3*e+0]=t.content,this._data[3*e+1]=t.fg,this._data[3*e+2]=t.bg}setCellFromCodepoint(e,t,i,r){268435456&r.bg&&(this._extendedAttrs[e]=r.extended),this._data[3*e+0]=t|i<<22,this._data[3*e+1]=r.fg,this._data[3*e+2]=r.bg}addCodepointToCell(e,t,i){let r=this._data[3*e+0];2097152&r?this._combined[e]+=(0,o.stringFromCodePoint)(t):2097151&r?(this._combined[e]=(0,o.stringFromCodePoint)(2097151&r)+(0,o.stringFromCodePoint)(t),r&=-2097152,r|=2097152):r=t|1<<22,i&&(r&=-12582913,r|=i<<22),this._data[3*e+0]=r}insertCells(e,t,i){if((e%=this.length)&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,i),t<this.length-e){const r=new s.CellData;for(let i=this.length-e-t-1;i>=0;--i)this.setCell(e+t+i,this.loadCell(e+i,r));for(let r=0;r<t;++r)this.setCell(e+r,i)}else for(let t=e;t<this.length;++t)this.setCell(t,i);2===this.getWidth(this.length-1)&&this.setCellFromCodepoint(this.length-1,0,1,i)}deleteCells(e,t,i){if(e%=this.length,t<this.length-e){const r=new s.CellData;for(let i=0;i<this.length-e-t;++i)this.setCell(e+i,this.loadCell(e+t+i,r));for(let e=this.length-t;e<this.length;++e)this.setCell(e,i)}else for(let t=e;t<this.length;++t)this.setCell(t,i);e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,i),0!==this.getWidth(e)||this.hasContent(e)||this.setCellFromCodepoint(e,0,1,i)}replaceCells(e,t,i,r=!1){if(r)for(e&&2===this.getWidth(e-1)&&!this.isProtected(e-1)&&this.setCellFromCodepoint(e-1,0,1,i),t<this.length&&2===this.getWidth(t-1)&&!this.isProtected(t)&&this.setCellFromCodepoint(t,0,1,i);e<t&&e<this.length;)this.isProtected(e)||this.setCell(e,i),e++;else for(e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,i),t<this.length&&2===this.getWidth(t-1)&&this.setCellFromCodepoint(t,0,1,i);e<t&&e<this.length;)this.setCell(e++,i)}resize(e,t){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const i=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*i)this._data=new Uint32Array(this._data.buffer,0,i);else{const e=new Uint32Array(i);e.set(this._data),this._data=e}for(let i=this.length;i<e;++i)this.setCell(i,t)}else{this._data=this._data.subarray(0,i);const t=Object.keys(this._combined);for(let i=0;i<t.length;i++){const r=parseInt(t[i],10);r>=e&&delete this._combined[r]}const r=Object.keys(this._extendedAttrs);for(let t=0;t<r.length;t++){const i=parseInt(r[t],10);i>=e&&delete this._extendedAttrs[i]}}return this.length=e,4*i*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,t=!1){if(t)for(let t=0;t<this.length;++t)this.isProtected(t)||this.setCell(t,e);else{this._combined={},this._extendedAttrs={};for(let t=0;t<this.length;++t)this.setCell(t,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(const t in e._combined)this._combined[t]=e._combined[t];this._extendedAttrs={};for(const t in e._extendedAttrs)this._extendedAttrs[t]=e._extendedAttrs[t];this.isWrapped=e.isWrapped}clone(){const e=new l(0);e._data=new Uint32Array(this._data),e.length=this.length;for(const t in this._combined)e._combined[t]=this._combined[t];for(const t in this._extendedAttrs)e._extendedAttrs[t]=this._extendedAttrs[t];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||50331648&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,t,i,r,s){const n=e._data;if(s)for(let s=r-1;s>=0;s--){for(let e=0;e<3;e++)this._data[3*(i+s)+e]=n[3*(t+s)+e];268435456&n[3*(t+s)+2]&&(this._extendedAttrs[i+s]=e._extendedAttrs[t+s])}else for(let s=0;s<r;s++){for(let e=0;e<3;e++)this._data[3*(i+s)+e]=n[3*(t+s)+e];268435456&n[3*(t+s)+2]&&(this._extendedAttrs[i+s]=e._extendedAttrs[t+s])}const o=Object.keys(e._combined);for(let r=0;r<o.length;r++){const s=parseInt(o[r],10);s>=t&&(this._combined[s-t+i]=e._combined[s])}}translateToString(e,t,i,r){t=t??0,i=i??this.length,e&&(i=Math.min(i,this.getTrimmedLength())),r&&(r.length=0);let s="";for(;t<i;){const e=this._data[3*t+0],i=2097151&e,a=2097152&e?this._combined[t]:i?(0,o.stringFromCodePoint)(i):n.WHITESPACE_CELL_CHAR;if(s+=a,r)for(let e=0;e<a.length;++e)r.push(t);t+=e>>22||1}return r&&r.push(t),s}}t.BufferLine=l},4841:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}},4634:(e,t)=>{function i(e,t,i){if(t===e.length-1)return e[t].getTrimmedLength();const r=!e[t].hasContent(i-1)&&1===e[t].getWidth(i-1),s=2===e[t+1].getWidth(0);return r&&s?i-1:i}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(e,t,r,s,n){const o=[];for(let a=0;a<e.length-1;a++){let l=a,c=e.get(++l);if(!c.isWrapped)continue;const h=[e.get(a)];for(;l<e.length&&c.isWrapped;)h.push(c),c=e.get(++l);if(s>=a&&s<l){a+=h.length-1;continue}let u=0,d=i(h,u,t),f=1,p=0;for(;f<h.length;){const e=i(h,f,t),s=e-p,o=r-d,a=Math.min(s,o);h[u].copyCellsFrom(h[f],p,d,a,!1),d+=a,d===r&&(u++,d=0),p+=a,p===e&&(f++,p=0),0===d&&0!==u&&2===h[u-1].getWidth(r-1)&&(h[u].copyCellsFrom(h[u-1],r-1,d++,1,!1),h[u-1].setCell(r-1,n))}h[u].replaceCells(d,r,n);let g=0;for(let e=h.length-1;e>0&&(e>u||0===h[e].getTrimmedLength());e--)g++;g>0&&(o.push(a+h.length-g),o.push(g)),a+=h.length-1}return o},t.reflowLargerCreateNewLayout=function(e,t){const i=[];let r=0,s=t[r],n=0;for(let o=0;o<e.length;o++)if(s===o){const i=t[++r];e.onDeleteEmitter.fire({index:o-n,amount:i}),o+=i-1,n+=i,s=t[++r]}else i.push(o);return{layout:i,countRemoved:n}},t.reflowLargerApplyNewLayout=function(e,t){const i=[];for(let r=0;r<t.length;r++)i.push(e.get(t[r]));for(let t=0;t<i.length;t++)e.set(t,i[t]);e.length=t.length},t.reflowSmallerGetNewLineLengths=function(e,t,r){const s=[],n=e.map(((r,s)=>i(e,s,t))).reduce(((e,t)=>e+t));let o=0,a=0,l=0;for(;l<n;){if(n-l<r){s.push(n-l);break}o+=r;const c=i(e,a,t);o>c&&(o-=c,a++);const h=2===e[a].getWidth(o-1);h&&o--;const u=h?r-1:r;s.push(u),l+=u}return s},t.getWrappedLineTrimmedLength=i},5295:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;const r=i(8460),s=i(844),n=i(9092);class o extends s.Disposable{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this.register(new r.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new n.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new n.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}}t.BufferSet=o},511:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;const r=i(482),s=i(643),n=i(3734);class o extends n.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new n.ExtendedAttrs,this.combinedData=""}static fromCharData(e){const t=new o;return t.setFromCharData(e),t}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,r.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(e){this.fg=e[s.CHAR_DATA_ATTR_INDEX],this.bg=0;let t=!1;if(e[s.CHAR_DATA_CHAR_INDEX].length>2)t=!0;else if(2===e[s.CHAR_DATA_CHAR_INDEX].length){const i=e[s.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=i&&i<=56319){const r=e[s.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=r&&r<=57343?this.content=1024*(i-55296)+r-56320+65536|e[s.CHAR_DATA_WIDTH_INDEX]<<22:t=!0}else t=!0}else this.content=e[s.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|e[s.CHAR_DATA_WIDTH_INDEX]<<22;t&&(this.combinedData=e[s.CHAR_DATA_CHAR_INDEX],this.content=2097152|e[s.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=o},643:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;const r=i(8460),s=i(844);class n{get id(){return this._id}constructor(e){this.line=e,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new r.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,s.disposeArray)(this._disposables),this._disposables.length=0)}register(e){return this._disposables.push(e),e}}t.Marker=n,n._nextId=1},7116:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},t.CHARSETS.A={"#":""},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},t.CHARSETS.C=t.CHARSETS[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},t.CHARSETS.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},t.CHARSETS.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS.E=t.CHARSETS[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},t.CHARSETS.H=t.CHARSETS[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""}},2584:(e,t)=>{var i,r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,function(e){e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="",e.BS="\b",e.HT="\t",e.LF="\n",e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL=""}(i||(t.C0=i={})),function(e){e.PAD="",e.HOP="",e.BPH="",e.NBH="",e.IND="",e.NEL="",e.SSA="",e.ESA="",e.HTS="",e.HTJ="",e.VTS="",e.PLD="",e.PLU="",e.RI="",e.SS2="",e.SS3="",e.DCS="",e.PU1="",e.PU2="",e.STS="",e.CCH="",e.MW="",e.SPA="",e.EPA="",e.SOS="",e.SGCI="",e.SCI="",e.CSI="",e.ST="",e.OSC="",e.PM="",e.APC=""}(r||(t.C1=r={})),function(e){e.ST=`${i.ESC}\\`}(s||(t.C1_ESCAPED=s={}))},7399:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;const r=i(2584),s={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(e,t,i,n){const o={type:0,cancel:!1,key:void 0},a=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:"UIKeyInputUpArrow"===e.key?o.key=t?r.C0.ESC+"OA":r.C0.ESC+"[A":"UIKeyInputLeftArrow"===e.key?o.key=t?r.C0.ESC+"OD":r.C0.ESC+"[D":"UIKeyInputRightArrow"===e.key?o.key=t?r.C0.ESC+"OC":r.C0.ESC+"[C":"UIKeyInputDownArrow"===e.key&&(o.key=t?r.C0.ESC+"OB":r.C0.ESC+"[B");break;case 8:o.key=e.ctrlKey?"\b":r.C0.DEL,e.altKey&&(o.key=r.C0.ESC+o.key);break;case 9:if(e.shiftKey){o.key=r.C0.ESC+"[Z";break}o.key=r.C0.HT,o.cancel=!0;break;case 13:o.key=e.altKey?r.C0.ESC+r.C0.CR:r.C0.CR,o.cancel=!0;break;case 27:o.key=r.C0.ESC,e.altKey&&(o.key=r.C0.ESC+r.C0.ESC),o.cancel=!0;break;case 37:if(e.metaKey)break;a?(o.key=r.C0.ESC+"[1;"+(a+1)+"D",o.key===r.C0.ESC+"[1;3D"&&(o.key=r.C0.ESC+(i?"b":"[1;5D"))):o.key=t?r.C0.ESC+"OD":r.C0.ESC+"[D";break;case 39:if(e.metaKey)break;a?(o.key=r.C0.ESC+"[1;"+(a+1)+"C",o.key===r.C0.ESC+"[1;3C"&&(o.key=r.C0.ESC+(i?"f":"[1;5C"))):o.key=t?r.C0.ESC+"OC":r.C0.ESC+"[C";break;case 38:if(e.metaKey)break;a?(o.key=r.C0.ESC+"[1;"+(a+1)+"A",i||o.key!==r.C0.ESC+"[1;3A"||(o.key=r.C0.ESC+"[1;5A")):o.key=t?r.C0.ESC+"OA":r.C0.ESC+"[A";break;case 40:if(e.metaKey)break;a?(o.key=r.C0.ESC+"[1;"+(a+1)+"B",i||o.key!==r.C0.ESC+"[1;3B"||(o.key=r.C0.ESC+"[1;5B")):o.key=t?r.C0.ESC+"OB":r.C0.ESC+"[B";break;case 45:e.shiftKey||e.ctrlKey||(o.key=r.C0.ESC+"[2~");break;case 46:o.key=a?r.C0.ESC+"[3;"+(a+1)+"~":r.C0.ESC+"[3~";break;case 36:o.key=a?r.C0.ESC+"[1;"+(a+1)+"H":t?r.C0.ESC+"OH":r.C0.ESC+"[H";break;case 35:o.key=a?r.C0.ESC+"[1;"+(a+1)+"F":t?r.C0.ESC+"OF":r.C0.ESC+"[F";break;case 33:e.shiftKey?o.type=2:e.ctrlKey?o.key=r.C0.ESC+"[5;"+(a+1)+"~":o.key=r.C0.ESC+"[5~";break;case 34:e.shiftKey?o.type=3:e.ctrlKey?o.key=r.C0.ESC+"[6;"+(a+1)+"~":o.key=r.C0.ESC+"[6~";break;case 112:o.key=a?r.C0.ESC+"[1;"+(a+1)+"P":r.C0.ESC+"OP";break;case 113:o.key=a?r.C0.ESC+"[1;"+(a+1)+"Q":r.C0.ESC+"OQ";break;case 114:o.key=a?r.C0.ESC+"[1;"+(a+1)+"R":r.C0.ESC+"OR";break;case 115:o.key=a?r.C0.ESC+"[1;"+(a+1)+"S":r.C0.ESC+"OS";break;case 116:o.key=a?r.C0.ESC+"[15;"+(a+1)+"~":r.C0.ESC+"[15~";break;case 117:o.key=a?r.C0.ESC+"[17;"+(a+1)+"~":r.C0.ESC+"[17~";break;case 118:o.key=a?r.C0.ESC+"[18;"+(a+1)+"~":r.C0.ESC+"[18~";break;case 119:o.key=a?r.C0.ESC+"[19;"+(a+1)+"~":r.C0.ESC+"[19~";break;case 120:o.key=a?r.C0.ESC+"[20;"+(a+1)+"~":r.C0.ESC+"[20~";break;case 121:o.key=a?r.C0.ESC+"[21;"+(a+1)+"~":r.C0.ESC+"[21~";break;case 122:o.key=a?r.C0.ESC+"[23;"+(a+1)+"~":r.C0.ESC+"[23~";break;case 123:o.key=a?r.C0.ESC+"[24;"+(a+1)+"~":r.C0.ESC+"[24~";break;default:if(!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)if(i&&!n||!e.altKey||e.metaKey)!i||e.altKey||e.ctrlKey||e.shiftKey||!e.metaKey?e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&1===e.key.length?o.key=e.key:e.key&&e.ctrlKey&&("_"===e.key&&(o.key=r.C0.US),"@"===e.key&&(o.key=r.C0.NUL)):65===e.keyCode&&(o.type=1);else{const t=s[e.keyCode],i=t?.[e.shiftKey?1:0];if(i)o.key=r.C0.ESC+i;else if(e.keyCode>=65&&e.keyCode<=90){const t=e.ctrlKey?e.keyCode-64:e.keyCode+32;let i=String.fromCharCode(t);e.shiftKey&&(i=i.toUpperCase()),o.key=r.C0.ESC+i}else if(32===e.keyCode)o.key=r.C0.ESC+(e.ctrlKey?r.C0.NUL:" ");else if("Dead"===e.key&&e.code.startsWith("Key")){let t=e.code.slice(3,4);e.shiftKey||(t=t.toLowerCase()),o.key=r.C0.ESC+t,o.cancel=!0}}else e.keyCode>=65&&e.keyCode<=90?o.key=String.fromCharCode(e.keyCode-64):32===e.keyCode?o.key=r.C0.NUL:e.keyCode>=51&&e.keyCode<=55?o.key=String.fromCharCode(e.keyCode-51+27):56===e.keyCode?o.key=r.C0.DEL:219===e.keyCode?o.key=r.C0.ESC:220===e.keyCode?o.key=r.C0.FS:221===e.keyCode&&(o.key=r.C0.GS)}return o}},482:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10))+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)},t.utf32ToString=function(e,t=0,i=e.length){let r="";for(let s=t;s<i;++s){let t=e[s];t>65535?(t-=65536,r+=String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):r+=String.fromCharCode(t)}return r},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){const i=e.length;if(!i)return 0;let r=0,s=0;if(this._interim){const i=e.charCodeAt(s++);56320<=i&&i<=57343?t[r++]=1024*(this._interim-55296)+i-56320+65536:(t[r++]=this._interim,t[r++]=i),this._interim=0}for(let n=s;n<i;++n){const s=e.charCodeAt(n);if(55296<=s&&s<=56319){if(++n>=i)return this._interim=s,r;const o=e.charCodeAt(n);56320<=o&&o<=57343?t[r++]=1024*(s-55296)+o-56320+65536:(t[r++]=s,t[r++]=o)}else 65279!==s&&(t[r++]=s)}return r}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){const i=e.length;if(!i)return 0;let r,s,n,o,a=0,l=0,c=0;if(this.interim[0]){let r=!1,s=this.interim[0];s&=192==(224&s)?31:224==(240&s)?15:7;let n,o=0;for(;(n=63&this.interim[++o])&&o<4;)s<<=6,s|=n;const l=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,h=l-o;for(;c<h;){if(c>=i)return 0;if(n=e[c++],128!=(192&n)){c--,r=!0;break}this.interim[o++]=n,s<<=6,s|=63&n}r||(2===l?s<128?c--:t[a++]=s:3===l?s<2048||s>=55296&&s<=57343||65279===s||(t[a++]=s):s<65536||s>1114111||(t[a++]=s)),this.interim.fill(0)}const h=i-4;let u=c;for(;u<i;){for(;!(!(u<h)||128&(r=e[u])||128&(s=e[u+1])||128&(n=e[u+2])||128&(o=e[u+3]));)t[a++]=r,t[a++]=s,t[a++]=n,t[a++]=o,u+=4;if(r=e[u++],r<128)t[a++]=r;else if(192==(224&r)){if(u>=i)return this.interim[0]=r,a;if(s=e[u++],128!=(192&s)){u--;continue}if(l=(31&r)<<6|63&s,l<128){u--;continue}t[a++]=l}else if(224==(240&r)){if(u>=i)return this.interim[0]=r,a;if(s=e[u++],128!=(192&s)){u--;continue}if(u>=i)return this.interim[0]=r,this.interim[1]=s,a;if(n=e[u++],128!=(192&n)){u--;continue}if(l=(15&r)<<12|(63&s)<<6|63&n,l<2048||l>=55296&&l<=57343||65279===l)continue;t[a++]=l}else if(240==(248&r)){if(u>=i)return this.interim[0]=r,a;if(s=e[u++],128!=(192&s)){u--;continue}if(u>=i)return this.interim[0]=r,this.interim[1]=s,a;if(n=e[u++],128!=(192&n)){u--;continue}if(u>=i)return this.interim[0]=r,this.interim[1]=s,this.interim[2]=n,a;if(o=e[u++],128!=(192&o)){u--;continue}if(l=(7&r)<<18|(63&s)<<12|(63&n)<<6|63&o,l<65536||l>1114111)continue;t[a++]=l}}return a}}},225:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;const r=i(1480),s=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],n=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let o;t.UnicodeV6=class{constructor(){if(this.version="6",!o){o=new Uint8Array(65536),o.fill(1),o[0]=0,o.fill(0,1,32),o.fill(0,127,160),o.fill(2,4352,4448),o[9001]=2,o[9002]=2,o.fill(2,11904,42192),o[12351]=1,o.fill(2,44032,55204),o.fill(2,63744,64256),o.fill(2,65040,65050),o.fill(2,65072,65136),o.fill(2,65280,65377),o.fill(2,65504,65511);for(let e=0;e<s.length;++e)o.fill(0,s[e][0],s[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?o[e]:function(e,t){let i,r=0,s=t.length-1;if(e<t[0][0]||e>t[s][1])return!1;for(;s>=r;)if(i=r+s>>1,e>t[i][1])r=i+1;else{if(!(e<t[i][0]))return!0;s=i-1}return!1}(e,n)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let i=this.wcwidth(e),s=0===i&&0!==t;if(s){const e=r.UnicodeService.extractWidth(t);0===e?s=!1:e>i&&(i=e)}return r.UnicodeService.createPropertyValue(0,i,s)}}},5981:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;const r=i(8460),s=i(844);class n extends s.Disposable{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new r.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(void 0!==t&&this._syncCalls>t)return void(this._syncCalls=0);if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let i;for(this._isSyncWriting=!0;i=this._writeBuffer.shift();){this._action(i);const e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){const i=e||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const e=this._writeBuffer[this._bufferOffset],r=this._action(e,t);if(r){const e=e=>Date.now()-i>=12?setTimeout((()=>this._innerWrite(0,e))):this._innerWrite(i,e);return void r.catch((e=>(queueMicrotask((()=>{throw e})),Promise.resolve(!1)))).then(e)}const s=this._callbacks[this._bufferOffset];if(s&&s(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-i>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=n},5941:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;const i=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,r=/^[\da-f]+$/;function s(e,t){const i=e.toString(16),r=i.length<2?"0"+i:i;switch(t){case 4:return i[0];case 8:return r;case 12:return(r+r).slice(0,3);default:return r+r}}t.parseColor=function(e){if(!e)return;let t=e.toLowerCase();if(0===t.indexOf("rgb:")){t=t.slice(4);const e=i.exec(t);if(e){const t=e[1]?15:e[4]?255:e[7]?4095:65535;return[Math.round(parseInt(e[1]||e[4]||e[7]||e[10],16)/t*255),Math.round(parseInt(e[2]||e[5]||e[8]||e[11],16)/t*255),Math.round(parseInt(e[3]||e[6]||e[9]||e[12],16)/t*255)]}}else if(0===t.indexOf("#")&&(t=t.slice(1),r.exec(t)&&[3,6,9,12].includes(t.length))){const e=t.length/3,i=[0,0,0];for(let r=0;r<3;++r){const s=parseInt(t.slice(e*r,e*r+e),16);i[r]=1===e?s<<4:2===e?s:3===e?s>>4:s>>8}return i}},t.toRgbString=function(e,t=16){const[i,r,n]=e;return`rgb:${s(i,t)}/${s(r,t)}/${s(n,t)}`}},5770:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;const r=i(482),s=i(8742),n=i(5770),o=[];t.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=o,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=o}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const i=this._handlers[e];return i.push(t),{dispose:()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=o,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||o,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(t);else this._handlerFb(this._ident,"HOOK",t)}put(e,t,i){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,i);else this._handlerFb(this._ident,"PUT",(0,r.utf32ToString)(e,t,i))}unhook(e,t=!0){if(this._active.length){let i=!1,r=this._active.length-1,s=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,i=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&!1===i){for(;r>=0&&(i=this._active[r].unhook(e),!0!==i);r--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,i;r--}for(;r>=0;r--)if(i=this._active[r].unhook(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,i}else this._handlerFb(this._ident,"UNHOOK",e);this._active=o,this._ident=0}};const a=new s.Params;a.addParam(0),t.DcsHandler=class{constructor(e){this._handler=e,this._data="",this._params=a,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():a,this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=(0,r.utf32ToString)(e,t,i),this._data.length>n.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then((e=>(this._params=a,this._data="",this._hitLimit=!1,e)));return this._params=a,this._data="",this._hitLimit=!1,t}}},2015:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;const r=i(844),s=i(8742),n=i(6242),o=i(6351);class a{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,i,r){this.table[t<<8|e]=i<<4|r}addMany(e,t,i,r){for(let s=0;s<e.length;s++)this.table[t<<8|e[s]]=i<<4|r}}t.TransitionTable=a;const l=160;t.VT500_TRANSITION_TABLE=function(){const e=new a(4095),t=Array.apply(null,Array(256)).map(((e,t)=>t)),i=(e,i)=>t.slice(e,i),r=i(32,127),s=i(0,24);s.push(25),s.push.apply(s,i(28,32));const n=i(0,14);let o;for(o in e.setDefault(1,0),e.addMany(r,0,2,0),n)e.addMany([24,26,153,154],o,3,0),e.addMany(i(128,144),o,3,0),e.addMany(i(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(s,0,3,0),e.addMany(s,1,3,1),e.add(127,1,0,1),e.addMany(s,8,0,8),e.addMany(s,3,3,3),e.add(127,3,0,3),e.addMany(s,4,3,4),e.add(127,4,0,4),e.addMany(s,6,3,6),e.addMany(s,5,3,5),e.add(127,5,0,5),e.addMany(s,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(r,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(i(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(r,7,0,7),e.addMany(s,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(i(64,127),3,7,0),e.addMany(i(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(i(48,60),4,8,4),e.addMany(i(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(i(32,64),6,0,6),e.add(127,6,0,6),e.addMany(i(64,127),6,0,0),e.addMany(i(32,48),3,9,5),e.addMany(i(32,48),5,9,5),e.addMany(i(48,64),5,0,6),e.addMany(i(64,127),5,7,0),e.addMany(i(32,48),4,9,5),e.addMany(i(32,48),1,9,2),e.addMany(i(32,48),2,9,2),e.addMany(i(48,127),2,10,0),e.addMany(i(48,80),1,10,0),e.addMany(i(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(i(96,127),1,10,0),e.add(80,1,11,9),e.addMany(s,9,0,9),e.add(127,9,0,9),e.addMany(i(28,32),9,0,9),e.addMany(i(32,48),9,9,12),e.addMany(i(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(s,11,0,11),e.addMany(i(32,128),11,0,11),e.addMany(i(28,32),11,0,11),e.addMany(s,10,0,10),e.add(127,10,0,10),e.addMany(i(28,32),10,0,10),e.addMany(i(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(i(32,48),10,9,12),e.addMany(s,12,0,12),e.add(127,12,0,12),e.addMany(i(28,32),12,0,12),e.addMany(i(32,48),12,9,12),e.addMany(i(48,64),12,0,11),e.addMany(i(64,127),12,12,13),e.addMany(i(64,127),10,12,13),e.addMany(i(64,127),9,12,13),e.addMany(s,13,13,13),e.addMany(r,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(l,0,2,0),e.add(l,8,5,8),e.add(l,6,0,6),e.add(l,11,0,11),e.add(l,13,13,13),e}();class c extends r.Disposable{constructor(e=t.VT500_TRANSITION_TABLE){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new s.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(e,t,i)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,t)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,r.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new n.OscParser),this._dcsParser=this.register(new o.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(e,t=[64,126]){let i=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=e.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let t=0;t<e.intermediates.length;++t){const r=e.intermediates.charCodeAt(t);if(32>r||r>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=r}}if(1!==e.final.length)throw new Error("final must be a single byte");const r=e.final.charCodeAt(0);if(t[0]>r||r>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return i<<=8,i|=r,i}identToString(e){const t=[];for(;e;)t.push(String.fromCharCode(255&e)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){const i=this._identifier(e,[48,126]);void 0===this._escHandlers[i]&&(this._escHandlers[i]=[]);const r=this._escHandlers[i];return r.push(t),{dispose:()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){const i=this._identifier(e);void 0===this._csiHandlers[i]&&(this._csiHandlers[i]=[]);const r=this._csiHandlers[i];return r.push(t),{dispose:()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,i,r,s){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=i,this._parseStack.transition=r,this._parseStack.chunkPos=s}parse(e,t,i){let r,s=0,n=0,o=0;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,o=this._parseStack.chunkPos+1;else{if(void 0===i||1===this._parseStack.state)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const t=this._parseStack.handlers;let n=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===i&&n>-1)for(;n>=0&&(r=t[n](this._params),!0!==r);n--)if(r instanceof Promise)return this._parseStack.handlerPos=n,r;this._parseStack.handlers=[];break;case 4:if(!1===i&&n>-1)for(;n>=0&&(r=t[n](),!0!==r);n--)if(r instanceof Promise)return this._parseStack.handlerPos=n,r;this._parseStack.handlers=[];break;case 6:if(s=e[this._parseStack.chunkPos],r=this._dcsParser.unhook(24!==s&&26!==s,i),r)return r;27===s&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(s=e[this._parseStack.chunkPos],r=this._oscParser.end(24!==s&&26!==s,i),r)return r;27===s&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,o=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let i=o;i<t;++i){switch(s=e[i],n=this._transitions.table[this.currentState<<8|(s<160?s:l)],n>>4){case 2:for(let r=i+1;;++r){if(r>=t||(s=e[r])<32||s>126&&s<l){this._printHandler(e,i,r),i=r-1;break}if(++r>=t||(s=e[r])<32||s>126&&s<l){this._printHandler(e,i,r),i=r-1;break}if(++r>=t||(s=e[r])<32||s>126&&s<l){this._printHandler(e,i,r),i=r-1;break}if(++r>=t||(s=e[r])<32||s>126&&s<l){this._printHandler(e,i,r),i=r-1;break}}break;case 3:this._executeHandlers[s]?this._executeHandlers[s]():this._executeHandlerFb(s),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:i,code:s,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const o=this._csiHandlers[this._collect<<8|s];let a=o?o.length-1:-1;for(;a>=0&&(r=o[a](this._params),!0!==r);a--)if(r instanceof Promise)return this._preserveStack(3,o,a,n,i),r;a<0&&this._csiHandlerFb(this._collect<<8|s,this._params),this.precedingJoinState=0;break;case 8:do{switch(s){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(s-48)}}while(++i<t&&(s=e[i])>47&&s<60);i--;break;case 9:this._collect<<=8,this._collect|=s;break;case 10:const c=this._escHandlers[this._collect<<8|s];let h=c?c.length-1:-1;for(;h>=0&&(r=c[h](),!0!==r);h--)if(r instanceof Promise)return this._preserveStack(4,c,h,n,i),r;h<0&&this._escHandlerFb(this._collect<<8|s),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|s,this._params);break;case 13:for(let r=i+1;;++r)if(r>=t||24===(s=e[r])||26===s||27===s||s>127&&s<l){this._dcsParser.put(e,i,r),i=r-1;break}break;case 14:if(r=this._dcsParser.unhook(24!==s&&26!==s),r)return this._preserveStack(6,[],0,n,i),r;27===s&&(n|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let r=i+1;;r++)if(r>=t||(s=e[r])<32||s>127&&s<l){this._oscParser.put(e,i,r),i=r-1;break}break;case 6:if(r=this._oscParser.end(24!==s&&26!==s),r)return this._preserveStack(5,[],0,n,i),r;27===s&&(n|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&n}}}t.EscapeSequenceParser=c},6242:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;const r=i(5770),s=i(482),n=[];t.OscParser=class{constructor(){this._state=0,this._active=n,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const i=this._handlers[e];return i.push(t),{dispose:()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=n}reset(){if(2===this._state)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=n,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||n,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].start();else this._handlerFb(this._id,"START")}_put(e,t,i){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,t,i);else this._handlerFb(this._id,"PUT",(0,s.utf32ToString)(e,t,i))}start(){this.reset(),this._state=1}put(e,t,i){if(3!==this._state){if(1===this._state)for(;t<i;){const i=e[t++];if(59===i){this._state=2,this._start();break}if(i<48||57<i)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+i-48}2===this._state&&i-t>0&&this._put(e,t,i)}}end(e,t=!0){if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){let i=!1,r=this._active.length-1,s=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,i=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&!1===i){for(;r>=0&&(i=this._active[r].end(e),!0!==i);r--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,i;r--}for(;r>=0;r--)if(i=this._active[r].end(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,i}else this._handlerFb(this._id,"END",e);this._active=n,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=(0,s.utf32ToString)(e,t,i),this._data.length>r.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then((e=>(this._data="",this._hitLimit=!1,e)));return this._data="",this._hitLimit=!1,t}}},8742:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;const i=2147483647;class r{static fromArray(e){const t=new r;if(!e.length)return t;for(let i=Array.isArray(e[0])?1:0;i<e.length;++i){const r=e[i];if(Array.isArray(r))for(let e=0;e<r.length;++e)t.addSubParam(r[e]);else t.addParam(r)}return t}constructor(e=32,t=32){if(this.maxLength=e,this.maxSubParamsLength=t,t>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(e),this.length=0,this._subParams=new Int32Array(t),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(e),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const e=new r(this.maxLength,this.maxSubParamsLength);return e.params.set(this.params),e.length=this.length,e._subParams.set(this._subParams),e._subParamsLength=this._subParamsLength,e._subParamsIdx.set(this._subParamsIdx),e._rejectDigits=this._rejectDigits,e._rejectSubDigits=this._rejectSubDigits,e._digitIsSub=this._digitIsSub,e}toArray(){const e=[];for(let t=0;t<this.length;++t){e.push(this.params[t]);const i=this._subParamsIdx[t]>>8,r=255&this._subParamsIdx[t];r-i>0&&e.push(Array.prototype.slice.call(this._subParams,i,r))}return e}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(e){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=e>i?i:e}}addSubParam(e){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=e>i?i:e,this._subParamsIdx[this.length-1]++}}hasSubParams(e){return(255&this._subParamsIdx[e])-(this._subParamsIdx[e]>>8)>0}getSubParams(e){const t=this._subParamsIdx[e]>>8,i=255&this._subParamsIdx[e];return i-t>0?this._subParams.subarray(t,i):null}getSubParamsAll(){const e={};for(let t=0;t<this.length;++t){const i=this._subParamsIdx[t]>>8,r=255&this._subParamsIdx[t];r-i>0&&(e[t]=this._subParams.slice(i,r))}return e}addDigit(e){let t;if(this._rejectDigits||!(t=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const r=this._digitIsSub?this._subParams:this.params,s=r[t-1];r[t-1]=~s?Math.min(10*s+e,i):e}}t.Params=r},5741:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){const i={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(i),t.dispose=()=>this._wrappedAddonDispose(i),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let i=0;i<this._addons.length;i++)if(this._addons[i]===e){t=i;break}if(-1===t)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}}},8771:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;const r=i(3785),s=i(511);t.BufferApiView=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){const t=this._buffer.lines.get(e);if(t)return new r.BufferLineApiView(t)}getNullCell(){return new s.CellData}}},3785:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;const r=i(511);t.BufferLineApiView=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new r.CellData)}translateToString(e,t,i){return this._line.translateToString(e,t,i)}}},8285:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;const r=i(8771),s=i(8460),n=i(844);class o extends n.Disposable{constructor(e){super(),this._core=e,this._onBufferChange=this.register(new s.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new r.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new r.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}t.BufferNamespaceApi=o},7975:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,(e=>t(e.toArray())))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,((e,i)=>t(e,i.toArray())))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}}},7090:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}}},744:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;const n=i(8460),o=i(844),a=i(5295),l=i(2585);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let c=t.BufferService=class extends o.Disposable{get buffer(){return this.buffers.active}constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new n.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new n.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new a.BufferSet(e,this))}resize(e,t){this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){const i=this.buffer;let r;r=this._cachedBlankLine,r&&r.length===this.cols&&r.getFg(0)===e.fg&&r.getBg(0)===e.bg||(r=i.getBlankLine(e,t),this._cachedBlankLine=r),r.isWrapped=t;const s=i.ybase+i.scrollTop,n=i.ybase+i.scrollBottom;if(0===i.scrollTop){const e=i.lines.isFull;n===i.lines.length-1?e?i.lines.recycle().copyFrom(r):i.lines.push(r.clone()):i.lines.splice(n+1,0,r.clone()),e?this.isUserScrolling&&(i.ydisp=Math.max(i.ydisp-1,0)):(i.ybase++,this.isUserScrolling||i.ydisp++)}else{const e=n-s+1;i.lines.shiftElements(s+1,e-1,-1),i.lines.set(n,r.clone())}this.isUserScrolling||(i.ydisp=i.ybase),this._onScroll.fire(i.ydisp)}scrollLines(e,t,i){const r=this.buffer;if(e<0){if(0===r.ydisp)return;this.isUserScrolling=!0}else e+r.ydisp>=r.ybase&&(this.isUserScrolling=!1);const s=r.ydisp;r.ydisp=Math.max(Math.min(r.ydisp+e,r.ybase),0),s!==r.ydisp&&(t||this._onScroll.fire(r.ydisp))}};t.BufferService=c=r([s(0,l.IOptionsService)],c)},7994:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}}},1753:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;const n=i(2585),o=i(8460),a=i(844),l={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>4!==e.button&&1===e.action&&(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>32!==e.action},DRAG:{events:23,restrict:e=>32!==e.action||3!==e.button},ANY:{events:31,restrict:e=>!0}};function c(e,t){let i=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return 4===e.button?(i|=64,i|=e.action):(i|=3&e.button,4&e.button&&(i|=64),8&e.button&&(i|=128),32===e.action?i|=32:0!==e.action||t||(i|=3)),i}const h=String.fromCharCode,u={DEFAULT:e=>{const t=[c(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`[M${h(t[0])}${h(t[1])}${h(t[2])}`},SGR:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${c(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${c(e,!0)};${e.x};${e.y}${t}`}};let d=t.CoreMouseService=class extends a.Disposable{constructor(e,t){super(),this._bufferService=e,this._coreService=t,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new o.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const e of Object.keys(l))this.addProtocol(e,l[e]);for(const e of Object.keys(u))this.addEncoding(e,u[e]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows)return!1;if(4===e.button&&32===e.action)return!1;if(3===e.button&&32!==e.action)return!1;if(4!==e.button&&(2===e.action||3===e.action))return!1;if(e.col++,e.row++,32===e.action&&this._lastEvent&&this._equalEvents(this._lastEvent,e,"SGR_PIXELS"===this._activeEncoding))return!1;if(!this._protocols[this._activeProtocol].restrict(e))return!1;const t=this._encodings[this._activeEncoding](e);return t&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(1&e),up:!!(2&e),drag:!!(4&e),move:!!(8&e),wheel:!!(16&e)}}_equalEvents(e,t,i){if(i){if(e.x!==t.x)return!1;if(e.y!==t.y)return!1}else{if(e.col!==t.col)return!1;if(e.row!==t.row)return!1}return e.button===t.button&&e.action===t.action&&e.ctrl===t.ctrl&&e.alt===t.alt&&e.shift===t.shift}};t.CoreMouseService=d=r([s(0,n.IBufferService),s(1,n.ICoreService)],d)},6975:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;const n=i(1439),o=i(8460),a=i(844),l=i(2585),c=Object.freeze({insertMode:!1}),h=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let u=t.CoreService=class extends a.Disposable{constructor(e,t,i){super(),this._bufferService=e,this._logService=t,this._optionsService=i,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new o.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new o.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new o.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new o.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,n.clone)(c),this.decPrivateModes=(0,n.clone)(h)}reset(){this.modes=(0,n.clone)(c),this.decPrivateModes=(0,n.clone)(h)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;const i=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&i.ybase!==i.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,(()=>e.split("").map((e=>e.charCodeAt(0))))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,(()=>e.split("").map((e=>e.charCodeAt(0))))),this._onBinary.fire(e))}};t.CoreService=u=r([s(0,l.IBufferService),s(1,l.ILogService),s(2,l.IOptionsService)],u)},9074:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;const r=i(8055),s=i(8460),n=i(844),o=i(6106);let a=0,l=0;class c extends n.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new o.SortedList((e=>e?.marker.line)),this._onDecorationRegistered=this.register(new s.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new s.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,n.toDisposable)((()=>this.reset())))}registerDecoration(e){if(e.marker.isDisposed)return;const t=new h(e);if(t){const e=t.marker.onDispose((()=>t.dispose()));t.onDispose((()=>{t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),e.dispose())})),this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(const e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,i){let r=0,s=0;for(const n of this._decorations.getKeyIterator(t))r=n.options.x??0,s=r+(n.options.width??1),e>=r&&e<s&&(!i||(n.options.layer??"bottom")===i)&&(yield n)}forEachDecorationAtCell(e,t,i,r){this._decorations.forEachByKey(t,(t=>{a=t.options.x??0,l=a+(t.options.width??1),e>=a&&e<l&&(!i||(t.options.layer??"bottom")===i)&&r(t)}))}}t.DecorationService=c;class h extends n.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=r.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=r.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(e){super(),this.options=e,this.onRenderEmitter=this.register(new s.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new s.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;const r=i(2585),s=i(8343);class n{constructor(...e){this._entries=new Map;for(const[t,i]of e)this.set(t,i)}set(e,t){const i=this._entries.get(e);return this._entries.set(e,t),i}forEach(e){for(const[t,i]of this._entries.entries())e(t,i)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}}t.ServiceCollection=n,t.InstantiationService=class{constructor(){this._services=new n,this._services.set(r.IInstantiationService,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){const i=(0,s.getServiceDependencies)(e).sort(((e,t)=>e.index-t.index)),r=[];for(const t of i){const i=this._services.get(t.id);if(!i)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${t.id}.`);r.push(i)}const n=i.length>0?i[0].index:t.length;if(t.length!==n)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${n+1} conflicts with ${t.length} static arguments`);return new e(...[...t,...r])}}},7866:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.traceCall=t.setTraceLogger=t.LogService=void 0;const n=i(844),o=i(2585),a={trace:o.LogLevelEnum.TRACE,debug:o.LogLevelEnum.DEBUG,info:o.LogLevelEnum.INFO,warn:o.LogLevelEnum.WARN,error:o.LogLevelEnum.ERROR,off:o.LogLevelEnum.OFF};let l,c=t.LogService=class extends n.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=o.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),l=this}_updateLogLevel(){this._logLevel=a[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)"function"==typeof e[t]&&(e[t]=e[t]())}_log(e,t,i){this._evalLazyOptionalParams(i),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+t,...i)}trace(e,...t){this._logLevel<=o.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,t)}debug(e,...t){this._logLevel<=o.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,t)}info(e,...t){this._logLevel<=o.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,t)}warn(e,...t){this._logLevel<=o.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,t)}error(e,...t){this._logLevel<=o.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,t)}};t.LogService=c=r([s(0,o.IOptionsService)],c),t.setTraceLogger=function(e){l=e},t.traceCall=function(e,t,i){if("function"!=typeof i.value)throw new Error("not supported");const r=i.value;i.value=function(...e){if(l.logLevel!==o.LogLevelEnum.TRACE)return r.apply(this,e);l.trace(`GlyphRenderer#${r.name}(${e.map((e=>JSON.stringify(e))).join(", ")})`);const t=r.apply(this,e);return l.trace(`GlyphRenderer#${r.name} return`,t),t}}},7302:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;const r=i(8460),s=i(844),n=i(6114);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:n.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const o=["normal","bold","100","200","300","400","500","600","700","800","900"];class a extends s.Disposable{constructor(e){super(),this._onOptionChange=this.register(new r.EventEmitter),this.onOptionChange=this._onOptionChange.event;const i={...t.DEFAULT_OPTIONS};for(const t in e)if(t in i)try{const r=e[t];i[t]=this._sanitizeAndValidateOption(t,r)}catch(e){console.error(e)}this.rawOptions=i,this.options={...i},this._setupOptions(),this.register((0,s.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(e,t){return this.onOptionChange((i=>{i===e&&t(this.rawOptions[e])}))}onMultipleOptionChange(e,t){return this.onOptionChange((i=>{-1!==e.indexOf(i)&&t()}))}_setupOptions(){const e=e=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);return this.rawOptions[e]},i=(e,i)=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);i=this._sanitizeAndValidateOption(e,i),this.rawOptions[e]!==i&&(this.rawOptions[e]=i,this._onOptionChange.fire(e))};for(const t in this.rawOptions){const r={get:e.bind(this,t),set:i.bind(this,t)};Object.defineProperty(this.options,t,r)}}_sanitizeAndValidateOption(e,i){switch(e){case"cursorStyle":if(i||(i=t.DEFAULT_OPTIONS[e]),!function(e){return"block"===e||"underline"===e||"bar"===e}(i))throw new Error(`"${i}" is not a valid value for ${e}`);break;case"wordSeparator":i||(i=t.DEFAULT_OPTIONS[e]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof i&&1<=i&&i<=1e3)break;i=o.includes(i)?i:t.DEFAULT_OPTIONS[e];break;case"cursorWidth":i=Math.floor(i);case"lineHeight":case"tabStopWidth":if(i<1)throw new Error(`${e} cannot be less than 1, value: ${i}`);break;case"minimumContrastRatio":i=Math.max(1,Math.min(21,Math.round(10*i)/10));break;case"scrollback":if((i=Math.min(i,4294967295))<0)throw new Error(`${e} cannot be less than 0, value: ${i}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(i<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${i}`);break;case"rows":case"cols":if(!i&&0!==i)throw new Error(`${e} must be numeric, value: ${i}`);break;case"windowsPty":i=i??{}}return i}}t.OptionsService=a},2660:function(e,t,i){var r=this&&this.__decorate||function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},s=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;const n=i(2585);let o=t.OscLinkService=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){const t=this._bufferService.buffer;if(void 0===e.id){const i=t.addMarker(t.ybase+t.y),r={data:e,id:this._nextId++,lines:[i]};return i.onDispose((()=>this._removeMarkerFromLink(r,i))),this._dataByLinkId.set(r.id,r),r.id}const i=e,r=this._getEntryIdKey(i),s=this._entriesWithId.get(r);if(s)return this.addLineToLink(s.id,t.ybase+t.y),s.id;const n=t.addMarker(t.ybase+t.y),o={id:this._nextId++,key:this._getEntryIdKey(i),data:i,lines:[n]};return n.onDispose((()=>this._removeMarkerFromLink(o,n))),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,t){const i=this._dataByLinkId.get(e);if(i&&i.lines.every((e=>e.line!==t))){const e=this._bufferService.buffer.addMarker(t);i.lines.push(e),e.onDispose((()=>this._removeMarkerFromLink(i,e)))}}getLinkData(e){return this._dataByLinkId.get(e)?.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){const i=e.lines.indexOf(t);-1!==i&&(e.lines.splice(i,1),0===e.lines.length&&(void 0!==e.data.id&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};t.OscLinkService=o=r([s(0,n.IBufferService)],o)},8343:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0;const i="di$target",r="di$dependencies";t.serviceRegistry=new Map,t.getServiceDependencies=function(e){return e[r]||[]},t.createDecorator=function(e){if(t.serviceRegistry.has(e))return t.serviceRegistry.get(e);const s=function(e,t,n){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");!function(e,t,s){t[i]===t?t[r].push({id:e,index:s}):(t[r]=[{id:e,index:s}],t[i]=t)}(s,e,n)};return s.toString=()=>e,t.serviceRegistry.set(e,s),s}},2585:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;const r=i(8343);var s;t.IBufferService=(0,r.createDecorator)("BufferService"),t.ICoreMouseService=(0,r.createDecorator)("CoreMouseService"),t.ICoreService=(0,r.createDecorator)("CoreService"),t.ICharsetService=(0,r.createDecorator)("CharsetService"),t.IInstantiationService=(0,r.createDecorator)("InstantiationService"),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.OFF=5]="OFF"}(s||(t.LogLevelEnum=s={})),t.ILogService=(0,r.createDecorator)("LogService"),t.IOptionsService=(0,r.createDecorator)("OptionsService"),t.IOscLinkService=(0,r.createDecorator)("OscLinkService"),t.IUnicodeService=(0,r.createDecorator)("UnicodeService"),t.IDecorationService=(0,r.createDecorator)("DecorationService")},1480:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;const r=i(8460),s=i(225);class n{static extractShouldJoin(e){return!!(1&e)}static extractWidth(e){return e>>1&3}static extractCharKind(e){return e>>3}static createPropertyValue(e,t,i=!1){return(16777215&e)<<3|(3&t)<<1|(i?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new r.EventEmitter,this.onChange=this._onChange.event;const e=new s.UnicodeV6;this.register(e),this._active=e.version,this._activeProvider=e}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(e){if(!this._providers[e])throw new Error(`unknown Unicode version "${e}"`);this._active=e,this._activeProvider=this._providers[e],this._onChange.fire(e)}register(e){this._providers[e.version]=e}wcwidth(e){return this._activeProvider.wcwidth(e)}getStringCellWidth(e){let t=0,i=0;const r=e.length;for(let s=0;s<r;++s){let o=e.charCodeAt(s);if(55296<=o&&o<=56319){if(++s>=r)return t+this.wcwidth(o);const i=e.charCodeAt(s);56320<=i&&i<=57343?o=1024*(o-55296)+i-56320+65536:t+=this.wcwidth(i)}const a=this.charProperties(o,i);let l=n.extractWidth(a);n.extractShouldJoin(a)&&(l-=n.extractWidth(i)),t+=l,i=a}return t}charProperties(e,t){return this._activeProvider.charProperties(e,t)}}t.UnicodeService=n}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,i),n.exports}var r={};return(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.Terminal=void 0;const t=i(9042),s=i(3236),n=i(844),o=i(5741),a=i(8285),l=i(7975),c=i(7090),h=["cols","rows"];class u extends n.Disposable{constructor(e){super(),this._core=this.register(new s.Terminal(e)),this._addonManager=this.register(new o.AddonManager),this._publicOptions={...this._core.options};const t=e=>this._core.options[e],i=(e,t)=>{this._checkReadonlyOptions(e),this._core.options[e]=t};for(const e in this._core.options){const r={get:t.bind(this,e),set:i.bind(this,e)};Object.defineProperty(this._publicOptions,e,r)}}_checkReadonlyOptions(e){if(h.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new l.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new c.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new a.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const e=this._core.coreService.decPrivateModes;let t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any"}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(const t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,t=!0){this._core.input(e,t)}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,i){this._verifyIntegers(e,t,i),this._core.select(e,t,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write("\r\n",t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return t}_verifyIntegers(...e){for(const t of e)if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(const t of e)if(t&&(t===1/0||isNaN(t)||t%1!=0||t<0))throw new Error("This API only accepts positive integers")}}e.Terminal=u})(),r})(),e.exports=t()},7902:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;var r=i(9706),s=function(){function e(){this.transportRequestManager=new r.TransportRequestManager,this.transportRequestManager.transportEventChannel.on("error",(function(){}))}return e.prototype.subscribe=function(e,t){this.transportRequestManager.transportEventChannel.addListener(e,t)},e.prototype.unsubscribe=function(e,t){if(!e)return this.transportRequestManager.transportEventChannel.removeAllListeners();e&&t&&this.transportRequestManager.transportEventChannel.removeListener(e,t)},e.prototype.parseData=function(e){return e instanceof Array?e.map((function(e){return e.request.request})):e.request},e}();t.Transport=s},8014:function(e,t){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},i(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.convertJSONToRPCError=t.JSONRPCError=t.ERR_UNKNOWN=t.ERR_MISSIING_ID=t.ERR_TIMEOUT=void 0,t.ERR_TIMEOUT=7777,t.ERR_MISSIING_ID=7878,t.ERR_UNKNOWN=7979;var s=function(e){function t(t,i,r){var s=this.constructor,n=e.call(this,t)||this;return n.message=t,n.code=i,n.data=r,Object.setPrototypeOf(n,s.prototype),n}return r(t,e),t}(Error);t.JSONRPCError=s,t.convertJSONToRPCError=function(e){if(e.error){var i=e.error,r=i.message,n=i.code,o=i.data;return new s(r,n,o)}return new s("Unknown error",t.ERR_UNKNOWN,e)}},8297:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNotifications=t.getBatchRequests=t.isNotification=void 0,t.isNotification=function(e){return void 0===e.request.id||null===e.request.id},t.getBatchRequests=function(e){return e instanceof Array?e.filter((function(e){return null!=e.request.request.id})).map((function(e){return e.request})):[]},t.getNotifications=function(e){return e instanceof Array?e.filter((function(e){return t.isNotification(e.request)})).map((function(e){return e.request})):t.isNotification(e)?[e]:[]}},8461:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeDefinitionRequest=void 0;const r=i(372);var s;!function(e){e.method="textDocument/typeDefinition",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.TypeDefinitionRequest=s={}))},8585:(e,t)=>{"use strict";function i(e){return"string"==typeof e||e instanceof String}function r(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.stringArray=t.array=t.func=t.error=t.number=t.string=t.boolean=void 0,t.boolean=function(e){return!0===e||!1===e},t.string=i,t.number=function(e){return"number"==typeof e||e instanceof Number},t.error=function(e){return e instanceof Error},t.func=function(e){return"function"==typeof e},t.array=r,t.stringArray=function(e){return r(e)&&e.every((e=>i(e)))}},8598:(e,t)=>{"use strict";function i(e){return"string"==typeof e||e instanceof String}function r(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.objectLiteral=t.typedArray=t.stringArray=t.array=t.func=t.error=t.number=t.string=t.boolean=void 0,t.boolean=function(e){return!0===e||!1===e},t.string=i,t.number=function(e){return"number"==typeof e||e instanceof Number},t.error=function(e){return e instanceof Error},t.func=function(e){return"function"==typeof e},t.array=r,t.stringArray=function(e){return r(e)&&e.every((e=>i(e)))},t.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)},t.objectLiteral=function(e){return null!==e&&"object"==typeof e}},8624:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DOMException:()=>w,Headers:()=>h,Request:()=>v,Response:()=>y,fetch:()=>S});var r="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==i.g&&i.g||{},s={searchParams:"URLSearchParams"in r,iterable:"Symbol"in r&&"iterator"in Symbol,blob:"FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in r,arrayBuffer:"ArrayBuffer"in r};if(s.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function c(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s.iterable&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function u(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function d(e){return new Promise((function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}}))}function f(e){var t=new FileReader,i=d(t);return t.readAsArrayBuffer(e),i}function p(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:s.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:s.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:s.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s.arrayBuffer&&s.blob&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=p(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||o(e))?this._bodyArrayBuffer=p(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s.blob&&(this.blob=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer)return u(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer));if(s.blob)return this.blob().then(f);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,i,r,s,n=u(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,i=d(t=new FileReader),s=(r=/charset=([A-Za-z0-9_-]+)/.exec(e.type))?r[1]:"utf-8",t.readAsText(e,s),i;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),i=new Array(t.length),r=0;r<t.length;r++)i[r]=String.fromCharCode(t[r]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s.formData&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=a(e),t=l(t);var i=this.map[e];this.map[e]=i?i+", "+t:t},h.prototype.delete=function(e){delete this.map[a(e)]},h.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},h.prototype.set=function(e,t){this.map[a(e)]=l(t)},h.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,i){e.push(i)})),c(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),c(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,i){e.push([i,t])})),c(e)},s.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);var m=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function v(e,t){if(!(this instanceof v))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var i,s,n=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(s=(i=t.method||this.method||"GET").toUpperCase(),m.indexOf(s)>-1?s:i),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in r)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var o=/([?&])_=[^&]*/;o.test(this.url)?this.url=this.url.replace(o,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function _(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var i=e.split("="),r=i.shift().replace(/\+/g," "),s=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(s))}})),t}function y(e,t){if(!(this instanceof y))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},g.call(v.prototype),g.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var b=[301,302,303,307,308];y.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})};var w=r.DOMException;try{new w}catch(e){(w=function(e,t){this.message=e,this.name=t;var i=Error(e);this.stack=i.stack}).prototype=Object.create(Error.prototype),w.prototype.constructor=w}function S(e,t){return new Promise((function(i,n){var o=new v(e,t);if(o.signal&&o.signal.aborted)return n(new w("Aborted","AbortError"));var c=new XMLHttpRequest;function u(){c.abort()}if(c.onload=function(){var e,t,r={statusText:c.statusText,headers:(e=c.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var i=e.split(":"),r=i.shift().trim();if(r){var s=i.join(":").trim();try{t.append(r,s)}catch(e){console.warn("Response "+e.message)}}})),t)};0===o.url.indexOf("file://")&&(c.status<200||c.status>599)?r.status=200:r.status=c.status,r.url="responseURL"in c?c.responseURL:r.headers.get("X-Request-URL");var s="response"in c?c.response:c.responseText;setTimeout((function(){i(new y(s,r))}),0)},c.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},c.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request timed out"))}),0)},c.onabort=function(){setTimeout((function(){n(new w("Aborted","AbortError"))}),0)},c.open(o.method,function(e){try{return""===e&&r.location.href?r.location.href:e}catch(t){return e}}(o.url),!0),"include"===o.credentials?c.withCredentials=!0:"omit"===o.credentials&&(c.withCredentials=!1),"responseType"in c&&(s.blob?c.responseType="blob":s.arrayBuffer&&(c.responseType="arraybuffer")),t&&"object"==typeof t.headers&&!(t.headers instanceof h||r.Headers&&t.headers instanceof r.Headers)){var d=[];Object.getOwnPropertyNames(t.headers).forEach((function(e){d.push(a(e)),c.setRequestHeader(e,l(t.headers[e]))})),o.headers.forEach((function(e,t){-1===d.indexOf(t)&&c.setRequestHeader(t,e)}))}else o.headers.forEach((function(e,t){c.setRequestHeader(t,e)}));o.signal&&(o.signal.addEventListener("abort",u),c.onreadystatechange=function(){4===c.readyState&&o.signal.removeEventListener("abort",u)}),c.send(void 0===o._bodyInit?null:o._bodyInit)}))}S.polyfill=!0,r.fetch||(r.fetch=S,r.Headers=h,r.Request=v,r.Response=y)},8765:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallHierarchyOutgoingCallsRequest=t.CallHierarchyIncomingCallsRequest=t.CallHierarchyPrepareRequest=void 0;const r=i(372);var s,n,o;!function(e){e.method="textDocument/prepareCallHierarchy",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.CallHierarchyPrepareRequest=s={})),function(e){e.method="callHierarchy/incomingCalls",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(n||(t.CallHierarchyIncomingCallsRequest=n={})),function(e){e.method="callHierarchy/outgoingCalls",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(o||(t.CallHierarchyOutgoingCallsRequest=o={}))},8766:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,s)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.LSPErrorCodes=t.createProtocolConnection=void 0,s(i(6439),t),s(i(6203),t),s(i(372),t),s(i(1560),t);var n,o=i(1580);Object.defineProperty(t,"createProtocolConnection",{enumerable:!0,get:function(){return o.createProtocolConnection}}),function(e){e.lspReservedErrorRangeStart=-32899,e.RequestFailed=-32803,e.ServerCancelled=-32802,e.ContentModified=-32801,e.RequestCancelled=-32800,e.lspReservedErrorRangeEnd=-32800}(n||(t.LSPErrorCodes=n={}))},9047:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MonikerRequest=t.MonikerKind=t.UniquenessLevel=void 0;const r=i(372);var s,n,o;!function(e){e.document="document",e.project="project",e.group="group",e.scheme="scheme",e.global="global"}(s||(t.UniquenessLevel=s={})),function(e){e.$import="import",e.$export="export",e.local="local"}(n||(t.MonikerKind=n={})),function(e){e.method="textDocument/moniker",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(o||(t.MonikerRequest=o={}))},9085:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadableStreamMessageReader=t.AbstractMessageReader=t.MessageReader=void 0;const r=i(9590),s=i(8585),n=i(2676),o=i(4323);var a,l;!function(e){e.is=function(e){let t=e;return t&&s.func(t.listen)&&s.func(t.dispose)&&s.func(t.onError)&&s.func(t.onClose)&&s.func(t.onPartialMessage)}}(a||(t.MessageReader=a={}));class c{constructor(){this.errorEmitter=new n.Emitter,this.closeEmitter=new n.Emitter,this.partialMessageEmitter=new n.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${s.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageReader=c,function(e){e.fromOptions=function(e){let t,i;const s=new Map;let n;const o=new Map;if(void 0===e||"string"==typeof e)t=e??"utf-8";else{if(t=e.charset??"utf-8",void 0!==e.contentDecoder&&(i=e.contentDecoder,s.set(i.name,i)),void 0!==e.contentDecoders)for(const t of e.contentDecoders)s.set(t.name,t);if(void 0!==e.contentTypeDecoder&&(n=e.contentTypeDecoder,o.set(n.name,n)),void 0!==e.contentTypeDecoders)for(const t of e.contentTypeDecoders)o.set(t.name,t)}return void 0===n&&(n=(0,r.default)().applicationJson.decoder,o.set(n.name,n)),{charset:t,contentDecoder:i,contentDecoders:s,contentTypeDecoder:n,contentTypeDecoders:o}}}(l||(l={})),t.ReadableStreamMessageReader=class extends c{constructor(e,t){super(),this.readable=e,this.options=l.fromOptions(t),this.buffer=(0,r.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new o.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;const t=this.readable.onData((e=>{this.onData(e)}));return this.readable.onError((e=>this.fireError(e))),this.readable.onClose((()=>this.fireClose())),t}onData(e){try{for(this.buffer.append(e);;){if(-1===this.nextMessageLength){const e=this.buffer.tryReadHeaders(!0);if(!e)return;const t=e.get("content-length");if(!t)return void this.fireError(new Error(`Header must provide a Content-Length property.\n${JSON.stringify(Object.fromEntries(e))}`));const i=parseInt(t);if(isNaN(i))return void this.fireError(new Error(`Content-Length value must be a number. Got ${t}`));this.nextMessageLength=i}const e=this.buffer.tryReadBody(this.nextMessageLength);if(void 0===e)return void this.setPartialMessageTimer();this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock((async()=>{const t=void 0!==this.options.contentDecoder?await this.options.contentDecoder.decode(e):e,i=await this.options.contentTypeDecoder.decode(t,this.options);this.callback(i)})).catch((e=>{this.fireError(e)}))}}catch(e){this.fireError(e)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),this._partialMessageTimeout<=0||(this.partialMessageTimer=(0,r.default)().timer.setTimeout(((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())}),this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}},9222:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var i,r,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultNextRequest=void 0;var n=i(7007);t.defaultNextRequest=function(){var e=-1;return function(){return++e}};var o=function(){function e(e,i){void 0===i&&(i=t.defaultNextRequest()),this.batch=[],this.batchStarted=!1,this.lastId=-1,this.transports=e,this.requests={},this.connectPromise=this.connect(),this.requestChannel=new n.EventEmitter,this.nextID=i}return e.prototype.connect=function(){var e=this;return Promise.all(this.transports.map((function(t){return r(e,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return t.subscribe("error",this.handleError.bind(this)),t.subscribe("notification",this.handleNotification.bind(this)),[4,t.connect()];case 1:return e.sent(),[2]}}))}))})))},e.prototype.getPrimaryTransport=function(){return this.transports[0]},e.prototype.request=function(e,t,i){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var r,n,o,a=this;return s(this,(function(s){return r=this.nextID().toString(),n=t?null:r,o={request:this.makeRequest(e.method,e.params||[],n),internalID:r},this.batchStarted?[2,new Promise((function(e,t){a.batch.push({resolve:e,reject:t,request:o})}))]:[2,this.getPrimaryTransport().sendData(o,i)]}))}))},e.prototype.close=function(){this.requestChannel.removeAllListeners(),this.transports.forEach((function(e){e.unsubscribe(),e.close()}))},e.prototype.startBatch=function(){this.batchStarted=!0},e.prototype.stopBatch=function(){if(!1===this.batchStarted)throw new Error("cannot end that which has never started");0!==this.batch.length?(this.getPrimaryTransport().sendData(this.batch),this.batch=[],this.batchStarted=!1):this.batchStarted=!1},e.prototype.makeRequest=function(e,t,i){return i?{jsonrpc:"2.0",id:i,method:e,params:t}:{jsonrpc:"2.0",method:e,params:t}},e.prototype.handleError=function(e){this.requestChannel.emit("error",e)},e.prototype.handleNotification=function(e){this.requestChannel.emit("notification",e)},e}();t.default=o},9244:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractMessageBuffer=void 0,t.AbstractMessageBuffer=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){const t="string"==typeof e?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(0===this._chunks.length)return;let t=0,i=0,r=0,s=0;e:for(;i<this._chunks.length;){const e=this._chunks[i];for(r=0;r<e.length;){switch(e[r]){case 13:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case 10:switch(t){case 1:t=2;break;case 3:t=4,r++;break e;default:t=0}break;default:t=0}r++}s+=e.byteLength,i++}if(4!==t)return;const n=this._read(s+r),o=new Map,a=this.toString(n,"ascii").split("\r\n");if(a.length<2)return o;for(let t=0;t<a.length-2;t++){const i=a[t],r=i.indexOf(":");if(-1===r)throw new Error(`Message header must separate key and value using ':'\n${i}`);const s=i.substr(0,r),n=i.substr(r+1).trim();o.set(e?s.toLowerCase():s,n)}return o}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(0===e)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){const t=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(t)}if(this._chunks[0].byteLength>e){const t=this._chunks[0],i=this.asNative(t,e);return this._chunks[0]=t.slice(e),this._totalLength-=e,i}const t=this.allocNative(e);let i=0;for(;e>0;){const r=this._chunks[0];if(r.byteLength>e){const s=r.slice(0,e);t.set(s,i),i+=e,this._chunks[0]=r.slice(e),this._totalLength-=e,e-=e}else t.set(r,i),i+=r.byteLength,this._chunks.shift(),this._totalLength-=r.byteLength,e-=r.byteLength}return t}}},9574:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImplementationRequest=void 0;const r=i(372);var s;!function(e){e.method="textDocument/implementation",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(s||(t.ImplementationRequest=s={}))},9590:(e,t)=>{"use strict";let i;function r(){if(void 0===i)throw new Error("No runtime abstraction layer installed");return i}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.install=function(e){if(void 0===e)throw new Error("No runtime abstraction layer provided");i=e}}(r||(r={})),t.default=r},9706:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransportRequestManager=void 0;var r=i(7007),s=i(8014),n=function(){function e(){this.pendingRequest={},this.pendingBatchRequest={},this.transportEventChannel=new r.EventEmitter}return e.prototype.addRequest=function(e,t){return this.transportEventChannel.emit("pending",e),e instanceof Array?(this.addBatchReq(e,t),Promise.resolve()):this.addReq(e.internalID,t)},e.prototype.settlePendingRequest=function(e,t){var i=this;e.forEach((function(e){var r=i.pendingRequest[e.internalID];delete i.pendingBatchRequest[e.internalID],void 0!==r&&(t?r.reject(t):(r.resolve(),null!==e.request.id&&void 0!==e.request.id||delete i.pendingRequest[e.internalID]))}))},e.prototype.isPendingRequest=function(e){return this.pendingRequest.hasOwnProperty(e)},e.prototype.resolveResponse=function(e,t){void 0===t&&(t=!0);var i=e;try{if(i=JSON.parse(e),!1===this.checkJSONRPC(i))return;return i instanceof Array?this.resolveBatch(i,t):this.resolveRes(i,t)}catch(i){var r=new s.JSONRPCError("Bad response format",s.ERR_UNKNOWN,e);return t&&this.transportEventChannel.emit("error",r),r}},e.prototype.addBatchReq=function(e,t){var i=this;return e.forEach((function(e){var t=e.resolve,r=e.reject,s=e.request.internalID;i.pendingBatchRequest[s]=!0,i.pendingRequest[s]={resolve:t,reject:r}})),Promise.resolve()},e.prototype.addReq=function(e,t){var i=this;return new Promise((function(r,s){null!==t&&t&&i.setRequestTimeout(e,t,s),i.pendingRequest[e]={resolve:r,reject:s}}))},e.prototype.checkJSONRPC=function(e){var t=[e];return e instanceof Array&&(t=e),t.every((function(e){return void 0!==e.result||void 0!==e.error||void 0!==e.method}))},e.prototype.processResult=function(e,t){if(e.error){var i=s.convertJSONToRPCError(e);t.reject(i)}else t.resolve(e.result)},e.prototype.resolveBatch=function(e,t){var i=this,r=e.map((function(e){return i.resolveRes(e,t)})).filter((function(e){return e}));if(r.length>0)return r[0]},e.prototype.resolveRes=function(e,t){var i,r=e.id,n=e.error,o=this.pendingRequest[r];return o?(delete this.pendingRequest[r],this.processResult(e,o),void this.transportEventChannel.emit("response",e)):void 0!==r||void 0!==n?(n&&(i=s.convertJSONToRPCError(e)),t&&n&&i&&this.transportEventChannel.emit("error",i),i):void this.transportEventChannel.emit("notification",e)},e.prototype.setRequestTimeout=function(e,t,i){var r=this;setTimeout((function(){delete r.pendingRequest[e],i(new s.JSONRPCError("Request timeout request took longer than "+t+" ms to resolve",s.ERR_TIMEOUT))}),t)},e}();t.TransportRequestManager=n},9840:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WillDeleteFilesRequest=t.DidDeleteFilesNotification=t.DidRenameFilesNotification=t.WillRenameFilesRequest=t.DidCreateFilesNotification=t.WillCreateFilesRequest=t.FileOperationPatternKind=void 0;const r=i(372);var s,n,o,a,l,c,h;!function(e){e.file="file",e.folder="folder"}(s||(t.FileOperationPatternKind=s={})),function(e){e.method="workspace/willCreateFiles",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(n||(t.WillCreateFilesRequest=n={})),function(e){e.method="workspace/didCreateFiles",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(o||(t.DidCreateFilesNotification=o={})),function(e){e.method="workspace/willRenameFiles",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(a||(t.WillRenameFilesRequest=a={})),function(e){e.method="workspace/didRenameFiles",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(l||(t.DidRenameFilesNotification=l={})),function(e){e.method="workspace/didDeleteFiles",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(c||(t.DidDeleteFilesNotification=c={})),function(e){e.method="workspace/willDeleteFiles",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolRequestType(e.method)}(h||(t.WillDeleteFilesRequest=h={}))},9850:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationTokenSource=t.CancellationToken=void 0;const r=i(9590),s=i(8585),n=i(2676);var o;!function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:n.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:n.Event.None}),e.is=function(t){const i=t;return i&&(i===e.None||i===e.Cancelled||s.boolean(i.isCancellationRequested)&&!!i.onCancellationRequested)}}(o||(t.CancellationToken=o={}));const a=Object.freeze((function(e,t){const i=(0,r.default)().timer.setTimeout(e.bind(t),0);return{dispose(){i.dispose()}}}));class l{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?a:(this._emitter||(this._emitter=new n.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}t.CancellationTokenSource=class{get token(){return this._token||(this._token=new l),this._token}cancel(){this._token?this._token.cancel():this._token=o.Cancelled}dispose(){this._token?this._token instanceof l&&this._token.dispose():this._token=o.None}}},9935:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DidChangeWorkspaceFoldersNotification=t.WorkspaceFoldersRequest=void 0;const r=i(372);var s,n;!function(e){e.method="workspace/workspaceFolders",e.messageDirection=r.MessageDirection.serverToClient,e.type=new r.ProtocolRequestType0(e.method)}(s||(t.WorkspaceFoldersRequest=s={})),function(e){e.method="workspace/didChangeWorkspaceFolders",e.messageDirection=r.MessageDirection.clientToServer,e.type=new r.ProtocolNotificationType(e.method)}(n||(t.DidChangeWorkspaceFoldersNotification=n={}))}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,i),n.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";i.r(r),i.d(r,{EditorState:()=>Ee,EditorView:()=>rn,FitAddon:()=>t.FitAddon,Terminal:()=>e.Terminal,WebLinksAddon:()=>s.WebLinksAddon,WebSocketTransport:()=>Gf.WebSocketTransport,basicSetup:()=>Kf,languageServer:()=>Rg});var e=i(7856),t=i(3616),s=i(1832);let n=[],o=[];function a(e){if(e<768)return!1;for(let t=0,i=n.length;;){let r=t+i>>1;if(e<n[r])i=r;else{if(!(e>=o[r]))return!0;t=r+1}if(t==i)return!1}}function l(e){return e>=127462&&e<=127487}function c(e,t,i=!0,r=!0){return(i?h:u)(e,t,r)}function h(e,t,i){if(t==e.length)return t;t&&f(e.charCodeAt(t))&&p(e.charCodeAt(t-1))&&t--;let r=d(e,t);for(t+=g(r);t<e.length;){let s=d(e,t);if(8205==r||8205==s||i&&a(s))t+=g(s),r=s;else{if(!l(s))break;{let i=0,r=t-2;for(;r>=0&&l(d(e,r));)i++,r-=2;if(i%2==0)break;t+=2}}}return t}function u(e,t,i){for(;t>0;){let r=h(e,t-2,i);if(r<t)return r;t--}return 0}function d(e,t){let i=e.charCodeAt(t);if(!p(i)||t+1==e.length)return i;let r=e.charCodeAt(t+1);return f(r)?r-56320+(i-55296<<10)+65536:i}function f(e){return e>=56320&&e<57344}function p(e){return e>=55296&&e<56320}function g(e){return e<65536?1:2}(()=>{let e="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((e=>e?parseInt(e,36):1));for(let t=0,i=0;t<e.length;t++)(t%2?o:n).push(i+=e[t])})();class m{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){[e,t]=x(this,e,t);let r=[];return this.decompose(0,e,r,2),i.length&&i.decompose(0,i.length,r,3),this.decompose(t,this.length,r,1),_.from(r,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=x(this,e,t);let i=[];return this.decompose(e,t,i,0),_.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),r=new w(this),s=new w(e);for(let e=t,n=t;;){if(r.next(e),s.next(e),e=0,r.lineBreak!=s.lineBreak||r.done!=s.done||r.value!=s.value)return!1;if(n+=r.value.length,r.done||n>=i)return!0}}iter(e=1){return new w(this,e)}iterRange(e,t=this.length){return new S(this,e,t)}iterLines(e,t){let i;if(null==e)i=this.iter();else{null==t&&(t=this.lines+1);let r=this.line(e).from;i=this.iterRange(r,Math.max(r,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new C(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(0==e.length)throw new RangeError("A document must have at least one line");return 1!=e.length||e[0]?e.length<=32?new v(e):_.from(v.split(e,[])):m.empty}}class v extends m{constructor(e,t=function(e){let t=-1;for(let i of e)t+=i.length+1;return t}(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,r){for(let s=0;;s++){let n=this.text[s],o=r+n.length;if((t?i:o)>=e)return new k(r,o,i,n);r=o+1,i++}}decompose(e,t,i,r){let s=e<=0&&t>=this.length?this:new v(b(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(1&r){let e=i.pop(),t=y(s.text,e.text.slice(),0,s.length);if(t.length<=32)i.push(new v(t,e.length+s.length));else{let e=t.length>>1;i.push(new v(t.slice(0,e)),new v(t.slice(e)))}}else i.push(s)}replace(e,t,i){if(!(i instanceof v))return super.replace(e,t,i);[e,t]=x(this,e,t);let r=y(this.text,y(i.text,b(this.text,0,e)),t),s=this.length+i.length-(t-e);return r.length<=32?new v(r,s):_.from(v.split(r,[]),s)}sliceString(e,t=this.length,i="\n"){[e,t]=x(this,e,t);let r="";for(let s=0,n=0;s<=t&&n<this.text.length;n++){let o=this.text[n],a=s+o.length;s>e&&n&&(r+=i),e<a&&t>s&&(r+=o.slice(Math.max(0,e-s),t-s)),s=a+1}return r}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],r=-1;for(let s of e)i.push(s),r+=s.length+1,32==i.length&&(t.push(new v(i,r)),i=[],r=-1);return r>-1&&t.push(new v(i,r)),t}}class _ extends m{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let t of e)this.lines+=t.lines}lineInner(e,t,i,r){for(let s=0;;s++){let n=this.children[s],o=r+n.length,a=i+n.lines-1;if((t?a:o)>=e)return n.lineInner(e,t,i,r);r=o+1,i=a+1}}decompose(e,t,i,r){for(let s=0,n=0;n<=t&&s<this.children.length;s++){let o=this.children[s],a=n+o.length;if(e<=a&&t>=n){let s=r&((n<=e?1:0)|(a>=t?2:0));n>=e&&a<=t&&!s?i.push(o):o.decompose(e-n,t-n,i,s)}n=a+1}}replace(e,t,i){if([e,t]=x(this,e,t),i.lines<this.lines)for(let r=0,s=0;r<this.children.length;r++){let n=this.children[r],o=s+n.length;if(e>=s&&t<=o){let a=n.replace(e-s,t-s,i),l=this.lines-n.lines+a.lines;if(a.lines<l>>4&&a.lines>l>>6){let s=this.children.slice();return s[r]=a,new _(s,this.length-(t-e)+i.length)}return super.replace(s,o,a)}s=o+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i="\n"){[e,t]=x(this,e,t);let r="";for(let s=0,n=0;s<this.children.length&&n<=t;s++){let o=this.children[s],a=n+o.length;n>e&&s&&(r+=i),e<a&&t>n&&(r+=o.sliceString(e-n,t-n,i)),n=a+1}return r}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof _))return 0;let i=0,[r,s,n,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;r+=t,s+=t){if(r==n||s==o)return i;let a=this.children[r],l=e.children[s];if(a!=l)return i+a.scanIdentical(l,t);i+=a.length+1}}static from(e,t=e.reduce(((e,t)=>e+t.length+1),-1)){let i=0;for(let t of e)i+=t.lines;if(i<32){let i=[];for(let t of e)t.flatten(i);return new v(i,t)}let r=Math.max(32,i>>5),s=r<<1,n=r>>1,o=[],a=0,l=-1,c=[];function h(e){let t;if(e.lines>s&&e instanceof _)for(let t of e.children)h(t);else e.lines>n&&(a>n||!a)?(u(),o.push(e)):e instanceof v&&a&&(t=c[c.length-1])instanceof v&&e.lines+t.lines<=32?(a+=e.lines,l+=e.length+1,c[c.length-1]=new v(t.text.concat(e.text),t.length+1+e.length)):(a+e.lines>r&&u(),a+=e.lines,l+=e.length+1,c.push(e))}function u(){0!=a&&(o.push(1==c.length?c[0]:_.from(c,l)),l=-1,a=c.length=0)}for(let t of e)h(t);return u(),1==o.length?o[0]:new _(o,t)}}function y(e,t,i=0,r=1e9){for(let s=0,n=0,o=!0;n<e.length&&s<=r;n++){let a=e[n],l=s+a.length;l>=i&&(l>r&&(a=a.slice(0,r-s)),s<i&&(a=a.slice(i-s)),o?(t[t.length-1]+=a,o=!1):t.push(a)),s=l+1}return t}function b(e,t,i){return y(e,[""],t,i)}m.empty=new v([""],0);class w{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof v?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,r=this.nodes[i],s=this.offsets[i],n=s>>1,o=r instanceof v?r.text.length:r.children.length;if(n==(t>0?o:0)){if(0==i)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&s)==(t>0?0:1)){if(this.offsets[i]+=t,0==e)return this.lineBreak=!0,this.value="\n",this;e--}else if(r instanceof v){let s=r.text[n+(t<0?-1:0)];if(this.offsets[i]+=t,s.length>Math.max(0,e))return this.value=0==e?s:t>0?s.slice(e):s.slice(0,s.length-e),this;e-=s.length}else{let s=r.children[n+(t<0?-1:0)];e>s.length?(e-=s.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(s),this.offsets.push(t>0?1:(s instanceof v?s.text.length:s.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class S{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new w(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:r}=this.cursor.next(e);return this.pos+=(r.length+e)*t,this.value=r.length<=i?r:t<0?r.slice(r.length-i):r.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class C{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:r}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=r,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(m.prototype[Symbol.iterator]=function(){return this.iter()},w.prototype[Symbol.iterator]=S.prototype[Symbol.iterator]=C.prototype[Symbol.iterator]=function(){return this});class k{constructor(e,t,i,r){this.from=e,this.to=t,this.number=i,this.text=r}get length(){return this.to-this.from}}function x(e,t,i){return[t=Math.max(0,Math.min(e.length,t)),Math.max(t,Math.min(e.length,i))]}function R(e,t,i=!0,r=!0){return c(e,t,i,r)}function E(e,t){let i=e.charCodeAt(t);if(!((r=i)>=55296&&r<56320&&t+1!=e.length))return i;var r;let s=e.charCodeAt(t+1);return function(e){return e>=56320&&e<57344}(s)?s-56320+(i-55296<<10)+65536:i}function D(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function T(e){return e<65536?1:2}const M=/\r\n?|\n/;var A=function(e){return e[e.Simple=0]="Simple",e[e.TrackDel=1]="TrackDel",e[e.TrackBefore=2]="TrackBefore",e[e.TrackAfter=3]="TrackAfter",e}(A||(A={}));class O{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,r=0;t<this.sections.length;){let s=this.sections[t++],n=this.sections[t++];n<0?(e(i,r,s),r+=s):r+=n,i+=s}}iterChangedRanges(e,t=!1){I(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];r<0?e.push(i,r):e.push(r,i)}return new O(e)}composeDesc(e){return this.empty?e:e.empty?this:q(this,e)}mapDesc(e,t=!1){return e.empty?this:N(this,e,t)}mapPos(e,t=-1,i=A.Simple){let r=0,s=0;for(let n=0;n<this.sections.length;){let o=this.sections[n++],a=this.sections[n++],l=r+o;if(a<0){if(l>e)return s+(e-r);s+=o}else{if(i!=A.Simple&&l>=e&&(i==A.TrackDel&&r<e&&l>e||i==A.TrackBefore&&r<e||i==A.TrackAfter&&l>e))return null;if(l>e||l==e&&t<0&&!o)return e==r||t<0?s:s+a;s+=a}r=l}if(e>r)throw new RangeError(`Position ${e} is out of range for changeset of length ${r}`);return s}touchesRange(e,t=e){for(let i=0,r=0;i<this.sections.length&&r<=t;){let s=r+this.sections[i++];if(this.sections[i++]>=0&&r<=t&&s>=e)return!(r<e&&s>t)||"cover";r=s}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];e+=(e?" ":"")+i+(r>=0?":"+r:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some((e=>"number"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new O(e)}static create(e){return new O(e)}}class L extends O{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return I(this,((t,i,r,s,n)=>e=e.replace(r,r+(i-t),n)),!1),e}mapDesc(e,t=!1){return N(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let r=0,s=0;r<t.length;r+=2){let n=t[r],o=t[r+1];if(o>=0){t[r]=o,t[r+1]=n;let a=r>>1;for(;i.length<a;)i.push(m.empty);i.push(n?e.slice(s,s+n):m.empty)}s+=n}return new L(t,i)}compose(e){return this.empty?e:e.empty?this:q(this,e,!0)}map(e,t=!1){return e.empty?this:N(this,e,t,!0)}iterChanges(e,t=!1){I(this,e,t)}get desc(){return O.create(this.sections)}filter(e){let t=[],i=[],r=[],s=new H(this);e:for(let n=0,o=0;;){let a=n==e.length?1e9:e[n++];for(;o<a||o==a&&0==s.len;){if(s.done)break e;let e=Math.min(s.len,a-o);P(r,e,-1);let n=-1==s.ins?-1:0==s.off?s.ins:0;P(t,e,n),n>0&&B(i,t,s.text),s.forward(e),o+=e}let l=e[n++];for(;o<l;){if(s.done)break e;let e=Math.min(s.len,l-o);P(t,e,-1),P(r,e,-1==s.ins?-1:0==s.off?s.ins:0),s.forward(e),o+=e}}return{changes:new L(t,i),filtered:O.create(r)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],r=this.sections[t+1];r<0?e.push(i):0==r?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let r=[],s=[],n=0,o=null;function a(e=!1){if(!e&&!r.length)return;n<t&&P(r,t-n,-1);let i=new L(r,s);o=o?o.compose(i.map(o)):i,r=[],s=[],n=0}return function e(l){if(Array.isArray(l))for(let t of l)e(t);else if(l instanceof L){if(l.length!=t)throw new RangeError(`Mismatched change set length (got ${l.length}, expected ${t})`);a(),o=o?o.compose(l.map(o)):l}else{let{from:e,to:o=e,insert:c}=l;if(e>o||e<0||o>t)throw new RangeError(`Invalid change range ${e} to ${o} (in doc of length ${t})`);let h=c?"string"==typeof c?m.of(c.split(i||M)):c:m.empty,u=h.length;if(e==o&&0==u)return;e<n&&a(),e>n&&P(r,e-n,-1),P(r,o-e,u),B(s,r,h),n=o}}(e),a(!o),o}static empty(e){return new L(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let r=0;r<e.length;r++){let s=e[r];if("number"==typeof s)t.push(s,-1);else{if(!Array.isArray(s)||"number"!=typeof s[0]||s.some(((e,t)=>t&&"string"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==s.length)t.push(s[0],0);else{for(;i.length<r;)i.push(m.empty);i[r]=m.of(s.slice(1)),t.push(s[0],i[r].length)}}}return new L(t,i)}static createSet(e,t){return new L(e,t)}}function P(e,t,i,r=!1){if(0==t&&i<=0)return;let s=e.length-2;s>=0&&i<=0&&i==e[s+1]?e[s]+=t:s>=0&&0==t&&0==e[s]?e[s+1]+=i:r?(e[s]+=t,e[s+1]+=i):e.push(t,i)}function B(e,t,i){if(0==i.length)return;let r=t.length-2>>1;if(r<e.length)e[e.length-1]=e[e.length-1].append(i);else{for(;e.length<r;)e.push(m.empty);e.push(i)}}function I(e,t,i){let r=e.inserted;for(let s=0,n=0,o=0;o<e.sections.length;){let a=e.sections[o++],l=e.sections[o++];if(l<0)s+=a,n+=a;else{let c=s,h=n,u=m.empty;for(;c+=a,h+=l,l&&r&&(u=u.append(r[o-2>>1])),!(i||o==e.sections.length||e.sections[o+1]<0);)a=e.sections[o++],l=e.sections[o++];t(s,c,n,h,u),s=c,n=h}}}function N(e,t,i,r=!1){let s=[],n=r?[]:null,o=new H(e),a=new H(t);for(let e=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(-1==o.ins&&-1==a.ins){let e=Math.min(o.len,a.len);P(s,e,-1),o.forward(e),a.forward(e)}else if(a.ins>=0&&(o.ins<0||e==o.i||0==o.off&&(a.len<o.len||a.len==o.len&&!i))){let t=a.len;for(P(s,a.ins,-1);t;){let i=Math.min(o.len,t);o.ins>=0&&e<o.i&&o.len<=i&&(P(s,0,o.ins),n&&B(n,s,o.text),e=o.i),o.forward(i),t-=i}a.next()}else{if(!(o.ins>=0)){if(o.done&&a.done)return n?L.createSet(s,n):O.create(s);throw new Error("Mismatched change set lengths")}{let t=0,i=o.len;for(;i;)if(-1==a.ins){let e=Math.min(i,a.len);t+=e,i-=e,a.forward(e)}else{if(!(0==a.ins&&a.len<i))break;i-=a.len,a.next()}P(s,t,e<o.i?o.ins:0),n&&e<o.i&&B(n,s,o.text),e=o.i,o.forward(o.len-i)}}}}function q(e,t,i=!1){let r=[],s=i?[]:null,n=new H(e),o=new H(t);for(let e=!1;;){if(n.done&&o.done)return s?L.createSet(r,s):O.create(r);if(0==n.ins)P(r,n.len,0,e),n.next();else if(0!=o.len||o.done){if(n.done||o.done)throw new Error("Mismatched change set lengths");{let t=Math.min(n.len2,o.len),i=r.length;if(-1==n.ins){let i=-1==o.ins?-1:o.off?0:o.ins;P(r,t,i,e),s&&i&&B(s,r,o.text)}else-1==o.ins?(P(r,n.off?0:n.len,t,e),s&&B(s,r,n.textBit(t))):(P(r,n.off?0:n.len,o.off?0:o.ins,e),s&&!o.off&&B(s,r,o.text));e=(n.ins>t||o.ins>=0&&o.len>t)&&(e||r.length>i),n.forward2(t),o.forward(t)}}else P(r,0,o.ins,e),s&&B(s,r,o.text),o.next()}}class H{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?m.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?m.empty:t[i].slice(this.off,null==e?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){-1==this.ins?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class F{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return 32&this.flags?this.to:this.from}get head(){return 32&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 8&this.flags?-1:16&this.flags?1:0}get bidiLevel(){let e=7&this.flags;return 7==e?null:e}get goalColumn(){let e=this.flags>>6;return 16777215==e?void 0:e}map(e,t=-1){let i,r;return this.empty?i=r=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),r=e.mapPos(this.to,-1)),i==this.from&&r==this.to?this:new F(i,r,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return W.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return W.range(this.anchor,i)}eq(e,t=!1){return!(this.anchor!=e.anchor||this.head!=e.head||t&&this.empty&&this.assoc!=e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||"number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid JSON representation for SelectionRange");return W.range(e.anchor,e.head)}static create(e,t,i){return new F(e,t,i)}}class W{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:W.create(this.ranges.map((i=>i.map(e,t))),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new W([this.main],0)}addRange(e,t=!0){return W.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,W.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((e=>e.toJSON())),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||"number"!=typeof e.main||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new W(e.ranges.map((e=>F.fromJSON(e))),e.main)}static single(e,t=e){return new W([W.range(e,t)],0)}static create(e,t=0){if(0==e.length)throw new RangeError("A selection needs at least one range");for(let i=0,r=0;r<e.length;r++){let s=e[r];if(s.empty?s.from<=i:s.from<i)return W.normalized(e.slice(),t);i=s.to}return new W(e,t)}static cursor(e,t=0,i,r){return F.create(e,e,(0==t?0:t<0?8:16)|(null==i?7:Math.min(6,i))|(null!=r?r:16777215)<<6)}static range(e,t,i,r){let s=(null!=i?i:16777215)<<6|(null==r?7:Math.min(6,r));return t<e?F.create(t,e,48|s):F.create(e,t,(t>e?8:0)|s)}static normalized(e,t=0){let i=e[t];e.sort(((e,t)=>e.from-t.from)),t=e.indexOf(i);for(let i=1;i<e.length;i++){let r=e[i],s=e[i-1];if(r.empty?r.from<=s.to:r.from<s.to){let n=s.from,o=Math.max(r.to,s.to);i<=t&&t--,e.splice(--i,2,r.anchor>r.head?W.range(o,n):W.range(n,o))}}return new W(e,t)}}function j(e,t){for(let i of e.ranges)if(i.to>t)throw new RangeError("Selection points outside of document")}let $=0;class z{constructor(e,t,i,r,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=r,this.id=$++,this.default=e([]),this.extensions="function"==typeof s?s(this):s}get reader(){return this}static define(e={}){return new z(e.combine||(e=>e),e.compareInput||((e,t)=>e===t),e.compare||(e.combine?(e,t)=>e===t:U),!!e.static,e.enables)}of(e){return new V([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new V(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new V(e,this,2,t)}from(e,t){return t||(t=e=>e),this.compute([e],(i=>t(i.field(e))))}}function U(e,t){return e==t||e.length==t.length&&e.every(((e,i)=>e===t[i]))}class V{constructor(e,t,i,r){this.dependencies=e,this.facet=t,this.type=i,this.value=r,this.id=$++}dynamicSlot(e){var t;let i=this.value,r=this.facet.compareInput,s=this.id,n=e[s]>>1,o=2==this.type,a=!1,l=!1,c=[];for(let i of this.dependencies)"doc"==i?a=!0:"selection"==i?l=!0:1&(null!==(t=e[i.id])&&void 0!==t?t:1)||c.push(e[i.id]);return{create:e=>(e.values[n]=i(e),1),update(e,t){if(a&&t.docChanged||l&&(t.docChanged||t.selection)||G(e,c)){let t=i(e);if(o?!K(t,e.values[n],r):!r(t,e.values[n]))return e.values[n]=t,1}return 0},reconfigure:(e,t)=>{let a,l=t.config.address[s];if(null!=l){let s=ne(t,l);if(this.dependencies.every((i=>i instanceof z?t.facet(i)===e.facet(i):!(i instanceof Y)||t.field(i,!1)==e.field(i,!1)))||(o?K(a=i(e),s,r):r(a=i(e),s)))return e.values[n]=s,0}else a=i(e);return e.values[n]=a,1}}}}function K(e,t,i){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1;return!0}function G(e,t){let i=!1;for(let r of t)1&se(e,r)&&(i=!0);return i}function J(e,t,i){let r=i.map((t=>e[t.id])),s=i.map((e=>e.type)),n=r.filter((e=>!(1&e))),o=e[t.id]>>1;function a(e){let i=[];for(let t=0;t<r.length;t++){let n=ne(e,r[t]);if(2==s[t])for(let e of n)i.push(e);else i.push(n)}return t.combine(i)}return{create(e){for(let t of r)se(e,t);return e.values[o]=a(e),1},update(e,i){if(!G(e,n))return 0;let r=a(e);return t.compare(r,e.values[o])?0:(e.values[o]=r,1)},reconfigure(e,s){let n=G(e,r),l=s.config.facets[t.id],c=s.facet(t);if(l&&!n&&U(i,l))return e.values[o]=c,0;let h=a(e);return t.compare(h,c)?(e.values[o]=c,0):(e.values[o]=h,1)}}}const X=z.define({static:!0});class Y{constructor(e,t,i,r,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=r,this.spec=s,this.provides=void 0}static define(e){let t=new Y($++,e.create,e.update,e.compare||((e,t)=>e===t),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(X).find((e=>e.field==this));return((null==t?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:e=>(e.values[t]=this.create(e),1),update:(e,i)=>{let r=e.values[t],s=this.updateF(r,i);return this.compareF(r,s)?0:(e.values[t]=s,1)},reconfigure:(e,i)=>{let r,s=e.facet(X),n=i.facet(X);return(r=s.find((e=>e.field==this)))&&r!=n.find((e=>e.field==this))?(e.values[t]=r.create(e),1):null!=i.config.address[this.id]?(e.values[t]=i.field(this),0):(e.values[t]=this.create(e),1)}}}init(e){return[this,X.of({field:this,create:e})]}get extension(){return this}}function Z(e){return t=>new ee(t,e)}const Q={highest:Z(0),high:Z(1),default:Z(2),low:Z(3),lowest:Z(4)};class ee{constructor(e,t){this.inner=e,this.prec=t}}class te{of(e){return new ie(this,e)}reconfigure(e){return te.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class ie{constructor(e,t){this.compartment=e,this.inner=t}}class re{constructor(e,t,i,r,s,n){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=r,this.staticValues=s,this.facets=n,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return null==t?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let r=[],s=Object.create(null),n=new Map;for(let i of function(e,t,i){let r=[[],[],[],[],[]],s=new Map;return function e(n,o){let a=s.get(n);if(null!=a){if(a<=o)return;let e=r[a].indexOf(n);e>-1&&r[a].splice(e,1),n instanceof ie&&i.delete(n.compartment)}if(s.set(n,o),Array.isArray(n))for(let t of n)e(t,o);else if(n instanceof ie){if(i.has(n.compartment))throw new RangeError("Duplicate use of compartment in extensions");let r=t.get(n.compartment)||n.inner;i.set(n.compartment,r),e(r,o)}else if(n instanceof ee)e(n.inner,n.prec);else if(n instanceof Y)r[o].push(n),n.provides&&e(n.provides,o);else if(n instanceof V)r[o].push(n),n.facet.extensions&&e(n.facet.extensions,2);else{let t=n.extension;if(!t)throw new Error(`Unrecognized extension value in extension set (${n}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);e(t,o)}}(e,2),r.reduce(((e,t)=>e.concat(t)))}(e,t,n))i instanceof Y?r.push(i):(s[i.facet.id]||(s[i.facet.id]=[])).push(i);let o=Object.create(null),a=[],l=[];for(let e of r)o[e.id]=l.length<<1,l.push((t=>e.slot(t)));let c=null==i?void 0:i.config.facets;for(let e in s){let t=s[e],r=t[0].facet,n=c&&c[e]||[];if(t.every((e=>0==e.type)))if(o[r.id]=a.length<<1|1,U(n,t))a.push(i.facet(r));else{let e=r.combine(t.map((e=>e.value)));a.push(i&&r.compare(e,i.facet(r))?i.facet(r):e)}else{for(let e of t)0==e.type?(o[e.id]=a.length<<1|1,a.push(e.value)):(o[e.id]=l.length<<1,l.push((t=>e.dynamicSlot(t))));o[r.id]=l.length<<1,l.push((e=>J(e,r,t)))}}let h=l.map((e=>e(o)));return new re(e,n,h,o,a,s)}}function se(e,t){if(1&t)return 2;let i=t>>1,r=e.status[i];if(4==r)throw new Error("Cyclic dependency between fields and/or facets");if(2&r)return r;e.status[i]=4;let s=e.computeSlot(e,e.config.dynamicSlots[i]);return e.status[i]=2|s}function ne(e,t){return 1&t?e.config.staticValues[t>>1]:e.values[t>>1]}const oe=z.define(),ae=z.define({combine:e=>e.some((e=>e)),static:!0}),le=z.define({combine:e=>e.length?e[0]:void 0,static:!0}),ce=z.define(),he=z.define(),ue=z.define(),de=z.define({combine:e=>!!e.length&&e[0]});class fe{constructor(e,t){this.type=e,this.value=t}static define(){return new pe}}class pe{of(e){return new fe(this,e)}}class ge{constructor(e){this.map=e}of(e){return new me(this,e)}}class me{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return void 0===t?void 0:t==this.value?this:new me(this.type,t)}is(e){return this.type==e}static define(e={}){return new ge(e.map||(e=>e))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let r of e){let e=r.map(t);e&&i.push(e)}return i}}me.reconfigure=me.define(),me.appendConfig=me.define();class ve{constructor(e,t,i,r,s,n){this.startState=e,this.changes=t,this.selection=i,this.effects=r,this.annotations=s,this.scrollIntoView=n,this._doc=null,this._state=null,i&&j(i,t.newLength),s.some((e=>e.type==ve.time))||(this.annotations=s.concat(ve.time.of(Date.now())))}static create(e,t,i,r,s,n){return new ve(e,t,i,r,s,n)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(ve.userEvent);return!(!t||!(t==e||t.length>e.length&&t.slice(0,e.length)==e&&"."==t[e.length]))}}function _e(e,t){let i=[];for(let r=0,s=0;;){let n,o;if(r<e.length&&(s==t.length||t[s]>=e[r]))n=e[r++],o=e[r++];else{if(!(s<t.length))return i;n=t[s++],o=t[s++]}!i.length||i[i.length-1]<n?i.push(n,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function ye(e,t,i){var r;let s,n,o;return i?(s=t.changes,n=L.empty(t.changes.length),o=e.changes.compose(t.changes)):(s=t.changes.map(e.changes),n=e.changes.mapDesc(t.changes,!0),o=e.changes.compose(s)),{changes:o,selection:t.selection?t.selection.map(n):null===(r=e.selection)||void 0===r?void 0:r.map(s),effects:me.mapEffects(e.effects,s).concat(me.mapEffects(t.effects,n)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function be(e,t,i){let r=t.selection,s=Ce(t.annotations);return t.userEvent&&(s=s.concat(ve.userEvent.of(t.userEvent))),{changes:t.changes instanceof L?t.changes:L.of(t.changes||[],i,e.facet(le)),selection:r&&(r instanceof W?r:W.single(r.anchor,r.head)),effects:Ce(t.effects),annotations:s,scrollIntoView:!!t.scrollIntoView}}function we(e,t,i){let r=be(e,t.length?t[0]:{},e.doc.length);t.length&&!1===t[0].filter&&(i=!1);for(let s=1;s<t.length;s++){!1===t[s].filter&&(i=!1);let n=!!t[s].sequential;r=ye(r,be(e,t[s],n?r.changes.newLength:e.doc.length),n)}let s=ve.create(e,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return function(e){let t=e.startState,i=t.facet(ue),r=e;for(let s=i.length-1;s>=0;s--){let n=i[s](e);n&&Object.keys(n).length&&(r=ye(r,be(t,n,e.changes.newLength),!0))}return r==e?e:ve.create(t,e.changes,e.selection,r.effects,r.annotations,r.scrollIntoView)}(i?function(e){let t=e.startState,i=!0;for(let r of t.facet(ce)){let t=r(e);if(!1===t){i=!1;break}Array.isArray(t)&&(i=!0===i?t:_e(i,t))}if(!0!==i){let r,s;if(!1===i)s=e.changes.invertedDesc,r=L.empty(t.doc.length);else{let t=e.changes.filter(i);r=t.changes,s=t.filtered.mapDesc(t.changes).invertedDesc}e=ve.create(t,r,e.selection&&e.selection.map(s),me.mapEffects(e.effects,s),e.annotations,e.scrollIntoView)}let r=t.facet(he);for(let i=r.length-1;i>=0;i--){let s=r[i](e);e=s instanceof ve?s:Array.isArray(s)&&1==s.length&&s[0]instanceof ve?s[0]:we(t,Ce(s),!1)}return e}(s):s)}ve.time=fe.define(),ve.userEvent=fe.define(),ve.addToHistory=fe.define(),ve.remote=fe.define();const Se=[];function Ce(e){return null==e?Se:Array.isArray(e)?e:[e]}var ke=function(e){return e[e.Word=0]="Word",e[e.Space=1]="Space",e[e.Other=2]="Other",e}(ke||(ke={}));const xe=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Re;try{Re=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(e){}class Ee{constructor(e,t,i,r,s,n){this.config=e,this.doc=t,this.selection=i,this.values=r,this.status=e.statusTemplate.slice(),this.computeSlot=s,n&&(n._state=this);for(let e=0;e<this.config.dynamicSlots.length;e++)se(this,e<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(null!=i)return se(this,i),ne(this,i);if(t)throw new RangeError("Field is not present in this state")}update(...e){return we(this,e,!0)}applyTransaction(e){let t,i=this.config,{base:r,compartments:s}=i;for(let t of e.effects)t.is(te.reconfigure)?(i&&(s=new Map,i.compartments.forEach(((e,t)=>s.set(t,e))),i=null),s.set(t.value.compartment,t.value.extension)):t.is(me.reconfigure)?(i=null,r=t.value):t.is(me.appendConfig)&&(i=null,r=Ce(r).concat(t.value));i?t=e.startState.values.slice():(i=re.resolve(r,s,this),t=new Ee(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((e,t)=>t.reconfigure(e,this)),null).values);let n=e.startState.facet(ae)?e.newSelection:e.newSelection.asSingle();new Ee(i,e.newDoc,n,t,((t,i)=>i.update(t,e)),e)}replaceSelection(e){return"string"==typeof e&&(e=this.toText(e)),this.changeByRange((t=>({changes:{from:t.from,to:t.to,insert:e},range:W.cursor(t.from+e.length)})))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),r=this.changes(i.changes),s=[i.range],n=Ce(i.effects);for(let i=1;i<t.ranges.length;i++){let o=e(t.ranges[i]),a=this.changes(o.changes),l=a.map(r);for(let e=0;e<i;e++)s[e]=s[e].map(l);let c=r.mapDesc(a,!0);s.push(o.range.map(c)),r=r.compose(l),n=me.mapEffects(n,l).concat(me.mapEffects(Ce(o.effects),c))}return{changes:r,selection:W.create(s,t.mainIndex),effects:n}}changes(e=[]){return e instanceof L?e:L.of(e,this.doc.length,this.facet(Ee.lineSeparator))}toText(e){return m.of(e.split(this.facet(Ee.lineSeparator)||M))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return null==t?e.default:(se(this,t),ne(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let r=e[i];r instanceof Y&&null!=this.config.address[r.id]&&(t[i]=r.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||"string"!=typeof e.doc)throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(i)for(let t in i)if(Object.prototype.hasOwnProperty.call(e,t)){let s=i[t],n=e[t];r.push(s.init((e=>s.spec.fromJSON(n,e))))}return Ee.create({doc:e.doc,selection:W.fromJSON(e.selection),extensions:t.extensions?r.concat([t.extensions]):r})}static create(e={}){let t=re.resolve(e.extensions||[],new Map),i=e.doc instanceof m?e.doc:m.of((e.doc||"").split(t.staticFacet(Ee.lineSeparator)||M)),r=e.selection?e.selection instanceof W?e.selection:W.single(e.selection.anchor,e.selection.head):W.single(0);return j(r,i.length),t.staticFacet(ae)||(r=r.asSingle()),new Ee(t,i,r,t.dynamicSlots.map((()=>null)),((e,t)=>t.create(e)),null)}get tabSize(){return this.facet(Ee.tabSize)}get lineBreak(){return this.facet(Ee.lineSeparator)||"\n"}get readOnly(){return this.facet(de)}phrase(e,...t){for(let t of this.facet(Ee.phrases))if(Object.prototype.hasOwnProperty.call(t,e)){e=t[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,((e,i)=>{if("$"==i)return"$";let r=+(i||1);return!r||r>t.length?e:t[r-1]}))),e}languageDataAt(e,t,i=-1){let r=[];for(let s of this.facet(oe))for(let n of s(this,t,i))Object.prototype.hasOwnProperty.call(n,e)&&r.push(n[e]);return r}charCategorizer(e){return t=this.languageDataAt("wordChars",e).join(""),e=>{if(!/\S/.test(e))return ke.Space;if(function(e){if(Re)return Re.test(e);for(let t=0;t<e.length;t++){let i=e[t];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||xe.test(i)))return!0}return!1}(e))return ke.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return ke.Word;return ke.Other};var t}wordAt(e){let{text:t,from:i,length:r}=this.doc.lineAt(e),s=this.charCategorizer(e),n=e-i,o=e-i;for(;n>0;){let e=R(t,n,!1);if(s(t.slice(e,n))!=ke.Word)break;n=e}for(;o<r;){let e=R(t,o);if(s(t.slice(o,e))!=ke.Word)break;o=e}return n==o?null:W.range(n+i,o+i)}}function De(e,t,i={}){let r={};for(let t of e)for(let e of Object.keys(t)){let s=t[e],n=r[e];if(void 0===n)r[e]=s;else if(n===s||void 0===s);else{if(!Object.hasOwnProperty.call(i,e))throw new Error("Config merge conflict for field "+e);r[e]=i[e](n,s)}}for(let e in t)void 0===r[e]&&(r[e]=t[e]);return r}Ee.allowMultipleSelections=ae,Ee.tabSize=z.define({combine:e=>e.length?e[0]:4}),Ee.lineSeparator=le,Ee.readOnly=de,Ee.phrases=z.define({compare(e,t){let i=Object.keys(e),r=Object.keys(t);return i.length==r.length&&i.every((i=>e[i]==t[i]))}}),Ee.languageData=oe,Ee.changeFilter=ce,Ee.transactionFilter=he,Ee.transactionExtender=ue,te.reconfigure=me.define();class Te{eq(e){return this==e}range(e,t=e){return Me.create(e,t,this)}}Te.prototype.startSide=Te.prototype.endSide=0,Te.prototype.point=!1,Te.prototype.mapMode=A.TrackDel;class Me{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Me(e,t,i)}}function Ae(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}class Oe{constructor(e,t,i,r){this.from=e,this.to=t,this.value=i,this.maxPoint=r}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,r=0){let s=i?this.to:this.from;for(let n=r,o=s.length;;){if(n==o)return n;let r=n+o>>1,a=s[r]-e||(i?this.value[r].endSide:this.value[r].startSide)-t;if(r==n)return a>=0?n:o;a>=0?o=r:n=r+1}}between(e,t,i,r){for(let s=this.findIndex(t,-1e9,!0),n=this.findIndex(i,1e9,!1,s);s<n;s++)if(!1===r(this.from[s]+e,this.to[s]+e,this.value[s]))return!1}map(e,t){let i=[],r=[],s=[],n=-1,o=-1;for(let a=0;a<this.value.length;a++){let l,c,h=this.value[a],u=this.from[a]+e,d=this.to[a]+e;if(u==d){let e=t.mapPos(u,h.startSide,h.mapMode);if(null==e)continue;if(l=c=e,h.startSide!=h.endSide&&(c=t.mapPos(u,h.endSide),c<l))continue}else if(l=t.mapPos(u,h.startSide),c=t.mapPos(d,h.endSide),l>c||l==c&&h.startSide>0&&h.endSide<=0)continue;(c-l||h.endSide-h.startSide)<0||(n<0&&(n=l),h.point&&(o=Math.max(o,c-l)),i.push(h),r.push(l-n),s.push(c-n))}return{mapped:i.length?new Oe(r,s,i,o):null,pos:n}}}class Le{constructor(e,t,i,r){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=r}static create(e,t,i,r){return new Le(e,t,i,r)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:r=0,filterTo:s=this.length}=e,n=e.filter;if(0==t.length&&!n)return this;if(i&&(t=t.slice().sort(Ae)),this.isEmpty)return t.length?Le.of(t):this;let o=new Ie(this,null,-1).goto(0),a=0,l=[],c=new Pe;for(;o.value||a<t.length;)if(a<t.length&&(o.from-t[a].from||o.startSide-t[a].value.startSide)>=0){let e=t[a++];c.addInner(e.from,e.to,e.value)||l.push(e)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(o.chunkIndex)<t[a].from)&&(!n||r>this.chunkEnd(o.chunkIndex)||s<this.chunkPos[o.chunkIndex])&&c.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!n||r>o.to||s<o.from||n(o.from,o.to,o.value))&&(c.addInner(o.from,o.to,o.value)||l.push(Me.create(o.from,o.to,o.value))),o.next());return c.finishInner(this.nextLayer.isEmpty&&!l.length?Le.empty:this.nextLayer.update({add:l,filter:n,filterFrom:r,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],r=-1;for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],o=this.chunk[s],a=e.touchesRange(n,n+o.length);if(!1===a)r=Math.max(r,o.maxPoint),t.push(o),i.push(e.mapPos(n));else if(!0===a){let{mapped:s,pos:a}=o.map(n,e);s&&(r=Math.max(r,s.maxPoint),t.push(s),i.push(a))}}let s=this.nextLayer.map(e);return 0==t.length?s:new Le(i,t,s||Le.empty,r)}between(e,t,i){if(!this.isEmpty){for(let r=0;r<this.chunk.length;r++){let s=this.chunkPos[r],n=this.chunk[r];if(t>=s&&e<=s+n.length&&!1===n.between(s,e-s,t-s,i))return}this.nextLayer.between(e,t,i)}}iter(e=0){return Ne.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Ne.from(e).goto(t)}static compare(e,t,i,r,s=-1){let n=e.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=s)),o=t.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=s)),a=Be(n,o,i),l=new He(n,a,s),c=new He(o,a,s);i.iterGaps(((e,t,i)=>Fe(l,e,c,t,i,r))),i.empty&&0==i.length&&Fe(l,0,c,0,0,r)}static eq(e,t,i=0,r){null==r&&(r=999999999);let s=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0)),n=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0));if(s.length!=n.length)return!1;if(!s.length)return!0;let o=Be(s,n),a=new He(s,o,0).goto(i),l=new He(n,o,0).goto(i);for(;;){if(a.to!=l.to||!We(a.active,l.active)||a.point&&(!l.point||!a.point.eq(l.point)))return!1;if(a.to>r)return!0;a.next(),l.next()}}static spans(e,t,i,r,s=-1){let n=new He(e,null,s).goto(t),o=t,a=n.openStart;for(;;){let e=Math.min(n.to,i);if(n.point){let i=n.activeForPoint(n.to),s=n.pointFrom<t?i.length+1:n.point.startSide<0?i.length:Math.min(i.length,a);r.point(o,e,n.point,i,s,n.pointRank),a=Math.min(n.openEnd(e),i.length)}else e>o&&(r.span(o,e,n.active,a),a=n.openEnd(e));if(n.to>i)return a+(n.point&&n.to>i?1:0);o=n.to,n.next()}}static of(e,t=!1){let i=new Pe;for(let r of e instanceof Me?[e]:t?function(e){if(e.length>1)for(let t=e[0],i=1;i<e.length;i++){let r=e[i];if(Ae(t,r)>0)return e.slice().sort(Ae);t=r}return e}(e):e)i.add(r.from,r.to,r.value);return i.finish()}static join(e){if(!e.length)return Le.empty;let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)for(let r=e[i];r!=Le.empty;r=r.nextLayer)t=new Le(r.chunkPos,r.chunk,t,Math.max(r.maxPoint,t.maxPoint));return t}}Le.empty=new Le([],[],null,-1),Le.empty.nextLayer=Le.empty;class Pe{finishChunk(e){this.chunks.push(new Oe(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Pe)).add(e,t,i)}addInner(e,t,i){let r=e-this.lastTo||i.startSide-this.last.endSide;if(r<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(r<0||(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),0))}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(Le.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return e;let t=Le.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Be(e,t,i){let r=new Map;for(let t of e)for(let e=0;e<t.chunk.length;e++)t.chunk[e].maxPoint<=0&&r.set(t.chunk[e],t.chunkPos[e]);let s=new Set;for(let e of t)for(let t=0;t<e.chunk.length;t++){let n=r.get(e.chunk[t]);null==n||(i?i.mapPos(n):n)!=e.chunkPos[t]||(null==i?void 0:i.touchesRange(n,n+e.chunk[t].length))||s.add(e.chunk[t])}return s}class Ie{constructor(e,t,i,r=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=r}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let t=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(t)||this.layer.chunkEnd(this.chunkIndex)<e||t.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let r=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<r)&&this.setRangeIndex(r)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Ne{constructor(e){this.heap=e}static from(e,t=null,i=-1){let r=[];for(let s=0;s<e.length;s++)for(let n=e[s];!n.isEmpty;n=n.nextLayer)n.maxPoint>=i&&r.push(new Ie(n,t,i,s));return 1==r.length?r[0]:new Ne(r)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let e=this.heap.length>>1;e>=0;e--)qe(this.heap,e);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let e=this.heap.length>>1;e>=0;e--)qe(this.heap,e);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),qe(this.heap,0)}}}function qe(e,t){for(let i=e[t];;){let r=1+(t<<1);if(r>=e.length)break;let s=e[r];if(r+1<e.length&&s.compare(e[r+1])>=0&&(s=e[r+1],r++),i.compare(s)<0)break;e[r]=i,e[t]=s,t=r}}class He{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Ne.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){je(this.active,e),je(this.activeTo,e),je(this.activeRank,e),this.minActive=ze(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:r,rank:s}=this.cursor;for(;t<this.activeRank.length&&(s-this.activeRank[t]||r-this.activeTo[t])>0;)t++;$e(this.active,t,i),$e(this.activeTo,t,r),$e(this.activeRank,t,s),e&&$e(e,t,this.cursor.from),this.minActive=ze(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>e){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&je(i,r)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let e=this.cursor.value;if(e.point){if(!(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=e,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=e.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){this.openStart=0;for(let t=i.length-1;t>=0&&i[t]<e;t--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function Fe(e,t,i,r,s,n){e.goto(t),i.goto(r);let o=r+s,a=r,l=r-t;for(;;){let t=e.to+l-i.to,r=t||e.endSide-i.endSide,s=r<0?e.to+l:i.to,c=Math.min(s,o);if(e.point||i.point?e.point&&i.point&&(e.point==i.point||e.point.eq(i.point))&&We(e.activeForPoint(e.to),i.activeForPoint(i.to))||n.comparePoint(a,c,e.point,i.point):c>a&&!We(e.active,i.active)&&n.compareRange(a,c,e.active,i.active),s>o)break;(t||e.openEnd!=i.openEnd)&&n.boundChange&&n.boundChange(s),a=s,r<=0&&e.next(),r>=0&&i.next()}}function We(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i]&&!e[i].eq(t[i]))return!1;return!0}function je(e,t){for(let i=t,r=e.length-1;i<r;i++)e[i]=e[i+1];e.pop()}function $e(e,t,i){for(let i=e.length-1;i>=t;i--)e[i+1]=e[i];e[t]=i}function ze(e,t){let i=-1,r=1e9;for(let s=0;s<t.length;s++)(t[s]-r||e[s].endSide-e[i].endSide)<0&&(i=s,r=t[s]);return i}function Ue(e,t,i=e.length){let r=0;for(let s=0;s<i&&s<e.length;)9==e.charCodeAt(s)?(r+=t-r%t,s++):(r++,s=R(e,s));return r}function Ve(e,t,i,r){for(let r=0,s=0;;){if(s>=t)return r;if(r==e.length)break;s+=9==e.charCodeAt(r)?i-s%i:1,r=R(e,r)}return!0===r?-1:e.length}const Ke="undefined"==typeof Symbol?"__":Symbol.for(""),Ge="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),Je="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class Xe{constructor(e,t){this.rules=[];let{finish:i}=t||{};function r(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function s(e,t,n,o){let a=[],l=/^@(\w+)\b/.exec(e[0]),c=l&&"keyframes"==l[1];if(l&&null==t)return n.push(e[0]+";");for(let i in t){let o=t[i];if(/&/.test(i))s(i.split(/,\s*/).map((t=>e.map((e=>t.replace(/&/,e))))).reduce(((e,t)=>e.concat(t))),o,n);else if(o&&"object"==typeof o){if(!l)throw new RangeError("The value of a property ("+i+") should be a primitive value.");s(r(i),o,a,c)}else null!=o&&a.push(i.replace(/_.*/,"").replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()))+": "+o+";")}(a.length||c)&&n.push((!i||l||o?e:e.map(i)).join(", ")+" {"+a.join(" ")+"}")}for(let t in e)s(r(t),e[t],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let e=Je[Ke]||1;return Je[Ke]=e+1,""+e.toString(36)}static mount(e,t,i){let r=e[Ge],s=i&&i.nonce;r?s&&r.setNonce(s):r=new Ze(e,s),r.mount(Array.isArray(t)?t:[t],e)}}let Ye=new Map;class Ze{constructor(e,t){let i=e.ownerDocument||e,r=i.defaultView;if(!e.head&&e.adoptedStyleSheets&&r.CSSStyleSheet){let t=Ye.get(i);if(t)return e[Ge]=t;this.sheet=new r.CSSStyleSheet,Ye.set(i,this)}else this.styleTag=i.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[Ge]=this}mount(e,t){let i=this.sheet,r=0,s=0;for(let t=0;t<e.length;t++){let n=e[t],o=this.modules.indexOf(n);if(o<s&&o>-1&&(this.modules.splice(o,1),s--,o=-1),-1==o){if(this.modules.splice(s++,0,n),i)for(let e=0;e<n.rules.length;e++)i.insertRule(n.rules[e],r++)}else{for(;s<o;)r+=this.modules[s++].rules.length;r+=n.rules.length,s++}}if(i)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let e="";for(let t=0;t<this.modules.length;t++)e+=this.modules[t].getRules()+"\n";this.styleTag.textContent=e;let i=t.head||t;this.styleTag.parentNode!=i&&i.insertBefore(this.styleTag,i.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}for(var Qe={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},et={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},tt="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),it="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),rt=0;rt<10;rt++)Qe[48+rt]=Qe[96+rt]=String(rt);for(rt=1;rt<=24;rt++)Qe[rt+111]="F"+rt;for(rt=65;rt<=90;rt++)Qe[rt]=String.fromCharCode(rt+32),et[rt]=String.fromCharCode(rt);for(var st in Qe)et.hasOwnProperty(st)||(et[st]=Qe[st]);function nt(e){let t;return t=11==e.nodeType?e.getSelection?e:e.ownerDocument:e,t.getSelection()}function ot(e,t){return!!t&&(e==t||e.contains(1!=t.nodeType?t.parentNode:t))}function at(e,t){if(!t.anchorNode)return!1;try{return ot(e,t.anchorNode)}catch(e){return!1}}function lt(e){return 3==e.nodeType?wt(e,0,e.nodeValue.length).getClientRects():1==e.nodeType?e.getClientRects():[]}function ct(e,t,i,r){return!!i&&(dt(e,t,i,r,-1)||dt(e,t,i,r,1))}function ht(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t}function ut(e){return 1==e.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}function dt(e,t,i,r,s){for(;;){if(e==i&&t==r)return!0;if(t==(s<0?0:ft(e))){if("DIV"==e.nodeName)return!1;let i=e.parentNode;if(!i||1!=i.nodeType)return!1;t=ht(e)+(s<0?0:1),e=i}else{if(1!=e.nodeType)return!1;if(1==(e=e.childNodes[t+(s<0?-1:0)]).nodeType&&"false"==e.contentEditable)return!1;t=s<0?ft(e):0}}}function ft(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function pt(e,t){let i=t?e.left:e.right;return{left:i,right:i,top:e.top,bottom:e.bottom}}function gt(e){let t=e.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}function mt(e,t){let i=t.width/e.offsetWidth,r=t.height/e.offsetHeight;return(i>.995&&i<1.005||!isFinite(i)||Math.abs(t.width-e.offsetWidth)<1)&&(i=1),(r>.995&&r<1.005||!isFinite(r)||Math.abs(t.height-e.offsetHeight)<1)&&(r=1),{scaleX:i,scaleY:r}}class vt{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?ft(t):0),i,Math.min(e.focusOffset,i?ft(i):0))}set(e,t,i,r){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=r}}let _t,yt=null;function bt(e){if(e.setActive)return e.setActive();if(yt)return e.focus(yt);let t=[];for(let i=e;i&&(t.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(e.focus(null==yt?{get preventScroll(){return yt={preventScroll:!0},!0}}:void 0),!yt){yt=!1;for(let e=0;e<t.length;){let i=t[e++],r=t[e++],s=t[e++];i.scrollTop!=r&&(i.scrollTop=r),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function wt(e,t,i=t){let r=_t||(_t=document.createRange());return r.setEnd(e,i),r.setStart(e,t),r}function St(e,t,i,r){let s={key:t,code:t,keyCode:i,which:i,cancelable:!0};r&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=r);let n=new KeyboardEvent("keydown",s);n.synthetic=!0,e.dispatchEvent(n);let o=new KeyboardEvent("keyup",s);return o.synthetic=!0,e.dispatchEvent(o),n.defaultPrevented||o.defaultPrevented}function Ct(e){for(;e.attributes.length;)e.removeAttributeNode(e.attributes[0])}function kt(e){return e.scrollTop>Math.max(1,e.scrollHeight-e.clientHeight-4)}function xt(e,t){for(let i=e,r=t;;){if(3==i.nodeType&&r>0)return{node:i,offset:r};if(1==i.nodeType&&r>0){if("false"==i.contentEditable)return null;i=i.childNodes[r-1],r=ft(i)}else{if(!i.parentNode||ut(i))return null;r=ht(i),i=i.parentNode}}}function Rt(e,t){for(let i=e,r=t;;){if(3==i.nodeType&&r<i.nodeValue.length)return{node:i,offset:r};if(1==i.nodeType&&r<i.childNodes.length){if("false"==i.contentEditable)return null;i=i.childNodes[r],r=0}else{if(!i.parentNode||ut(i))return null;r=ht(i)+1,i=i.parentNode}}}class Et{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new Et(e.parentNode,ht(e),t)}static after(e,t){return new Et(e.parentNode,ht(e)+1,t)}}const Dt=[];class Tt{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(2&this.flags){let i,r=this.dom,s=null;for(let n of this.children){if(7&n.flags){if(!n.dom&&(i=s?s.nextSibling:r.firstChild)){let e=Tt.get(i);(!e||!e.parent&&e.canReuseDOM(n))&&n.reuseDOM(i)}n.sync(e,t),n.flags&=-8}if(i=s?s.nextSibling:r.firstChild,t&&!t.written&&t.node==r&&i!=n.dom&&(t.written=!0),n.dom.parentNode==r)for(;i&&i!=n.dom;)i=Mt(i);else r.insertBefore(n.dom,i);s=n.dom}for(i=s?s.nextSibling:r.firstChild,i&&t&&t.node==r&&(t.written=!0);i;)i=Mt(i)}else if(1&this.flags)for(let i of this.children)7&i.flags&&(i.sync(e,t),i.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let r=0==ft(e)?0:0==t?-1:1;for(;;){let t=e.parentNode;if(t==this.dom)break;0==r&&t.firstChild!=t.lastChild&&(r=e==t.firstChild?-1:1),e=t}i=r<0?e:e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Tt.get(i);)i=i.nextSibling;if(!i)return this.length;for(let e=0,t=0;;e++){let r=this.children[e];if(r.dom==i)return t;t+=r.length+r.breakAfter}}domBoundsAround(e,t,i=0){let r=-1,s=-1,n=-1,o=-1;for(let a=0,l=i,c=i;a<this.children.length;a++){let i=this.children[a],h=l+i.length;if(l<e&&h>t)return i.domBoundsAround(e,t,l);if(h>=e&&-1==r&&(r=a,s=l),l>t&&i.dom.parentNode==this.dom){n=a,o=c;break}c=h,l=h+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:n<this.children.length&&n>=0?this.children[n].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),1&t.flags)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,7&this.flags&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=Dt){this.markDirty();for(let r=e;r<t;r++){let e=this.children[r];e.parent==this&&i.indexOf(e)<0&&e.destroy()}i.length<250?this.children.splice(e,t-e,...i):this.children=[].concat(this.children.slice(0,e),i,this.children.slice(t));for(let e=0;e<i.length;e++)i[e].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new At(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==e?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,i,r,s,n){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!(8&(this.flags|e.flags))}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}function Mt(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}Tt.prototype.breakAfter=0;class At{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Ot(e,t,i,r,s,n,o,a,l){let{children:c}=e,h=c.length?c[t]:null,u=n.length?n[n.length-1]:null,d=u?u.breakAfter:o;if(!(t==r&&h&&!o&&!d&&n.length<2&&h.merge(i,s,n.length?u:null,0==i,a,l))){if(r<c.length){let e=c[r];e&&(s<e.length||e.breakAfter&&(null==u?void 0:u.breakAfter))?(t==r&&(e=e.split(s),s=0),!d&&u&&e.merge(0,s,u,!0,0,l)?n[n.length-1]=e:((s||e.children.length&&!e.children[0].length)&&e.merge(0,s,null,!1,0,l),n.push(e))):(null==e?void 0:e.breakAfter)&&(u?u.breakAfter=1:o=1),r++}for(h&&(h.breakAfter=o,i>0&&(!o&&n.length&&h.merge(i,h.length,n[0],!1,a,0)?h.breakAfter=n.shift().breakAfter:(i<h.length||h.children.length&&0==h.children[h.children.length-1].length)&&h.merge(i,h.length,null,!1,a,0),t++));t<r&&n.length;)if(c[r-1].become(n[n.length-1]))r--,n.pop(),l=n.length?0:a;else{if(!c[t].become(n[0]))break;t++,n.shift(),a=n.length?0:l}!n.length&&t&&r<c.length&&!c[t-1].breakAfter&&c[r].merge(0,0,c[t-1],!1,a,l)&&t--,(t<r||n.length)&&e.replaceChildren(t,r,n)}}function Lt(e,t,i,r,s,n){let o=e.childCursor(),{i:a,off:l}=o.findPos(i,1),{i:c,off:h}=o.findPos(t,-1),u=t-i;for(let e of r)u+=e.length;e.length+=u,Ot(e,c,h,a,l,r,0,s,n)}let Pt="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Bt="undefined"!=typeof document?document:{documentElement:{style:{}}};const It=/Edge\/(\d+)/.exec(Pt.userAgent),Nt=/MSIE \d/.test(Pt.userAgent),qt=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Pt.userAgent),Ht=!!(Nt||qt||It),Ft=!Ht&&/gecko\/(\d+)/i.test(Pt.userAgent),Wt=!Ht&&/Chrome\/(\d+)/.exec(Pt.userAgent),jt="webkitFontSmoothing"in Bt.documentElement.style,$t=!Ht&&/Apple Computer/.test(Pt.vendor),zt=$t&&(/Mobile\/\w+/.test(Pt.userAgent)||Pt.maxTouchPoints>2);var Ut={mac:zt||/Mac/.test(Pt.platform),windows:/Win/.test(Pt.platform),linux:/Linux|X11/.test(Pt.platform),ie:Ht,ie_version:Nt?Bt.documentMode||6:qt?+qt[1]:It?+It[1]:0,gecko:Ft,gecko_version:Ft?+(/Firefox\/(\d+)/.exec(Pt.userAgent)||[0,0])[1]:0,chrome:!!Wt,chrome_version:Wt?+Wt[1]:0,ios:zt,android:/Android\b/.test(Pt.userAgent),webkit:jt,safari:$t,webkit_version:jt?+(/\bAppleWebKit\/(\d+)/.exec(Pt.userAgent)||[0,0])[1]:0,tabSize:null!=Bt.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class Vt extends Tt{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){3==e.nodeType&&this.createDOM(e)}merge(e,t,i){return!(8&this.flags||i&&(!(i instanceof Vt)||this.length-(t-e)+i.length>256||8&i.flags)||(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),0))}split(e){let t=new Vt(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=8&this.flags,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new Et(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return function(e,t,i){let r=e.nodeValue.length;t>r&&(t=r);let s=t,n=t,o=0;0==t&&i<0||t==r&&i>=0?Ut.chrome||Ut.gecko||(t?(s--,o=1):n<r&&(n++,o=-1)):i<0?s--:n<r&&n++;let a=wt(e,s,n).getClientRects();if(!a.length)return null;let l=a[(o?o<0:i>=0)?0:a.length-1];return Ut.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(a,(e=>e.width))||l),o?pt(l,o<0):l||null}(this.dom,e,t)}}class Kt extends Tt{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let e of t)e.setParent(this)}setAttrs(e){if(Ct(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!(8&(this.flags|e.flags))}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?4&this.flags&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,i,r,s,n){return!(i&&(!(i instanceof Kt&&i.mark.eq(this.mark))||e&&s<=0||t<this.length&&n<=0)||(Lt(this,e,t,i?i.children.slice():[],s-1,n-1),this.markDirty(),0))}split(e){let t=[],i=0,r=-1,s=0;for(let n of this.children){let o=i+n.length;o>e&&t.push(i<e?n.split(e-i):n),r<0&&i>=e&&(r=s),i=o,s++}let n=this.length-e;return this.length=e,r>-1&&(this.children.length=r,this.markDirty()),new Kt(this.mark,t,n)}domAtPos(e){return Xt(this,e)}coordsAt(e,t){return Zt(this,e,t)}}class Gt extends Tt{static create(e,t,i){return new Gt(e,t,i)}constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}split(e){let t=Gt.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,i,r,s,n){return!(i&&(!(i instanceof Gt&&this.widget.compare(i.widget))||e>0&&s<=0||t<this.length&&n<=0)||(this.length=e+(i?i.length:0)+(this.length-t),0))}become(e){return e instanceof Gt&&e.side==this.side&&this.widget.constructor==e.widget.constructor&&(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(0==this.length)return m.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,i=t&&t.state.doc,r=this.posAtStart;return i?i.slice(r,r+this.length):m.empty}domAtPos(e){return(this.length?0==e:this.side>0)?Et.before(this.dom):Et.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);if(i)return i;let r=this.dom.getClientRects(),s=null;if(!r.length)return null;let n=this.side?this.side<0:e>0;for(let t=n?r.length-1:0;s=r[t],!(e>0?0==t:t==r.length-1||s.top<s.bottom);t+=n?-1:1);return pt(s,!n)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Jt extends Tt{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Jt&&e.side==this.side}split(){return new Jt(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?Et.before(this.dom):Et.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return m.empty}get isHidden(){return!0}}function Xt(e,t){let i=e.dom,{children:r}=e,s=0;for(let e=0;s<r.length;s++){let n=r[s],o=e+n.length;if(!(o==e&&n.getSide()<=0)){if(t>e&&t<o&&n.dom.parentNode==i)return n.domAtPos(t-e);if(t<=e)break;e=o}}for(let e=s;e>0;e--){let t=r[e-1];if(t.dom.parentNode==i)return t.domAtPos(t.length)}for(let e=s;e<r.length;e++){let t=r[e];if(t.dom.parentNode==i)return t.domAtPos(0)}return new Et(i,0)}function Yt(e,t,i){let r,{children:s}=e;i>0&&t instanceof Kt&&s.length&&(r=s[s.length-1])instanceof Kt&&r.mark.eq(t.mark)?Yt(r,t.children[0],i-1):(s.push(t),t.setParent(e)),e.length+=t.length}function Zt(e,t,i){let r=null,s=-1,n=null,o=-1;!function e(t,a){for(let l=0,c=0;l<t.children.length&&c<=a;l++){let h=t.children[l],u=c+h.length;u>=a&&(h.children.length?e(h,a-c):(!n||n.isHidden&&(i>0||Qt(n,h)))&&(u>a||c==u&&h.getSide()>0)?(n=h,o=a-c):(c<a||c==u&&h.getSide()<0&&!h.isHidden)&&(r=h,s=a-c)),c=u}}(e,t);let a=(i<0?r:n)||r||n;return a?a.coordsAt(Math.max(0,a==r?s:o),i):function(e){let t=e.dom.lastChild;if(!t)return e.dom.getBoundingClientRect();let i=lt(t);return i[i.length-1]||null}(e)}function Qt(e,t){let i=e.coordsAt(0,1),r=t.coordsAt(0,1);return i&&r&&r.top<i.bottom}function ei(e,t){for(let i in e)"class"==i&&t.class?t.class+=" "+e.class:"style"==i&&t.style?t.style+=";"+e.style:t[i]=e[i];return t}Vt.prototype.children=Gt.prototype.children=Jt.prototype.children=Dt;const ti=Object.create(null);function ii(e,t,i){if(e==t)return!0;e||(e=ti),t||(t=ti);let r=Object.keys(e),s=Object.keys(t);if(r.length-(i&&r.indexOf(i)>-1?1:0)!=s.length-(i&&s.indexOf(i)>-1?1:0))return!1;for(let n of r)if(n!=i&&(-1==s.indexOf(n)||e[n]!==t[n]))return!1;return!0}function ri(e,t,i){let r=!1;if(t)for(let s in t)i&&s in i||(r=!0,"style"==s?e.style.cssText="":e.removeAttribute(s));if(i)for(let s in i)t&&t[s]==i[s]||(r=!0,"style"==s?e.style.cssText=i[s]:e.setAttribute(s,i[s]));return r}function si(e){let t=Object.create(null);for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i];t[r.name]=r.value}return t}class ni{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var oi=function(e){return e[e.Text=0]="Text",e[e.WidgetBefore=1]="WidgetBefore",e[e.WidgetAfter=2]="WidgetAfter",e[e.WidgetRange=3]="WidgetRange",e}(oi||(oi={}));class ai extends Te{constructor(e,t,i,r){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=r}get heightRelevant(){return!1}static mark(e){return new li(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new hi(e,t,t,i,e.widget||null,!1)}static replace(e){let t,i,r=!!e.block;if(e.isBlockGap)t=-5e8,i=4e8;else{let{start:s,end:n}=ui(e,r);t=(s?r?-3e8:-1:5e8)-1,i=1+(n?r?2e8:1:-6e8)}return new hi(e,t,i,r,e.widget||null,!0)}static line(e){return new ci(e)}static set(e,t=!1){return Le.of(e,t)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}ai.none=Le.empty;class li extends ai{constructor(e){let{start:t,end:i}=ui(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,i;return this==e||e instanceof li&&this.tagName==e.tagName&&(this.class||(null===(t=this.attrs)||void 0===t?void 0:t.class))==(e.class||(null===(i=e.attrs)||void 0===i?void 0:i.class))&&ii(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}li.prototype.point=!1;class ci extends ai{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof ci&&this.spec.class==e.spec.class&&ii(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}ci.prototype.mapMode=A.TrackBefore,ci.prototype.point=!0;class hi extends ai{constructor(e,t,i,r,s,n){super(t,i,s,e),this.block=r,this.isReplace=n,this.mapMode=r?t<=0?A.TrackBefore:A.TrackAfter:A.TrackDel}get type(){return this.startSide!=this.endSide?oi.WidgetRange:this.startSide<=0?oi.WidgetBefore:oi.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof hi&&((t=this.widget)==(i=e.widget)||!!(t&&i&&t.compare(i)))&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide;var t,i}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}function ui(e,t=!1){let{inclusiveStart:i,inclusiveEnd:r}=e;return null==i&&(i=e.inclusive),null==r&&(r=e.inclusive),{start:null!=i?i:t,end:null!=r?r:t}}function di(e,t,i,r=0){let s=i.length-1;s>=0&&i[s]+r>=e?i[s]=Math.max(i[s],t):i.push(e,t)}hi.prototype.point=!0;class fi extends Tt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,r,s,n){if(i){if(!(i instanceof fi))return!1;this.dom||i.transferDOM(this)}return r&&this.setDeco(i?i.attrs:null),Lt(this,e,t,i?i.children.slice():[],s,n),!0}split(e){let t=new fi;if(t.breakAfter=this.breakAfter,0==this.length)return t;let{i,off:r}=this.childPos(e);r&&(t.append(this.children[i].split(r),0),this.children[i].merge(r,this.children[i].length,null,!1,0,0),i++);for(let e=i;e<this.children.length;e++)t.append(this.children[e],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){ii(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Yt(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=ei(t,this.attrs||{})),i&&(this.attrs=ei({class:i},this.attrs||{}))}domAtPos(e){return Xt(this,e)}reuseDOM(e){"DIV"==e.nodeName&&(this.setDOM(e),this.flags|=6)}sync(e,t){var i;this.dom?4&this.flags&&(Ct(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(ri(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let r=this.dom.lastChild;for(;r&&Tt.get(r)instanceof Kt;)r=r.lastChild;if(!(r&&this.length&&("BR"==r.nodeName||0!=(null===(i=Tt.get(r))||void 0===i?void 0:i.isEditable)||Ut.ios&&this.children.some((e=>e instanceof Vt))))){let e=document.createElement("BR");e.cmIgnore=!0,this.dom.appendChild(e)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let e,t=0;for(let i of this.children){if(!(i instanceof Vt)||/[^ -~]/.test(i.text))return null;let r=lt(i.dom);if(1!=r.length)return null;t+=r[0].width,e=r[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(e,t){let i=Zt(this,e,t);if(!this.children.length&&i&&this.parent){let{heightOracle:e}=this.parent.view.viewState,t=i.bottom-i.top;if(Math.abs(t-e.lineHeight)<2&&e.textHeight<t){let r=(t-e.textHeight)/2;return{top:i.top+r,bottom:i.bottom-r,left:i.left,right:i.left}}}return i}become(e){return e instanceof fi&&0==this.children.length&&0==e.children.length&&ii(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let i=0,r=0;i<e.children.length;i++){let s=e.children[i],n=r+s.length;if(n>=t){if(s instanceof fi)return s;if(n>t)break}r=n+s.breakAfter}return null}}class pi extends Tt{constructor(e,t,i){super(),this.widget=e,this.length=t,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,r,s,n){return!(i&&(!(i instanceof pi&&this.widget.compare(i.widget))||e>0&&s<=0||t<this.length&&n<=0)||(this.length=e+(i?i.length:0)+(this.length-t),0))}domAtPos(e){return 0==e?Et.before(this.dom):Et.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new pi(this.widget,t,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return Dt}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):m.empty}domBoundsAround(){return null}become(e){return e instanceof pi&&e.widget.constructor==this.widget.constructor&&(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){return this.widget.coordsAt(this.dom,e,t)||(this.widget instanceof gi?null:pt(this.dom.getBoundingClientRect(),this.length?0==e:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:i}=this.deco;return t!=i&&(e<0?t<0:i>0)}}class gi extends ni{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class mi{constructor(e,t,i,r){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=r,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof pi&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new fi),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(vi(new Jt(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||e&&this.content.length&&this.content[this.content.length-1]instanceof pi||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:t,lineBreak:i,done:r}=this.cursor.next(this.skip);if(this.skip=0,r)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}this.text=t,this.textOff=0}let r=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-i)),this.getLine().append(vi(new Vt(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=0}}span(e,t,i,r){this.buildText(t-e,i,r),this.pos=t,this.openStart<0&&(this.openStart=r)}point(e,t,i,r,s,n){if(this.disallowBlockEffectsFor[n]&&i instanceof hi){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=t-e;if(i instanceof hi)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new pi(i.widget||_i.block,o,i));else{let n=Gt.create(i.widget||_i.inline,o,o?0:i.startSide),a=this.atCursorPos&&!n.isEditable&&s<=r.length&&(e<t||i.startSide>0),l=!n.isEditable&&(e<t||s>r.length||i.startSide<=0),c=this.getLine();2!=this.pendingBuffer||a||n.isEditable||(this.pendingBuffer=0),this.flushBuffer(r),a&&(c.append(vi(new Jt(1),r),s),s=r.length+Math.max(0,s-r.length)),c.append(vi(n,r),s),this.atCursorPos=l,this.pendingBuffer=l?e<t||s>r.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=r.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}static build(e,t,i,r,s){let n=new mi(e,t,i,s);return n.openEnd=Le.spans(r,t,i,n),n.openStart<0&&(n.openStart=n.openEnd),n.finish(n.openEnd),n}}function vi(e,t){for(let i of t)e=new Kt(i,[e],e.length);return e}class _i extends ni{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}_i.inline=new _i("span"),_i.block=new _i("div");var yi=function(e){return e[e.LTR=0]="LTR",e[e.RTL=1]="RTL",e}(yi||(yi={}));const bi=yi.LTR,wi=yi.RTL;function Si(e){let t=[];for(let i=0;i<e.length;i++)t.push(1<<+e[i]);return t}const Ci=Si("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ki=Si("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),xi=Object.create(null),Ri=[];for(let e of["()","[]","{}"]){let t=e.charCodeAt(0),i=e.charCodeAt(1);xi[t]=i,xi[i]=-t}function Ei(e){return e<=247?Ci[e]:1424<=e&&e<=1524?2:1536<=e&&e<=1785?ki[e-1536]:1774<=e&&e<=2220?4:8192<=e&&e<=8204?256:64336<=e&&e<=65023?4:1}const Di=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Ti{get dir(){return this.level%2?wi:bi}constructor(e,t,i){this.from=e,this.to=t,this.level=i}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,i,r){let s=-1;for(let n=0;n<e.length;n++){let o=e[n];if(o.from<=t&&o.to>=t){if(o.level==i)return n;(s<0||(0!=r?r<0?o.from<t:o.to>t:e[s].level>o.level))&&(s=n)}}if(s<0)throw new RangeError("Index out of range");return s}}function Mi(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],s=t[i];if(r.from!=s.from||r.to!=s.to||r.direction!=s.direction||!Mi(r.inner,s.inner))return!1}return!0}const Ai=[];function Oi(e,t,i,r,s,n,o){let a=r%2?2:1;if(r%2==s%2)for(let l=t,c=0;l<i;){let t=!0,h=!1;if(c==n.length||l<n[c].from){let e=Ai[l];e!=a&&(t=!1,h=16==e)}let u=t||1!=a?null:[],d=t?r:r+1,f=l;e:for(;;)if(c<n.length&&f==n[c].from){if(h)break e;let p=n[c];if(!t)for(let e=p.to,t=c+1;;){if(e==i)break e;if(!(t<n.length&&n[t].from==e)){if(Ai[e]==a)break e;break}e=n[t++].to}c++,u?u.push(p):(p.from>l&&o.push(new Ti(l,p.from,d)),Li(e,p.direction==bi!=!(d%2)?r+1:r,s,p.inner,p.from,p.to,o),l=p.to),f=p.to}else{if(f==i||(t?Ai[f]!=a:Ai[f]==a))break;f++}u?Oi(e,l,f,r+1,s,u,o):l<f&&o.push(new Ti(l,f,d)),l=f}else for(let l=i,c=n.length;l>t;){let i=!0,h=!1;if(!c||l>n[c-1].to){let e=Ai[l-1];e!=a&&(i=!1,h=16==e)}let u=i||1!=a?null:[],d=i?r:r+1,f=l;e:for(;;)if(c&&f==n[c-1].to){if(h)break e;let p=n[--c];if(!i)for(let e=p.from,i=c;;){if(e==t)break e;if(!i||n[i-1].to!=e){if(Ai[e-1]==a)break e;break}e=n[--i].from}u?u.push(p):(p.to<l&&o.push(new Ti(p.to,l,d)),Li(e,p.direction==bi!=!(d%2)?r+1:r,s,p.inner,p.from,p.to,o),l=p.from),f=p.from}else{if(f==t||(i?Ai[f-1]!=a:Ai[f-1]==a))break;f--}u?Oi(e,f,l,r+1,s,u,o):f<l&&o.push(new Ti(f,l,d)),l=f}}function Li(e,t,i,r,s,n,o){let a=t%2?2:1;!function(e,t,i,r,s){for(let n=0;n<=r.length;n++){let o=n?r[n-1].to:t,a=n<r.length?r[n].from:i,l=n?256:s;for(let t=o,i=l,r=l;t<a;t++){let s=Ei(e.charCodeAt(t));512==s?s=i:8==s&&4==r&&(s=16),Ai[t]=4==s?2:s,7&s&&(r=s),i=s}for(let e=o,t=l,r=l;e<a;e++){let s=Ai[e];if(128==s)e<a-1&&t==Ai[e+1]&&24&t?s=Ai[e]=t:Ai[e]=256;else if(64==s){let s=e+1;for(;s<a&&64==Ai[s];)s++;let n=e&&8==t||s<i&&8==Ai[s]?1==r?1:8:256;for(let t=e;t<s;t++)Ai[t]=n;e=s-1}else 8==s&&1==r&&(Ai[e]=1);t=s,7&s&&(r=s)}}}(e,s,n,r,a),function(e,t,i,r,s){let n=1==s?2:1;for(let o=0,a=0,l=0;o<=r.length;o++){let c=o?r[o-1].to:t,h=o<r.length?r[o].from:i;for(let t,i,r,o=c;o<h;o++)if(i=xi[t=e.charCodeAt(o)])if(i<0){for(let e=a-3;e>=0;e-=3)if(Ri[e+1]==-i){let t=Ri[e+2],i=2&t?s:4&t?1&t?n:s:0;i&&(Ai[o]=Ai[Ri[e]]=i),a=e;break}}else{if(189==Ri.length)break;Ri[a++]=o,Ri[a++]=t,Ri[a++]=l}else if(2==(r=Ai[o])||1==r){let e=r==s;l=e?0:1;for(let t=a-3;t>=0;t-=3){let i=Ri[t+2];if(2&i)break;if(e)Ri[t+2]|=2;else{if(4&i)break;Ri[t+2]|=4}}}}}(e,s,n,r,a),function(e,t,i,r){for(let s=0,n=r;s<=i.length;s++){let o=s?i[s-1].to:e,a=s<i.length?i[s].from:t;for(let l=o;l<a;){let o=Ai[l];if(256==o){let o=l+1;for(;;)if(o==a){if(s==i.length)break;o=i[s++].to,a=s<i.length?i[s].from:t}else{if(256!=Ai[o])break;o++}let c=1==n,h=c==(1==(o<t?Ai[o]:r))?c?1:2:r;for(let t=o,r=s,n=r?i[r-1].to:e;t>l;)t==n&&(t=i[--r].from,n=r?i[r-1].to:e),Ai[--t]=h;l=o}else n=o,l++}}}(s,n,r,a),Oi(e,s,n,t,i,r,o)}function Pi(e){return[new Ti(0,e,0)]}let Bi="";function Ii(e,t,i,r,s){var n;let o=r.head-e.from,a=Ti.find(t,o,null!==(n=r.bidiLevel)&&void 0!==n?n:-1,r.assoc),l=t[a],c=l.side(s,i);if(o==c){let e=a+=s?1:-1;if(e<0||e>=t.length)return null;l=t[a=e],o=l.side(!s,i),c=l.side(s,i)}let h=R(e.text,o,l.forward(s,i));(h<l.from||h>l.to)&&(h=c),Bi=e.text.slice(Math.min(o,h),Math.max(o,h));let u=a==(s?t.length-1:0)?null:t[a+(s?1:-1)];return u&&h==c&&u.level+(s?0:1)<l.level?W.cursor(u.side(!s,i)+e.from,u.forward(s,i)?1:-1,u.level):W.cursor(h+e.from,l.forward(s,i)?-1:1,l.level)}function Ni(e,t,i){for(let r=t;r<i;r++){let t=Ei(e.charCodeAt(r));if(1==t)return bi;if(2==t||4==t)return wi}return bi}const qi=z.define(),Hi=z.define(),Fi=z.define(),Wi=z.define(),ji=z.define(),$i=z.define(),zi=z.define(),Ui=z.define(),Vi=z.define(),Ki=z.define({combine:e=>e.some((e=>e))}),Gi=z.define({combine:e=>e.some((e=>e))}),Ji=z.define();class Xi{constructor(e,t="nearest",i="nearest",r=5,s=5,n=!1){this.range=e,this.y=t,this.x=i,this.yMargin=r,this.xMargin=s,this.isSnapshot=n}map(e){return e.empty?this:new Xi(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new Xi(W.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Yi=me.define({map:(e,t)=>e.map(t)}),Zi=me.define();function Qi(e,t,i){let r=e.facet(Wi);r.length?r[0](t):window.onerror&&window.onerror(String(t),i,void 0,void 0,t)||(i?console.error(i+":",t):console.error(t))}const er=z.define({combine:e=>!e.length||e[0]});let tr=0;const ir=z.define({combine:e=>e.filter(((t,i)=>{for(let r=0;r<i;r++)if(e[r].plugin==t.plugin)return!1;return!0}))});class rr{constructor(e,t,i,r,s){this.id=e,this.create=t,this.domEventHandlers=i,this.domEventObservers=r,this.baseExtensions=s(this),this.extension=this.baseExtensions.concat(ir.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(ir.of({plugin:this,arg:e}))}static define(e,t){const{eventHandlers:i,eventObservers:r,provide:s,decorations:n}=t||{};return new rr(tr++,e,i,r,(e=>{let t=[];return n&&t.push(ar.of((t=>{let i=t.plugin(e);return i?n(i):ai.none}))),s&&t.push(s(e)),t}))}static fromClass(e,t){return rr.define(((t,i)=>new e(t,i)),t)}}class sr{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(t){if(Qi(e.state,t,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(e){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){Qi(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(null===(t=this.value)||void 0===t?void 0:t.destroy)try{this.value.destroy()}catch(t){Qi(e.state,t,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const nr=z.define(),or=z.define(),ar=z.define(),lr=z.define(),cr=z.define(),hr=z.define();function ur(e,t){let i=e.state.facet(hr);if(!i.length)return i;let r=i.map((t=>t instanceof Function?t(e):t)),s=[];return Le.spans(r,t.from,t.to,{point(){},span(e,i,r,n){let o=e-t.from,a=i-t.from,l=s;for(let e=r.length-1;e>=0;e--,n--){let i,s=r[e].spec.bidiIsolate;if(null==s&&(s=Ni(t.text,o,a)),n>0&&l.length&&(i=l[l.length-1]).to==o&&i.direction==s)i.to=a,l=i.inner;else{let e={from:o,to:a,direction:s,inner:[]};l.push(e),l=e.inner}}}}),s}const dr=z.define();function fr(e){let t=0,i=0,r=0,s=0;for(let n of e.state.facet(dr)){let o=n(e);o&&(null!=o.left&&(t=Math.max(t,o.left)),null!=o.right&&(i=Math.max(i,o.right)),null!=o.top&&(r=Math.max(r,o.top)),null!=o.bottom&&(s=Math.max(s,o.bottom)))}return{left:t,right:i,top:r,bottom:s}}const pr=z.define();class gr{constructor(e,t,i,r){this.fromA=e,this.toA=t,this.fromB=i,this.toB=r}join(e){return new gr(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let r=e[t-1];if(!(r.fromA>i.toA)){if(r.toA<i.fromA)break;i=i.join(r),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(0==t.length)return e;let i=[];for(let r=0,s=0,n=0,o=0;;r++){let a=r==e.length?null:e[r],l=n-o,c=a?a.fromB:1e9;for(;s<t.length&&t[s]<c;){let e=t[s],r=t[s+1],n=Math.max(o,e),a=Math.min(c,r);if(n<=a&&new gr(n+l,a+l,n,a).addToSet(i),r>c)break;s+=2}if(!a)return i;new gr(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),n=a.toA,o=a.toB}}}class mr{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=L.empty(this.startState.doc.length);for(let e of i)this.changes=this.changes.compose(e.changes);let r=[];this.changes.iterChangedRanges(((e,t,i,s)=>r.push(new gr(e,t,i,s)))),this.changedRanges=r}static create(e,t,i){return new mr(e,t,i)}get viewportChanged(){return(4&this.flags)>0}get viewportMoved(){return(8&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(18&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((e=>e.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}class vr extends Tt{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=ai.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new fi],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new gr(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every((({fromA:e,toA:t})=>t<this.minWidthFrom||e>this.minWidthTo))?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let r=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&((null===(t=this.domChanged)||void 0===t?void 0:t.newSel)?r=this.domChanged.newSel.head:function(e,t){let i=!1;return t&&e.iterChangedRanges(((e,r)=>{e<t.to&&r>t.from&&(i=!0)})),i}(e.changes,this.hasComposition)||e.selectionSet||(r=e.state.selection.main.head));let s=r>-1?function(e,t,i){let r=_r(e,i);if(!r)return null;let{node:s,from:n,to:o}=r,a=s.nodeValue;if(/[\n\r]/.test(a))return null;if(e.state.doc.sliceString(r.from,r.to)!=a)return null;let l=t.invertedDesc,c=new gr(l.mapPos(n),l.mapPos(o),n,o),h=[];for(let t=s.parentNode;;t=t.parentNode){let i=Tt.get(t);if(i instanceof Kt)h.push({node:t,deco:i.mark});else{if(i instanceof fi||"DIV"==t.nodeName&&t.parentNode==e.contentDOM)return{range:c,text:s,marks:h,line:t};if(t==e.contentDOM)return null;h.push({node:t,deco:new li({inclusive:!0,attributes:si(t),tagName:t.tagName.toLowerCase()})})}}}(this.view,e.changes,r):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:t,to:r}=this.hasComposition;i=new gr(t,r,e.changes.mapPos(t,-1),e.changes.mapPos(r,1)).addToSet(i.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,(Ut.ie||Ut.chrome)&&!s&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let n=function(e,t,i){let r=new yr;return Le.compare(e,t,i,r),r.changes}(this.decorations,this.updateDeco(),e.changes);return i=gr.extendWithRanges(i,n),!!(7&this.flags||0!=i.length)&&(this.updateInner(i,e.startState.doc.length,s),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,i);let{observer:r}=this.view;r.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let e=Ut.chrome||Ut.ios?{node:r.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,e),this.flags&=-8,e&&(e.written||r.selectionRange.focusNode!=e.node)&&(this.forceSelection=!0),this.dom.style.height=""})),this.markedForComposition.forEach((e=>e.flags&=-9));let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let e of this.children)e instanceof pi&&e.widget instanceof gi&&s.push(e.dom);r.updateGaps(s)}updateChildren(e,t,i){let r=i?i.range.addToSet(e.slice()):e,s=this.childCursor(t);for(let e=r.length-1;;e--){let t=e>=0?r[e]:null;if(!t)break;let n,o,a,l,{fromA:c,toA:h,fromB:u,toB:d}=t;if(i&&i.range.fromB<d&&i.range.toB>u){let e=mi.build(this.view.state.doc,u,i.range.fromB,this.decorations,this.dynamicDecorationMap),t=mi.build(this.view.state.doc,i.range.toB,d,this.decorations,this.dynamicDecorationMap);o=e.breakAtStart,a=e.openStart,l=t.openEnd;let r=this.compositionView(i);t.breakAtStart?r.breakAfter=1:t.content.length&&r.merge(r.length,r.length,t.content[0],!1,t.openStart,0)&&(r.breakAfter=t.content[0].breakAfter,t.content.shift()),e.content.length&&r.merge(0,0,e.content[e.content.length-1],!0,0,e.openEnd)&&e.content.pop(),n=e.content.concat(r).concat(t.content)}else({content:n,breakAtStart:o,openStart:a,openEnd:l}=mi.build(this.view.state.doc,u,d,this.decorations,this.dynamicDecorationMap));let{i:f,off:p}=s.findPos(h,1),{i:g,off:m}=s.findPos(c,-1);Ot(this,g,m,f,p,n,o,a,l)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let e of t.effects)e.is(Zi)&&(this.editContextFormatting=e.value)}compositionView(e){let t=new Vt(e.text.nodeValue);t.flags|=8;for(let{deco:i}of e.marks)t=new Kt(i,[t],t.length);let i=new fi;return i.append(t,0),i}fixCompositionDOM(e){let t=(e,t)=>{t.flags|=8|(t.children.some((e=>7&e.flags))?1:0),this.markedForComposition.add(t);let i=Tt.get(e);i&&i!=t&&(i.dom=null),t.setDOM(e)},i=this.childPos(e.range.fromB,1),r=this.children[i.i];t(e.line,r);for(let s=e.marks.length-1;s>=-1;s--)i=r.childPos(i.off,1),r=r.children[i.i],t(s>=0?e.marks[s].node:e.text,r)}updateSelection(e=!1,t=!1){!e&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange();let i=this.view.root.activeElement,r=i==this.dom,s=!r&&!(this.view.state.facet(er)||this.dom.tabIndex>-1)&&at(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(r||t||s))return;let n=this.forceSelection;this.forceSelection=!1;let o=this.view.state.selection.main,a=this.moveToLine(this.domAtPos(o.anchor)),l=o.empty?a:this.moveToLine(this.domAtPos(o.head));if(Ut.gecko&&o.empty&&!this.hasComposition&&1==(c=a).node.nodeType&&c.node.firstChild&&(0==c.offset||"false"==c.node.childNodes[c.offset-1].contentEditable)&&(c.offset==c.node.childNodes.length||"false"==c.node.childNodes[c.offset].contentEditable)){let e=document.createTextNode("");this.view.observer.ignore((()=>a.node.insertBefore(e,a.node.childNodes[a.offset]||null))),a=l=new Et(e,0),n=!0}var c;let h=this.view.observer.selectionRange;!n&&h.focusNode&&(ct(a.node,a.offset,h.anchorNode,h.anchorOffset)&&ct(l.node,l.offset,h.focusNode,h.focusOffset)||this.suppressWidgetCursorChange(h,o))||(this.view.observer.ignore((()=>{Ut.android&&Ut.chrome&&this.dom.contains(h.focusNode)&&function(e,t){for(let i=e;i&&i!=t;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let e=nt(this.view.root);if(e)if(o.empty){if(Ut.gecko){let e=(t=a.node,r=a.offset,1!=t.nodeType?0:(r&&"false"==t.childNodes[r-1].contentEditable?1:0)|(r<t.childNodes.length&&"false"==t.childNodes[r].contentEditable?2:0));if(e&&3!=e){let t=(1==e?xt:Rt)(a.node,a.offset);t&&(a=new Et(t.node,t.offset))}}e.collapse(a.node,a.offset),null!=o.bidiLevel&&void 0!==e.caretBidiLevel&&(e.caretBidiLevel=o.bidiLevel)}else if(e.extend){e.collapse(a.node,a.offset);try{e.extend(l.node,l.offset)}catch(e){}}else{let t=document.createRange();o.anchor>o.head&&([a,l]=[l,a]),t.setEnd(l.node,l.offset),t.setStart(a.node,a.offset),e.removeAllRanges(),e.addRange(t)}var t,r;s&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())})),this.view.observer.setSelectionRange(a,l)),this.impreciseAnchor=a.precise?null:new Et(h.anchorNode,h.anchorOffset),this.impreciseHead=l.precise?null:new Et(h.focusNode,h.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&ct(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,i=nt(e.root),{anchorNode:r,anchorOffset:s}=e.observer.selectionRange;if(!(i&&t.empty&&t.assoc&&i.modify))return;let n=fi.find(this,t.head);if(!n)return;let o=n.posAtStart;if(t.head==o||t.head==o+n.length)return;let a=this.coordsAt(t.head,-1),l=this.coordsAt(t.head,1);if(!a||!l||a.bottom>l.top)return;let c=this.domAtPos(t.head+t.assoc);i.collapse(c.node,c.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let h=e.observer.selectionRange;e.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=t.from&&i.collapse(r,s)}moveToLine(e){let t,i=this.dom;if(e.node!=i)return e;for(let r=e.offset;!t&&r<i.childNodes.length;r++){let e=Tt.get(i.childNodes[r]);e instanceof fi&&(t=e.domAtPos(0))}for(let r=e.offset-1;!t&&r>=0;r--){let e=Tt.get(i.childNodes[r]);e instanceof fi&&(t=e.domAtPos(e.length))}return t?new Et(t.node,t.offset,!0):e}nearest(e){for(let t=e;t;){let e=Tt.get(t);if(e&&e.rootView==this)return e;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let e=this.children[t];if(i<e.length||e instanceof fi)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){let i=null,r=0;for(let s=this.length,n=this.children.length-1;n>=0;n--){let o=this.children[n],a=s-o.breakAfter,l=a-o.length;if(a<e)break;if(l<=e&&(l<e||o.covers(-1))&&(a>e||o.covers(1))&&(!i||o instanceof fi&&!(i instanceof fi&&t>=0)))i=o,r=l;else if(i&&l==e&&a==e&&o instanceof pi&&Math.abs(t)<2){if(o.deco.startSide<0)break;n&&(i=null)}s=l}return i?i.coordsAt(e-r,t):null}coordsForChar(e){let{i:t,off:i}=this.childPos(e,1),r=this.children[t];if(!(r instanceof fi))return null;for(;r.children.length;){let{i:e,off:t}=r.childPos(i,1);for(;;e++){if(e==r.children.length)return null;if((r=r.children[e]).length)break}i=t}if(!(r instanceof Vt))return null;let s=R(r.text,i);if(s==i)return null;let n=wt(r.dom,i,s).getClientRects();for(let e=0;e<n.length;e++){let t=n[e];if(e==n.length-1||t.top<t.bottom&&t.left<t.right)return t}return null}measureVisibleLineHeights(e){let t=[],{from:i,to:r}=e,s=this.view.contentDOM.clientWidth,n=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,a=this.view.textDirection==yi.LTR;for(let e=0,l=0;l<this.children.length;l++){let c=this.children[l],h=e+c.length;if(h>r)break;if(e>=i){let i=c.dom.getBoundingClientRect();if(t.push(i.height),n){let t=c.dom.lastChild,r=t?lt(t):[];if(r.length){let t=r[r.length-1],n=a?t.right-i.left:i.right-t.left;n>o&&(o=n,this.minWidth=s,this.minWidthFrom=e,this.minWidthTo=h)}}}e=h+c.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return"rtl"==getComputedStyle(this.children[t].dom).direction?yi.RTL:yi.LTR}measureTextSize(){for(let e of this.children)if(e instanceof fi){let t=e.measureTextSize();if(t)return t}let e,t,i,r=document.createElement("div");return r.className="cm-line",r.style.width="99999px",r.style.position="absolute",r.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(r);let s=lt(r.firstChild)[0];e=r.getBoundingClientRect().height,t=s?s.width/27:7,i=s?s.height:e,r.remove()})),{lineHeight:e,charWidth:t,textHeight:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new At(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,r=0;;r++){let s=r==t.viewports.length?null:t.viewports[r],n=s?s.from-1:this.length;if(n>i){let r=(t.lineBlockAt(n).bottom-t.lineBlockAt(i).top)/this.view.scaleY;e.push(ai.replace({widget:new gi(r),block:!0,inclusive:!0,isBlockGap:!0}).range(i,n))}if(!s)break;i=s.to+1}return ai.set(e)}updateDeco(){let e=1,t=this.view.state.facet(ar).map((t=>(this.dynamicDecorationMap[e++]="function"==typeof t)?t(this.view):t)),i=!1,r=this.view.state.facet(lr).map(((e,t)=>{let r="function"==typeof e;return r&&(i=!0),r?e(this.view):e}));for(r.length&&(this.dynamicDecorationMap[e++]=i,t.push(Le.join(r))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let t=this.view.viewState.lineBlockAt(e.range.head);return this.view.scrollDOM.scrollTop=t.top-e.yMargin,void(this.view.scrollDOM.scrollLeft=e.xMargin)}for(let t of this.view.state.facet(Ji))try{if(t(this.view,e.range,e))return!0}catch(e){Qi(this.view.state,e,"scroll handler")}let t,{range:i}=e,r=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!r)return;!i.empty&&(t=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(r={left:Math.min(r.left,t.left),top:Math.min(r.top,t.top),right:Math.max(r.right,t.right),bottom:Math.max(r.bottom,t.bottom)});let s=fr(this.view),n={left:r.left-s.left,top:r.top-s.top,right:r.right+s.right,bottom:r.bottom+s.bottom},{offsetWidth:o,offsetHeight:a}=this.view.scrollDOM;!function(e,t,i,r,s,n,o,a){let l=e.ownerDocument,c=l.defaultView||window;for(let h=e,u=!1;h&&!u;)if(1==h.nodeType){let e,d=h==l.body,f=1,p=1;if(d)e=gt(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(h).position)&&(u=!0),h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.assignedSlot||h.parentNode;continue}let t=h.getBoundingClientRect();({scaleX:f,scaleY:p}=mt(h,t)),e={left:t.left,right:t.left+h.clientWidth*f,top:t.top,bottom:t.top+h.clientHeight*p}}let g=0,m=0;if("nearest"==s)t.top<e.top?(m=t.top-(e.top+o),i>0&&t.bottom>e.bottom+m&&(m=t.bottom-e.bottom+o)):t.bottom>e.bottom&&(m=t.bottom-e.bottom+o,i<0&&t.top-m<e.top&&(m=t.top-(e.top+o)));else{let r=t.bottom-t.top,n=e.bottom-e.top;m=("center"==s&&r<=n?t.top+r/2-n/2:"start"==s||"center"==s&&i<0?t.top-o:t.bottom-n+o)-e.top}if("nearest"==r?t.left<e.left?(g=t.left-(e.left+n),i>0&&t.right>e.right+g&&(g=t.right-e.right+n)):t.right>e.right&&(g=t.right-e.right+n,i<0&&t.left<e.left+g&&(g=t.left-(e.left+n))):g=("center"==r?t.left+(t.right-t.left)/2-(e.right-e.left)/2:"start"==r==a?t.left-n:t.right-(e.right-e.left)+n)-e.left,g||m)if(d)c.scrollBy(g,m);else{let e=0,i=0;if(m){let e=h.scrollTop;h.scrollTop+=m/p,i=(h.scrollTop-e)*p}if(g){let t=h.scrollLeft;h.scrollLeft+=g/f,e=(h.scrollLeft-t)*f}t={left:t.left-e,top:t.top-i,right:t.right-e,bottom:t.bottom-i},e&&Math.abs(e-g)<1&&(r="nearest"),i&&Math.abs(i-m)<1&&(s="nearest")}if(d)break;(t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right)&&(t={left:Math.max(t.left,e.left),right:Math.min(t.right,e.right),top:Math.max(t.top,e.top),bottom:Math.min(t.bottom,e.bottom)}),h=h.assignedSlot||h.parentNode}else{if(11!=h.nodeType)break;h=h.host}}(this.view.scrollDOM,n,i.head<i.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,o),-o),Math.max(Math.min(e.yMargin,a),-a),this.view.textDirection==yi.LTR)}}function _r(e,t){let i=e.observer.selectionRange;if(!i.focusNode)return null;let r=xt(i.focusNode,i.focusOffset),s=Rt(i.focusNode,i.focusOffset),n=r||s;if(s&&r&&s.node!=r.node){let t=Tt.get(s.node);if(!t||t instanceof Vt&&t.text!=s.node.nodeValue)n=s;else if(e.docView.lastCompositionAfterCursor){let e=Tt.get(r.node);!e||e instanceof Vt&&e.text!=r.node.nodeValue||(n=s)}}if(e.docView.lastCompositionAfterCursor=n!=r,!n)return null;let o=t-n.offset;return{from:o,to:o+n.node.nodeValue.length,node:n.node}}let yr=class{constructor(){this.changes=[]}compareRange(e,t){di(e,t,this.changes)}comparePoint(e,t){di(e,t,this.changes)}boundChange(e){di(e,e,this.changes)}};function br(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function wr(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function Sr(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function Cr(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function kr(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function xr(e,t,i){let r,s,n,o,a,l,c,h,u=!1;for(let d=e.firstChild;d;d=d.nextSibling){let e=lt(d);for(let f=0;f<e.length;f++){let p=e[f];s&&Sr(s,p)&&(p=Cr(kr(p,s.bottom),s.top));let g=br(t,p),m=wr(i,p);if(0==g&&0==m)return 3==d.nodeType?Rr(d,t,i):xr(d,t,i);if(!r||o>m||o==m&&n>g){r=d,s=p,n=g,o=m;let a=m?i<p.top?-1:1:g?t<p.left?-1:1:0;u=!a||(a>0?f<e.length-1:f>0)}0==g?i>p.bottom&&(!c||c.bottom<p.bottom)?(a=d,c=p):i<p.top&&(!h||h.top>p.top)&&(l=d,h=p):c&&Sr(c,p)?c=kr(c,p.bottom):h&&Sr(h,p)&&(h=Cr(h,p.top))}}if(c&&c.bottom>=i?(r=a,s=c):h&&h.top<=i&&(r=l,s=h),!r)return{node:e,offset:0};let d=Math.max(s.left,Math.min(s.right,t));return 3==r.nodeType?Rr(r,d,i):u&&"false"!=r.contentEditable?xr(r,d,i):{node:e,offset:Array.prototype.indexOf.call(e.childNodes,r)+(t>=(s.left+s.right)/2?1:0)}}function Rr(e,t,i){let r=e.nodeValue.length,s=-1,n=1e9,o=0;for(let a=0;a<r;a++){let r=wt(e,a,a+1).getClientRects();for(let l=0;l<r.length;l++){let c=r[l];if(c.top==c.bottom)continue;o||(o=t-c.left);let h=(c.top>i?c.top-i:i-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&h<n){let i=t>=(c.left+c.right)/2,r=i;if((Ut.chrome||Ut.gecko)&&wt(e,a).getBoundingClientRect().left==c.right&&(r=!i),h<=0)return{node:e,offset:a+(r?1:0)};s=a+(r?1:0),n=h}}}return{node:e,offset:s>-1?s:o>0?e.nodeValue.length:0}}function Er(e,t,i,r=-1){var s,n;let o,a=e.contentDOM.getBoundingClientRect(),l=a.top+e.viewState.paddingTop,{docHeight:c}=e.viewState,{x:h,y:u}=t,d=u-l;if(d<0)return 0;if(d>c)return e.state.doc.length;for(let t=e.viewState.heightOracle.textHeight/2,s=!1;o=e.elementAtHeight(d),o.type!=oi.Text;)for(;d=r>0?o.bottom+t:o.top-t,!(d>=0&&d<=c);){if(s)return i?null:0;s=!0,r=-r}u=l+d;let f=o.from;if(f<e.viewport.from)return 0==e.viewport.from?0:i?null:Dr(e,a,o,h,u);if(f>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:i?null:Dr(e,a,o,h,u);let p=e.dom.ownerDocument,g=e.root.elementFromPoint?e.root:p,m=g.elementFromPoint(h,u);m&&!e.contentDOM.contains(m)&&(m=null),m||(h=Math.max(a.left+1,Math.min(a.right-1,h)),m=g.elementFromPoint(h,u),m&&!e.contentDOM.contains(m)&&(m=null));let v,_=-1;if(m&&0!=(null===(s=e.docView.nearest(m))||void 0===s?void 0:s.isEditable)){if(p.caretPositionFromPoint){let e=p.caretPositionFromPoint(h,u);e&&({offsetNode:v,offset:_}=e)}else if(p.caretRangeFromPoint){let t=p.caretRangeFromPoint(h,u);t&&(({startContainer:v,startOffset:_}=t),(!e.contentDOM.contains(v)||Ut.safari&&function(e,t,i){let r;if(3!=e.nodeType||t!=(r=e.nodeValue.length))return!1;for(let t=e.nextSibling;t;t=t.nextSibling)if(1!=t.nodeType||"BR"!=t.nodeName)return!1;return wt(e,r-1,r).getBoundingClientRect().left>i}(v,_,h)||Ut.chrome&&function(e,t,i){if(0!=t)return!1;for(let t=e;;){let e=t.parentNode;if(!e||1!=e.nodeType||e.firstChild!=t)return!1;if(e.classList.contains("cm-line"))break;t=e}return i-(1==e.nodeType?e.getBoundingClientRect():wt(e,0,Math.max(e.nodeValue.length,1)).getBoundingClientRect()).left>5}(v,_,h))&&(v=void 0))}v&&(_=Math.min(ft(v),_))}if(!v||!e.docView.dom.contains(v)){let t=fi.find(e.docView,f);if(!t)return d>o.top+o.height/2?o.to:o.from;({node:v,offset:_}=xr(t.dom,h,u))}let y=e.docView.nearest(v);if(!y)return null;if(y.isWidget&&1==(null===(n=y.dom)||void 0===n?void 0:n.nodeType)){let e=y.dom.getBoundingClientRect();return t.y<e.top||t.y<=e.bottom&&t.x<=(e.left+e.right)/2?y.posAtStart:y.posAtEnd}return y.localPosFromDOM(v,_)+y.posAtStart}function Dr(e,t,i,r,s){let n=Math.round((r-t.left)*e.defaultCharacterWidth);if(e.lineWrapping&&i.height>1.5*e.defaultLineHeight){let t=e.viewState.heightOracle.textHeight;n+=Math.floor((s-i.top-.5*(e.defaultLineHeight-t))/t)*e.viewState.heightOracle.lineLength}let o=e.state.sliceDoc(i.from,i.to);return i.from+Ve(o,n,e.state.tabSize)}function Tr(e,t,i){let r=e.lineBlockAt(t);if(Array.isArray(r.type)){let e;for(let s of r.type){if(s.from>t)break;if(!(s.to<t)){if(s.from<t&&s.to>t)return s;e&&(s.type!=oi.Text||e.type==s.type&&!(i<0?s.from<t:s.to>t))||(e=s)}}return e||r}return r}function Mr(e,t,i,r){let s=e.state.doc.lineAt(t.head),n=e.bidiSpans(s),o=e.textDirectionAt(s.from);for(let a=t,l=null;;){let t=Ii(s,n,o,a,i),c=Bi;if(!t){if(s.number==(i?e.state.doc.lines:1))return a;c="\n",s=e.state.doc.line(s.number+(i?1:-1)),n=e.bidiSpans(s),t=e.visualLineSide(s,!i)}if(l){if(!l(c))return a}else{if(!r)return t;l=r(c)}a=t}}function Ar(e,t,i){for(;;){let r=0;for(let s of e)s.between(t-1,t+1,((e,s,n)=>{if(t>e&&t<s){let n=r||i||(t-e<s-t?-1:1);t=n<0?e:s,r=n}}));if(!r)return t}}function Or(e,t,i){let r=Ar(e.state.facet(cr).map((t=>t(e))),i.from,t.head>i.from?-1:1);return r==i.from?i:W.cursor(r,r<i.from?1:-1)}const Lr="";class Pr{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(Ee.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Lr}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let r=e;;){this.findPointBefore(i,r);let e=this.text.length;this.readNode(r);let s=r.nextSibling;if(s==t)break;let n=Tt.get(r),o=Tt.get(s);(n&&o?n.breakAfter:(n?n.breakAfter:ut(r))||ut(s)&&("BR"!=r.nodeName||r.cmIgnore)&&this.text.length>e)&&this.lineBreak(),r=s}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,r=this.lineSeparator?null:/\r\n?|\n/g;;){let s,n=-1,o=1;if(this.lineSeparator?(n=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=r.exec(t))&&(n=s.index,o=s[0].length),this.append(t.slice(i,n<0?t.length:n)),n<0)break;if(this.lineBreak(),o>1)for(let t of this.points)t.node==e&&t.pos>this.text.length&&(t.pos-=o-1);i=n+o}}readNode(e){if(e.cmIgnore)return;let t=Tt.get(e),i=t&&t.overrideDOMText;if(null!=i){this.findPointInside(e,i.length);for(let e=i.iter();!e.next().done;)e.lineBreak?this.lineBreak():this.append(e.value)}else 3==e.nodeType?this.readTextNode(e):"BR"==e.nodeName?e.nextSibling&&this.lineBreak():1==e.nodeType&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(3==e.nodeType?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+(Br(e,i.node,i.offset)?t:0))}}function Br(e,t,i){for(;;){if(!t||i<ft(t))return!1;if(t==e)return!0;i=ht(t)+1,t=t.parentNode}}class Ir{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class Nr{constructor(e,t,i,r){this.typeOver=r,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:s,impreciseAnchor:n}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,i,0))){let t=s||n?[]:function(e){let t=[];if(e.root.activeElement!=e.contentDOM)return t;let{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:n}=e.observer.selectionRange;return i&&(t.push(new Ir(i,r)),s==i&&n==r||t.push(new Ir(s,n))),t}(e),i=new Pr(t,e.state);i.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=i.text,this.newSel=function(e,t){if(0==e.length)return null;let i=e[0].pos,r=2==e.length?e[1].pos:i;return i>-1&&r>-1?W.single(i+t,r+t):null}(t,this.bounds.from)}else{let t=e.observer.selectionRange,i=s&&s.node==t.focusNode&&s.offset==t.focusOffset||!ot(e.contentDOM,t.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(t.focusNode,t.focusOffset),r=n&&n.node==t.anchorNode&&n.offset==t.anchorOffset||!ot(e.contentDOM,t.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(t.anchorNode,t.anchorOffset),o=e.viewport;if((Ut.ios||Ut.chrome)&&e.state.selection.main.empty&&i!=r&&(o.from>0||o.to<e.state.doc.length)){let t=Math.min(i,r),s=Math.max(i,r),n=o.from-t,a=o.to-s;0!=n&&1!=n&&0!=t||0!=a&&-1!=a&&s!=e.state.doc.length||(i=0,r=e.state.doc.length)}this.newSel=W.single(r,i)}}}function qr(e,t){let i,{newSel:r}=t,s=e.state.selection.main,n=e.inputState.lastKeyTime>Date.now()-100?e.inputState.lastKeyCode:-1;if(t.bounds){let{from:r,to:o}=t.bounds,a=s.from,l=null;(8===n||Ut.android&&t.text.length<o-r)&&(a=s.to,l="end");let c=function(e,t,i,r){let s=Math.min(e.length,t.length),n=0;for(;n<s&&e.charCodeAt(n)==t.charCodeAt(n);)n++;if(n==s&&e.length==t.length)return null;let o=e.length,a=t.length;for(;o>0&&a>0&&e.charCodeAt(o-1)==t.charCodeAt(a-1);)o--,a--;return"end"==r&&(i-=o+Math.max(0,n-Math.min(o,a))-n),o<n&&e.length<t.length?(n-=i<=n&&i>=o?n-i:0,a=n+(a-o),o=n):a<n&&(n-=i<=n&&i>=a?n-i:0,o=n+(o-a),a=n),{from:n,toA:o,toB:a}}(e.state.doc.sliceString(r,o,Lr),t.text,a-r,l);c&&(Ut.chrome&&13==n&&c.toB==c.from+2&&t.text.slice(c.from,c.toB)==Lr+Lr&&c.toB--,i={from:r+c.from,to:r+c.toA,insert:m.of(t.text.slice(c.from,c.toB).split(Lr))})}else r&&(!e.hasFocus&&e.state.facet(er)||r.main.eq(s))&&(r=null);if(!i&&!r)return!1;if(!i&&t.typeOver&&!s.empty&&r&&r.main.empty?i={from:s.from,to:s.to,insert:e.state.doc.slice(s.from,s.to)}:(Ut.mac||Ut.android)&&i&&i.from==i.to&&i.from==s.head-1&&/^\. ?$/.test(i.insert.toString())&&"off"==e.contentDOM.getAttribute("autocorrect")?(r&&2==i.insert.length&&(r=W.single(r.main.anchor-1,r.main.head-1)),i={from:i.from,to:i.to,insert:m.of([i.insert.toString().replace("."," ")])}):i&&i.from>=s.from&&i.to<=s.to&&(i.from!=s.from||i.to!=s.to)&&s.to-s.from-(i.to-i.from)<=4?i={from:s.from,to:s.to,insert:e.state.doc.slice(s.from,i.from).append(i.insert).append(e.state.doc.slice(i.to,s.to))}:Ut.chrome&&i&&i.from==i.to&&i.from==s.head&&"\n "==i.insert.toString()&&e.lineWrapping&&(r&&(r=W.single(r.main.anchor-1,r.main.head-1)),i={from:s.from,to:s.to,insert:m.of([" "])}),i)return Hr(e,i,r,n);if(r&&!r.main.eq(s)){let t=!1,i="select";return e.inputState.lastSelectionTime>Date.now()-50&&("select"==e.inputState.lastSelectionOrigin&&(t=!0),i=e.inputState.lastSelectionOrigin),e.dispatch({selection:r,scrollIntoView:t,userEvent:i}),!0}return!1}function Hr(e,t,i,r=-1){if(Ut.ios&&e.inputState.flushIOSKey(t))return!0;let s=e.state.selection.main;if(Ut.android&&(t.to==s.to&&(t.from==s.from||t.from==s.from-1&&" "==e.state.sliceDoc(t.from,s.from))&&1==t.insert.length&&2==t.insert.lines&&St(e.contentDOM,"Enter",13)||(t.from==s.from-1&&t.to==s.to&&0==t.insert.length||8==r&&t.insert.length<t.to-t.from&&t.to>s.head)&&St(e.contentDOM,"Backspace",8)||t.from==s.from&&t.to==s.to+1&&0==t.insert.length&&St(e.contentDOM,"Delete",46)))return!0;let n,o=t.insert.toString();e.inputState.composing>=0&&e.inputState.composing++;let a=()=>n||(n=function(e,t,i){let r,s=e.state,n=s.selection.main;if(t.from>=n.from&&t.to<=n.to&&t.to-t.from>=(n.to-n.from)/3&&(!i||i.main.empty&&i.main.from==t.from+t.insert.length)&&e.inputState.composing<0){let i=n.from<t.from?s.sliceDoc(n.from,t.from):"",o=n.to>t.to?s.sliceDoc(t.to,n.to):"";r=s.replaceSelection(e.state.toText(i+t.insert.sliceString(0,void 0,e.state.lineBreak)+o))}else{let o=s.changes(t),a=i&&i.main.to<=o.newLength?i.main:void 0;if(s.selection.ranges.length>1&&e.inputState.composing>=0&&t.to<=n.to&&t.to>=n.to-10){let l,c=e.state.sliceDoc(t.from,t.to),h=i&&_r(e,i.main.head);if(h){let e=t.insert.length-(t.to-t.from);l={from:h.from,to:h.to-e}}else l=e.state.doc.lineAt(n.head);let u=n.to-t.to,d=n.to-n.from;r=s.changeByRange((i=>{if(i.from==n.from&&i.to==n.to)return{changes:o,range:a||i.map(o)};let r=i.to-u,h=r-c.length;if(i.to-i.from!=d||e.state.sliceDoc(h,r)!=c||i.to>=l.from&&i.from<=l.to)return{range:i};let f=s.changes({from:h,to:r,insert:t.insert}),p=i.to-n.to;return{changes:f,range:a?W.range(Math.max(0,a.anchor+p),Math.max(0,a.head+p)):i.map(f)}}))}else r={changes:o,selection:a&&s.selection.replaceRange(a)}}let o="input.type";return(e.composing||e.inputState.compositionPendingChange&&e.inputState.compositionEndedAt>Date.now()-50)&&(e.inputState.compositionPendingChange=!1,o+=".compose",e.inputState.compositionFirstChange&&(o+=".start",e.inputState.compositionFirstChange=!1)),s.update(r,{userEvent:o,scrollIntoView:!0})}(e,t,i));return e.state.facet($i).some((i=>i(e,t.from,t.to,o,a)))||e.dispatch(a()),!0}class Fr{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,Ut.safari&&e.contentDOM.addEventListener("input",(()=>null)),Ut.gecko&&function(e){fs.has(e)||(fs.add(e),e.addEventListener("copy",(()=>{})),e.addEventListener("cut",(()=>{})))}(e.contentDOM.ownerDocument)}handleEvent(e){(function(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let i,r=t.target;r!=e.contentDOM;r=r.parentNode)if(!r||11==r.nodeType||(i=Tt.get(r))&&i.ignoreEvent(t))return!1;return!0})(this.view,e)&&!this.ignoreDuringComposition(e)&&("keydown"==e.type&&this.keydown(e)||(0!=this.view.updateState?Promise.resolve().then((()=>this.runHandlers(e.type,e))):this.runHandlers(e.type,e)))}runHandlers(e,t){let i=this.handlers[e];if(i){for(let e of i.observers)e(this.view,t);for(let e of i.handlers){if(t.defaultPrevented)break;if(e(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=jr(e),i=this.handlers,r=this.view.contentDOM;for(let e in t)if("scroll"!=e){let s=!t[e].handlers.length,n=i[e];n&&s!=!n.handlers.length&&(r.removeEventListener(e,this.handleEvent),n=null),n||r.addEventListener(e,this.handleEvent,{passive:s})}for(let e in i)"scroll"==e||t[e]||r.removeEventListener(e,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&27!=e.keyCode&&Ur.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),Ut.android&&Ut.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return!Ut.ios||e.synthetic||e.altKey||e.metaKey||!((t=$r.find((t=>t.keyCode==e.keyCode)))&&!e.ctrlKey||zr.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(229!=e.keyCode&&this.view.observer.forceFlush(),!1):(this.pendingIOSKey=t||e,setTimeout((()=>this.flushIOSKey()),250),!0)}flushIOSKey(e){let t=this.pendingIOSKey;return!!t&&!("Enter"==t.key&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString()))&&(this.pendingIOSKey=void 0,St(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!!/^key/.test(e.type)&&(this.composing>0||!!(Ut.safari&&!Ut.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100)&&(this.compositionPendingKey=!1,!0))}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function Wr(e,t){return(i,r)=>{try{return t.call(e,r,i)}catch(e){Qi(i.state,e)}}}function jr(e){let t=Object.create(null);function i(e){return t[e]||(t[e]={observers:[],handlers:[]})}for(let t of e){let e=t.spec,r=e&&e.plugin.domEventHandlers,s=e&&e.plugin.domEventObservers;if(r)for(let e in r){let s=r[e];s&&i(e).handlers.push(Wr(t.value,s))}if(s)for(let e in s){let r=s[e];r&&i(e).observers.push(Wr(t.value,r))}}for(let e in Gr)i(e).handlers.push(Gr[e]);for(let e in Jr)i(e).observers.push(Jr[e]);return t}const $r=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],zr="dthko",Ur=[16,17,18,20,91,92,224,225];function Vr(e){return.7*Math.max(0,e)+8}class Kr{constructor(e,t,i,r){this.view=e,this.startEvent=t,this.style=i,this.mustSelect=r,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=function(e){let t,i,r=e.ownerDocument;for(let s=e.parentNode;s&&!(s==r.body||t&&i);)if(1==s.nodeType)!i&&s.scrollHeight>s.clientHeight&&(i=s),!t&&s.scrollWidth>s.clientWidth&&(t=s),s=s.assignedSlot||s.parentNode;else{if(11!=s.nodeType)break;s=s.host}return{x:t,y:i}}(e.contentDOM),this.atoms=e.state.facet(cr).map((t=>t(e)));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Ee.allowMultipleSelections)&&function(e,t){let i=e.state.facet(qi);return i.length?i[0](t):Ut.mac?t.metaKey:t.ctrlKey}(e,t),this.dragging=!(!function(e,t){let{main:i}=e.state.selection;if(i.empty)return!1;let r=nt(e.root);if(!r||0==r.rangeCount)return!0;let s=r.getRangeAt(0).getClientRects();for(let e=0;e<s.length;e++){let i=s[e];if(i.left<=t.clientX&&i.right>=t.clientX&&i.top<=t.clientY&&i.bottom>=t.clientY)return!0}return!1}(e,t)||1!=as(t))&&null}start(e){!1===this.dragging&&this.select(e)}move(e){if(0==e.buttons)return this.destroy();if(this.dragging||null==this.dragging&&(t=this.startEvent,i=e,Math.max(Math.abs(t.clientX-i.clientX),Math.abs(t.clientY-i.clientY))<10))return;var t,i;this.select(this.lastEvent=e);let r=0,s=0,n=0,o=0,a=this.view.win.innerWidth,l=this.view.win.innerHeight;this.scrollParents.x&&({left:n,right:a}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:o,bottom:l}=this.scrollParents.y.getBoundingClientRect());let c=fr(this.view);e.clientX-c.left<=n+6?r=-Vr(n-e.clientX):e.clientX+c.right>=a-6&&(r=Vr(e.clientX-a)),e.clientY-c.top<=o+6?s=-Vr(o-e.clientY):e.clientY+c.bottom>=l-6&&(s=Vr(e.clientY-l)),this.setScrollSpeed(r,s)}up(e){null==this.dragging&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval((()=>this.scroll()),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),!1===this.dragging&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let i=0;i<e.ranges.length;i++){let r=e.ranges[i],s=null;if(r.empty){let e=Ar(this.atoms,r.from,0);e!=r.from&&(s=W.cursor(e,-1))}else{let e=Ar(this.atoms,r.from,-1),t=Ar(this.atoms,r.to,1);e==r.from&&t==r.to||(s=W.range(r.from==r.anchor?e:t,r.from==r.head?e:t))}s&&(t||(t=e.ranges.slice()),t[i]=s)}return t?W.create(t,e.mainIndex):e}select(e){let{view:t}=this,i=this.skipAtoms(this.style.get(e,this.extend,this.multiple));!this.mustSelect&&i.eq(t.state.selection,!1===this.dragging)||this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some((e=>e.isUserEvent("input.type")))?this.destroy():this.style.update(e)&&setTimeout((()=>this.select(this.lastEvent)),20)}}const Gr=Object.create(null),Jr=Object.create(null),Xr=Ut.ie&&Ut.ie_version<15||Ut.ios&&Ut.webkit_version<604;function Yr(e,t,i){for(let r of e.facet(t))i=r(i,e);return i}function Zr(e,t){t=Yr(e.state,Ui,t);let i,{state:r}=e,s=1,n=r.toText(t),o=n.lines==r.selection.ranges.length;if(null!=cs&&r.selection.ranges.every((e=>e.empty))&&cs==n.toString()){let e=-1;i=r.changeByRange((i=>{let a=r.doc.lineAt(i.from);if(a.from==e)return{range:i};e=a.from;let l=r.toText((o?n.line(s++).text:t)+r.lineBreak);return{changes:{from:a.from,insert:l},range:W.cursor(i.from+l.length)}}))}else i=o?r.changeByRange((e=>{let t=n.line(s++);return{changes:{from:e.from,to:e.to,insert:t.text},range:W.cursor(e.from+t.length)}})):r.replaceSelection(n);e.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}function Qr(e,t,i,r){if(1==r)return W.cursor(t,i);if(2==r)return function(e,t,i=1){let r=e.charCategorizer(t),s=e.doc.lineAt(t),n=t-s.from;if(0==s.length)return W.cursor(t);0==n?i=1:n==s.length&&(i=-1);let o=n,a=n;i<0?o=R(s.text,n,!1):a=R(s.text,n);let l=r(s.text.slice(o,a));for(;o>0;){let e=R(s.text,o,!1);if(r(s.text.slice(e,o))!=l)break;o=e}for(;a<s.length;){let e=R(s.text,a);if(r(s.text.slice(a,e))!=l)break;a=e}return W.range(o+s.from,a+s.from)}(e.state,t,i);{let i=fi.find(e.docView,t),r=e.state.doc.lineAt(i?i.posAtEnd:t),s=i?i.posAtStart:r.from,n=i?i.posAtEnd:r.to;return n<e.state.doc.length&&n==r.to&&n++,W.range(s,n)}}Jr.scroll=e=>{e.inputState.lastScrollTop=e.scrollDOM.scrollTop,e.inputState.lastScrollLeft=e.scrollDOM.scrollLeft},Gr.keydown=(e,t)=>(e.inputState.setSelectionOrigin("select"),27==t.keyCode&&0!=e.inputState.tabFocusMode&&(e.inputState.tabFocusMode=Date.now()+2e3),!1),Jr.touchstart=(e,t)=>{e.inputState.lastTouchTime=Date.now(),e.inputState.setSelectionOrigin("select.pointer")},Jr.touchmove=e=>{e.inputState.setSelectionOrigin("select.pointer")},Gr.mousedown=(e,t)=>{if(e.observer.flush(),e.inputState.lastTouchTime>Date.now()-2e3)return!1;let i=null;for(let r of e.state.facet(Fi))if(i=r(e,t),i)break;if(i||0!=t.button||(i=function(e,t){let i=is(e,t),r=as(t),s=e.state.selection;return{update(e){e.docChanged&&(i.pos=e.changes.mapPos(i.pos),s=s.map(e.changes))},get(t,n,o){let a,l=is(e,t),c=Qr(e,l.pos,l.bias,r);if(i.pos!=l.pos&&!n){let t=Qr(e,i.pos,i.bias,r),s=Math.min(t.from,c.from),n=Math.max(t.to,c.to);c=s<c.from?W.range(s,n):W.range(n,s)}return n?s.replaceRange(s.main.extend(c.from,c.to)):o&&1==r&&s.ranges.length>1&&(a=function(e,t){for(let i=0;i<e.ranges.length;i++){let{from:r,to:s}=e.ranges[i];if(r<=t&&s>=t)return W.create(e.ranges.slice(0,i).concat(e.ranges.slice(i+1)),e.mainIndex==i?0:e.mainIndex-(e.mainIndex>i?1:0))}return null}(s,l.pos))?a:o?s.addRange(c):W.create([c])}}}(e,t)),i){let r=!e.hasFocus;e.inputState.startMouseSelection(new Kr(e,t,i,r)),r&&e.observer.ignore((()=>{bt(e.contentDOM);let t=e.root.activeElement;t&&!t.contains(e.contentDOM)&&t.blur()}));let s=e.inputState.mouseSelection;if(s)return s.start(t),!1===s.dragging}return!1};let es=(e,t,i)=>t>=i.top&&t<=i.bottom&&e>=i.left&&e<=i.right;function ts(e,t,i,r){let s=fi.find(e.docView,t);if(!s)return 1;let n=t-s.posAtStart;if(0==n)return 1;if(n==s.length)return-1;let o=s.coordsAt(n,-1);if(o&&es(i,r,o))return-1;let a=s.coordsAt(n,1);return a&&es(i,r,a)?1:o&&o.bottom>=r?-1:1}function is(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:i,bias:ts(e,i,t.clientX,t.clientY)}}const rs=Ut.ie&&Ut.ie_version<=11;let ss=null,ns=0,os=0;function as(e){if(!rs)return e.detail;let t=ss,i=os;return ss=e,os=Date.now(),ns=!t||i>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(ns+1)%3:1}function ls(e,t,i,r){if(!(i=Yr(e.state,Ui,i)))return;let s=e.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:n}=e.inputState,o=r&&n&&function(e,t){let i=e.state.facet(Hi);return i.length?i[0](t):Ut.mac?!t.altKey:!t.ctrlKey}(e,t)?{from:n.from,to:n.to}:null,a={from:s,insert:i},l=e.state.changes(o?[o,a]:a);e.focus(),e.dispatch({changes:l,selection:{anchor:l.mapPos(s,-1),head:l.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"}),e.inputState.draggedContent=null}Gr.dragstart=(e,t)=>{let{selection:{main:i}}=e.state;if(t.target.draggable){let r=e.docView.nearest(t.target);if(r&&r.isWidget){let e=r.posAtStart,t=e+r.length;(e>=i.to||t<=i.from)&&(i=W.range(e,t))}}let{inputState:r}=e;return r.mouseSelection&&(r.mouseSelection.dragging=!0),r.draggedContent=i,t.dataTransfer&&(t.dataTransfer.setData("Text",Yr(e.state,Vi,e.state.sliceDoc(i.from,i.to))),t.dataTransfer.effectAllowed="copyMove"),!1},Gr.dragend=e=>(e.inputState.draggedContent=null,!1),Gr.drop=(e,t)=>{if(!t.dataTransfer)return!1;if(e.state.readOnly)return!0;let i=t.dataTransfer.files;if(i&&i.length){let r=Array(i.length),s=0,n=()=>{++s==i.length&&ls(e,t,r.filter((e=>null!=e)).join(e.state.lineBreak),!1)};for(let e=0;e<i.length;e++){let t=new FileReader;t.onerror=n,t.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(t.result)||(r[e]=t.result),n()},t.readAsText(i[e])}return!0}{let i=t.dataTransfer.getData("Text");if(i)return ls(e,t,i,!0),!0}return!1},Gr.paste=(e,t)=>{if(e.state.readOnly)return!0;e.observer.flush();let i=Xr?null:t.clipboardData;return i?(Zr(e,i.getData("text/plain")||i.getData("text/uri-list")),!0):(function(e){let t=e.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{e.focus(),i.remove(),Zr(e,i.value)}),50)}(e),!1)};let cs=null;Gr.copy=Gr.cut=(e,t)=>{let{text:i,ranges:r,linewise:s}=function(e){let t=[],i=[],r=!1;for(let r of e.selection.ranges)r.empty||(t.push(e.sliceDoc(r.from,r.to)),i.push(r));if(!t.length){let s=-1;for(let{from:r}of e.selection.ranges){let n=e.doc.lineAt(r);n.number>s&&(t.push(n.text),i.push({from:n.from,to:Math.min(e.doc.length,n.to+1)})),s=n.number}r=!0}return{text:Yr(e,Vi,t.join(e.lineBreak)),ranges:i,linewise:r}}(e.state);if(!i&&!s)return!1;cs=s?i:null,"cut"!=t.type||e.state.readOnly||e.dispatch({changes:r,scrollIntoView:!0,userEvent:"delete.cut"});let n=Xr?null:t.clipboardData;return n?(n.clearData(),n.setData("text/plain",i),!0):(function(e,t){let i=e.dom.parentNode;if(!i)return;let r=i.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=t,r.focus(),r.selectionEnd=t.length,r.selectionStart=0,setTimeout((()=>{r.remove(),e.focus()}),50)}(e,i),!1)};const hs=fe.define();function us(e,t){let i=[];for(let r of e.facet(zi)){let s=r(e,t);s&&i.push(s)}return i.length?e.update({effects:i,annotations:hs.of(!0)}):null}function ds(e){setTimeout((()=>{let t=e.hasFocus;if(t!=e.inputState.notifiedFocused){let i=us(e.state,t);i?e.dispatch(i):e.update([])}}),10)}Jr.focus=e=>{e.inputState.lastFocusTime=Date.now(),e.scrollDOM.scrollTop||!e.inputState.lastScrollTop&&!e.inputState.lastScrollLeft||(e.scrollDOM.scrollTop=e.inputState.lastScrollTop,e.scrollDOM.scrollLeft=e.inputState.lastScrollLeft),ds(e)},Jr.blur=e=>{e.observer.clearSelectionRange(),ds(e)},Jr.compositionstart=Jr.compositionupdate=e=>{e.observer.editContext||(null==e.inputState.compositionFirstChange&&(e.inputState.compositionFirstChange=!0),e.inputState.composing<0&&(e.inputState.composing=0))},Jr.compositionend=e=>{e.observer.editContext||(e.inputState.composing=-1,e.inputState.compositionEndedAt=Date.now(),e.inputState.compositionPendingKey=!0,e.inputState.compositionPendingChange=e.observer.pendingRecords().length>0,e.inputState.compositionFirstChange=null,Ut.chrome&&Ut.android?e.observer.flushSoon():e.inputState.compositionPendingChange?Promise.resolve().then((()=>e.observer.flush())):setTimeout((()=>{e.inputState.composing<0&&e.docView.hasComposition&&e.update([])}),50))},Jr.contextmenu=e=>{e.inputState.lastContextMenu=Date.now()},Gr.beforeinput=(e,t)=>{var i,r;if("insertReplacementText"==t.inputType&&e.observer.editContext){let r=null===(i=t.dataTransfer)||void 0===i?void 0:i.getData("text/plain"),s=t.getTargetRanges();if(r&&s.length){let t=s[0],i=e.posAtDOM(t.startContainer,t.startOffset),n=e.posAtDOM(t.endContainer,t.endOffset);return Hr(e,{from:i,to:n,insert:e.state.toText(r)},null),!0}}let s;if(Ut.chrome&&Ut.android&&(s=$r.find((e=>e.inputType==t.inputType)))&&(e.observer.delayAndroidKey(s.key,s.keyCode),"Backspace"==s.key||"Delete"==s.key)){let t=(null===(r=window.visualViewport)||void 0===r?void 0:r.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>t+10&&e.hasFocus&&(e.contentDOM.blur(),e.focus())}),100)}return Ut.ios&&"deleteContentForward"==t.inputType&&e.observer.flushSoon(),Ut.safari&&"insertText"==t.inputType&&e.inputState.composing>=0&&setTimeout((()=>Jr.compositionend(e,t)),20),!1};const fs=new Set,ps=["pre-wrap","normal","pre-line","break-spaces"];let gs=!1;function ms(){gs=!1}class vs{constructor(e){this.lineWrapping=e,this.doc=m.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return ps.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let r=e[i];r<0?i++:this.heightSamples[Math.floor(10*r)]||(t=!0,this.heightSamples[Math.floor(10*r)]=!0)}return t}refresh(e,t,i,r,s,n){let o=ps.indexOf(e)>-1,a=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=t,this.charWidth=i,this.textHeight=r,this.lineLength=s,a){this.heightSamples={};for(let e=0;e<n.length;e++){let t=n[e];t<0?e++:this.heightSamples[Math.floor(10*t)]=!0}}return a}}class _s{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class ys{constructor(e,t,i,r,s){this.from=e,this.length=t,this.top=i,this.height=r,this._content=s}get type(){return"number"==typeof this._content?oi.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof hi?this._content.widget:null}get widgetLineBreaks(){return"number"==typeof this._content?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new ys(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var bs=function(e){return e[e.ByPos=0]="ByPos",e[e.ByHeight=1]="ByHeight",e[e.ByPosNoHeight=2]="ByPosNoHeight",e}(bs||(bs={}));const ws=.001;class Ss{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(e){this.flags=(e?2:0)|-3&this.flags}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>ws&&(gs=!0),this.height=e)}replace(e,t,i){return Ss.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,r){let s=this,n=i.doc;for(let o=r.length-1;o>=0;o--){let{fromA:a,toA:l,fromB:c,toB:h}=r[o],u=s.lineAt(a,bs.ByPosNoHeight,i.setDoc(t),0,0),d=u.to>=l?u:s.lineAt(l,bs.ByPosNoHeight,i,0,0);for(h+=d.to-l,l=d.to;o>0&&u.from<=r[o-1].toA;)a=r[o-1].fromA,c=r[o-1].fromB,o--,a<u.from&&(u=s.lineAt(a,bs.ByPosNoHeight,i,0,0));c+=u.from-a,a=u.from;let f=Ts.build(i.setDoc(n),e,c,h);s=Cs(s,s.replace(a,l,f))}return s.updateHeight(i,0)}static empty(){return new xs(0,0)}static of(e){if(1==e.length)return e[0];let t=0,i=e.length,r=0,s=0;for(;;)if(t==i)if(r>2*s){let s=e[t-1];s.break?e.splice(--t,1,s.left,null,s.right):e.splice(--t,1,s.left,s.right),i+=1+s.break,r-=s.size}else{if(!(s>2*r))break;{let t=e[i];t.break?e.splice(i,1,t.left,null,t.right):e.splice(i,1,t.left,t.right),i+=2+t.break,s-=t.size}}else if(r<s){let i=e[t++];i&&(r+=i.size)}else{let t=e[--i];t&&(s+=t.size)}let n=0;return null==e[t-1]?(n=1,t--):null==e[t]&&(n=1,i++),new Es(Ss.of(e.slice(0,t)),n,Ss.of(e.slice(i)))}}function Cs(e,t){return e==t?e:(e.constructor!=t.constructor&&(gs=!0),t)}Ss.prototype.size=1;class ks extends Ss{constructor(e,t,i){super(e,t),this.deco=i}blockAt(e,t,i,r){return new ys(r,this.length,i,this.height,this.deco||0)}lineAt(e,t,i,r,s){return this.blockAt(0,i,r,s)}forEachLine(e,t,i,r,s,n){e<=s+this.length&&t>=s&&n(this.blockAt(0,i,r,s))}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more&&this.setHeight(r.heights[r.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class xs extends ks{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,i,r){return new ys(r,this.length,i,this.height,this.breaks)}replace(e,t,i){let r=i[0];return 1==i.length&&(r instanceof xs||r instanceof Rs&&4&r.flags)&&Math.abs(this.length-r.length)<10?(r instanceof Rs?r=new xs(r.length,this.height):r.height=this.height,this.outdated||(r.outdated=!1),r):Ss.of(i)}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more?this.setHeight(r.heights[r.index++]):(i||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Rs extends Ss{constructor(e){super(e,0)}heightMetrics(e,t){let i,r=e.doc.lineAt(t).number,s=e.doc.lineAt(t+this.length).number,n=s-r+1,o=0;if(e.lineWrapping){let t=Math.min(this.height,e.lineHeight*n);i=t/n,this.length>n+1&&(o=(this.height-t)/(this.length-n-1))}else i=this.height/n;return{firstLine:r,lastLine:s,perLine:i,perChar:o}}blockAt(e,t,i,r){let{firstLine:s,lastLine:n,perLine:o,perChar:a}=this.heightMetrics(t,r);if(t.lineWrapping){let s=r+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length)),n=t.doc.lineAt(s),l=o+n.length*a,c=Math.max(i,e-l/2);return new ys(n.from,n.length,c,l,0)}{let r=Math.max(0,Math.min(n-s,Math.floor((e-i)/o))),{from:a,length:l}=t.doc.line(s+r);return new ys(a,l,i+o*r,o,0)}}lineAt(e,t,i,r,s){if(t==bs.ByHeight)return this.blockAt(e,i,r,s);if(t==bs.ByPosNoHeight){let{from:t,to:r}=i.doc.lineAt(e);return new ys(t,r-t,0,0,0)}let{firstLine:n,perLine:o,perChar:a}=this.heightMetrics(i,s),l=i.doc.lineAt(e),c=o+l.length*a,h=l.number-n,u=r+o*h+a*(l.from-s-h);return new ys(l.from,l.length,Math.max(r,Math.min(u,r+this.height-c)),c,0)}forEachLine(e,t,i,r,s,n){e=Math.max(e,s),t=Math.min(t,s+this.length);let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(i,s);for(let c=e,h=r;c<=t;){let t=i.doc.lineAt(c);if(c==e){let i=t.number-o;h+=a*i+l*(e-s-i)}let r=a+l*t.length;n(new ys(t.from,t.length,h,r,0)),h+=r,c=t.to+1}}replace(e,t,i){let r=this.length-t;if(r>0){let e=i[i.length-1];e instanceof Rs?i[i.length-1]=new Rs(e.length+r):i.push(null,new Rs(r-1))}if(e>0){let t=i[0];t instanceof Rs?i[0]=new Rs(e+t.length):i.unshift(new Rs(e-1),null)}return Ss.of(i)}decomposeLeft(e,t){t.push(new Rs(e-1),null)}decomposeRight(e,t){t.push(null,new Rs(this.length-e-1))}updateHeight(e,t=0,i=!1,r){let s=t+this.length;if(r&&r.from<=t+this.length&&r.more){let i=[],n=Math.max(t,r.from),o=-1;for(r.from>t&&i.push(new Rs(r.from-t-1).updateHeight(e,t));n<=s&&r.more;){let t=e.doc.lineAt(n).length;i.length&&i.push(null);let s=r.heights[r.index++];-1==o?o=s:Math.abs(s-o)>=ws&&(o=-2);let a=new xs(t,s);a.outdated=!1,i.push(a),n+=t+1}n<=s&&i.push(null,new Rs(s-n).updateHeight(e,n));let a=Ss.of(i);return(o<0||Math.abs(a.height-this.height)>=ws||Math.abs(o-this.heightMetrics(e,t).perLine)>=ws)&&(gs=!0),Cs(this,a)}return(i||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class Es extends Ss{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return 1&this.flags}blockAt(e,t,i,r){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,r):this.right.blockAt(e,t,s,r+this.left.length+this.break)}lineAt(e,t,i,r,s){let n=r+this.left.height,o=s+this.left.length+this.break,a=t==bs.ByHeight?e<n:e<o,l=a?this.left.lineAt(e,t,i,r,s):this.right.lineAt(e,t,i,n,o);if(this.break||(a?l.to<o:l.from>o))return l;let c=t==bs.ByPosNoHeight?bs.ByPosNoHeight:bs.ByPos;return a?l.join(this.right.lineAt(o,c,i,n,o)):this.left.lineAt(o,c,i,r,s).join(l)}forEachLine(e,t,i,r,s,n){let o=r+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,r,s,n),t>=a&&this.right.forEachLine(e,t,i,o,a,n);else{let l=this.lineAt(a,bs.ByPos,i,r,s);e<l.from&&this.left.forEachLine(e,l.from-1,i,r,s,n),l.to>=e&&l.from<=t&&n(l),t>l.to&&this.right.forEachLine(l.to+1,t,i,o,a,n)}}replace(e,t,i){let r=this.left.length+this.break;if(t<r)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-r,t-r,i));let s=[];e>0&&this.decomposeLeft(e,s);let n=s.length;for(let e of i)s.push(e);if(e>0&&Ds(s,n-1),t<this.length){let e=s.length;this.decomposeRight(t,s),Ds(s,e)}return Ss.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,r=i+this.break;if(e>=r)return this.right.decomposeRight(e-r,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<r&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Ss.of(this.break?[e,null,t]:[e,t]):(this.left=Cs(this.left,e),this.right=Cs(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,r){let{left:s,right:n}=this,o=t+s.length+this.break,a=null;return r&&r.from<=t+s.length&&r.more?a=s=s.updateHeight(e,t,i,r):s.updateHeight(e,t,i),r&&r.from<=o+n.length&&r.more?a=n=n.updateHeight(e,o,i,r):n.updateHeight(e,o,i),a?this.balanced(s,n):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Ds(e,t){let i,r;null==e[t]&&(i=e[t-1])instanceof Rs&&(r=e[t+1])instanceof Rs&&e.splice(t-1,3,new Rs(i.length+1+r.length))}class Ts{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let e=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof xs?i.length+=e-this.pos:(e>this.pos||!this.isCovered)&&this.nodes.push(new xs(e-this.pos,-1)),this.writtenTo=e,t>e&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let r=i.widget?i.widget.estimatedHeight:0,s=i.widget?i.widget.lineBreaks:0;r<0&&(r=this.oracle.lineHeight);let n=t-e;i.block?this.addBlock(new ks(n,r,i)):(n||s||r>=5)&&this.addLineDeco(r,s,n)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new xs(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new Rs(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof xs)return e;let t=new xs(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,i){let r=this.ensureLine();r.length+=i,r.collapsed+=i,r.widgetHeight=Math.max(r.widgetHeight,e),r.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||t instanceof xs||this.isCovered?(this.writtenTo<this.pos||null==t)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new xs(0,-1));let i=e;for(let e of this.nodes)e instanceof xs&&e.updateHeight(this.oracle,i),i+=e?e.length:1;return this.nodes}static build(e,t,i,r){let s=new Ts(i,e);return Le.spans(t,i,r,s,0),s.finish(i)}}class Ms{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,r){(e<t||i&&i.heightRelevant||r&&r.heightRelevant)&&di(e,t,this.changes,5)}}function As(e,t){let i=e.getBoundingClientRect(),r=e.ownerDocument,s=r.defaultView||window,n=Math.max(0,i.left),o=Math.min(s.innerWidth,i.right),a=Math.max(0,i.top),l=Math.min(s.innerHeight,i.bottom);for(let t=e.parentNode;t&&t!=r.body;)if(1==t.nodeType){let i=t,r=window.getComputedStyle(i);if((i.scrollHeight>i.clientHeight||i.scrollWidth>i.clientWidth)&&"visible"!=r.overflow){let r=i.getBoundingClientRect();n=Math.max(n,r.left),o=Math.min(o,r.right),a=Math.max(a,r.top),l=Math.min(t==e.parentNode?s.innerHeight:l,r.bottom)}t="absolute"==r.position||"fixed"==r.position?i.offsetParent:i.parentNode}else{if(11!=t.nodeType)break;t=t.host}return{left:n-i.left,right:Math.max(n,o)-i.left,top:a-(i.top+t),bottom:Math.max(a,l)-(i.top+t)}}function Os(e,t){let i=e.getBoundingClientRect();return{left:0,right:i.right-i.left,top:t,bottom:i.bottom-(i.top+t)}}class Ls{constructor(e,t,i,r){this.from=e,this.to=t,this.size=i,this.displaySize=r}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],s=t[i];if(r.from!=s.from||r.to!=s.to||r.size!=s.size)return!1}return!0}draw(e,t){return ai.replace({widget:new Ps(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class Ps extends ni{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class Bs{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Hs,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=yi.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(or).some((e=>"function"!=typeof e&&"cm-lineWrapping"==e.class));this.heightOracle=new vs(t),this.stateDeco=e.facet(ar).filter((e=>"function"!=typeof e)),this.heightMap=Ss.empty().applyChanges(this.stateDeco,m.empty,this.heightOracle.setDoc(e.doc),[new gr(0,0,0,e.doc.length)]);for(let e=0;e<2&&(this.viewport=this.getViewport(0,null),this.updateForViewport());e++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ai.set(this.lineGaps.map((e=>e.draw(this,!1)))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let r=i?t.head:t.anchor;if(!e.some((({from:e,to:t})=>r>=e&&r<=t))){let{from:t,to:i}=this.lineBlockAt(r);e.push(new Is(t,i))}}return this.viewports=e.sort(((e,t)=>e.from-t.from)),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?Hs:new Fs(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,(e=>{this.viewportLines.push(Ws(e,this.scaler))}))}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(ar).filter((e=>"function"!=typeof e));let r=e.changedRanges,s=gr.extendWithRanges(r,function(e,t,i){let r=new Ms;return Le.compare(e,t,i,r,0),r.changes}(i,this.stateDeco,e?e.changes:L.empty(this.state.doc.length))),n=this.heightMap.height,o=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);ms(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=n||gs)&&(e.flags|=2),o?(this.scrollAnchorPos=e.changes.mapPos(o.from,-1),this.scrollAnchorHeight=o.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=n);let a=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let l=a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,e.flags|=this.updateForViewport(),(l||!e.changes.empty||2&e.flags)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(Gi)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),r=this.heightOracle,s=i.whiteSpace;this.defaultTextDirection="rtl"==i.direction?yi.RTL:yi.LTR;let n=this.heightOracle.mustRefreshForWrapping(s),o=t.getBoundingClientRect(),a=n||this.mustMeasureContent||this.contentDOMHeight!=o.height;this.contentDOMHeight=o.height,this.mustMeasureContent=!1;let l=0,c=0;if(o.width&&o.height){let{scaleX:e,scaleY:i}=mt(t,o);(e>.005&&Math.abs(this.scaleX-e)>.005||i>.005&&Math.abs(this.scaleY-i)>.005)&&(this.scaleX=e,this.scaleY=i,l|=16,n=a=!0)}let h=(parseInt(i.paddingTop)||0)*this.scaleY,u=(parseInt(i.paddingBottom)||0)*this.scaleY;this.paddingTop==h&&this.paddingBottom==u||(this.paddingTop=h,this.paddingBottom=u,l|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(r.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,l|=16);let d=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=d&&(this.scrollAnchorHeight=-1,this.scrollTop=d),this.scrolledToBottom=kt(e.scrollDOM);let f=(this.printing?Os:As)(t,this.paddingTop),p=f.top-this.pixelViewport.top,g=f.bottom-this.pixelViewport.bottom;this.pixelViewport=f;let v=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(v!=this.inView&&(this.inView=v,v&&(a=!0)),!this.inView&&!this.scrollTarget&&!function(e){let t=e.getBoundingClientRect(),i=e.ownerDocument.defaultView||window;return t.left<i.innerWidth&&t.right>0&&t.top<i.innerHeight&&t.bottom>0}(e.dom))return 0;let _=o.width;if(this.contentDOMWidth==_&&this.editorHeight==e.scrollDOM.clientHeight||(this.contentDOMWidth=o.width,this.editorHeight=e.scrollDOM.clientHeight,l|=16),a){let t=e.docView.measureVisibleLineHeights(this.viewport);if(r.mustRefreshForHeights(t)&&(n=!0),n||r.lineWrapping&&Math.abs(_-this.contentDOMWidth)>r.charWidth){let{lineHeight:i,charWidth:o,textHeight:a}=e.docView.measureTextSize();n=i>0&&r.refresh(s,i,o,a,_/o,t),n&&(e.docView.minWidth=0,l|=16)}p>0&&g>0?c=Math.max(p,g):p<0&&g<0&&(c=Math.min(p,g)),ms();for(let i of this.viewports){let s=i.from==this.viewport.from?t:e.docView.measureVisibleLineHeights(i);this.heightMap=(n?Ss.empty().applyChanges(this.stateDeco,m.empty,this.heightOracle,[new gr(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(r,0,n,new _s(i.from,s))}gs&&(l|=2)}let y=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(2&l&&(l|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),l|=this.updateForViewport()),(2&l||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(n?[]:this.lineGaps,e)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),r=this.heightMap,s=this.heightOracle,{visibleTop:n,visibleBottom:o}=this,a=new Is(r.lineAt(n-1e3*i,bs.ByHeight,s,0,0).from,r.lineAt(o+1e3*(1-i),bs.ByHeight,s,0,0).to);if(t){let{head:e}=t.range;if(e<a.from||e>a.to){let i,n=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=r.lineAt(e,bs.ByPos,s,0,0);i="center"==t.y?(o.top+o.bottom)/2-n/2:"start"==t.y||"nearest"==t.y&&e<a.from?o.top:o.bottom-n,a=new Is(r.lineAt(i-500,bs.ByHeight,s,0,0).from,r.lineAt(i+n+500,bs.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),r=t.mapPos(e.to,1);return new Is(this.heightMap.lineAt(i,bs.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(r,bs.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:r}=this.heightMap.lineAt(e,bs.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(t,bs.ByPos,this.heightOracle,0,0),{visibleTop:n,visibleBottom:o}=this;return(0==e||r<=n-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&r>n-2e3&&s<o+2e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let r of e)t.touchesRange(r.from,r.to)||i.push(new Ls(t.mapPos(r.from),t.mapPos(r.to),r.size,r.displaySize));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,r=i?1e4:2e3,s=r>>1,n=r<<1;if(this.defaultTextDirection!=yi.LTR&&!i)return[];let o=[],a=(r,n,l,c)=>{if(n-r<s)return;let h=this.state.selection.main,u=[h.from];h.empty||u.push(h.to);for(let e of u)if(e>r&&e<n)return a(r,e-10,l,c),void a(e+10,n,l,c);let d=function(e,t){for(let i of e)if(t(i))return i}(e,(e=>e.from>=l.from&&e.to<=l.to&&Math.abs(e.from-r)<s&&Math.abs(e.to-n)<s&&!u.some((t=>e.from<t&&e.to>t))));if(!d){if(n<l.to&&t&&i&&t.visibleRanges.some((e=>e.from<=n&&e.to>=n))){let e=t.moveToLineBoundary(W.cursor(n),!1,!0).head;e>r&&(n=e)}let e=this.gapSize(l,r,n,c);d=new Ls(r,n,e,i||e<2e6?e:2e6)}o.push(d)},l=t=>{if(t.length<n||t.type!=oi.Text)return;let s=function(e,t,i){let r=[],s=e,n=0;return Le.spans(i,e,t,{span(){},point(e,t){e>s&&(r.push({from:s,to:e}),n+=e-s),s=t}},20),s<t&&(r.push({from:s,to:t}),n+=t-s),{total:n,ranges:r}}(t.from,t.to,this.stateDeco);if(s.total<n)return;let o,l,c=this.scrollTarget?this.scrollTarget.range.head:null;if(i){let e,i,n=r/this.heightOracle.lineLength*this.heightOracle.lineHeight;if(null!=c){let r=qs(s,c),o=((this.visibleBottom-this.visibleTop)/2+n)/t.height;e=r-o,i=r+o}else e=(this.visibleTop-t.top-n)/t.height,i=(this.visibleBottom-t.top+n)/t.height;o=Ns(s,e),l=Ns(s,i)}else{let i=s.total*this.heightOracle.charWidth,n=r*this.heightOracle.charWidth,a=0;if(i>2e6)for(let i of e)i.from>=t.from&&i.from<t.to&&i.size!=i.displaySize&&i.from*this.heightOracle.charWidth+a<this.pixelViewport.left&&(a=i.size-i.displaySize);let h,u,d=this.pixelViewport.left+a,f=this.pixelViewport.right+a;if(null!=c){let e=qs(s,c),t=((f-d)/2+n)/i;h=e-t,u=e+t}else h=(d-n)/i,u=(f+n)/i;o=Ns(s,h),l=Ns(s,u)}o>t.from&&a(t.from,o,t,s),l<t.to&&a(l,t.to,t,s)};for(let e of this.viewportLines)Array.isArray(e.type)?e.type.forEach(l):l(e);return o}gapSize(e,t,i,r){let s=qs(r,i)-qs(r,t);return this.heightOracle.lineWrapping?e.height*s:r.total*this.heightOracle.charWidth*s}updateLineGaps(e){Ls.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ai.set(e.map((e=>e.draw(this,this.heightOracle.lineWrapping)))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let i=[];Le.spans(t,this.viewport.from,this.viewport.to,{span(e,t){i.push({from:e,to:t})},point(){}},20);let r=0;if(i.length!=this.visibleRanges.length)r=12;else for(let t=0;t<i.length&&!(8&r);t++){let s=this.visibleRanges[t],n=i[t];s.from==n.from&&s.to==n.to||(r|=4,e&&e.mapPos(s.from,-1)==n.from&&e.mapPos(s.to,1)==n.to||(r|=8))}return this.visibleRanges=i,r}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find((t=>t.from<=e&&t.to>=e))||Ws(this.heightMap.lineAt(e,bs.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find((t=>t.top<=e&&t.bottom>=e))||Ws(this.heightMap.lineAt(this.scaler.fromDOM(e),bs.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Ws(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Is{constructor(e,t){this.from=e,this.to=t}}function Ns({total:e,ranges:t},i){if(i<=0)return t[0].from;if(i>=1)return t[t.length-1].to;let r=Math.floor(e*i);for(let e=0;;e++){let{from:i,to:s}=t[e],n=s-i;if(r<=n)return i+r;r-=n}}function qs(e,t){let i=0;for(let{from:r,to:s}of e.ranges){if(t<=s){i+=t-r;break}i+=s-r}return i/e.total}const Hs={toDOM:e=>e,fromDOM:e=>e,scale:1,eq(e){return e==this}};class Fs{constructor(e,t,i){let r=0,s=0,n=0;this.viewports=i.map((({from:i,to:s})=>{let n=t.lineAt(i,bs.ByPos,e,0,0).top,o=t.lineAt(s,bs.ByPos,e,0,0).bottom;return r+=o-n,{from:i,to:s,top:n,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-r)/(t.height-r);for(let e of this.viewports)e.domTop=n+(e.top-s)*this.scale,n=e.domBottom=e.domTop+(e.bottom-e.top),s=e.bottom}toDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return r+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,r=s.domBottom}}fromDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-r)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,r=s.domBottom}}eq(e){return e instanceof Fs&&this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every(((t,i)=>t.from==e.viewports[i].from&&t.to==e.viewports[i].to))}}function Ws(e,t){if(1==t.scale)return e;let i=t.toDOM(e.top),r=t.toDOM(e.bottom);return new ys(e.from,e.length,i,r-i,Array.isArray(e._content)?e._content.map((e=>Ws(e,t))):e._content)}const js=z.define({combine:e=>e.join(" ")}),$s=z.define({combine:e=>e.indexOf(!0)>-1}),zs=Xe.newName(),Us=Xe.newName(),Vs=Xe.newName(),Ks={"&light":"."+Us,"&dark":"."+Vs};function Gs(e,t,i){return new Xe(t,{finish:t=>/&/.test(t)?t.replace(/&\w*/,(t=>{if("&"==t)return e;if(!i||!i[t])throw new RangeError(`Unsupported selector: ${t}`);return i[t]})):e+" "+t})}const Js=Gs("."+zs,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>\')',backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Ks),Xs={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Ys=Ut.ie&&Ut.ie_version<=11;class Zs{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new vt,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver((t=>{for(let e of t)this.queue.push(e);(Ut.ie&&Ut.ie_version<=11||Ut.ios&&e.composing)&&t.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),!window.EditContext||!1===e.constructor.EDIT_CONTEXT||Ut.chrome&&Ut.chrome_version<126||(this.editContext=new tn(e),e.state.facet(er)&&(e.contentDOM.editContext=this.editContext.editContext)),Ys&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),"function"==typeof ResizeObserver&&(this.resizeScroll=new ResizeObserver((()=>{var e;(null===(e=this.view.docView)||void 0===e?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()})),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(e){("change"!=e.type&&e.type||e.matches)&&(this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some(((t,i)=>t!=e[i])))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,r=this.selectionRange;if(i.state.facet(er)?i.root.activeElement!=this.dom:!at(this.dom,r))return;let s=r.anchorNode&&i.docView.nearest(r.anchorNode);s&&s.ignoreEvent(e)?t||(this.selectionChanged=!1):(Ut.ie&&Ut.ie_version<=11||Ut.android&&Ut.chrome)&&!i.state.selection.main.empty&&r.focusNode&&ct(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=nt(e.root);if(!t)return!1;let i=Ut.safari&&11==e.root.nodeType&&e.root.activeElement==this.dom&&function(e,t){if(t.getComposedRanges){let i=t.getComposedRanges(e.root)[0];if(i)return en(e,i)}let i=null;function r(e){e.preventDefault(),e.stopImmediatePropagation(),i=e.getTargetRanges()[0]}return e.contentDOM.addEventListener("beforeinput",r,!0),e.dom.ownerDocument.execCommand("indent"),e.contentDOM.removeEventListener("beforeinput",r,!0),i?en(e,i):null}(this.view,t)||t;if(!i||this.selectionRange.eq(i))return!1;let r=at(this.dom,i);return r&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&function(e,t){let i=t.focusNode,r=t.focusOffset;if(!i||t.anchorNode!=i||t.anchorOffset!=r)return!1;for(r=Math.min(r,ft(i));;)if(r){if(1!=i.nodeType)return!1;let e=i.childNodes[r-1];"false"==e.contentEditable?r--:(i=e,r=ft(i))}else{if(i==e)return!0;r=ht(i),i=i.parentNode}}(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),r&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(1==i.nodeType)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);for(let e of this.scrollTargets=t)e.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Xs),Ys&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Ys&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let e=()=>{let e=this.delayedAndroidKey;e&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=e.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&e.force&&St(this.dom,e.key,e.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(e)}this.delayedAndroidKey&&"Enter"!=e||(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(null===(i=this.delayedAndroidKey)||void 0===i?void 0:i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame((()=>{this.delayedFlush=-1,this.flush()})))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,r=!1;for(let s of e){let e=this.readMutation(s);e&&(e.typeOver&&(r=!0),-1==t?({from:t,to:i}=e):(t=Math.min(e.from,t),i=Math.max(e.to,i)))}return{from:t,to:i,typeOver:r}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),r=this.selectionChanged&&at(this.dom,this.selectionRange);if(e<0&&!r)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new Nr(this.view,e,t,i);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let i=this.view.state,r=qr(this.view,t);return this.view.state==i&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),r}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty("attributes"==e.type),"attributes"==e.type&&(t.flags|=4),"childList"==e.type){let i=Qs(t,e.previousSibling||e.target.previousSibling,-1),r=Qs(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:r?t.posBefore(r):t.posAtEnd,typeOver:!1}}return"characterData"==e.type?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(er)!=e.state.facet(er)&&(e.view.contentDOM.editContext=e.state.facet(er)?this.editContext.editContext:null))}destroy(){var e,t,i;this.stop(),null===(e=this.intersection)||void 0===e||e.disconnect(),null===(t=this.gapIntersection)||void 0===t||t.disconnect(),null===(i=this.resizeScroll)||void 0===i||i.disconnect();for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function Qs(e,t,i){for(;t;){let r=Tt.get(t);if(r&&r.parent==e)return r;let s=t.parentNode;t=s!=e.dom?s:i>0?t.nextSibling:t.previousSibling}return null}function en(e,t){let i=t.startContainer,r=t.startOffset,s=t.endContainer,n=t.endOffset,o=e.docView.domAtPos(e.state.selection.main.anchor);return ct(o.node,o.offset,s,n)&&([i,r,s,n]=[s,n,i,r]),{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:n}}class tn{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=t=>{let i=e.state.selection.main,{anchor:r,head:s}=i,n=this.toEditorPos(t.updateRangeStart),o=this.toEditorPos(t.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:t.updateRangeStart,editorBase:n,drifted:!1});let a={from:n,to:o,insert:m.of(t.text.split("\n"))};if(a.from==this.from&&r<this.from?a.from=r:a.to==this.to&&r>this.to&&(a.to=r),a.from!=a.to||a.insert.length){if((Ut.mac||Ut.android)&&a.from==s-1&&/^\. ?$/.test(t.text)&&"off"==e.contentDOM.getAttribute("autocorrect")&&(a={from:n,to:o,insert:m.of([t.text.replace("."," ")])}),this.pendingContextChange=a,!e.state.readOnly){let i=this.to-this.from+(a.to-a.from+a.insert.length);Hr(e,a,W.single(this.toEditorPos(t.selectionStart,i),this.toEditorPos(t.selectionEnd,i)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state))}else{let r=W.single(this.toEditorPos(t.selectionStart),this.toEditorPos(t.selectionEnd));r.main.eq(i)||e.dispatch({selection:r,userEvent:"select"})}},this.handlers.characterboundsupdate=i=>{let r=[],s=null;for(let t=this.toEditorPos(i.rangeStart),n=this.toEditorPos(i.rangeEnd);t<n;t++){let i=e.coordsForChar(t);s=i&&new DOMRect(i.left,i.top,i.right-i.left,i.bottom-i.top)||s||new DOMRect,r.push(s)}t.updateCharacterBounds(i.rangeStart,r)},this.handlers.textformatupdate=t=>{let i=[];for(let e of t.getTextFormats()){let t=e.underlineStyle,r=e.underlineThickness;if("None"!=t&&"None"!=r){let s=this.toEditorPos(e.rangeStart),n=this.toEditorPos(e.rangeEnd);if(s<n){let e=`text-decoration: underline ${"Dashed"==t?"dashed ":"Squiggle"==t?"wavy ":""}${"Thin"==r?1:2}px`;i.push(ai.mark({attributes:{style:e}}).range(s,n))}}}e.dispatch({effects:Zi.of(ai.set(i))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:t}=this.composing;this.composing=null,t&&this.reset(e.state)}};for(let e in this.handlers)t.addEventListener(e,this.handlers[e]);this.measureReq={read:e=>{this.editContext.updateControlBounds(e.contentDOM.getBoundingClientRect());let t=nt(e.root);t&&t.rangeCount&&this.editContext.updateSelectionBounds(t.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,i=!1,r=this.pendingContextChange;return e.changes.iterChanges(((s,n,o,a,l)=>{if(i)return;let c=l.length-(n-s);if(r&&n>=r.to){if(r.from==s&&r.to==n&&r.insert.eq(l))return r=this.pendingContextChange=null,t+=c,void(this.to+=c);r=null,this.revertPending(e.state)}if(s+=t,(n+=t)<=this.from)this.from+=c,this.to+=c;else if(s<this.to){if(s<this.from||n>this.to||this.to-this.from+l.length>3e4)return void(i=!0);this.editContext.updateText(this.toContextPos(s),this.toContextPos(n),l.toString()),this.to+=c}t+=c})),r&&!i&&this.revertPending(e.state),!i}update(e){let t=this.pendingContextChange,i=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(i.from,i.to)&&e.transactions.some((e=>!e.isUserEvent("input.type")&&e.changes.touchesRange(this.from,this.to))))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):this.applyEdits(e)&&this.rangeIsValid(e.state)?(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state):(this.pendingContextChange=null,this.reset(e.state)),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),r=this.toContextPos(t.head);this.editContext.selectionStart==i&&this.editContext.selectionEnd==r||this.editContext.updateSelection(i,r)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>3e4)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let i=this.composing;return i&&i.drifted?i.editorBase+(e-i.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class rn{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:i}=e;this.dispatchTransactions=e.dispatchTransactions||i&&(e=>e.forEach((e=>i(e,this))))||(e=>this.update(e)),this.dispatch=this.dispatch.bind(this),this._root=e.root||function(e){for(;e;){if(e&&(9==e.nodeType||11==e.nodeType&&e.host))return e;e=e.assignedSlot||e.parentNode}return null}(e.parent)||document,this.viewState=new Bs(e.state||Ee.create(e)),e.scrollTo&&e.scrollTo.is(Yi)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(ir).map((e=>new sr(e)));for(let e of this.plugins)e.update(this);this.observer=new Zs(this),this.inputState=new Fr(this),this.inputState.ensureHandlers(this.plugins),this.docView=new vr(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),(null===(t=document.fonts)||void 0===t?void 0:t.ready)&&document.fonts.ready.then((()=>this.requestMeasure()))}dispatch(...e){let t=1==e.length&&e[0]instanceof ve?e:1==e.length&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t,i=!1,r=!1,s=this.state;for(let t of e){if(t.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=t.state}if(this.destroyed)return void(this.viewState.state=s);let n=this.hasFocus,o=0,a=null;e.some((e=>e.annotation(hs)))?(this.inputState.notifiedFocused=n,o=1):n!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=n,a=us(s,n),a||(o=1));let l=this.observer.delayedAndroidKey,c=null;if(l?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(c=null)):this.observer.clear(),s.facet(Ee.phrases)!=this.state.facet(Ee.phrases))return this.setState(s);t=mr.create(this,s,e),t.flags|=o;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let t of e){if(h&&(h=h.map(t.changes)),t.scrollIntoView){let{main:e}=t.state.selection;h=new Xi(e.empty?e:W.cursor(e.head,e.head>e.anchor?-1:1))}for(let e of t.effects)e.is(Yi)&&(h=e.value.clip(this.state))}this.viewState.update(t,h),this.bidiCache=on.update(this.bidiCache,t.changes),t.empty||(this.updatePlugins(t),this.inputState.update(t)),i=this.docView.update(t),this.state.facet(pr)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some((e=>e.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(t.startState.facet(js)!=t.state.facet(js)&&(this.viewState.mustMeasureContent=!0),(i||r||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),i&&this.docViewUpdate(),!t.empty)for(let e of this.state.facet(ji))try{e(t)}catch(e){Qi(this.state,e,"update listener")}(a||c)&&Promise.resolve().then((()=>{a&&this.state==a.startState&&this.dispatch(a),c&&!qr(this,c)&&l.force&&St(this.contentDOM,l.key,l.keyCode)}))}setState(e){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=e);this.updateState=2;let t=this.hasFocus;try{for(let e of this.plugins)e.destroy(this);this.viewState=new Bs(e),this.plugins=e.facet(ir).map((e=>new sr(e))),this.pluginMap.clear();for(let e of this.plugins)e.update(this);this.docView.destroy(),this.docView=new vr(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(ir),i=e.state.facet(ir);if(t!=i){let r=[];for(let s of i){let i=t.indexOf(s);if(i<0)r.push(new sr(s));else{let t=this.plugins[i];t.mustUpdate=e,r.push(t)}}for(let t of this.plugins)t.mustUpdate!=e&&t.destroy(this);this.plugins=r,this.pluginMap.clear()}else for(let t of this.plugins)t.mustUpdate=e;for(let e=0;e<this.plugins.length;e++)this.plugins[e].update(this);t!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(e){Qi(this.state,e,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey)return this.measureScheduled=-1,void this.requestMeasure();this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,r=i.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:n}=this.viewState;Math.abs(r-this.viewState.scrollTop)>1&&(n=-1),this.viewState.scrollAnchorHeight=-1;try{for(let e=0;;e++){if(n<0)if(kt(i))s=-1,n=this.viewState.heightMap.height;else{let e=this.viewState.scrollAnchorAt(r);s=e.from,n=e.top}this.updateState=1;let o=this.viewState.measure(this);if(!o&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(e>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let a=[];4&o||([this.measureRequests,a]=[a,this.measureRequests]);let l=a.map((e=>{try{return e.read(this)}catch(e){return Qi(this.state,e),nn}})),c=mr.create(this,this.state,[]),h=!1;c.flags|=o,t?t.flags|=o:t=c,this.updateState=2,c.empty||(this.updatePlugins(c),this.inputState.update(c),this.updateAttrs(),h=this.docView.update(c),h&&this.docViewUpdate());for(let e=0;e<a.length;e++)if(l[e]!=nn)try{let t=a[e];t.write&&t.write(l[e],this)}catch(e){Qi(this.state,e)}if(h&&this.docView.updateSelection(!0),!c.viewportChanged&&0==this.measureRequests.length){if(this.viewState.editorHeight){if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,n=-1;continue}{let e=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-n;if(e>1||e<-1){r+=e,i.scrollTop=r/this.scaleY,n=-1;continue}}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let e of this.state.facet(ji))e(t)}get themeClasses(){return zs+" "+(this.state.facet($s)?Vs:Us)+" "+this.state.facet(js)}updateAttrs(){let e=an(this,nr,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(er)?"true":"false",class:"cm-content",style:`${Ut.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),an(this,or,t);let i=this.observer.ignore((()=>{let i=ri(this.contentDOM,this.contentAttrs,t),r=ri(this.dom,this.editorAttrs,e);return i||r}));return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let e of i.effects)e.is(rn.announce)&&(t&&(this.announceDOM.textContent=""),t=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=e.value)}mountStyles(){this.styleModules=this.state.facet(pr);let e=this.state.facet(rn.cspNonce);Xe.mount(this.root,this.styleModules.concat(Js).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame((()=>this.measure()))),e){if(this.measureRequests.indexOf(e)>-1)return;if(null!=e.key)for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key)return void(this.measureRequests[t]=e);this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(void 0===t||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find((t=>t.plugin==e))||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return Or(this,e,Mr(this,e,t,i))}moveByGroup(e,t){return Or(this,e,Mr(this,e,t,(t=>function(e,t,i){let r=e.state.charCategorizer(t),s=r(i);return e=>{let t=r(e);return s==ke.Space&&(s=t),s==t}}(this,e.head,t))))}visualLineSide(e,t){let i=this.bidiSpans(e),r=this.textDirectionAt(e.from),s=i[t?i.length-1:0];return W.cursor(s.side(t,r)+e.from,s.forward(!t,r)?1:-1)}moveToLineBoundary(e,t,i=!0){return function(e,t,i,r){let s=Tr(e,t.head,t.assoc||-1),n=r&&s.type==oi.Text&&(e.lineWrapping||s.widgetLineBreaks)?e.coordsAtPos(t.assoc<0&&t.head>s.from?t.head-1:t.head):null;if(n){let t=e.dom.getBoundingClientRect(),r=e.textDirectionAt(s.from),o=e.posAtCoords({x:i==(r==yi.LTR)?t.right-1:t.left+1,y:(n.top+n.bottom)/2});if(null!=o)return W.cursor(o,i?-1:1)}return W.cursor(i?s.to:s.from,i?-1:1)}(this,e,t,i)}moveVertically(e,t,i){return Or(this,e,function(e,t,i,r){let s=t.head,n=i?1:-1;if(s==(i?e.state.doc.length:0))return W.cursor(s,t.assoc);let o,a=t.goalColumn,l=e.contentDOM.getBoundingClientRect(),c=e.coordsAtPos(s,t.assoc||-1),h=e.documentTop;if(c)null==a&&(a=c.left-l.left),o=n<0?c.top:c.bottom;else{let t=e.viewState.lineBlockAt(s);null==a&&(a=Math.min(l.right-l.left,e.defaultCharacterWidth*(s-t.from))),o=(n<0?t.top:t.bottom)+h}let u=l.left+a,d=null!=r?r:e.viewState.heightOracle.textHeight>>1;for(let t=0;;t+=10){let i=o+(d+t)*n,r=Er(e,{x:u,y:i},!1,n);if(i<l.top||i>l.bottom||(n<0?r<s:r>s)){let t=e.docView.coordsForChar(r),s=!t||i<t.top?-1:1;return W.cursor(r,s,void 0,a)}}}(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),Er(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let r=this.state.doc.lineAt(e),s=this.bidiSpans(r);return pt(i,s[Ti.find(s,e-r.from,-1,t)].dir==yi.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(Ki)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>sn)return Pi(e.length);let t,i=this.textDirectionAt(e.from);for(let r of this.bidiCache)if(r.from==e.from&&r.dir==i&&(r.fresh||Mi(r.isolates,t=ur(this,e))))return r.order;t||(t=ur(this,e));let r=function(e,t,i){if(!e)return[new Ti(0,0,t==wi?1:0)];if(t==bi&&!i.length&&!Di.test(e))return Pi(e.length);if(i.length)for(;e.length>Ai.length;)Ai[Ai.length]=256;let r=[],s=t==bi?0:1;return Li(e,s,s,i,0,e.length,r),r}(e.text,i,t);return this.bidiCache.push(new on(e.from,e.to,i,t,!0,r)),r}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||Ut.safari&&(null===(e=this.inputState)||void 0===e?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{bt(this.contentDOM),this.docView.updateSelection()}))}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((9==e.nodeType?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Yi.of(new Xi("number"==typeof e?W.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,i=this.viewState.scrollAnchorAt(e);return Yi.of(new Xi(W.cursor(i.from),"start","start",i.top-e,t,!0))}setTabFocusMode(e){null==e?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:"boolean"==typeof e?this.inputState.tabFocusMode=e?0:-1:0!=this.inputState.tabFocusMode&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return rr.define((()=>({})),{eventHandlers:e})}static domEventObservers(e){return rr.define((()=>({})),{eventObservers:e})}static theme(e,t){let i=Xe.newName(),r=[js.of(i),pr.of(Gs(`.${i}`,e))];return t&&t.dark&&r.push($s.of(!0)),r}static baseTheme(e){return Q.lowest(pr.of(Gs("."+zs,e,Ks)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),r=i&&Tt.get(i)||Tt.get(e);return(null===(t=null==r?void 0:r.rootView)||void 0===t?void 0:t.view)||null}}rn.styleModule=pr,rn.inputHandler=$i,rn.clipboardInputFilter=Ui,rn.clipboardOutputFilter=Vi,rn.scrollHandler=Ji,rn.focusChangeEffect=zi,rn.perLineTextDirection=Ki,rn.exceptionSink=Wi,rn.updateListener=ji,rn.editable=er,rn.mouseSelectionStyle=Fi,rn.dragMovesSelection=Hi,rn.clickAddsSelectionRange=qi,rn.decorations=ar,rn.outerDecorations=lr,rn.atomicRanges=cr,rn.bidiIsolatedRanges=hr,rn.scrollMargins=dr,rn.darkTheme=$s,rn.cspNonce=z.define({combine:e=>e.length?e[0]:""}),rn.contentAttributes=or,rn.editorAttributes=nr,rn.lineWrapping=rn.contentAttributes.of({class:"cm-lineWrapping"}),rn.announce=me.define();const sn=4096,nn={};class on{constructor(e,t,i,r,s,n){this.from=e,this.to=t,this.dir=i,this.isolates=r,this.fresh=s,this.order=n}static update(e,t){if(t.empty&&!e.some((e=>e.fresh)))return e;let i=[],r=e.length?e[e.length-1].dir:yi.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let n=e[s];n.dir!=r||t.touchesRange(n.from,n.to)||i.push(new on(t.mapPos(n.from,1),t.mapPos(n.to,-1),n.dir,n.isolates,!1,n.order))}return i}}function an(e,t,i){for(let r=e.state.facet(t),s=r.length-1;s>=0;s--){let t=r[s],n="function"==typeof t?t(e):t;n&&ei(n,i)}return i}const ln=Ut.mac?"mac":Ut.windows?"win":Ut.linux?"linux":"key";function cn(e,t,i){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==i&&t.shiftKey&&(e="Shift-"+e),e}const hn=Q.default(rn.domEventHandlers({keydown:(e,t)=>vn(fn(t.state),e,t,"editor")})),un=z.define({enables:hn}),dn=new WeakMap;function fn(e){let t=e.facet(un),i=dn.get(t);return i||dn.set(t,i=function(e,t=ln){let i=Object.create(null),r=Object.create(null),s=(e,t)=>{let i=r[e];if(null==i)r[e]=t;else if(i!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")},n=(e,r,n,o,a)=>{var l,c;let h=i[e]||(i[e]=Object.create(null)),u=r.split(/ (?!$)/).map((e=>function(e,t){const i=e.split(/-(?!$)/);let r,s,n,o,a=i[i.length-1];"Space"==a&&(a=" ");for(let e=0;e<i.length-1;++e){const a=i[e];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))r=!0;else if(/^(c|ctrl|control)$/i.test(a))s=!0;else if(/^s(hift)?$/i.test(a))n=!0;else{if(!/^mod$/i.test(a))throw new Error("Unrecognized modifier name: "+a);"mac"==t?o=!0:s=!0}}return r&&(a="Alt-"+a),s&&(a="Ctrl-"+a),o&&(a="Meta-"+a),n&&(a="Shift-"+a),a}(e,t)));for(let t=1;t<u.length;t++){let i=u.slice(0,t).join(" ");s(i,!0),h[i]||(h[i]={preventDefault:!0,stopPropagation:!1,run:[t=>{let r=pn={view:t,prefix:i,scope:e};return setTimeout((()=>{pn==r&&(pn=null)}),gn),!0}]})}let d=u.join(" ");s(d,!1);let f=h[d]||(h[d]={preventDefault:!1,stopPropagation:!1,run:(null===(c=null===(l=h._any)||void 0===l?void 0:l.run)||void 0===c?void 0:c.slice())||[]});n&&f.run.push(n),o&&(f.preventDefault=!0),a&&(f.stopPropagation=!0)};for(let r of e){let e=r.scope?r.scope.split(" "):["editor"];if(r.any)for(let t of e){let e=i[t]||(i[t]=Object.create(null));e._any||(e._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:s}=r;for(let t in e)e[t].run.push((e=>s(e,mn)))}let s=r[t]||r.key;if(s)for(let t of e)n(t,s,r.run,r.preventDefault,r.stopPropagation),r.shift&&n(t,"Shift-"+s,r.shift,r.preventDefault,r.stopPropagation)}return i}(t.reduce(((e,t)=>e.concat(t)),[]))),i}let pn=null;const gn=4e3;let mn=null;function vn(e,t,i,r){mn=t;let s=function(e){var t=!(tt&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||it&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?et:Qe)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}(t),n=T(E(s,0))==s.length&&" "!=s,o="",a=!1,l=!1,c=!1;pn&&pn.view==i&&pn.scope==r&&(o=pn.prefix+" ",Ur.indexOf(t.keyCode)<0&&(l=!0,pn=null));let h,u,d=new Set,f=e=>{if(e){for(let t of e.run)if(!d.has(t)&&(d.add(t),t(i)))return e.stopPropagation&&(c=!0),!0;e.preventDefault&&(e.stopPropagation&&(c=!0),l=!0)}return!1},p=e[r];return p&&(f(p[o+cn(s,t,!n)])?a=!0:n&&(t.altKey||t.metaKey||t.ctrlKey)&&!(Ut.windows&&t.ctrlKey&&t.altKey)&&(h=Qe[t.keyCode])&&h!=s?(f(p[o+cn(h,t,!0)])||t.shiftKey&&(u=et[t.keyCode])!=s&&u!=h&&f(p[o+cn(u,t,!1)]))&&(a=!0):n&&t.shiftKey&&f(p[o+cn(s,t,!0)])&&(a=!0),!a&&f(p._any)&&(a=!0)),l&&(a=!0),a&&c&&t.stopPropagation(),mn=null,a}class _n{constructor(e,t,i,r,s){this.className=e,this.left=t,this.top=i,this.width=r,this.height=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className==this.className&&(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",null!=this.width&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,i){if(i.empty){let r=e.coordsAtPos(i.head,i.assoc||1);if(!r)return[];let s=yn(e);return[new _n(t,r.left-s.left,r.top-s.top,null,r.bottom-r.top)]}return function(e,t,i){if(i.to<=e.viewport.from||i.from>=e.viewport.to)return[];let r=Math.max(i.from,e.viewport.from),s=Math.min(i.to,e.viewport.to),n=e.textDirection==yi.LTR,o=e.contentDOM,a=o.getBoundingClientRect(),l=yn(e),c=o.querySelector(".cm-line"),h=c&&window.getComputedStyle(c),u=a.left+(h?parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)):0),d=a.right-(h?parseInt(h.paddingRight):0),f=Tr(e,r,1),p=Tr(e,s,-1),g=f.type==oi.Text?f:null,m=p.type==oi.Text?p:null;if(g&&(e.lineWrapping||f.widgetLineBreaks)&&(g=bn(e,r,1,g)),m&&(e.lineWrapping||p.widgetLineBreaks)&&(m=bn(e,s,-1,m)),g&&m&&g.from==m.from&&g.to==m.to)return _(y(i.from,i.to,g));{let t=g?y(i.from,null,g):b(f,!1),r=m?y(null,i.to,m):b(p,!0),s=[];return(g||f).to<(m||p).from-(g&&m?1:0)||f.widgetLineBreaks>1&&t.bottom+e.defaultLineHeight/2<r.top?s.push(v(u,t.bottom,d,r.top)):t.bottom<r.top&&e.elementAtHeight((t.bottom+r.top)/2).type==oi.Text&&(t.bottom=r.top=(t.bottom+r.top)/2),_(t).concat(s).concat(_(r))}function v(e,i,r,s){return new _n(t,e-l.left,i-l.top,r-e,s-i)}function _({top:e,bottom:t,horizontal:i}){let r=[];for(let s=0;s<i.length;s+=2)r.push(v(i[s],e,i[s+1],t));return r}function y(t,i,r){let s=1e9,o=-1e9,a=[];function l(t,i,l,c,h){let f=e.coordsAtPos(t,t==r.to?-2:2),p=e.coordsAtPos(l,l==r.from?2:-2);f&&p&&(s=Math.min(f.top,p.top,s),o=Math.max(f.bottom,p.bottom,o),h==yi.LTR?a.push(n&&i?u:f.left,n&&c?d:p.right):a.push(!n&&c?u:p.left,!n&&i?d:f.right))}let c=null!=t?t:r.from,h=null!=i?i:r.to;for(let r of e.visibleRanges)if(r.to>c&&r.from<h)for(let s=Math.max(r.from,c),n=Math.min(r.to,h);;){let r=e.state.doc.lineAt(s);for(let o of e.bidiSpans(r)){let e=o.from+r.from,a=o.to+r.from;if(e>=n)break;a>s&&l(Math.max(e,s),null==t&&e<=c,Math.min(a,n),null==i&&a>=h,o.dir)}if(s=r.to+1,s>=n)break}return 0==a.length&&l(c,null==t,h,null==i,e.textDirection),{top:s,bottom:o,horizontal:a}}function b(e,t){let i=a.top+(t?e.top:e.bottom);return{top:i,bottom:i,horizontal:[]}}}(e,t,i)}}function yn(e){let t=e.scrollDOM.getBoundingClientRect();return{left:(e.textDirection==yi.LTR?t.left:t.right-e.scrollDOM.clientWidth*e.scaleX)-e.scrollDOM.scrollLeft*e.scaleX,top:t.top-e.scrollDOM.scrollTop*e.scaleY}}function bn(e,t,i,r){let s=e.coordsAtPos(t,2*i);if(!s)return r;let n=e.dom.getBoundingClientRect(),o=(s.top+s.bottom)/2,a=e.posAtCoords({x:n.left+1,y:o}),l=e.posAtCoords({x:n.right-1,y:o});return null==a||null==l?r:{from:Math.max(r.from,Math.min(a,l)),to:Math.min(r.to,Math.max(a,l))}}class wn{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(Sn)!=e.state.facet(Sn)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){!1!==this.layer.updateOnDocViewUpdate&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,i=e.facet(Sn);for(;t<i.length&&i[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;e==this.scaleX&&t==this.scaleY||(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some(((e,t)=>{return i=e,r=this.drawn[t],!(i.constructor==r.constructor&&i.eq(r));var i,r}))){let t=this.dom.firstChild,i=0;for(let r of e)r.update&&t&&r.constructor&&this.drawn[i].constructor&&r.update(t,this.drawn[i])?(t=t.nextSibling,i++):this.dom.insertBefore(r.draw(),t);for(;t;){let e=t.nextSibling;t.remove(),t=e}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const Sn=z.define();function Cn(e){return[rr.define((t=>new wn(t,e))),Sn.of(e)]}const kn=z.define({combine:e=>De(e,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})});function xn(e={}){return[kn.of(e),En,Tn,Mn,Gi.of(!0)]}function Rn(e){return e.startState.facet(kn)!=e.state.facet(kn)}const En=Cn({above:!0,markers(e){let{state:t}=e,i=t.facet(kn),r=[];for(let s of t.selection.ranges){let n=s==t.selection.main;if(s.empty||i.drawRangeCursor){let t=n?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",i=s.empty?s:W.cursor(s.head,s.head>s.anchor?-1:1);for(let s of _n.forRange(e,t,i))r.push(s)}}return r},update(e,t){e.transactions.some((e=>e.selection))&&(t.style.animationName="cm-blink"==t.style.animationName?"cm-blink2":"cm-blink");let i=Rn(e);return i&&Dn(e.state,t),e.docChanged||e.selectionSet||i},mount(e,t){Dn(t.state,e)},class:"cm-cursorLayer"});function Dn(e,t){t.style.animationDuration=e.facet(kn).cursorBlinkRate+"ms"}const Tn=Cn({above:!1,markers:e=>e.state.selection.ranges.map((t=>t.empty?[]:_n.forRange(e,"cm-selectionBackground",t))).reduce(((e,t)=>e.concat(t))),update:(e,t)=>e.docChanged||e.selectionSet||e.viewportChanged||Rn(e),class:"cm-selectionLayer"}),Mn=Q.highest(rn.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}})),An=me.define({map:(e,t)=>null==e?null:t.mapPos(e)}),On=Y.define({create:()=>null,update:(e,t)=>(null!=e&&(e=t.changes.mapPos(e)),t.effects.reduce(((e,t)=>t.is(An)?t.value:e),e))}),Ln=rr.fromClass(class{constructor(e){this.view=e,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(e){var t;let i=e.state.field(On);null==i?null!=this.cursor&&(null===(t=this.cursor)||void 0===t||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(e.startState.field(On)!=i||e.docChanged||e.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:e}=this,t=e.state.field(On),i=null!=t&&e.coordsAtPos(t);if(!i)return null;let r=e.scrollDOM.getBoundingClientRect();return{left:i.left-r.left+e.scrollDOM.scrollLeft*e.scaleX,top:i.top-r.top+e.scrollDOM.scrollTop*e.scaleY,height:i.bottom-i.top}}drawCursor(e){if(this.cursor){let{scaleX:t,scaleY:i}=this.view;e?(this.cursor.style.left=e.left/t+"px",this.cursor.style.top=e.top/i+"px",this.cursor.style.height=e.height/i+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(e){this.view.state.field(On)!=e&&this.view.dispatch({effects:An.of(e)})}},{eventObservers:{dragover(e){this.setDropPos(this.view.posAtCoords({x:e.clientX,y:e.clientY}))},dragleave(e){e.target!=this.view.contentDOM&&this.view.contentDOM.contains(e.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function Pn(e,t,i,r,s){t.lastIndex=0;for(let n,o=e.iterRange(i,r),a=i;!o.next().done;a+=o.value.length)if(!o.lineBreak)for(;n=t.exec(o.value);)s(a+n.index,n)}class Bn{constructor(e){const{regexp:t,decoration:i,decorate:r,boundary:s,maxLength:n=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,r)this.addMatch=(e,t,i,s)=>r(s,i,i+e[0].length,e,t);else if("function"==typeof i)this.addMatch=(e,t,r,s)=>{let n=i(e,t,r);n&&s(r,r+e[0].length,n)};else{if(!i)throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.addMatch=(e,t,r,s)=>s(r,r+e[0].length,i)}this.boundary=s,this.maxLength=n}createDeco(e){let t=new Pe,i=t.add.bind(t);for(let{from:t,to:r}of function(e,t){let i=e.visibleRanges;if(1==i.length&&i[0].from==e.viewport.from&&i[0].to==e.viewport.to)return i;let r=[];for(let{from:s,to:n}of i)s=Math.max(e.state.doc.lineAt(s).from,s-t),n=Math.min(e.state.doc.lineAt(n).to,n+t),r.length&&r[r.length-1].to>=s?r[r.length-1].to=n:r.push({from:s,to:n});return r}(e,this.maxLength))Pn(e.state.doc,this.regexp,t,r,((t,r)=>this.addMatch(r,e,t,i)));return t.finish()}updateDeco(e,t){let i=1e9,r=-1;return e.docChanged&&e.changes.iterChanges(((t,s,n,o)=>{o>=e.view.viewport.from&&n<=e.view.viewport.to&&(i=Math.min(n,i),r=Math.max(o,r))})),e.viewportMoved||r-i>1e3?this.createDeco(e.view):r>-1?this.updateRange(e.view,t.map(e.changes),i,r):t}updateRange(e,t,i,r){for(let s of e.visibleRanges){let n=Math.max(s.from,i),o=Math.min(s.to,r);if(o>=n){let i=e.state.doc.lineAt(n),r=i.to<o?e.state.doc.lineAt(o):i,a=Math.max(s.from,i.from),l=Math.min(s.to,r.to);if(this.boundary){for(;n>i.from;n--)if(this.boundary.test(i.text[n-1-i.from])){a=n;break}for(;o<r.to;o++)if(this.boundary.test(r.text[o-r.from])){l=o;break}}let c,h=[],u=(e,t,i)=>h.push(i.range(e,t));if(i==r)for(this.regexp.lastIndex=a-i.from;(c=this.regexp.exec(i.text))&&c.index<l-i.from;)this.addMatch(c,e,c.index+i.from,u);else Pn(e.state.doc,this.regexp,a,l,((t,i)=>this.addMatch(i,e,t,u)));t=t.update({filterFrom:a,filterTo:l,filter:(e,t)=>e<a||t>l,add:h})}}return t}}const In=null!=/x/.unicode?"gu":"g",Nn=new RegExp("[\0-\b\n--\u2028\u2029\ufeff-]",In),qn={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Hn=null;const Fn=z.define({combine(e){let t=De(e,{render:null,specialChars:Nn,addSpecialChars:null});return(t.replaceTabs=!function(){var e;if(null==Hn&&"undefined"!=typeof document&&document.body){let t=document.body.style;Hn=null!=(null!==(e=t.tabSize)&&void 0!==e?e:t.MozTabSize)}return Hn||!1}())&&(t.specialChars=new RegExp("\t|"+t.specialChars.source,In)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,In)),t}});function Wn(e={}){return[Fn.of(e),jn||(jn=rr.fromClass(class{constructor(e){this.view=e,this.decorations=ai.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(e.state.facet(Fn)),this.decorations=this.decorator.createDeco(e)}makeDecorator(e){return new Bn({regexp:e.specialChars,decoration:(t,i,r)=>{let{doc:s}=i.state,n=E(t[0],0);if(9==n){let e=s.lineAt(r),t=i.state.tabSize,n=Ue(e.text,t,r-e.from);return ai.replace({widget:new zn((t-n%t)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[n]||(this.decorationCache[n]=ai.replace({widget:new $n(e,n)}))},boundary:e.replaceTabs?void 0:/[^]/})}update(e){let t=e.state.facet(Fn);e.startState.facet(Fn)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(e.view)):this.decorations=this.decorator.updateDeco(e,this.decorations)}},{decorations:e=>e.decorations}))]}let jn=null;class $n extends ni{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=function(e){return e>=32?"":10==e?"":String.fromCharCode(9216+e)}(this.code),i=e.state.phrase("Control character")+" "+(qn[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,i,t);if(r)return r;let s=document.createElement("span");return s.textContent=t,s.title=i,s.setAttribute("aria-label",i),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class zn extends ni{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="\t",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}const Un=ai.line({class:"cm-activeLine"}),Vn=rr.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.docChanged||e.selectionSet)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=-1,i=[];for(let r of e.state.selection.ranges){let s=e.lineBlockAt(r.head);s.from>t&&(i.push(Un.range(s.from)),t=s.from)}return ai.set(i)}},{decorations:e=>e.decorations}),Kn=2e3;function Gn(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1),r=e.state.doc.lineAt(i),s=i-r.from,n=s>Kn?-1:s==r.length?function(e,t){let i=e.coordsAtPos(e.viewport.from);return i?Math.round(Math.abs((i.left-t)/e.defaultCharacterWidth)):-1}(e,t.clientX):Ue(r.text,e.state.tabSize,i-r.from);return{line:r.number,col:n,off:s}}function Jn(e){let t=(null==e?void 0:e.eventFilter)||(e=>e.altKey&&0==e.button);return rn.mouseSelectionStyle.of(((e,i)=>t(i)?function(e,t){let i=Gn(e,t),r=e.state.selection;return i?{update(e){if(e.docChanged){let t=e.changes.mapPos(e.startState.doc.line(i.line).from),s=e.state.doc.lineAt(t);i={line:s.number,col:i.col,off:Math.min(i.off,s.length)},r=r.map(e.changes)}},get(t,s,n){let o=Gn(e,t);if(!o)return r;let a=function(e,t,i){let r=Math.min(t.line,i.line),s=Math.max(t.line,i.line),n=[];if(t.off>Kn||i.off>Kn||t.col<0||i.col<0){let o=Math.min(t.off,i.off),a=Math.max(t.off,i.off);for(let t=r;t<=s;t++){let i=e.doc.line(t);i.length<=a&&n.push(W.range(i.from+o,i.to+a))}}else{let o=Math.min(t.col,i.col),a=Math.max(t.col,i.col);for(let t=r;t<=s;t++){let i=e.doc.line(t),r=Ve(i.text,o,e.tabSize,!0);if(r<0)n.push(W.cursor(i.to));else{let t=Ve(i.text,a,e.tabSize);n.push(W.range(i.from+r,i.from+t))}}}return n}(e.state,i,o);return a.length?n?W.create(a.concat(r.ranges)):W.create(a):r}}:null}(e,i):null))}const Xn={Alt:[18,e=>!!e.altKey],Control:[17,e=>!!e.ctrlKey],Shift:[16,e=>!!e.shiftKey],Meta:[91,e=>!!e.metaKey]},Yn={style:"cursor: crosshair"};function Zn(e={}){let[t,i]=Xn[e.key||"Alt"],r=rr.fromClass(class{constructor(e){this.view=e,this.isDown=!1}set(e){this.isDown!=e&&(this.isDown=e,this.view.update([]))}},{eventObservers:{keydown(e){this.set(e.keyCode==t||i(e))},keyup(e){e.keyCode!=t&&i(e)||this.set(!1)},mousemove(e){this.set(i(e))}}});return[r,rn.contentAttributes.of((e=>{var t;return(null===(t=e.plugin(r))||void 0===t?void 0:t.isDown)?Yn:null}))]}const Qn="-10000px";class eo{constructor(e,t,i,r){this.facet=t,this.createTooltipView=i,this.removeTooltipView=r,this.input=e.state.facet(t),this.tooltips=this.input.filter((e=>e));let s=null;this.tooltipViews=this.tooltips.map((e=>s=i(e,s)))}update(e,t){var i;let r=e.state.facet(this.facet),s=r.filter((e=>e));if(r===this.input){for(let t of this.tooltipViews)t.update&&t.update(e);return!1}let n=[],o=t?[]:null;for(let i=0;i<s.length;i++){let r=s[i],a=-1;if(r){for(let e=0;e<this.tooltips.length;e++){let t=this.tooltips[e];t&&t.create==r.create&&(a=e)}if(a<0)n[i]=this.createTooltipView(r,i?n[i-1]:null),o&&(o[i]=!!r.above);else{let r=n[i]=this.tooltipViews[a];o&&(o[i]=t[a]),r.update&&r.update(e)}}}for(let e of this.tooltipViews)n.indexOf(e)<0&&(this.removeTooltipView(e),null===(i=e.destroy)||void 0===i||i.call(e));return t&&(o.forEach(((e,i)=>t[i]=e)),t.length=o.length),this.input=r,this.tooltips=s,this.tooltipViews=n,!0}}function to(e){let t=e.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:t.clientHeight,right:t.clientWidth}}const io=z.define({combine:e=>{var t,i,r;return{position:Ut.ios?"absolute":(null===(t=e.find((e=>e.position)))||void 0===t?void 0:t.position)||"fixed",parent:(null===(i=e.find((e=>e.parent)))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(r=e.find((e=>e.tooltipSpace)))||void 0===r?void 0:r.tooltipSpace)||to}}}),ro=new WeakMap,so=rr.fromClass(class{constructor(e){this.view=e,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let t=e.state.facet(io);this.position=t.position,this.parent=t.parent,this.classes=e.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver="function"==typeof ResizeObserver?new ResizeObserver((()=>this.measureSoon())):null,this.manager=new eo(e,lo,((e,t)=>this.createTooltip(e,t)),(e=>{this.resizeObserver&&this.resizeObserver.unobserve(e.dom),e.dom.remove()})),this.above=this.manager.tooltips.map((e=>!!e.above)),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),e.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let e of this.manager.tooltipViews)this.intersectionObserver.observe(e.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(e){e.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(e,this.above);t&&this.observeIntersection();let i=t||e.geometryChanged,r=e.state.facet(io);if(r.position!=this.position&&!this.madeAbsolute){this.position=r.position;for(let e of this.manager.tooltipViews)e.dom.style.position=this.position;i=!0}if(r.parent!=this.parent){this.parent&&this.container.remove(),this.parent=r.parent,this.createContainer();for(let e of this.manager.tooltipViews)this.container.appendChild(e.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(e,t){let i=e.create(this.view),r=t?t.dom:null;if(i.dom.classList.add("cm-tooltip"),e.arrow&&!i.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",i.dom.appendChild(e)}return i.dom.style.position=this.position,i.dom.style.top=Qn,i.dom.style.left="0px",this.container.insertBefore(i.dom,r),i.mount&&i.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(i.dom),i}destroy(){var e,t,i;this.view.win.removeEventListener("resize",this.measureSoon);for(let t of this.manager.tooltipViews)t.dom.remove(),null===(e=t.destroy)||void 0===e||e.call(t);this.parent&&this.container.remove(),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),null===(i=this.intersectionObserver)||void 0===i||i.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let e=1,t=1,i=!1;if("fixed"==this.position&&this.manager.tooltipViews.length){let{dom:e}=this.manager.tooltipViews[0];if(Ut.gecko)i=e.offsetParent!=this.container.ownerDocument.body;else if(e.style.top==Qn&&"0px"==e.style.left){let t=e.getBoundingClientRect();i=Math.abs(t.top+1e4)>1||Math.abs(t.left)>1}}if(i||"absolute"==this.position)if(this.parent){let i=this.parent.getBoundingClientRect();i.width&&i.height&&(e=i.width/this.parent.offsetWidth,t=i.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:t}=this.view.viewState);let r=this.view.scrollDOM.getBoundingClientRect(),s=fr(this.view);return{visible:{left:r.left+s.left,top:r.top+s.top,right:r.right-s.right,bottom:r.bottom-s.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map(((e,t)=>{let i=this.manager.tooltipViews[t];return i.getCoords?i.getCoords(e.pos):this.view.coordsAtPos(e.pos)})),size:this.manager.tooltipViews.map((({dom:e})=>e.getBoundingClientRect())),space:this.view.state.facet(io).tooltipSpace(this.view),scaleX:e,scaleY:t,makeAbsolute:i}}writeMeasure(e){var t;if(e.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let e of this.manager.tooltipViews)e.dom.style.position="absolute"}let{visible:i,space:r,scaleX:s,scaleY:n}=e,o=[];for(let a=0;a<this.manager.tooltips.length;a++){let l=this.manager.tooltips[a],c=this.manager.tooltipViews[a],{dom:h}=c,u=e.pos[a],d=e.size[a];if(!u||!1!==l.clip&&(u.bottom<=Math.max(i.top,r.top)||u.top>=Math.min(i.bottom,r.bottom)||u.right<Math.max(i.left,r.left)-.1||u.left>Math.min(i.right,r.right)+.1)){h.style.top=Qn;continue}let f=l.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,p=f?7:0,g=d.right-d.left,m=null!==(t=ro.get(c))&&void 0!==t?t:d.bottom-d.top,v=c.offset||ao,_=this.view.textDirection==yi.LTR,y=d.width>r.right-r.left?_?r.left:r.right-d.width:_?Math.max(r.left,Math.min(u.left-(f?14:0)+v.x,r.right-g)):Math.min(Math.max(r.left,u.left-g+(f?14:0)-v.x),r.right-g),b=this.above[a];!l.strictSide&&(b?u.top-m-p-v.y<r.top:u.bottom+m+p+v.y>r.bottom)&&b==r.bottom-u.bottom>u.top-r.top&&(b=this.above[a]=!b);let w=(b?u.top-r.top:r.bottom-u.bottom)-p;if(w<m&&!1!==c.resize){if(w<this.view.defaultLineHeight){h.style.top=Qn;continue}ro.set(c,m),h.style.height=(m=w)/n+"px"}else h.style.height&&(h.style.height="");let S=b?u.top-m-p-v.y:u.bottom+p+v.y,C=y+g;if(!0!==c.overlap)for(let e of o)e.left<C&&e.right>y&&e.top<S+m&&e.bottom>S&&(S=b?e.top-m-2-p:e.bottom+p+2);if("absolute"==this.position?(h.style.top=(S-e.parent.top)/n+"px",no(h,(y-e.parent.left)/s)):(h.style.top=S/n+"px",no(h,y/s)),f){let e=u.left+(_?v.x:-v.x)-(y+14-7);f.style.left=e/s+"px"}!0!==c.overlap&&o.push({left:y,top:S,right:C,bottom:S+m}),h.classList.toggle("cm-tooltip-above",b),h.classList.toggle("cm-tooltip-below",!b),c.positioned&&c.positioned(e.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let e of this.manager.tooltipViews)e.dom.style.top=Qn}},{eventObservers:{scroll(){this.maybeMeasure()}}});function no(e,t){let i=parseInt(e.style.left,10);(isNaN(i)||Math.abs(t-i)>1)&&(e.style.left=t+"px")}const oo=rn.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),ao={x:0,y:0},lo=z.define({enables:[so,oo]}),co=z.define({combine:e=>e.reduce(((e,t)=>e.concat(t)),[])});class ho{static create(e){return new ho(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new eo(e,co,((e,t)=>this.createHostedView(e,t)),(e=>e.dom.remove()))}createHostedView(e,t){let i=e.create(this.view);return i.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(i.dom,t?t.dom.nextSibling:this.dom.firstChild),this.mounted&&i.mount&&i.mount(this.view),i}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(e){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let t of this.manager.tooltipViews)null===(e=t.destroy)||void 0===e||e.call(t)}passProp(e){let t;for(let i of this.manager.tooltipViews){let r=i[e];if(void 0!==r)if(void 0===t)t=r;else if(t!==r)return}return t}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const uo=lo.compute([co],(e=>{let t=e.facet(co);return 0===t.length?null:{pos:Math.min(...t.map((e=>e.pos))),end:Math.max(...t.map((e=>{var t;return null!==(t=e.end)&&void 0!==t?t:e.pos}))),create:ho.create,above:t[0].above,arrow:t.some((e=>e.arrow))}}));class fo{constructor(e,t,i,r,s){this.view=e,this.source=t,this.field=i,this.setHover=r,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout((()=>this.startHover()),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:t}=this,i=e.docView.nearest(t.target);if(!i)return;let r,s=1;if(i instanceof Gt)r=i.posAtStart;else{if(r=e.posAtCoords(t),null==r)return;let i=e.coordsAtPos(r);if(!i||t.y<i.top||t.y>i.bottom||t.x<i.left-e.defaultCharacterWidth||t.x>i.right+e.defaultCharacterWidth)return;let n=e.bidiSpans(e.state.doc.lineAt(r)).find((e=>e.from<=r&&e.to>=r)),o=n&&n.dir==yi.RTL?-1:1;s=t.x<i.left?-o:o}let n=this.source(e,r,s);if(null==n?void 0:n.then){let t=this.pending={pos:r};n.then((i=>{this.pending==t&&(this.pending=null,!i||Array.isArray(i)&&!i.length||e.dispatch({effects:this.setHover.of(Array.isArray(i)?i:[i])}))}),(t=>Qi(e.state,t,"hover tooltip")))}else!n||Array.isArray(n)&&!n.length||e.dispatch({effects:this.setHover.of(Array.isArray(n)?n:[n])})}get tooltip(){let e=this.view.plugin(so),t=e?e.manager.tooltips.findIndex((e=>e.create==ho.create)):-1;return t>-1?e.manager.tooltipViews[t]:null}mousemove(e){var t,i;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:r,tooltip:s}=this;if(r.length&&s&&!function(e,t){let i,{left:r,right:s,top:n,bottom:o}=e.getBoundingClientRect();if(i=e.querySelector(".cm-tooltip-arrow")){let e=i.getBoundingClientRect();n=Math.min(e.top,n),o=Math.max(e.bottom,o)}return t.clientX>=r-po&&t.clientX<=s+po&&t.clientY>=n-po&&t.clientY<=o+po}(s.dom,e)||this.pending){let{pos:s}=r[0]||this.pending,n=null!==(i=null===(t=r[0])||void 0===t?void 0:t.end)&&void 0!==i?i:s;(s==n?this.view.posAtCoords(this.lastMove)==s:function(e,t,i,r,s){let n=e.scrollDOM.getBoundingClientRect(),o=e.documentTop+e.documentPadding.top+e.contentHeight;if(n.left>r||n.right<r||n.top>s||Math.min(n.bottom,o)<s)return!1;let a=e.posAtCoords({x:r,y:s},!1);return a>=t&&a<=i}(this.view,s,n,e.clientX,e.clientY))||(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:t}=this;if(t.length){let{tooltip:t}=this;t&&t.dom.contains(e.relatedTarget)?this.watchTooltipLeave(t.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(e){let t=i=>{e.removeEventListener("mouseleave",t),this.active.length&&!this.view.dom.contains(i.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};e.addEventListener("mouseleave",t)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const po=4;function go(e,t={}){let i=me.define(),r=Y.define({create:()=>[],update(e,r){if(e.length&&(t.hideOnChange&&(r.docChanged||r.selection)?e=[]:t.hideOn&&(e=e.filter((e=>!t.hideOn(r,e)))),r.docChanged)){let t=[];for(let i of e){let e=r.changes.mapPos(i.pos,-1,A.TrackDel);if(null!=e){let s=Object.assign(Object.create(null),i);s.pos=e,null!=s.end&&(s.end=r.changes.mapPos(s.end)),t.push(s)}}e=t}for(let t of r.effects)t.is(i)&&(e=t.value),t.is(vo)&&(e=[]);return e},provide:e=>co.from(e)});return{active:r,extension:[r,rr.define((s=>new fo(s,e,r,i,t.hoverTime||300))),uo]}}function mo(e,t){let i=e.plugin(so);if(!i)return null;let r=i.manager.tooltips.indexOf(t);return r<0?null:i.manager.tooltipViews[r]}const vo=me.define(),_o=z.define({combine(e){let t,i;for(let r of e)t=t||r.topContainer,i=i||r.bottomContainer;return{topContainer:t,bottomContainer:i}}});function yo(e,t){let i=e.plugin(bo),r=i?i.specs.indexOf(t):-1;return r>-1?i.panels[r]:null}const bo=rr.fromClass(class{constructor(e){this.input=e.state.facet(Co),this.specs=this.input.filter((e=>e)),this.panels=this.specs.map((t=>t(e)));let t=e.state.facet(_o);this.top=new wo(e,!0,t.topContainer),this.bottom=new wo(e,!1,t.bottomContainer),this.top.sync(this.panels.filter((e=>e.top))),this.bottom.sync(this.panels.filter((e=>!e.top)));for(let e of this.panels)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}update(e){let t=e.state.facet(_o);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new wo(e.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new wo(e.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=e.state.facet(Co);if(i!=this.input){let t=i.filter((e=>e)),r=[],s=[],n=[],o=[];for(let i of t){let t,a=this.specs.indexOf(i);a<0?(t=i(e.view),o.push(t)):(t=this.panels[a],t.update&&t.update(e)),r.push(t),(t.top?s:n).push(t)}this.specs=t,this.panels=r,this.top.sync(s),this.bottom.sync(n);for(let e of o)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}else for(let t of this.panels)t.update&&t.update(e)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:e=>rn.scrollMargins.of((t=>{let i=t.plugin(e);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}}))});class wo{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=So(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=So(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function So(e){let t=e.nextSibling;return e.remove(),t}const Co=z.define({enables:bo});class ko extends Te{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}ko.prototype.elementClass="",ko.prototype.toDOM=void 0,ko.prototype.mapMode=A.TrackBefore,ko.prototype.startSide=ko.prototype.endSide=-1,ko.prototype.point=!0;const xo=z.define(),Ro=z.define(),Eo={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>Le.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Do=z.define();function To(e){return[Ao(),Do.of({...Eo,...e})]}const Mo=z.define({combine:e=>e.some((e=>e))});function Ao(e){let t=[Oo];return e&&!1===e.fixed&&t.push(Mo.of(!0)),t}const Oo=rr.fromClass(class{constructor(e){this.view=e,this.prevViewport=e.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=e.state.facet(Do).map((t=>new Io(e,t)));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!e.state.facet(Mo),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),e.scrollDOM.insertBefore(this.dom,e.contentDOM)}update(e){if(this.updateGutters(e)){let t=this.prevViewport,i=e.view.viewport,r=Math.min(t.to,i.to)-Math.max(t.from,i.from);this.syncGutters(r<.8*(i.to-i.from))}e.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(Mo)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=e.view.viewport}syncGutters(e){let t=this.dom.nextSibling;e&&this.dom.remove();let i=Le.iter(this.view.state.facet(xo),this.view.viewport.from),r=[],s=this.gutters.map((e=>new Bo(e,this.view.viewport,-this.view.documentPadding.top)));for(let e of this.view.viewportLineBlocks)if(r.length&&(r=[]),Array.isArray(e.type)){let t=!0;for(let n of e.type)if(n.type==oi.Text&&t){Po(i,r,n.from);for(let e of s)e.line(this.view,n,r);t=!1}else if(n.widget)for(let e of s)e.widget(this.view,n)}else if(e.type==oi.Text){Po(i,r,e.from);for(let t of s)t.line(this.view,e,r)}else if(e.widget)for(let t of s)t.widget(this.view,e);for(let e of s)e.finish();e&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(e){let t=e.startState.facet(Do),i=e.state.facet(Do),r=e.docChanged||e.heightChanged||e.viewportChanged||!Le.eq(e.startState.facet(xo),e.state.facet(xo),e.view.viewport.from,e.view.viewport.to);if(t==i)for(let t of this.gutters)t.update(e)&&(r=!0);else{r=!0;let s=[];for(let r of i){let i=t.indexOf(r);i<0?s.push(new Io(this.view,r)):(this.gutters[i].update(e),s.push(this.gutters[i]))}for(let e of this.gutters)e.dom.remove(),s.indexOf(e)<0&&e.destroy();for(let e of s)this.dom.appendChild(e.dom);this.gutters=s}return r}destroy(){for(let e of this.gutters)e.destroy();this.dom.remove()}},{provide:e=>rn.scrollMargins.of((t=>{let i=t.plugin(e);return i&&0!=i.gutters.length&&i.fixed?t.textDirection==yi.LTR?{left:i.dom.offsetWidth*t.scaleX}:{right:i.dom.offsetWidth*t.scaleX}:null}))});function Lo(e){return Array.isArray(e)?e:[e]}function Po(e,t,i){for(;e.value&&e.from<=i;)e.from==i&&t.push(e.value),e.next()}class Bo{constructor(e,t,i){this.gutter=e,this.height=i,this.i=0,this.cursor=Le.iter(e.markers,t.from)}addElement(e,t,i){let{gutter:r}=this,s=(t.top-this.height)/e.scaleY,n=t.height/e.scaleY;if(this.i==r.elements.length){let t=new No(e,n,s,i);r.elements.push(t),r.dom.appendChild(t.dom)}else r.elements[this.i].update(e,n,s,i);this.height=t.bottom,this.i++}line(e,t,i){let r=[];Po(this.cursor,r,t.from),i.length&&(r=r.concat(i));let s=this.gutter.config.lineMarker(e,t,r);s&&r.unshift(s);let n=this.gutter;(0!=r.length||n.config.renderEmptyElements)&&this.addElement(e,t,r)}widget(e,t){let i=this.gutter.config.widgetMarker(e,t.widget,t),r=i?[i]:null;for(let i of e.state.facet(Ro)){let s=i(e,t.widget,t);s&&(r||(r=[])).push(s)}r&&this.addElement(e,t,r)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Io{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,(r=>{let s,n=r.target;if(n!=this.dom&&this.dom.contains(n)){for(;n.parentNode!=this.dom;)n=n.parentNode;let e=n.getBoundingClientRect();s=(e.top+e.bottom)/2}else s=r.clientY;let o=e.lineBlockAtHeight(s-e.documentTop);t.domEventHandlers[i](e,o,r)&&r.preventDefault()}));this.markers=Lo(t.markers(e)),t.initialSpacer&&(this.spacer=new No(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Lo(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let t=this.config.updateSpacer(this.spacer.markers[0],e);t!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[t])}let i=e.view.viewport;return!Le.eq(this.markers,t,i.from,i.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(e)}destroy(){for(let e of this.elements)e.destroy()}}class No{constructor(e,t,i,r){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,r)}update(e,t,i,r){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),function(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(!e[i].compare(t[i]))return!1;return!0}(this.markers,r)||this.setMarkers(e,r)}setMarkers(e,t){let i="cm-gutterElement",r=this.dom.firstChild;for(let s=0,n=0;;){let o=n,a=s<t.length?t[s++]:null,l=!1;if(a){let e=a.elementClass;e&&(i+=" "+e);for(let e=n;e<this.markers.length;e++)if(this.markers[e].compare(a)){o=e,l=!0;break}}else o=this.markers.length;for(;n<o;){let e=this.markers[n++];if(e.toDOM){e.destroy(r);let t=r.nextSibling;r.remove(),r=t}}if(!a)break;a.toDOM&&(l?r=r.nextSibling:this.dom.insertBefore(a.toDOM(e),r)),l&&n++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}const qo=z.define(),Ho=z.define(),Fo=z.define({combine:e=>De(e,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let e in t){let r=i[e],s=t[e];i[e]=r?(e,t,i)=>r(e,t,i)||s(e,t,i):s}return i}})});class Wo extends ko{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function jo(e,t){return e.state.facet(Fo).formatNumber(t,e.state)}const $o=Do.compute([Fo],(e=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:e=>e.state.facet(qo),lineMarker:(e,t,i)=>i.some((e=>e.toDOM))?null:new Wo(jo(e,e.state.doc.lineAt(t.from).number)),widgetMarker:(e,t,i)=>{for(let r of e.state.facet(Ho)){let s=r(e,t,i);if(s)return s}return null},lineMarkerChange:e=>e.startState.facet(Fo)!=e.state.facet(Fo),initialSpacer:e=>new Wo(jo(e,Uo(e.state.doc.lines))),updateSpacer(e,t){let i=jo(t.view,Uo(t.view.state.doc.lines));return i==e.number?e:new Wo(i)},domEventHandlers:e.facet(Fo).domEventHandlers})));function zo(e={}){return[Fo.of(e),Ao(),$o]}function Uo(e){let t=9;for(;t<e;)t=10*t+9;return t}const Vo=new class extends ko{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},Ko=xo.compute(["selection"],(e=>{let t=[],i=-1;for(let r of e.selection.ranges){let s=e.doc.lineAt(r.head).from;s>i&&(i=s,t.push(Vo.range(s)))}return Le.of(t)})),Go=1024;let Jo=0;class Xo{constructor(e,t){this.from=e,this.to=t}}class Yo{constructor(e={}){this.id=Jo++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=ea.match(e)),t=>{let i=e(t);return void 0===i?null:[this,i]}}}Yo.closedBy=new Yo({deserialize:e=>e.split(" ")}),Yo.openedBy=new Yo({deserialize:e=>e.split(" ")}),Yo.group=new Yo({deserialize:e=>e.split(" ")}),Yo.isolate=new Yo({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw new RangeError("Invalid value for isolate: "+e);return e||"auto"}}),Yo.contextHash=new Yo({perNode:!0}),Yo.lookAhead=new Yo({perNode:!0}),Yo.mounted=new Yo({perNode:!0});class Zo{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}static get(e){return e&&e.props&&e.props[Yo.mounted.id]}}const Qo=Object.create(null);class ea{constructor(e,t,i,r=0){this.name=e,this.props=t,this.id=i,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):Qo,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),r=new ea(e.name||"",t,e.id,i);if(e.props)for(let i of e.props)if(Array.isArray(i)||(i=i(r)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[i[0].id]=i[1]}return r}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(Yo.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let r of i.split(" "))t[r]=e[i];return e=>{for(let i=e.prop(Yo.group),r=-1;r<(i?i.length:0);r++){let s=t[r<0?e.name:i[r]];if(s)return s}}}}ea.none=new ea("",Object.create(null),0,8);const ta=new WeakMap,ia=new WeakMap;var ra;!function(e){e[e.ExcludeBuffers=1]="ExcludeBuffers",e[e.IncludeAnonymous=2]="IncludeAnonymous",e[e.IgnoreMounts=4]="IgnoreMounts",e[e.IgnoreOverlays=8]="IgnoreOverlays"}(ra||(ra={}));class sa{constructor(e,t,i,r,s){if(this.type=e,this.children=t,this.positions=i,this.length=r,this.props=null,s&&s.length){this.props=Object.create(null);for(let[e,t]of s)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=Zo.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let i=e.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new va(this.topNode,e)}cursorAt(e,t=0,i=0){let r=ta.get(this)||this.topNode,s=new va(r);return s.moveTo(e,t),ta.set(this,s._tree),s}get topNode(){return new ha(this,0,0,null)}resolve(e,t=0){let i=la(ta.get(this)||this.topNode,e,t,!1);return ta.set(this,i),i}resolveInner(e,t=0){let i=la(ia.get(this)||this.topNode,e,t,!0);return ia.set(this,i),i}resolveStack(e,t=0){return function(e,t,i){let r=e.resolveInner(t,i),s=null;for(let e=r instanceof ha?r:r.context.parent;e;e=e.parent)if(e.index<0){let n=e.parent;(s||(s=[r])).push(n.resolve(t,i)),e=n}else{let n=Zo.get(e.tree);if(n&&n.overlay&&n.overlay[0].from<=t&&n.overlay[n.overlay.length-1].to>=t){let o=new ha(n.tree,n.overlay[0].from+e.from,-1,e);(s||(s=[r])).push(la(o,t,i,!1))}}return s?ga(s):r}(this,e,t)}iterate(e){let{enter:t,leave:i,from:r=0,to:s=this.length}=e,n=e.mode||0,o=(n&ra.IncludeAnonymous)>0;for(let e=this.cursor(n|ra.IncludeAnonymous);;){let n=!1;if(e.from<=s&&e.to>=r&&(!o&&e.type.isAnonymous||!1!==t(e))){if(e.firstChild())continue;n=!0}for(;n&&i&&(o||!e.type.isAnonymous)&&i(e),!e.nextSibling();){if(!e.parent())return;n=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:wa(ea.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,i)=>new sa(this.type,e,t,i,this.propValues)),e.makeTree||((e,t,i)=>new sa(ea.none,e,t,i)))}static build(e){return function(e){var t;let{buffer:i,nodeSet:r,maxBufferLength:s=Go,reused:n=[],minRepeatType:o=r.types.length}=e,a=Array.isArray(i)?new na(i,i.length):i,l=r.types,c=0,h=0;function u(e,t,i,m,v,_){let{id:y,start:b,end:w,size:S}=a,C=h,k=c;for(;S<0;){if(a.next(),-1==S){let t=n[y];return i.push(t),void m.push(b-e)}if(-3==S)return void(c=y);if(-4==S)return void(h=y);throw new RangeError(`Unrecognized record size: ${S}`)}let x,R,E=l[y],D=b-e;if(w-b<=s&&(R=function(e,t){let i=a.fork(),r=0,n=0,l=0,c=i.end-s,h={size:0,start:0,skip:0};e:for(let s=i.pos-e;i.pos>s;){let e=i.size;if(i.id==t&&e>=0){h.size=r,h.start=n,h.skip=l,l+=4,r+=4,i.next();continue}let a=i.pos-e;if(e<0||a<s||i.start<c)break;let u=i.id>=o?4:0,d=i.start;for(i.next();i.pos>a;){if(i.size<0){if(-3!=i.size)break e;u+=4}else i.id>=o&&(u+=4);i.next()}n=d,r+=e,l+=u}return(t<0||r==e)&&(h.size=r,h.start=n,h.skip=l),h.size>4?h:void 0}(a.pos-t,v))){let t=new Uint16Array(R.size-R.skip),i=a.pos-R.size,s=t.length;for(;a.pos>i;)s=g(R.start,t,s);x=new oa(t,w-R.start,r),D=R.start-e}else{let e=a.pos-S;a.next();let t=[],i=[],r=y>=o?y:-1,n=0,l=w;for(;a.pos>e;)r>=0&&a.id==r&&a.size>=0?(a.end<=l-s&&(f(t,i,b,n,a.end,l,r,C,k),n=t.length,l=a.end),a.next()):_>2500?d(b,e,t,i):u(b,e,t,i,r,_+1);if(r>=0&&n>0&&n<t.length&&f(t,i,b,n,b,l,r,C,k),t.reverse(),i.reverse(),r>-1&&n>0){let e=function(e,t){return(i,r,s)=>{let n,o,a=0,l=i.length-1;if(l>=0&&(n=i[l])instanceof sa){if(!l&&n.type==e&&n.length==s)return n;(o=n.prop(Yo.lookAhead))&&(a=r[l]+n.length+o)}return p(e,i,r,s,a,t)}}(E,k);x=wa(E,t,i,0,t.length,0,w-b,e,e)}else x=p(E,t,i,w-b,C-w,k)}i.push(x),m.push(D)}function d(e,t,i,n){let o=[],l=0,c=-1;for(;a.pos>t;){let{id:e,start:t,end:i,size:r}=a;if(r>4)a.next();else{if(c>-1&&t<c)break;c<0&&(c=i-s),o.push(e,t,i),l++,a.next()}}if(l){let t=new Uint16Array(4*l),s=o[o.length-2];for(let e=o.length-3,i=0;e>=0;e-=3)t[i++]=o[e],t[i++]=o[e+1]-s,t[i++]=o[e+2]-s,t[i++]=i;i.push(new oa(t,o[2]-s,r)),n.push(s-e)}}function f(e,t,i,s,n,o,a,l,c){let h=[],u=[];for(;e.length>s;)h.push(e.pop()),u.push(t.pop()+i-n);e.push(p(r.types[a],h,u,o-n,l-o,c)),t.push(n-i)}function p(e,t,i,r,s,n,o){if(n){let e=[Yo.contextHash,n];o=o?[e].concat(o):[e]}if(s>25){let e=[Yo.lookAhead,s];o=o?[e].concat(o):[e]}return new sa(e,t,i,r,o)}function g(e,t,i){let{id:r,start:s,end:n,size:l}=a;if(a.next(),l>=0&&r<o){let o=i;if(l>4){let r=a.pos-(l-4);for(;a.pos>r;)i=g(e,t,i)}t[--i]=o,t[--i]=n-e,t[--i]=s-e,t[--i]=r}else-3==l?c=r:-4==l&&(h=r);return i}let m=[],v=[];for(;a.pos>0;)u(e.start||0,e.bufferStart||0,m,v,-1,0);let _=null!==(t=e.length)&&void 0!==t?t:m.length?v[0]+m[0].length:0;return new sa(l[e.topID],m.reverse(),v.reverse(),_)}(e)}}sa.empty=new sa(ea.none,[],[],0);class na{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new na(this.buffer,this.index)}}class oa{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return ea.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],r=this.set.types[t],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),i==(e+=4))return s;let n=[];for(;e<i;)n.push(this.childString(e)),e=this.buffer[e+3];return s+"("+n.join(",")+")"}findChild(e,t,i,r,s){let{buffer:n}=this,o=-1;for(let a=e;a!=t&&!(aa(s,r,n[a+1],n[a+2])&&(o=a,i>0));a=n[a+3]);return o}slice(e,t,i){let r=this.buffer,s=new Uint16Array(t-e),n=0;for(let o=e,a=0;o<t;){s[a++]=r[o++],s[a++]=r[o++]-i;let t=s[a++]=r[o++]-i;s[a++]=r[o++]-e,n=Math.max(n,t)}return new oa(s,n,this.set)}}function aa(e,t,i,r){switch(e){case-2:return i<t;case-1:return r>=t&&i<t;case 0:return i<t&&r>t;case 1:return i<=t&&r>t;case 2:return r>t;case 4:return!0}}function la(e,t,i,r){for(var s;e.from==e.to||(i<1?e.from>=t:e.from>t)||(i>-1?e.to<=t:e.to<t);){let t=!r&&e instanceof ha&&e.index<0?null:e.parent;if(!t)return e;e=t}let n=r?0:ra.IgnoreOverlays;if(r)for(let r=e,o=r.parent;o;r=o,o=r.parent)r instanceof ha&&r.index<0&&(null===(s=o.enter(t,i,n))||void 0===s?void 0:s.from)!=r.from&&(e=o);for(;;){let r=e.enter(t,i,n);if(!r)return e;e=r}}class ca{cursor(e=0){return new va(this,e)}getChild(e,t=null,i=null){let r=ua(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return ua(this,e,t,i)}resolve(e,t=0){return la(this,e,t,!1)}resolveInner(e,t=0){return la(this,e,t,!0)}matchContext(e){return da(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(i=t,t=e.prevSibling):t=e}return i}get node(){return this}get next(){return this.parent}}class ha extends ca{constructor(e,t,i,r){super(),this._tree=e,this.from=t,this.index=i,this._parent=r}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,r,s=0){for(let n=this;;){for(let{children:o,positions:a}=n._tree,l=t>0?o.length:-1;e!=l;e+=t){let l=o[e],c=a[e]+n.from;if(aa(r,i,c,c+l.length))if(l instanceof oa){if(s&ra.ExcludeBuffers)continue;let o=l.findChild(0,l.buffer.length,t,i-c,r);if(o>-1)return new pa(new fa(n,l,e,c),null,o)}else if(s&ra.IncludeAnonymous||!l.type.isAnonymous||_a(l)){let o;if(!(s&ra.IgnoreMounts)&&(o=Zo.get(l))&&!o.overlay)return new ha(o.tree,c,e,n);let a=new ha(l,c,e,n);return s&ra.IncludeAnonymous||!a.type.isAnonymous?a:a.nextChild(t<0?l.children.length-1:0,t,i,r)}}if(s&ra.IncludeAnonymous||!n.type.isAnonymous)return null;if(e=n.index>=0?n.index+t:t<0?-1:n._parent._tree.children.length,n=n._parent,!n)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let r;if(!(i&ra.IgnoreOverlays)&&(r=Zo.get(this._tree))&&r.overlay){let i=e-this.from;for(let{from:e,to:s}of r.overlay)if((t>0?e<=i:e<i)&&(t<0?s>=i:s>i))return new ha(r.tree,r.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function ua(e,t,i,r){let s=e.cursor(),n=[];if(!s.firstChild())return n;if(null!=i)for(let e=!1;!e;)if(e=s.type.is(i),!s.nextSibling())return n;for(;;){if(null!=r&&s.type.is(r))return n;if(s.type.is(t)&&n.push(s.node),!s.nextSibling())return null==r?n:[]}}function da(e,t,i=t.length-1){for(let r=e;i>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(t[i]&&t[i]!=r.name)return!1;i--}}return!0}class fa{constructor(e,t,i,r){this.parent=e,this.buffer=t,this.index=i,this.start=r}}class pa extends ca{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new pa(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&ra.ExcludeBuffers)return null;let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new pa(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new pa(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new pa(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,r=this.index+4,s=i.buffer[this.index+3];if(s>r){let n=i.buffer[this.index+1];e.push(i.slice(r,s,n)),t.push(0)}return new sa(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function ga(e){if(!e.length)return null;let t=0,i=e[0];for(let r=1;r<e.length;r++){let s=e[r];(s.from>i.from||s.to<i.to)&&(i=s,t=r)}let r=i instanceof ha&&i.index<0?null:i.parent,s=e.slice();return r?s[t]=r:s.splice(t,1),new ma(s,i)}class ma{constructor(e,t){this.heads=e,this.node=t}get next(){return ga(this.heads)}}class va{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof ha)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:i,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=i+r.buffer[e+1],this.to=i+r.buffer[e+2],!0}yield(e){return!!e&&(e instanceof ha?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:r}=this.buffer,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,i);return!(s<0)&&(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?!(i&ra.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&ra.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&ra.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let e=i<0?0:this.stack[i]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(e)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(r.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:i}=r)}else({index:t,_parent:i}=this._tree);for(;i;({index:t,_parent:i}=i))if(t>-1)for(let r=t+e,s=e<0?-1:i._tree.children.length;r!=s;r+=e){let e=i._tree.children[r];if(this.mode&ra.IncludeAnonymous||e instanceof oa||!e.type.isAnonymous||_a(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let r=this.index,s=this.stack.length;s>=0;){for(let n=e;n;n=n._parent)if(n.index==r){if(r==this.index)return n;t=n,i=s+1;break e}r=this.stack[--s]}for(let e=i;e<this.stack.length;e++)t=new pa(this.buffer,t,this.stack[e]);return this.bufferNode=new pa(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let r=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(r=!0)}for(;;){if(r&&t&&t(this),r=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,r=!0}}}matchContext(e){if(!this.buffer)return da(this.node.parent,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let r=e.length-1,s=this.stack.length-1;r>=0;s--){if(s<0)return da(this._tree,e,r);let n=i[t.buffer[this.stack[s]]];if(!n.isAnonymous){if(e[r]&&e[r]!=n.name)return!1;r--}}return!0}}function _a(e){return e.children.some((e=>e instanceof oa||!e.type.isAnonymous||_a(e)))}const ya=new WeakMap;function ba(e,t){if(!e.isAnonymous||t instanceof oa||t.type!=e)return 1;let i=ya.get(t);if(null==i){i=1;for(let r of t.children){if(r.type!=e||!(r instanceof sa)){i=1;break}i+=ba(e,r)}ya.set(t,i)}return i}function wa(e,t,i,r,s,n,o,a,l){let c=0;for(let i=r;i<s;i++)c+=ba(e,t[i]);let h=Math.ceil(1.5*c/8),u=[],d=[];return function t(i,r,s,o,a){for(let c=s;c<o;){let s=c,f=r[c],p=ba(e,i[c]);for(c++;c<o;c++){let t=ba(e,i[c]);if(p+t>=h)break;p+=t}if(c==s+1){if(p>h){let e=i[s];t(e.children,e.positions,0,e.children.length,r[s]+a);continue}u.push(i[s])}else{let t=r[c-1]+i[c-1].length-f;u.push(wa(e,i,r,s,c,f,t,null,l))}d.push(f+a-n)}}(t,i,r,s,0),(a||l)(u,d,o)}class Sa{constructor(e,t,i,r,s=!1,n=!1){this.from=e,this.to=t,this.tree=i,this.offset=r,this.open=(s?1:0)|(n?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(e,t=[],i=!1){let r=[new Sa(0,e.length,e,0,!1,i)];for(let i of t)i.to>e.length&&r.push(i);return r}static applyChanges(e,t,i=128){if(!t.length)return e;let r=[],s=1,n=e.length?e[0]:null;for(let o=0,a=0,l=0;;o++){let c=o<t.length?t[o]:null,h=c?c.fromA:1e9;if(h-a>=i)for(;n&&n.from<h;){let t=n;if(a>=t.from||h<=t.to||l){let e=Math.max(t.from,a)-l,i=Math.min(t.to,h)-l;t=e>=i?null:new Sa(e,i,t.tree,t.offset+l,o>0,!!c)}if(t&&r.push(t),n.to>h)break;n=s<e.length?e[s++]:null}if(!c)break;a=c.toA,l=c.toA-c.toB}return r}}class Ca{startParse(e,t,i){return"string"==typeof e&&(e=new ka(e)),i=i?i.length?i.map((e=>new Xo(e.from,e.to))):[new Xo(0,0)]:[new Xo(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let r=this.startParse(e,t,i);for(;;){let e=r.advance();if(e)return e}}}class ka{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new Yo({perNode:!0});let xa=0;class Ra{constructor(e,t,i,r){this.name=e,this.set=t,this.base=i,this.modified=r,this.id=xa++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let i="string"==typeof e?e:"?";if(e instanceof Ra&&(t=e),null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let r=new Ra(i,[],null,[]);if(r.set.push(r),t)for(let e of t.set)r.set.push(e);return r}static defineModifier(e){let t=new Da(e);return e=>e.modified.indexOf(t)>-1?e:Da.get(e.base||e,e.modified.concat(t).sort(((e,t)=>e.id-t.id)))}}let Ea=0;class Da{constructor(e){this.name=e,this.instances=[],this.id=Ea++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find((i=>{return i.base==e&&(r=t,s=i.modified,r.length==s.length&&r.every(((e,t)=>e==s[t])));var r,s}));if(i)return i;let r=[],s=new Ra(e.name,r,e,t);for(let e of t)e.instances.push(s);let n=function(e){let t=[[]];for(let i=0;i<e.length;i++)for(let r=0,s=t.length;r<s;r++)t.push(t[r].concat(e[i]));return t.sort(((e,t)=>t.length-e.length))}(t);for(let t of e.set)if(!t.modified.length)for(let e of n)r.push(Da.get(t,e));return s}}function Ta(e){let t=Object.create(null);for(let i in e){let r=e[i];Array.isArray(r)||(r=[r]);for(let e of i.split(" "))if(e){let i=[],s=2,n=e;for(let t=0;;){if("..."==n&&t>0&&t+3==e.length){s=1;break}let r=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(n);if(!r)throw new RangeError("Invalid path: "+e);if(i.push("*"==r[0]?"":'"'==r[0][0]?JSON.parse(r[0]):r[0]),t+=r[0].length,t==e.length)break;let o=e[t++];if(t==e.length&&"!"==o){s=0;break}if("/"!=o)throw new RangeError("Invalid path: "+e);n=e.slice(t)}let o=i.length-1,a=i[o];if(!a)throw new RangeError("Invalid path: "+e);let l=new Aa(r,s,o>0?i.slice(0,o):null);t[a]=l.sort(t[a])}}return Ma.add(t)}const Ma=new Yo;class Aa{constructor(e,t,i,r){this.tags=e,this.mode=t,this.context=i,this.next=r}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}function Oa(e,t){let i=Object.create(null);for(let t of e)if(Array.isArray(t.tag))for(let e of t.tag)i[e.id]=t.class;else i[t.tag.id]=t.class;let{scope:r,all:s=null}=t||{};return{style:e=>{let t=s;for(let r of e)for(let e of r.set){let r=i[e.id];if(r){t=t?t+" "+r:r;break}}return t},scope:r}}function La(e,t,i,r=0,s=e.length){let n=new Pa(r,Array.isArray(t)?t:[t],i);n.highlightRange(e.cursor(),r,s,"",n.highlighters),n.flush(s)}Aa.empty=new Aa([],2,null);class Pa{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,r,s){let{type:n,from:o,to:a}=e;if(o>=i||a<=t)return;n.isTop&&(s=this.highlighters.filter((e=>!e.scope||e.scope(n))));let l=r,c=function(e){let t=e.type.prop(Ma);for(;t&&t.context&&!e.matchContext(t.context);)t=t.next;return t||null}(e)||Aa.empty,h=function(e,t){let i=null;for(let r of e){let e=r.style(t);e&&(i=i?i+" "+e:e)}return i}(s,c.tags);if(h&&(l&&(l+=" "),l+=h,1==c.mode&&(r+=(r?" ":"")+h)),this.startSpan(Math.max(t,o),l),c.opaque)return;let u=e.tree&&e.tree.prop(Yo.mounted);if(u&&u.overlay){let n=e.node.enter(u.overlay[0].from+o,1),c=this.highlighters.filter((e=>!e.scope||e.scope(u.tree.type))),h=e.firstChild();for(let d=0,f=o;;d++){let p=d<u.overlay.length?u.overlay[d]:null,g=p?p.from+o:a,m=Math.max(t,f),v=Math.min(i,g);if(m<v&&h)for(;e.from<v&&(this.highlightRange(e,m,v,r,s),this.startSpan(Math.min(v,e.to),l),!(e.to>=g)&&e.nextSibling()););if(!p||g>i)break;f=p.to+o,f>t&&(this.highlightRange(n.cursor(),Math.max(t,p.from+o),Math.min(i,f),"",c),this.startSpan(Math.min(i,f),l))}h&&e.parent()}else if(e.firstChild()){u&&(r="");do{if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,r,s),this.startSpan(Math.min(i,e.to),l)}}while(e.nextSibling());e.parent()}}}const Ba=Ra.define,Ia=Ba(),Na=Ba(),qa=Ba(Na),Ha=Ba(Na),Fa=Ba(),Wa=Ba(Fa),ja=Ba(Fa),$a=Ba(),za=Ba($a),Ua=Ba(),Va=Ba(),Ka=Ba(),Ga=Ba(Ka),Ja=Ba(),Xa={comment:Ia,lineComment:Ba(Ia),blockComment:Ba(Ia),docComment:Ba(Ia),name:Na,variableName:Ba(Na),typeName:qa,tagName:Ba(qa),propertyName:Ha,attributeName:Ba(Ha),className:Ba(Na),labelName:Ba(Na),namespace:Ba(Na),macroName:Ba(Na),literal:Fa,string:Wa,docString:Ba(Wa),character:Ba(Wa),attributeValue:Ba(Wa),number:ja,integer:Ba(ja),float:Ba(ja),bool:Ba(Fa),regexp:Ba(Fa),escape:Ba(Fa),color:Ba(Fa),url:Ba(Fa),keyword:Ua,self:Ba(Ua),null:Ba(Ua),atom:Ba(Ua),unit:Ba(Ua),modifier:Ba(Ua),operatorKeyword:Ba(Ua),controlKeyword:Ba(Ua),definitionKeyword:Ba(Ua),moduleKeyword:Ba(Ua),operator:Va,derefOperator:Ba(Va),arithmeticOperator:Ba(Va),logicOperator:Ba(Va),bitwiseOperator:Ba(Va),compareOperator:Ba(Va),updateOperator:Ba(Va),definitionOperator:Ba(Va),typeOperator:Ba(Va),controlOperator:Ba(Va),punctuation:Ka,separator:Ba(Ka),bracket:Ga,angleBracket:Ba(Ga),squareBracket:Ba(Ga),paren:Ba(Ga),brace:Ba(Ga),content:$a,heading:za,heading1:Ba(za),heading2:Ba(za),heading3:Ba(za),heading4:Ba(za),heading5:Ba(za),heading6:Ba(za),contentSeparator:Ba($a),list:Ba($a),quote:Ba($a),emphasis:Ba($a),strong:Ba($a),link:Ba($a),monospace:Ba($a),strikethrough:Ba($a),inserted:Ba(),deleted:Ba(),changed:Ba(),invalid:Ba(),meta:Ja,documentMeta:Ba(Ja),annotation:Ba(Ja),processingInstruction:Ba(Ja),definition:Ra.defineModifier("definition"),constant:Ra.defineModifier("constant"),function:Ra.defineModifier("function"),standard:Ra.defineModifier("standard"),local:Ra.defineModifier("local"),special:Ra.defineModifier("special")};for(let e in Xa){let t=Xa[e];t instanceof Ra&&(t.name=e)}var Ya;Oa([{tag:Xa.link,class:"tok-link"},{tag:Xa.heading,class:"tok-heading"},{tag:Xa.emphasis,class:"tok-emphasis"},{tag:Xa.strong,class:"tok-strong"},{tag:Xa.keyword,class:"tok-keyword"},{tag:Xa.atom,class:"tok-atom"},{tag:Xa.bool,class:"tok-bool"},{tag:Xa.url,class:"tok-url"},{tag:Xa.labelName,class:"tok-labelName"},{tag:Xa.inserted,class:"tok-inserted"},{tag:Xa.deleted,class:"tok-deleted"},{tag:Xa.literal,class:"tok-literal"},{tag:Xa.string,class:"tok-string"},{tag:Xa.number,class:"tok-number"},{tag:[Xa.regexp,Xa.escape,Xa.special(Xa.string)],class:"tok-string2"},{tag:Xa.variableName,class:"tok-variableName"},{tag:Xa.local(Xa.variableName),class:"tok-variableName tok-local"},{tag:Xa.definition(Xa.variableName),class:"tok-variableName tok-definition"},{tag:Xa.special(Xa.variableName),class:"tok-variableName2"},{tag:Xa.definition(Xa.propertyName),class:"tok-propertyName tok-definition"},{tag:Xa.typeName,class:"tok-typeName"},{tag:Xa.namespace,class:"tok-namespace"},{tag:Xa.className,class:"tok-className"},{tag:Xa.macroName,class:"tok-macroName"},{tag:Xa.propertyName,class:"tok-propertyName"},{tag:Xa.operator,class:"tok-operator"},{tag:Xa.comment,class:"tok-comment"},{tag:Xa.meta,class:"tok-meta"},{tag:Xa.invalid,class:"tok-invalid"},{tag:Xa.punctuation,class:"tok-punctuation"}]);const Za=new Yo,Qa=new Yo;class el{constructor(e,t,i=[],r=""){this.data=e,this.name=r,Ee.prototype.hasOwnProperty("tree")||Object.defineProperty(Ee.prototype,"tree",{get(){return il(this)}}),this.parser=t,this.extension=[ul.of(this),Ee.languageData.of(((e,t,i)=>{let r=tl(e,t,i),s=r.type.prop(Za);if(!s)return[];let n=e.facet(s),o=r.type.prop(Qa);if(o){let s=r.resolve(t-r.from,i);for(let t of o)if(t.test(s,e)){let i=e.facet(t.facet);return"replace"==t.type?i:i.concat(n)}}return n}))].concat(i)}isActiveAt(e,t,i=-1){return tl(e,t,i).type.prop(Za)==this.data}findRegions(e){let t=e.facet(ul);if((null==t?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],r=(e,t)=>{if(e.prop(Za)==this.data)return void i.push({from:t,to:t+e.length});let s=e.prop(Yo.mounted);if(s){if(s.tree.prop(Za)==this.data){if(s.overlay)for(let e of s.overlay)i.push({from:e.from+t,to:e.to+t});else i.push({from:t,to:t+e.length});return}if(s.overlay){let e=i.length;if(r(s.tree,s.overlay[0].from+t),i.length>e)return}}for(let i=0;i<e.children.length;i++){let s=e.children[i];s instanceof sa&&r(s,e.positions[i]+t)}};return r(il(e),0),i}get allowsNesting(){return!0}}function tl(e,t,i){let r=e.facet(ul),s=il(e).topNode;if(!r||r.allowsNesting)for(let e=s;e;e=e.enter(t,i,ra.ExcludeBuffers))e.type.isTop&&(s=e);return s}function il(e){let t=e.field(el.state,!1);return t?t.tree:sa.empty}el.setState=me.define();class rl{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let sl=null;class nl{constructor(e,t,i=[],r,s,n,o,a){this.parser=e,this.state=t,this.fragments=i,this.tree=r,this.treeLen=s,this.viewport=n,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new nl(e,t,[],sa.empty,0,i,[],null)}startParse(){return this.parser.startParse(new rl(this.state.doc),this.fragments)}work(e,t){return null!=t&&t>=this.state.doc.length&&(t=void 0),this.tree!=sa.empty&&this.isDone(null!=t?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var i;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=t&&(null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let r=this.parse.advance();if(r){if(this.fragments=this.withoutTempSkipped(Sa.addTree(r,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=r,this.parse=null,!(this.treeLen<(null!=t?t:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}}))}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext((()=>{for(;!(t=this.parse.advance()););})),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Sa.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=sl;sl=this;try{return e()}finally{sl=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=ol(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:r,treeLen:s,viewport:n,skipped:o}=this;if(this.takeTree(),!e.empty){let t=[];if(e.iterChangedRanges(((e,i,r,s)=>t.push({fromA:e,toA:i,fromB:r,toB:s}))),i=Sa.applyChanges(i,t),r=sa.empty,s=0,n={from:e.mapPos(n.from,-1),to:e.mapPos(n.to,1)},this.skipped.length){o=[];for(let t of this.skipped){let i=e.mapPos(t.from,1),r=e.mapPos(t.to,-1);i<r&&o.push({from:i,to:r})}}}return new nl(this.parser,t,i,r,s,n,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let t=0;t<this.skipped.length;t++){let{from:i,to:r}=this.skipped[t];i<e.to&&r>e.from&&(this.fragments=ol(this.fragments,i,r),this.skipped.splice(t--,1))}return!(this.skipped.length>=t||(this.reset(),0))}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Ca{createParse(t,i,r){let s=r[0].from,n=r[r.length-1].to;return{parsedPos:s,advance(){let t=sl;if(t){for(let e of r)t.tempSkipped.push(e);e&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e)}return this.parsedPos=n,new sa(ea.none,[],[],n-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&0==t[0].from&&t[0].to>=e}static get(){return sl}}function ol(e,t,i){return Sa.applyChanges(e,[{fromA:t,toA:i,fromB:t,toB:i}])}class al{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new al(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=nl.create(e.facet(ul).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new al(i)}}el.state=Y.define({create:al.init,update(e,t){for(let e of t.effects)if(e.is(el.setState))return e.value;return t.startState.facet(ul)!=t.state.facet(ul)?al.init(t.state):e.apply(t)}});let ll=e=>{let t=setTimeout((()=>e()),500);return()=>clearTimeout(t)};"undefined"!=typeof requestIdleCallback&&(ll=e=>{let t=-1,i=setTimeout((()=>{t=requestIdleCallback(e,{timeout:400})}),100);return()=>t<0?clearTimeout(i):cancelIdleCallback(t)});const cl="undefined"!=typeof navigator&&(null===(Ya=navigator.scheduling)||void 0===Ya?void 0:Ya.isInputPending)?()=>navigator.scheduling.isInputPending():null,hl=rr.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(el.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(el.state);t.tree==t.context.tree&&t.context.isDone(e.doc.length)||(this.working=ll(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:r}}=this.view,s=i.field(el.state);if(s.tree==s.context.tree&&s.context.isDone(r+1e5))return;let n=Date.now()+Math.min(this.chunkBudget,100,e&&!cl?Math.max(25,e.timeRemaining()-5):1e9),o=s.context.treeLen<r&&i.doc.length>r+1e3,a=s.context.work((()=>cl&&cl()||Date.now()>n),r+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:el.setState.of(new al(s.context))})),this.chunkBudget>0&&(!a||o)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then((()=>this.scheduleWork())).catch((e=>Qi(this.view.state,e))).then((()=>this.workScheduled--)),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),ul=z.define({combine:e=>e.length?e[0]:null,enables:e=>[el.state,hl,rn.contentAttributes.compute([e],(t=>{let i=t.facet(e);return i&&i.name?{"data-language":i.name}:{}}))]}),dl=z.define(),fl=z.define({combine:e=>{if(!e.length)return"  ";let t=e[0];if(!t||/\S/.test(t)||Array.from(t).some((e=>e!=t[0])))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return t}});function pl(e){let t=e.facet(fl);return 9==t.charCodeAt(0)?e.tabSize*t.length:t.length}function gl(e,t){let i="",r=e.tabSize,s=e.facet(fl)[0];if("\t"==s){for(;t>=r;)i+="\t",t-=r;s=" "}for(let e=0;e<t;e++)i+=s;return i}function ml(e,t){e instanceof Ee&&(e=new vl(e));for(let i of e.state.facet(dl)){let r=i(e,t);if(void 0!==r)return r}let i=il(e.state);return i.length>=t?function(e,t,i){let r=t.resolveStack(i),s=t.resolveInner(i,-1).resolve(i,0).enterUnfinishedNodesBefore(i);if(s!=r.node){let e=[];for(let t=s;t&&!(t.from<r.node.from||t.to>r.node.to||t.from==r.node.from&&t.type==r.node.type);t=t.parent)e.push(t);for(let t=e.length-1;t>=0;t--)r={node:e[t],next:r}}return yl(r,e,i)}(e,i,t):null}class vl{constructor(e,t={}){this.state=e,this.options=t,this.unit=pl(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:r,simulateDoubleBreak:s}=this.options;return null!=r&&r>=i.from&&r<=i.to?s&&r==e?{text:"",from:e}:(t<0?r<e:r<=e)?{text:i.text.slice(r-i.from),from:r}:{text:i.text.slice(0,r-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:r}=this.lineAt(e,t);return i.slice(e-r,Math.min(i.length,e+100-r))}column(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.countColumn(i,e-r),n=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return n>-1&&(s+=n-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return Ue(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let e=s(r);if(e>-1)return e}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const _l=new Yo;function yl(e,t,i){for(let r=e;r;r=r.next){let e=bl(r.node);if(e)return e(Sl.create(t,i,r))}return 0}function bl(e){let t=e.type.prop(_l);if(t)return t;let i,r=e.firstChild;if(r&&(i=r.type.prop(Yo.closedBy))){let t=e.lastChild,r=t&&i.indexOf(t.name)>-1;return e=>function(e,t,i,r,s){let n=e.textAfter,o=n.match(/^\s*/)[0].length,a=r&&n.slice(o,o+r.length)==r||s==e.pos+o,l=t?function(e){let t=e.node,i=t.childAfter(t.from),r=t.lastChild;if(!i)return null;let s=e.options.simulateBreak,n=e.state.doc.lineAt(i.from),o=null==s||s<=n.from?n.to:Math.min(n.to,s);for(let e=i.to;;){let s=t.childAfter(e);if(!s||s==r)return null;if(!s.type.isSkipped){if(s.from>=o)return null;let e=/^ */.exec(n.text.slice(i.to-n.from))[0].length;return{from:i.from,to:i.to+e}}e=s.to}}(e):null;return l?a?e.column(l.from):e.column(l.to):e.baseIndent+(a?0:e.unit*i)}(e,!0,1,void 0,r&&!function(e){return e.pos==e.options.simulateBreak&&e.options.simulateDoubleBreak}(e)?t.from:void 0)}return null==e.parent?wl:null}function wl(){return 0}class Sl extends vl{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.context=i}get node(){return this.context.node}static create(e,t,i){return new Sl(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let i=e.resolve(t.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(Cl(i,e))break;t=this.state.doc.lineAt(i.from)}return this.lineIndent(t.from)}continue(){return yl(this.context.next,this.base,this.pos)}}function Cl(e,t){for(let i=t;i;i=i.parent)if(e==i)return!0;return!1}const kl=z.define(),xl=new Yo;function Rl(e){let t=e.lastChild;return t&&t.to==e.to&&t.type.isError}function El(e,t,i){for(let r of e.facet(kl)){let s=r(e,t,i);if(s)return s}return function(e,t,i){let r=il(e);if(r.length<i)return null;let s=null;for(let n=r.resolveStack(i,1);n;n=n.next){let o=n.node;if(o.to<=i||o.from>i)continue;if(s&&o.from<t)break;let a=o.type.prop(xl);if(a&&(o.to<r.length-50||r.length==e.doc.length||!Rl(o))){let r=a(o,e);r&&r.from<=i&&r.from>=t&&r.to>i&&(s=r)}}return s}(e,t,i)}function Dl(e,t){let i=t.mapPos(e.from,1),r=t.mapPos(e.to,-1);return i>=r?void 0:{from:i,to:r}}const Tl=me.define({map:Dl}),Ml=me.define({map:Dl});function Al(e){let t=[];for(let{head:i}of e.state.selection.ranges)t.some((e=>e.from<=i&&e.to>=i))||t.push(e.lineBlockAt(i));return t}const Ol=Y.define({create:()=>ai.none,update(e,t){e=e.map(t.changes);for(let i of t.effects)if(i.is(Tl)&&!Pl(e,i.value.from,i.value.to)){let{preparePlaceholder:r}=t.state.facet(Hl),s=r?ai.replace({widget:new $l(r(t.state,i.value))}):jl;e=e.update({add:[s.range(i.value.from,i.value.to)]})}else i.is(Ml)&&(e=e.update({filter:(e,t)=>i.value.from!=e||i.value.to!=t,filterFrom:i.value.from,filterTo:i.value.to}));if(t.selection){let i=!1,{head:r}=t.selection.main;e.between(r,r,((e,t)=>{e<r&&t>r&&(i=!0)})),i&&(e=e.update({filterFrom:r,filterTo:r,filter:(e,t)=>t<=r||e>=r}))}return e},provide:e=>rn.decorations.from(e),toJSON(e,t){let i=[];return e.between(0,t.doc.length,((e,t)=>{i.push(e,t)})),i},fromJSON(e){if(!Array.isArray(e)||e.length%2)throw new RangeError("Invalid JSON for fold state");let t=[];for(let i=0;i<e.length;){let r=e[i++],s=e[i++];if("number"!=typeof r||"number"!=typeof s)throw new RangeError("Invalid JSON for fold state");t.push(jl.range(r,s))}return ai.set(t,!0)}});function Ll(e,t,i){var r;let s=null;return null===(r=e.field(Ol,!1))||void 0===r||r.between(t,i,((e,t)=>{(!s||s.from>e)&&(s={from:e,to:t})})),s}function Pl(e,t,i){let r=!1;return e.between(t,t,((e,s)=>{e==t&&s==i&&(r=!0)})),r}function Bl(e,t){return e.field(Ol,!1)?t:t.concat(me.appendConfig.of(Fl()))}function Il(e,t,i=!0){let r=e.state.doc.lineAt(t.from).number,s=e.state.doc.lineAt(t.to).number;return rn.announce.of(`${e.state.phrase(i?"Folded lines":"Unfolded lines")} ${r} ${e.state.phrase("to")} ${s}.`)}const Nl=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:e=>{for(let t of Al(e)){let i=El(e.state,t.from,t.to);if(i)return e.dispatch({effects:Bl(e.state,[Tl.of(i),Il(e,i)])}),!0}return!1}},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:e=>{if(!e.state.field(Ol,!1))return!1;let t=[];for(let i of Al(e)){let r=Ll(e.state,i.from,i.to);r&&t.push(Ml.of(r),Il(e,r,!1))}return t.length&&e.dispatch({effects:t}),t.length>0}},{key:"Ctrl-Alt-[",run:e=>{let{state:t}=e,i=[];for(let r=0;r<t.doc.length;){let s=e.lineBlockAt(r),n=El(t,s.from,s.to);n&&i.push(Tl.of(n)),r=(n?e.lineBlockAt(n.to):s).to+1}return i.length&&e.dispatch({effects:Bl(e.state,i)}),!!i.length}},{key:"Ctrl-Alt-]",run:e=>{let t=e.state.field(Ol,!1);if(!t||!t.size)return!1;let i=[];return t.between(0,e.state.doc.length,((e,t)=>{i.push(Ml.of({from:e,to:t}))})),e.dispatch({effects:i}),!0}}],ql={placeholderDOM:null,preparePlaceholder:null,placeholderText:""},Hl=z.define({combine:e=>De(e,ql)});function Fl(e){let t=[Ol,Kl];return e&&t.push(Hl.of(e)),t}function Wl(e,t){let{state:i}=e,r=i.facet(Hl),s=t=>{let i=e.lineBlockAt(e.posAtDOM(t.target)),r=Ll(e.state,i.from,i.to);r&&e.dispatch({effects:Ml.of(r)}),t.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(e,s,t);let n=document.createElement("span");return n.textContent=r.placeholderText,n.setAttribute("aria-label",i.phrase("folded code")),n.title=i.phrase("unfold"),n.className="cm-foldPlaceholder",n.onclick=s,n}const jl=ai.replace({widget:new class extends ni{toDOM(e){return Wl(e,null)}}});class $l extends ni{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return Wl(e,this.value)}}const zl={openText:"",closedText:"",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class Ul extends ko{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function Vl(e={}){let t={...zl,...e},i=new Ul(t,!0),r=new Ul(t,!1),s=rr.fromClass(class{constructor(e){this.from=e.viewport.from,this.markers=this.buildMarkers(e)}update(e){(e.docChanged||e.viewportChanged||e.startState.facet(ul)!=e.state.facet(ul)||e.startState.field(Ol,!1)!=e.state.field(Ol,!1)||il(e.startState)!=il(e.state)||t.foldingChanged(e))&&(this.markers=this.buildMarkers(e.view))}buildMarkers(e){let t=new Pe;for(let s of e.viewportLineBlocks){let n=Ll(e.state,s.from,s.to)?r:El(e.state,s.from,s.to)?i:null;n&&t.add(s.from,s.from,n)}return t.finish()}}),{domEventHandlers:n}=t;return[s,To({class:"cm-foldGutter",markers(e){var t;return(null===(t=e.plugin(s))||void 0===t?void 0:t.markers)||Le.empty},initialSpacer:()=>new Ul(t,!1),domEventHandlers:{...n,click:(e,t,i)=>{if(n.click&&n.click(e,t,i))return!0;let r=Ll(e.state,t.from,t.to);if(r)return e.dispatch({effects:Ml.of(r)}),!0;let s=El(e.state,t.from,t.to);return!!s&&(e.dispatch({effects:Tl.of(s)}),!0)}}}),Fl()]}const Kl=rn.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class Gl{constructor(e,t){let i;function r(e){let t=Xe.newName();return(i||(i=Object.create(null)))["."+t]=e,t}this.specs=e;const s="string"==typeof t.all?t.all:t.all?r(t.all):void 0,n=t.scope;this.scope=n instanceof el?e=>e.prop(Za)==n.data:n?e=>e==n:void 0,this.style=Oa(e.map((e=>({tag:e.tag,class:e.class||r(Object.assign({},e,{tag:null}))}))),{all:s}).style,this.module=i?new Xe(i):null,this.themeType=t.themeType}static define(e,t){return new Gl(e,t||{})}}const Jl=z.define(),Xl=z.define({combine:e=>e.length?[e[0]]:null});function Yl(e){let t=e.facet(Jl);return t.length?t:e.facet(Xl)}function Zl(e,t){let i,r=[ec];return e instanceof Gl&&(e.module&&r.push(rn.styleModule.of(e.module)),i=e.themeType),(null==t?void 0:t.fallback)?r.push(Xl.of(e)):i?r.push(Jl.computeN([rn.darkTheme],(t=>t.facet(rn.darkTheme)==("dark"==i)?[e]:[]))):r.push(Jl.of(e)),r}class Ql{constructor(e){this.markCache=Object.create(null),this.tree=il(e.state),this.decorations=this.buildDeco(e,Yl(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=il(e.state),i=Yl(e.state),r=i!=Yl(e.startState),{viewport:s}=e.view,n=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!r&&t.type==this.tree.type&&n>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=n):(t!=this.tree||e.viewportChanged||r)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return ai.none;let i=new Pe;for(let{from:r,to:s}of e.visibleRanges)La(this.tree,t,((e,t,r)=>{i.add(e,t,this.markCache[r]||(this.markCache[r]=ai.mark({class:r})))}),r,s);return i.finish()}}const ec=Q.high(rr.fromClass(Ql,{decorations:e=>e.decorations})),tc=Gl.define([{tag:Xa.meta,color:"#404740"},{tag:Xa.link,textDecoration:"underline"},{tag:Xa.heading,textDecoration:"underline",fontWeight:"bold"},{tag:Xa.emphasis,fontStyle:"italic"},{tag:Xa.strong,fontWeight:"bold"},{tag:Xa.strikethrough,textDecoration:"line-through"},{tag:Xa.keyword,color:"#708"},{tag:[Xa.atom,Xa.bool,Xa.url,Xa.contentSeparator,Xa.labelName],color:"#219"},{tag:[Xa.literal,Xa.inserted],color:"#164"},{tag:[Xa.string,Xa.deleted],color:"#a11"},{tag:[Xa.regexp,Xa.escape,Xa.special(Xa.string)],color:"#e40"},{tag:Xa.definition(Xa.variableName),color:"#00f"},{tag:Xa.local(Xa.variableName),color:"#30a"},{tag:[Xa.typeName,Xa.namespace],color:"#085"},{tag:Xa.className,color:"#167"},{tag:[Xa.special(Xa.variableName),Xa.macroName],color:"#256"},{tag:Xa.definition(Xa.propertyName),color:"#00c"},{tag:Xa.comment,color:"#940"},{tag:Xa.invalid,color:"#f00"}]),ic=rn.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),rc="()[]{}",sc=z.define({combine:e=>De(e,{afterCursor:!0,brackets:rc,maxScanDistance:1e4,renderMatch:ac})}),nc=ai.mark({class:"cm-matchingBracket"}),oc=ai.mark({class:"cm-nonmatchingBracket"});function ac(e){let t=[],i=e.matched?nc:oc;return t.push(i.range(e.start.from,e.start.to)),e.end&&t.push(i.range(e.end.from,e.end.to)),t}const lc=Y.define({create:()=>ai.none,update(e,t){if(!t.docChanged&&!t.selection)return e;let i=[],r=t.state.facet(sc);for(let e of t.state.selection.ranges){if(!e.empty)continue;let s=pc(t.state,e.head,-1,r)||e.head>0&&pc(t.state,e.head-1,1,r)||r.afterCursor&&(pc(t.state,e.head,1,r)||e.head<t.state.doc.length&&pc(t.state,e.head+1,-1,r));s&&(i=i.concat(r.renderMatch(s,t.state)))}return ai.set(i,!0)},provide:e=>rn.decorations.from(e)}),cc=[lc,ic];function hc(e={}){return[sc.of(e),cc]}const uc=new Yo;function dc(e,t,i){let r=e.prop(t<0?Yo.openedBy:Yo.closedBy);if(r)return r;if(1==e.name.length){let r=i.indexOf(e.name);if(r>-1&&r%2==(t<0?1:0))return[i[r+t]]}return null}function fc(e){let t=e.type.prop(uc);return t?t(e.node):e}function pc(e,t,i,r={}){let s=r.maxScanDistance||1e4,n=r.brackets||rc,o=il(e),a=o.resolveInner(t,i);for(let e=a;e;e=e.parent){let r=dc(e.type,i,n);if(r&&e.from<e.to){let s=fc(e);if(s&&(i>0?t>=s.from&&t<s.to:t>s.from&&t<=s.to))return gc(0,0,i,e,s,r,n)}}return function(e,t,i,r,s,n,o){let a=i<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1),l=o.indexOf(a);if(l<0||l%2==0!=i>0)return null;let c={from:i<0?t-1:t,to:i>0?t+1:t},h=e.doc.iterRange(t,i>0?e.doc.length:0),u=0;for(let e=0;!h.next().done&&e<=n;){let n=h.value;i<0&&(e+=n.length);let a=t+e*i;for(let e=i>0?0:n.length-1,t=i>0?n.length:-1;e!=t;e+=i){let t=o.indexOf(n[e]);if(!(t<0||r.resolveInner(a+e,1).type!=s))if(t%2==0==i>0)u++;else{if(1==u)return{start:c,end:{from:a+e,to:a+e+1},matched:t>>1==l>>1};u--}}i>0&&(e+=n.length)}return h.done?{start:c,matched:!1}:null}(e,t,i,o,a.type,s,n)}function gc(e,t,i,r,s,n,o){let a=r.parent,l={from:s.from,to:s.to},c=0,h=null==a?void 0:a.cursor();if(h&&(i<0?h.childBefore(r.from):h.childAfter(r.to)))do{if(i<0?h.to<=r.from:h.from>=r.to){if(0==c&&n.indexOf(h.type.name)>-1&&h.from<h.to){let e=fc(h);return{start:l,end:e?{from:e.from,to:e.to}:void 0,matched:!0}}if(dc(h.type,i,o))c++;else if(dc(h.type,-i,o)){if(0==c){let e=fc(h);return{start:l,end:e&&e.from<e.to?{from:e.from,to:e.to}:void 0,matched:!1}}c--}}}while(i<0?h.prevSibling():h.nextSibling());return{start:l,matched:!1}}const mc=Object.create(null),vc=[ea.none],_c=[],yc=Object.create(null),bc=Object.create(null);for(let[e,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])bc[e]=Sc(mc,t);function wc(e,t){_c.indexOf(e)>-1||(_c.push(e),console.warn(t))}function Sc(e,t){let i=[];for(let r of t.split(" ")){let t=[];for(let i of r.split(".")){let r=e[i]||Xa[i];r?"function"==typeof r?t.length?t=t.map(r):wc(i,`Modifier ${i} used at start of tag`):t.length?wc(i,`Tag ${i} used as modifier`):t=Array.isArray(r)?r:[r]:wc(i,`Unknown highlighting tag ${i}`)}for(let e of t)i.push(e)}if(!i.length)return 0;let r=t.replace(/ /g,"_"),s=r+" "+i.map((e=>e.id)),n=yc[s];if(n)return n.id;let o=yc[s]=ea.define({id:vc.length,name:r,props:[Ta({[r]:i})]});return vc.push(o),o.id}function Cc(e,t){return({state:i,dispatch:r})=>{if(i.readOnly)return!1;let s=e(t,i);return!!s&&(r(i.update(s)),!0)}}yi.RTL,yi.LTR;const kc=Cc(Mc,0),xc=Cc(Tc,0),Rc=Cc(((e,t)=>Tc(e,t,function(e){let t=[];for(let i of e.selection.ranges){let r=e.doc.lineAt(i.from),s=i.to<=r.to?r:e.doc.lineAt(i.to);s.from>r.from&&s.from==i.to&&(s=i.to==r.to+1?r:e.doc.lineAt(i.to-1));let n=t.length-1;n>=0&&t[n].to>r.from?t[n].to=s.to:t.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:s.to})}return t}(t))),0);function Ec(e,t){let i=e.languageDataAt("commentTokens",t,1);return i.length?i[0]:{}}const Dc=50;function Tc(e,t,i=t.selection.ranges){let r=i.map((e=>Ec(t,e.from).block));if(!r.every((e=>e)))return null;let s=i.map(((e,i)=>function(e,{open:t,close:i},r,s){let n,o,a=e.sliceDoc(r-Dc,r),l=e.sliceDoc(s,s+Dc),c=/\s*$/.exec(a)[0].length,h=/^\s*/.exec(l)[0].length,u=a.length-c;if(a.slice(u-t.length,u)==t&&l.slice(h,h+i.length)==i)return{open:{pos:r-c,margin:c&&1},close:{pos:s+h,margin:h&&1}};s-r<=2*Dc?n=o=e.sliceDoc(r,s):(n=e.sliceDoc(r,r+Dc),o=e.sliceDoc(s-Dc,s));let d=/^\s*/.exec(n)[0].length,f=/\s*$/.exec(o)[0].length,p=o.length-f-i.length;return n.slice(d,d+t.length)==t&&o.slice(p,p+i.length)==i?{open:{pos:r+d+t.length,margin:/\s/.test(n.charAt(d+t.length))?1:0},close:{pos:s-f-i.length,margin:/\s/.test(o.charAt(p-1))?1:0}}:null}(t,r[i],e.from,e.to)));if(2!=e&&!s.every((e=>e)))return{changes:t.changes(i.map(((e,t)=>s[t]?[]:[{from:e.from,insert:r[t].open+" "},{from:e.to,insert:" "+r[t].close}])))};if(1!=e&&s.some((e=>e))){let e=[];for(let t,i=0;i<s.length;i++)if(t=s[i]){let s=r[i],{open:n,close:o}=t;e.push({from:n.pos-s.open.length,to:n.pos+n.margin},{from:o.pos-o.margin,to:o.pos+s.close.length})}return{changes:e}}return null}function Mc(e,t,i=t.selection.ranges){let r=[],s=-1;for(let{from:e,to:n}of i){let i=r.length,o=1e9,a=Ec(t,e).line;if(a){for(let i=e;i<=n;){let l=t.doc.lineAt(i);if(l.from>s&&(e==n||n>l.from)){s=l.from;let e=/^\s*/.exec(l.text)[0].length,t=e==l.length,i=l.text.slice(e,e+a.length)==a?e:-1;e<l.text.length&&e<o&&(o=e),r.push({line:l,comment:i,token:a,indent:e,empty:t,single:!1})}i=l.to+1}if(o<1e9)for(let e=i;e<r.length;e++)r[e].indent<r[e].line.text.length&&(r[e].indent=o);r.length==i+1&&(r[i].single=!0)}}if(2!=e&&r.some((e=>e.comment<0&&(!e.empty||e.single)))){let e=[];for(let{line:t,token:i,indent:s,empty:n,single:o}of r)!o&&n||e.push({from:t.from+s,insert:i+" "});let i=t.changes(e);return{changes:i,selection:t.selection.map(i,1)}}if(1!=e&&r.some((e=>e.comment>=0))){let e=[];for(let{line:t,comment:i,token:s}of r)if(i>=0){let r=t.from+i,n=r+s.length;" "==t.text[n-t.from]&&n++,e.push({from:r,to:n})}return{changes:e}}return null}const Ac=fe.define(),Oc=fe.define(),Lc=z.define(),Pc=z.define({combine:e=>De(e,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(i,r)=>e(i,r)||t(i,r)})}),Bc=Y.define({create:()=>Zc.empty,update(e,t){let i=t.state.facet(Pc),r=t.annotation(Ac);if(r){let s=jc.fromTransaction(t,r.selection),n=r.side,o=0==n?e.undone:e.done;return o=s?$c(o,o.length,i.minDepth,s):Kc(o,t.startState.selection),new Zc(0==n?r.rest:o,0==n?o:r.rest)}let s=t.annotation(Oc);if("full"!=s&&"before"!=s||(e=e.isolate()),!1===t.annotation(ve.addToHistory))return t.changes.empty?e:e.addMapping(t.changes.desc);let n=jc.fromTransaction(t),o=t.annotation(ve.time),a=t.annotation(ve.userEvent);return n?e=e.addChanges(n,o,a,i,t):t.selection&&(e=e.addSelection(t.startState.selection,o,a,i.newGroupDelay)),"full"!=s&&"after"!=s||(e=e.isolate()),e},toJSON:e=>({done:e.done.map((e=>e.toJSON())),undone:e.undone.map((e=>e.toJSON()))}),fromJSON:e=>new Zc(e.done.map(jc.fromJSON),e.undone.map(jc.fromJSON))});function Ic(e={}){return[Bc,Pc.of(e),rn.domEventHandlers({beforeinput(e,t){let i="historyUndo"==e.inputType?qc:"historyRedo"==e.inputType?Hc:null;return!!i&&(e.preventDefault(),i(t))}})]}function Nc(e,t){return function({state:i,dispatch:r}){if(!t&&i.readOnly)return!1;let s=i.field(Bc,!1);if(!s)return!1;let n=s.pop(e,i,t);return!!n&&(r(n),!0)}}const qc=Nc(0,!1),Hc=Nc(1,!1),Fc=Nc(0,!0),Wc=Nc(1,!0);class jc{constructor(e,t,i,r,s){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=r,this.selectionsAfter=s}setSelAfter(e){return new jc(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map((e=>e.toJSON()))}}static fromJSON(e){return new jc(e.changes&&L.fromJSON(e.changes),[],e.mapped&&O.fromJSON(e.mapped),e.startSelection&&W.fromJSON(e.startSelection),e.selectionsAfter.map(W.fromJSON))}static fromTransaction(e,t){let i=Uc;for(let t of e.startState.facet(Lc)){let r=t(e);r.length&&(i=i.concat(r))}return!i.length&&e.changes.empty?null:new jc(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,Uc)}static selection(e){return new jc(void 0,Uc,void 0,void 0,e)}}function $c(e,t,i,r){let s=t+1>i+20?t-i-1:0,n=e.slice(s,t);return n.push(r),n}function zc(e,t){return e.length?t.length?e.concat(t):e:t}const Uc=[],Vc=200;function Kc(e,t){if(e.length){let i=e[e.length-1],r=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-Vc));return r.length&&r[r.length-1].eq(t)?e:(r.push(t),$c(e,e.length-1,1e9,i.setSelAfter(r)))}return[jc.selection([t])]}function Gc(e){let t=e[e.length-1],i=e.slice();return i[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),i}function Jc(e,t){if(!e.length)return e;let i=e.length,r=Uc;for(;i;){let s=Xc(e[i-1],t,r);if(s.changes&&!s.changes.empty||s.effects.length){let t=e.slice(0,i);return t[i-1]=s,t}t=s.mapped,i--,r=s.selectionsAfter}return r.length?[jc.selection(r)]:Uc}function Xc(e,t,i){let r=zc(e.selectionsAfter.length?e.selectionsAfter.map((e=>e.map(t))):Uc,i);if(!e.changes)return jc.selection(r);let s=e.changes.map(t),n=t.mapDesc(e.changes,!0),o=e.mapped?e.mapped.composeDesc(n):n;return new jc(s,me.mapEffects(e.effects,t),o,e.startSelection.map(n),r)}const Yc=/^(input\.type|delete)($|\.)/;class Zc{constructor(e,t,i=0,r=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=r}isolate(){return this.prevTime?new Zc(this.done,this.undone):this}addChanges(e,t,i,r,s){let n=this.done,o=n[n.length-1];return n=o&&o.changes&&!o.changes.empty&&e.changes&&(!i||Yc.test(i))&&(!o.selectionsAfter.length&&t-this.prevTime<r.newGroupDelay&&r.joinToEvent(s,function(e,t){let i=[],r=!1;return e.iterChangedRanges(((e,t)=>i.push(e,t))),t.iterChangedRanges(((e,t,s,n)=>{for(let e=0;e<i.length;){let t=i[e++],o=i[e++];n>=t&&s<=o&&(r=!0)}})),r}(o.changes,e.changes))||"input.type.compose"==i)?$c(n,n.length-1,r.minDepth,new jc(e.changes.compose(o.changes),zc(me.mapEffects(e.effects,o.changes),o.effects),o.mapped,o.startSelection,Uc)):$c(n,n.length,r.minDepth,e),new Zc(n,Uc,t,i)}addSelection(e,t,i,r){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:Uc;return s.length>0&&t-this.prevTime<r&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&(n=s[s.length-1],o=e,n.ranges.length==o.ranges.length&&0===n.ranges.filter(((e,t)=>e.empty!=o.ranges[t].empty)).length)?this:new Zc(Kc(this.done,e),this.undone,t,i);var n,o}addMapping(e){return new Zc(Jc(this.done,e),Jc(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let r=0==e?this.done:this.undone;if(0==r.length)return null;let s=r[r.length-1],n=s.selectionsAfter[0]||t.selection;if(i&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Ac.of({side:e,rest:Gc(r),selection:n}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let i=1==r.length?Uc:r.slice(0,r.length-1);return s.mapped&&(i=Jc(i,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Ac.of({side:e,rest:i,selection:n}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}Zc.empty=new Zc(Uc,Uc);const Qc=[{key:"Mod-z",run:qc,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Hc,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Hc,preventDefault:!0},{key:"Mod-u",run:Fc,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Wc,preventDefault:!0}];function eh(e,t){return W.create(e.ranges.map(t),e.mainIndex)}function th(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function ih({state:e,dispatch:t},i){let r=eh(e.selection,i);return!r.eq(e.selection,!0)&&(t(th(e,r)),!0)}function rh(e,t){return W.cursor(t?e.to:e.from)}function sh(e,t){return ih(e,(i=>i.empty?e.moveByChar(i,t):rh(i,t)))}function nh(e){return e.textDirectionAt(e.state.selection.main.head)==yi.LTR}const oh=e=>sh(e,!nh(e)),ah=e=>sh(e,nh(e));function lh(e,t){return ih(e,(i=>i.empty?e.moveByGroup(i,t):rh(i,t)))}function ch(e,t,i){if(t.type.prop(i))return!0;let r=t.to-t.from;return r&&(r>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function hh(e,t,i){let r,s,n=il(e).resolveInner(t.head),o=i?Yo.closedBy:Yo.openedBy;for(let r=t.head;;){let t=i?n.childAfter(r):n.childBefore(r);if(!t)break;ch(e,t,o)?n=t:r=i?t.to:t.from}return s=n.type.prop(o)&&(r=i?pc(e,n.from,1):pc(e,n.to,-1))&&r.matched?i?r.end.to:r.end.from:i?n.to:n.from,W.cursor(s,i?-1:1)}function uh(e,t){return ih(e,(i=>{if(!i.empty)return rh(i,t);let r=e.moveVertically(i,t);return r.head!=i.head?r:e.moveToLineBoundary(i,t)}))}"undefined"!=typeof Intl&&Intl.Segmenter;const dh=e=>uh(e,!1),fh=e=>uh(e,!0);function ph(e){let t,i=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,r=0,s=0;if(i){for(let t of e.state.facet(rn.scrollMargins)){let i=t(e);(null==i?void 0:i.top)&&(r=Math.max(null==i?void 0:i.top,r)),(null==i?void 0:i.bottom)&&(s=Math.max(null==i?void 0:i.bottom,s))}t=e.scrollDOM.clientHeight-r-s}else t=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:r,marginBottom:s,selfScroll:i,height:Math.max(e.defaultLineHeight,t-5)}}function gh(e,t){let i,r=ph(e),{state:s}=e,n=eh(s.selection,(i=>i.empty?e.moveVertically(i,t,r.height):rh(i,t)));if(n.eq(s.selection))return!1;if(r.selfScroll){let t=e.coordsAtPos(s.selection.main.head),o=e.scrollDOM.getBoundingClientRect(),a=o.top+r.marginTop,l=o.bottom-r.marginBottom;t&&t.top>a&&t.bottom<l&&(i=rn.scrollIntoView(n.main.head,{y:"start",yMargin:t.top-a}))}return e.dispatch(th(s,n),{effects:i}),!0}const mh=e=>gh(e,!1),vh=e=>gh(e,!0);function _h(e,t,i){let r=e.lineBlockAt(t.head),s=e.moveToLineBoundary(t,i);if(s.head==t.head&&s.head!=(i?r.to:r.from)&&(s=e.moveToLineBoundary(t,i,!1)),!i&&s.head==r.from&&r.length){let i=/^\s*/.exec(e.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;i&&t.head!=r.from+i&&(s=W.cursor(r.from+i))}return s}function yh(e,t){let i=eh(e.state.selection,(e=>{let i=t(e);return W.range(e.anchor,i.head,i.goalColumn,i.bidiLevel||void 0)}));return!i.eq(e.state.selection)&&(e.dispatch(th(e.state,i)),!0)}function bh(e,t){return yh(e,(i=>e.moveByChar(i,t)))}const wh=e=>bh(e,!nh(e)),Sh=e=>bh(e,nh(e));function Ch(e,t){return yh(e,(i=>e.moveByGroup(i,t)))}function kh(e,t){return yh(e,(i=>e.moveVertically(i,t)))}const xh=e=>kh(e,!1),Rh=e=>kh(e,!0);function Eh(e,t){return yh(e,(i=>e.moveVertically(i,t,ph(e).height)))}const Dh=e=>Eh(e,!1),Th=e=>Eh(e,!0),Mh=({state:e,dispatch:t})=>(t(th(e,{anchor:0})),!0),Ah=({state:e,dispatch:t})=>(t(th(e,{anchor:e.doc.length})),!0),Oh=({state:e,dispatch:t})=>(t(th(e,{anchor:e.selection.main.anchor,head:0})),!0),Lh=({state:e,dispatch:t})=>(t(th(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0);function Ph(e,t){if(e.state.readOnly)return!1;let i="delete.selection",{state:r}=e,s=r.changeByRange((r=>{let{from:s,to:n}=r;if(s==n){let o=t(r);o<s?(i="delete.backward",o=Bh(e,o,!1)):o>s&&(i="delete.forward",o=Bh(e,o,!0)),s=Math.min(s,o),n=Math.max(n,o)}else s=Bh(e,s,!1),n=Bh(e,n,!0);return s==n?{range:r}:{changes:{from:s,to:n},range:W.cursor(s,s<r.head?-1:1)}}));return!s.changes.empty&&(e.dispatch(r.update(s,{scrollIntoView:!0,userEvent:i,effects:"delete.selection"==i?rn.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function Bh(e,t,i){if(e instanceof rn)for(let r of e.state.facet(rn.atomicRanges).map((t=>t(e))))r.between(t,t,((e,r)=>{e<t&&r>t&&(t=i?r:e)}));return t}const Ih=(e,t,i)=>Ph(e,(r=>{let s,n,o=r.from,{state:a}=e,l=a.doc.lineAt(o);if(i&&!t&&o>l.from&&o<l.from+200&&!/[^ \t]/.test(s=l.text.slice(0,o-l.from))){if("\t"==s[s.length-1])return o-1;let e=Ue(s,a.tabSize)%pl(a)||pl(a);for(let t=0;t<e&&" "==s[s.length-1-t];t++)o--;n=o}else n=R(l.text,o-l.from,t,t)+l.from,n==o&&l.number!=(t?a.doc.lines:1)?n+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(l.text.slice(n-l.from,o-l.from))&&(n=R(l.text,n-l.from,!1,!1)+l.from);return n})),Nh=e=>Ih(e,!1,!0),qh=e=>Ih(e,!0,!1),Hh=(e,t)=>Ph(e,(i=>{let r=i.head,{state:s}=e,n=s.doc.lineAt(r),o=s.charCategorizer(r);for(let e=null;;){if(r==(t?n.to:n.from)){r==i.head&&n.number!=(t?s.doc.lines:1)&&(r+=t?1:-1);break}let a=R(n.text,r-n.from,t)+n.from,l=n.text.slice(Math.min(r,a)-n.from,Math.max(r,a)-n.from),c=o(l);if(null!=e&&c!=e)break;" "==l&&r==i.head||(e=c),r=a}return r})),Fh=e=>Hh(e,!1);function Wh(e){let t=[],i=-1;for(let r of e.selection.ranges){let s=e.doc.lineAt(r.from),n=e.doc.lineAt(r.to);if(r.empty||r.to!=n.from||(n=e.doc.lineAt(r.to-1)),i>=s.number){let e=t[t.length-1];e.to=n.to,e.ranges.push(r)}else t.push({from:s.from,to:n.to,ranges:[r]});i=n.number+1}return t}function jh(e,t,i){if(e.readOnly)return!1;let r=[],s=[];for(let t of Wh(e)){if(i?t.to==e.doc.length:0==t.from)continue;let n=e.doc.lineAt(i?t.to+1:t.from-1),o=n.length+1;if(i){r.push({from:t.to,to:n.to},{from:t.from,insert:n.text+e.lineBreak});for(let i of t.ranges)s.push(W.range(Math.min(e.doc.length,i.anchor+o),Math.min(e.doc.length,i.head+o)))}else{r.push({from:n.from,to:t.from},{from:t.to,insert:e.lineBreak+n.text});for(let e of t.ranges)s.push(W.range(e.anchor-o,e.head-o))}}return!!r.length&&(t(e.update({changes:r,scrollIntoView:!0,selection:W.create(s,e.selection.mainIndex),userEvent:"move.line"})),!0)}function $h(e,t,i){if(e.readOnly)return!1;let r=[];for(let t of Wh(e))i?r.push({from:t.from,insert:e.doc.slice(t.from,t.to)+e.lineBreak}):r.push({from:t.to,insert:e.lineBreak+e.doc.slice(t.from,t.to)});return t(e.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const zh=Uh(!1);function Uh(e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let r=t.changeByRange((i=>{let{from:r,to:s}=i,n=t.doc.lineAt(r),o=!e&&r==s&&function(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let i,r=il(e).resolveInner(t),s=r.childBefore(t),n=r.childAfter(t);return s&&n&&s.to<=t&&n.from>=t&&(i=s.type.prop(Yo.closedBy))&&i.indexOf(n.name)>-1&&e.doc.lineAt(s.to).from==e.doc.lineAt(n.from).from&&!/\S/.test(e.sliceDoc(s.to,n.from))?{from:s.to,to:n.from}:null}(t,r);e&&(r=s=(s<=n.to?n:t.doc.lineAt(s)).to);let a=new vl(t,{simulateBreak:r,simulateDoubleBreak:!!o}),l=ml(a,r);for(null==l&&(l=Ue(/^\s*/.exec(t.doc.lineAt(r).text)[0],t.tabSize));s<n.to&&/\s/.test(n.text[s-n.from]);)s++;o?({from:r,to:s}=o):r>n.from&&r<n.from+100&&!/\S/.test(n.text.slice(0,r))&&(r=n.from);let c=["",gl(t,l)];return o&&c.push(gl(t,a.lineIndent(n.from,-1))),{changes:{from:r,to:s,insert:m.of(c)},range:W.cursor(r+1+c[1].length)}}));return i(t.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function Vh(e,t){let i=-1;return e.changeByRange((r=>{let s=[];for(let n=r.from;n<=r.to;){let o=e.doc.lineAt(n);o.number>i&&(r.empty||r.to>o.from)&&(t(o,s,r),i=o.number),n=o.to+1}let n=e.changes(s);return{changes:s,range:W.range(n.mapPos(r.anchor,1),n.mapPos(r.head,1))}}))}const Kh=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:e=>ih(e,(t=>hh(e.state,t,!nh(e)))),shift:e=>yh(e,(t=>hh(e.state,t,!nh(e))))},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:e=>ih(e,(t=>hh(e.state,t,nh(e)))),shift:e=>yh(e,(t=>hh(e.state,t,nh(e))))},{key:"Alt-ArrowUp",run:({state:e,dispatch:t})=>jh(e,t,!1)},{key:"Shift-Alt-ArrowUp",run:({state:e,dispatch:t})=>$h(e,t,!1)},{key:"Alt-ArrowDown",run:({state:e,dispatch:t})=>jh(e,t,!0)},{key:"Shift-Alt-ArrowDown",run:({state:e,dispatch:t})=>$h(e,t,!0)},{key:"Escape",run:({state:e,dispatch:t})=>{let i=e.selection,r=null;return i.ranges.length>1?r=W.create([i.main]):i.main.empty||(r=W.create([W.cursor(i.main.head)])),!!r&&(t(th(e,r)),!0)}},{key:"Mod-Enter",run:Uh(!0)},{key:"Alt-l",mac:"Ctrl-l",run:({state:e,dispatch:t})=>{let i=Wh(e).map((({from:t,to:i})=>W.range(t,Math.min(i+1,e.doc.length))));return t(e.update({selection:W.create(i),userEvent:"select"})),!0}},{key:"Mod-i",run:({state:e,dispatch:t})=>{let i=eh(e.selection,(t=>{let i=il(e),r=i.resolveStack(t.from,1);if(t.empty){let e=i.resolveStack(t.from,-1);e.node.from>=r.node.from&&e.node.to<=r.node.to&&(r=e)}for(let e=r;e;e=e.next){let{node:i}=e;if((i.from<t.from&&i.to>=t.to||i.to>t.to&&i.from<=t.from)&&e.next)return W.range(i.to,i.from)}return t}));return!i.eq(e.selection)&&(t(th(e,i)),!0)},preventDefault:!0},{key:"Mod-[",run:({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(Vh(e,((t,i)=>{let r=/^\s*/.exec(t.text)[0];if(!r)return;let s=Ue(r,e.tabSize),n=0,o=gl(e,Math.max(0,s-pl(e)));for(;n<r.length&&n<o.length&&r.charCodeAt(n)==o.charCodeAt(n);)n++;i.push({from:t.from+n,to:t.from+r.length,insert:o.slice(n)})})),{userEvent:"delete.dedent"})),!0)},{key:"Mod-]",run:({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(Vh(e,((t,i)=>{i.push({from:t.from,insert:e.facet(fl)})})),{userEvent:"input.indent"})),!0)},{key:"Mod-Alt-\\",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=Object.create(null),r=new vl(e,{overrideIndentation:e=>{let t=i[e];return null==t?-1:t}}),s=Vh(e,((t,s,n)=>{let o=ml(r,t.from);if(null==o)return;/\S/.test(t.text)||(o=0);let a=/^\s*/.exec(t.text)[0],l=gl(e,o);(a!=l||n.from<t.from+a.length)&&(i[t.from]=o,s.push({from:t.from,to:t.from+a.length,insert:l}))}));return s.changes.empty||t(e.update(s,{userEvent:"indent"})),!0}},{key:"Shift-Mod-k",run:e=>{if(e.state.readOnly)return!1;let{state:t}=e,i=t.changes(Wh(t).map((({from:e,to:i})=>(e>0?e--:i<t.doc.length&&i++,{from:e,to:i})))),r=eh(t.selection,(t=>{let i;if(e.lineWrapping){let r=e.lineBlockAt(t.head),s=e.coordsAtPos(t.head,t.assoc||1);s&&(i=r.bottom+e.documentTop-s.bottom+e.defaultLineHeight/2)}return e.moveVertically(t,!0,i)})).map(i);return e.dispatch({changes:i,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0}},{key:"Shift-Mod-\\",run:({state:e,dispatch:t})=>function(e,t,i){let r=!1,s=eh(e.selection,(t=>{let s=pc(e,t.head,-1)||pc(e,t.head,1)||t.head>0&&pc(e,t.head-1,1)||t.head<e.doc.length&&pc(e,t.head+1,-1);if(!s||!s.end)return t;r=!0;let n=s.start.from==t.head?s.end.to:s.end.from;return i?W.range(t.anchor,n):W.cursor(n)}));return!!r&&(t(th(e,s)),!0)}(e,t,!1)},{key:"Mod-/",run:e=>{let{state:t}=e,i=t.doc.lineAt(t.selection.main.from),r=Ec(e.state,i.from);return r.line?kc(e):!!r.block&&Rc(e)}},{key:"Alt-A",run:xc},{key:"Ctrl-m",mac:"Shift-Alt-m",run:e=>(e.setTabFocusMode(),!0)}].concat([{key:"ArrowLeft",run:oh,shift:wh,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:e=>lh(e,!nh(e)),shift:e=>Ch(e,!nh(e)),preventDefault:!0},{mac:"Cmd-ArrowLeft",run:e=>ih(e,(t=>_h(e,t,!nh(e)))),shift:e=>yh(e,(t=>_h(e,t,!nh(e)))),preventDefault:!0},{key:"ArrowRight",run:ah,shift:Sh,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:e=>lh(e,nh(e)),shift:e=>Ch(e,nh(e)),preventDefault:!0},{mac:"Cmd-ArrowRight",run:e=>ih(e,(t=>_h(e,t,nh(e)))),shift:e=>yh(e,(t=>_h(e,t,nh(e)))),preventDefault:!0},{key:"ArrowUp",run:dh,shift:xh,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Mh,shift:Oh},{mac:"Ctrl-ArrowUp",run:mh,shift:Dh},{key:"ArrowDown",run:fh,shift:Rh,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Ah,shift:Lh},{mac:"Ctrl-ArrowDown",run:vh,shift:Th},{key:"PageUp",run:mh,shift:Dh},{key:"PageDown",run:vh,shift:Th},{key:"Home",run:e=>ih(e,(t=>_h(e,t,!1))),shift:e=>yh(e,(t=>_h(e,t,!1))),preventDefault:!0},{key:"Mod-Home",run:Mh,shift:Oh},{key:"End",run:e=>ih(e,(t=>_h(e,t,!0))),shift:e=>yh(e,(t=>_h(e,t,!0))),preventDefault:!0},{key:"Mod-End",run:Ah,shift:Lh},{key:"Enter",run:zh,shift:zh},{key:"Mod-a",run:({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0)},{key:"Backspace",run:Nh,shift:Nh},{key:"Delete",run:qh},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Fh},{key:"Mod-Delete",mac:"Alt-Delete",run:e=>Hh(e,!0)},{mac:"Mod-Backspace",run:e=>Ph(e,(t=>{let i=e.moveToLineBoundary(t,!1).head;return t.head>i?i:Math.max(0,t.head-1)}))},{mac:"Mod-Delete",run:e=>Ph(e,(t=>{let i=e.moveToLineBoundary(t,!0).head;return t.head<i?i:Math.min(e.state.doc.length,t.head+1)}))}].concat([{key:"Ctrl-b",run:oh,shift:wh,preventDefault:!0},{key:"Ctrl-f",run:ah,shift:Sh},{key:"Ctrl-p",run:dh,shift:xh},{key:"Ctrl-n",run:fh,shift:Rh},{key:"Ctrl-a",run:e=>ih(e,(t=>W.cursor(e.lineBlockAt(t.head).from,1))),shift:e=>yh(e,(t=>W.cursor(e.lineBlockAt(t.head).from)))},{key:"Ctrl-e",run:e=>ih(e,(t=>W.cursor(e.lineBlockAt(t.head).to,-1))),shift:e=>yh(e,(t=>W.cursor(e.lineBlockAt(t.head).to)))},{key:"Ctrl-d",run:qh},{key:"Ctrl-h",run:Nh},{key:"Ctrl-k",run:e=>Ph(e,(t=>{let i=e.lineBlockAt(t.head).to;return t.head<i?i:Math.min(e.state.doc.length,t.head+1)}))},{key:"Ctrl-Alt-h",run:Fh},{key:"Ctrl-o",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:m.of(["",""])},range:W.cursor(e.from)})));return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}},{key:"Ctrl-t",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange((t=>{if(!t.empty||0==t.from||t.from==e.doc.length)return{range:t};let i=t.from,r=e.doc.lineAt(i),s=i==r.from?i-1:R(r.text,i-r.from,!1)+r.from,n=i==r.to?i+1:R(r.text,i-r.from,!0)+r.from;return{changes:{from:s,to:n,insert:e.doc.slice(i,n).append(e.doc.slice(s,i))},range:W.cursor(n)}}));return!i.changes.empty&&(t(e.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)}},{key:"Ctrl-v",run:vh}].map((e=>({mac:e.key,run:e.run,shift:e.shift})))));function Gh(){var e=arguments[0];"string"==typeof e&&(e=document.createElement(e));var t=1,i=arguments[1];if(i&&"object"==typeof i&&null==i.nodeType&&!Array.isArray(i)){for(var r in i)if(Object.prototype.hasOwnProperty.call(i,r)){var s=i[r];"string"==typeof s?e.setAttribute(r,s):null!=s&&(e[r]=s)}t++}for(;t<arguments.length;t++)Jh(e,arguments[t]);return e}function Jh(e,t){if("string"==typeof t)e.appendChild(document.createTextNode(t));else if(null==t);else if(null!=t.nodeType)e.appendChild(t);else{if(!Array.isArray(t))throw new RangeError("Unsupported child node: "+t);for(var i=0;i<t.length;i++)Jh(e,t[i])}}const Xh="function"==typeof String.prototype.normalize?e=>e.normalize("NFKD"):e=>e;class Yh{constructor(e,t,i=0,r=e.length,s,n){this.test=n,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,r),this.bufferStart=i,this.normalize=s?e=>s(Xh(e)):Xh,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return E(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=D(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=T(e);let r=this.normalize(t);if(r.length)for(let e=0,s=i;;e++){let n=r.charCodeAt(e),o=this.match(n,s,this.bufferPos+this.bufferStart);if(e==r.length-1){if(o)return this.value=o,this;break}s==i&&e<t.length&&t.charCodeAt(e)==n&&s++}}}match(e,t,i){let r=null;for(let t=0;t<this.matches.length;t+=2){let s=this.matches[t],n=!1;this.query.charCodeAt(s)==e&&(s==this.query.length-1?r={from:this.matches[t+1],to:i}:(this.matches[t]++,n=!0)),n||(this.matches.splice(t,2),t-=2)}return this.query.charCodeAt(0)==e&&(1==this.query.length?r={from:t,to:i}:this.matches.push(1,t)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferStart)&&(r=null),r}}"undefined"!=typeof Symbol&&(Yh.prototype[Symbol.iterator]=function(){return this});const Zh={from:-1,to:-1,match:/.*/.exec("")},Qh="gm"+(null==/x/.unicode?"":"u");class eu{constructor(e,t,i,r=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=Zh,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new ru(e,t,i,r,s);this.re=new RegExp(t,Qh+((null==i?void 0:i.ignoreCase)?"i":"")),this.test=null==i?void 0:i.test,this.iter=e.iter();let n=e.lineAt(r);this.curLineStart=n.from,this.matchPos=su(e,r),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,r=i+t[0].length;if(this.matchPos=su(this.text,r+(i==r?1:0)),i==this.curLineStart+this.curLine.length&&this.nextLine(),(i<r||i>this.value.to)&&(!this.test||this.test(i,r,t)))return this.value={from:i,to:r,match:t},this;e=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),e=0}}}}const tu=new WeakMap;class iu{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let r=tu.get(e);if(!r||r.from>=i||r.to<=t){let r=new iu(t,e.sliceString(t,i));return tu.set(e,r),r}if(r.from==t&&r.to==i)return r;let{text:s,from:n}=r;return n>t&&(s=e.sliceString(t,n)+s,n=t),r.to<i&&(s+=e.sliceString(r.to,i)),tu.set(e,new iu(n,s)),new iu(t,s.slice(t-n,i-n))}}class ru{constructor(e,t,i,r,s){this.text=e,this.to=s,this.done=!1,this.value=Zh,this.matchPos=su(e,r),this.re=new RegExp(t,Qh+((null==i?void 0:i.ignoreCase)?"i":"")),this.test=null==i?void 0:i.test,this.flat=iu.get(e,r,this.chunkEnd(r+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let e=this.flat.from+t.index,i=e+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(e,i,t)))return this.value={from:e,to:i,match:t},this.matchPos=su(this.text,i+(e==i?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=iu.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function su(e,t){if(t>=e.length)return t;let i,r=e.lineAt(t);for(;t<r.to&&(i=r.text.charCodeAt(t-r.from))>=56320&&i<57344;)t++;return t}function nu(e){let t=Gh("input",{class:"cm-textfield",name:"line",value:String(e.state.doc.lineAt(e.state.selection.main.head).number)});function i(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!i)return;let{state:r}=e,s=r.doc.lineAt(r.selection.main.head),[,n,o,a,l]=i,c=a?+a.slice(1):0,h=o?+o:s.number;if(o&&l){let e=h/100;n&&(e=e*("-"==n?-1:1)+s.number/r.doc.lines),h=Math.round(r.doc.lines*e)}else o&&n&&(h=h*("-"==n?-1:1)+s.number);let u=r.doc.line(Math.max(1,Math.min(r.doc.lines,h))),d=W.cursor(u.from+Math.max(0,Math.min(c,u.length)));e.dispatch({effects:[ou.of(!1),rn.scrollIntoView(d.from,{y:"center"})],selection:d}),e.focus()}return{dom:Gh("form",{class:"cm-gotoLine",onkeydown:t=>{27==t.keyCode?(t.preventDefault(),e.dispatch({effects:ou.of(!1)}),e.focus()):13==t.keyCode&&(t.preventDefault(),i())},onsubmit:e=>{e.preventDefault(),i()}},Gh("label",e.state.phrase("Go to line"),": ",t)," ",Gh("button",{class:"cm-button",type:"submit"},e.state.phrase("go")),Gh("button",{name:"close",onclick:()=>{e.dispatch({effects:ou.of(!1)}),e.focus()},"aria-label":e.state.phrase("close"),type:"button"},[""]))}}"undefined"!=typeof Symbol&&(eu.prototype[Symbol.iterator]=ru.prototype[Symbol.iterator]=function(){return this});const ou=me.define(),au=Y.define({create:()=>!0,update(e,t){for(let i of t.effects)i.is(ou)&&(e=i.value);return e},provide:e=>Co.from(e,(e=>e?nu:null))}),lu=rn.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),cu={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},hu=z.define({combine:e=>De(e,cu,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})});function uu(e){let t=[mu,gu];return e&&t.push(hu.of(e)),t}const du=ai.mark({class:"cm-selectionMatch"}),fu=ai.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function pu(e,t,i,r){return!(0!=i&&e(t.sliceDoc(i-1,i))==ke.Word||r!=t.doc.length&&e(t.sliceDoc(r,r+1))==ke.Word)}const gu=rr.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.selectionSet||e.docChanged||e.viewportChanged)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=e.state.facet(hu),{state:i}=e,r=i.selection;if(r.ranges.length>1)return ai.none;let s,n=r.main,o=null;if(n.empty){if(!t.highlightWordAroundCursor)return ai.none;let e=i.wordAt(n.head);if(!e)return ai.none;o=i.charCategorizer(n.head),s=i.sliceDoc(e.from,e.to)}else{let e=n.to-n.from;if(e<t.minSelectionLength||e>200)return ai.none;if(t.wholeWords){if(s=i.sliceDoc(n.from,n.to),o=i.charCategorizer(n.head),!pu(o,i,n.from,n.to)||!function(e,t,i,r){return e(t.sliceDoc(i,i+1))==ke.Word&&e(t.sliceDoc(r-1,r))==ke.Word}(o,i,n.from,n.to))return ai.none}else if(s=i.sliceDoc(n.from,n.to),!s)return ai.none}let a=[];for(let r of e.visibleRanges){let e=new Yh(i.doc,s,r.from,r.to);for(;!e.next().done;){let{from:r,to:s}=e.value;if((!o||pu(o,i,r,s))&&(n.empty&&r<=n.from&&s>=n.to?a.push(fu.range(r,s)):(r>=n.to||s<=n.from)&&a.push(du.range(r,s)),a.length>t.maxMatches))return ai.none}}return ai.set(a)}},{decorations:e=>e.decorations}),mu=rn.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),vu=z.define({combine:e=>De(e,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new Vu(e),scrollToMatch:e=>rn.scrollIntoView(e)})});class _u{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||function(e){try{return new RegExp(e,Qh),!0}catch(e){return!1}}(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,((e,t)=>"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\"))}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new xu(this):new wu(this)}getCursor(e,t=0,i){let r=e.doc?e:Ee.create({doc:e});return null==i&&(i=r.doc.length),this.regexp?Su(this,r,t,i):bu(this,r,t,i)}}class yu{constructor(e){this.spec=e}}function bu(e,t,i,r){return new Yh(t.doc,e.unquoted,i,r,e.caseSensitive?void 0:e=>e.toLowerCase(),e.wholeWord?function(e,t){return(i,r,s,n)=>((n>i||n+s.length<r)&&(n=Math.max(0,i-2),s=e.sliceString(n,Math.min(e.length,r+2))),!(t(Cu(s,i-n))==ke.Word&&t(ku(s,i-n))==ke.Word||t(ku(s,r-n))==ke.Word&&t(Cu(s,r-n))==ke.Word))}(t.doc,t.charCategorizer(t.selection.main.head)):void 0)}class wu extends yu{constructor(e){super(e)}nextMatch(e,t,i){let r=bu(this.spec,e,i,e.doc.length).nextOverlapping();if(r.done){let i=Math.min(e.doc.length,t+this.spec.unquoted.length);r=bu(this.spec,e,0,i).nextOverlapping()}return r.done||r.value.from==t&&r.value.to==i?null:r.value}prevMatchInRange(e,t,i){for(let r=i;;){let i=Math.max(t,r-1e4-this.spec.unquoted.length),s=bu(this.spec,e,i,r),n=null;for(;!s.nextOverlapping().done;)n=s.value;if(n)return n;if(i==t)return null;r-=1e4}}prevMatch(e,t,i){let r=this.prevMatchInRange(e,0,t);return r||(r=this.prevMatchInRange(e,Math.max(0,i-this.spec.unquoted.length),e.doc.length)),!r||r.from==t&&r.to==i?null:r}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let i=bu(this.spec,e,0,e.doc.length),r=[];for(;!i.next().done;){if(r.length>=t)return null;r.push(i.value)}return r}highlight(e,t,i,r){let s=bu(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}function Su(e,t,i,r){return new eu(t.doc,e.search,{ignoreCase:!e.caseSensitive,test:e.wholeWord?(s=t.charCategorizer(t.selection.main.head),(e,t,i)=>!i[0].length||(s(Cu(i.input,i.index))!=ke.Word||s(ku(i.input,i.index))!=ke.Word)&&(s(ku(i.input,i.index+i[0].length))!=ke.Word||s(Cu(i.input,i.index+i[0].length))!=ke.Word)):void 0},i,r);var s}function Cu(e,t){return e.slice(R(e,t,!1),t)}function ku(e,t){return e.slice(t,R(e,t))}class xu extends yu{nextMatch(e,t,i){let r=Su(this.spec,e,i,e.doc.length).next();return r.done&&(r=Su(this.spec,e,0,t).next()),r.done?null:r.value}prevMatchInRange(e,t,i){for(let r=1;;r++){let s=Math.max(t,i-1e4*r),n=Su(this.spec,e,s,i),o=null;for(;!n.next().done;)o=n.value;if(o&&(s==t||o.from>s+10))return o;if(s==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,((t,i)=>{if("&"==i)return e.match[0];if("$"==i)return"$";for(let t=i.length;t>0;t--){let r=+i.slice(0,t);if(r>0&&r<e.match.length)return e.match[r]+i.slice(t)}return t}))}matchAll(e,t){let i=Su(this.spec,e,0,e.doc.length),r=[];for(;!i.next().done;){if(r.length>=t)return null;r.push(i.value)}return r}highlight(e,t,i,r){let s=Su(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.doc.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}const Ru=me.define(),Eu=me.define(),Du=Y.define({create:e=>new Tu(Fu(e).create(),null),update(e,t){for(let i of t.effects)i.is(Ru)?e=new Tu(i.value.create(),e.panel):i.is(Eu)&&(e=new Tu(e.query,i.value?Hu:null));return e},provide:e=>Co.from(e,(e=>e.panel))});class Tu{constructor(e,t){this.query=e,this.panel=t}}const Mu=ai.mark({class:"cm-searchMatch"}),Au=ai.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Ou=rr.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(Du))}update(e){let t=e.state.field(Du);(t!=e.startState.field(Du)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return ai.none;let{view:i}=this,r=new Pe;for(let t=0,s=i.visibleRanges,n=s.length;t<n;t++){let{from:o,to:a}=s[t];for(;t<n-1&&a>s[t+1].from-500;)a=s[++t].to;e.highlight(i.state,o,a,((e,t)=>{let s=i.state.selection.ranges.some((i=>i.from==e&&i.to==t));r.add(e,t,s?Au:Mu)}))}return r.finish()}},{decorations:e=>e.decorations});function Lu(e){return t=>{let i=t.state.field(Du,!1);return i&&i.query.spec.valid?e(t,i):$u(t)}}const Pu=Lu(((e,{query:t})=>{let{to:i}=e.state.selection.main,r=t.nextMatch(e.state,i,i);if(!r)return!1;let s=W.single(r.from,r.to),n=e.state.facet(vu);return e.dispatch({selection:s,effects:[Xu(e,r),n.scrollToMatch(s.main,e)],userEvent:"select.search"}),ju(e),!0})),Bu=Lu(((e,{query:t})=>{let{state:i}=e,{from:r}=i.selection.main,s=t.prevMatch(i,r,r);if(!s)return!1;let n=W.single(s.from,s.to),o=e.state.facet(vu);return e.dispatch({selection:n,effects:[Xu(e,s),o.scrollToMatch(n.main,e)],userEvent:"select.search"}),ju(e),!0})),Iu=Lu(((e,{query:t})=>{let i=t.matchAll(e.state,1e3);return!(!i||!i.length||(e.dispatch({selection:W.create(i.map((e=>W.range(e.from,e.to)))),userEvent:"select.search.matches"}),0))})),Nu=Lu(((e,{query:t})=>{let{state:i}=e,{from:r,to:s}=i.selection.main;if(i.readOnly)return!1;let n=t.nextMatch(i,r,r);if(!n)return!1;let o,a,l=n,c=[],h=[];l.from==r&&l.to==s&&(a=i.toText(t.getReplacement(l)),c.push({from:l.from,to:l.to,insert:a}),l=t.nextMatch(i,l.from,l.to),h.push(rn.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(r).number)+".")));let u=e.state.changes(c);return l&&(o=W.single(l.from,l.to).map(u),h.push(Xu(e,l)),h.push(i.facet(vu).scrollToMatch(o.main,e))),e.dispatch({changes:u,selection:o,effects:h,userEvent:"input.replace"}),!0})),qu=Lu(((e,{query:t})=>{if(e.state.readOnly)return!1;let i=t.matchAll(e.state,1e9).map((e=>{let{from:i,to:r}=e;return{from:i,to:r,insert:t.getReplacement(e)}}));if(!i.length)return!1;let r=e.state.phrase("replaced $ matches",i.length)+".";return e.dispatch({changes:i,effects:rn.announce.of(r),userEvent:"input.replace.all"}),!0}));function Hu(e){return e.state.facet(vu).createPanel(e)}function Fu(e,t){var i,r,s,n,o;let a=e.selection.main,l=a.empty||a.to>a.from+100?"":e.sliceDoc(a.from,a.to);if(t&&!l)return t;let c=e.facet(vu);return new _u({search:(null!==(i=null==t?void 0:t.literal)&&void 0!==i?i:c.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:null!==(r=null==t?void 0:t.caseSensitive)&&void 0!==r?r:c.caseSensitive,literal:null!==(s=null==t?void 0:t.literal)&&void 0!==s?s:c.literal,regexp:null!==(n=null==t?void 0:t.regexp)&&void 0!==n?n:c.regexp,wholeWord:null!==(o=null==t?void 0:t.wholeWord)&&void 0!==o?o:c.wholeWord})}function Wu(e){let t=yo(e,Hu);return t&&t.dom.querySelector("[main-field]")}function ju(e){let t=Wu(e);t&&t==e.root.activeElement&&t.select()}const $u=e=>{let t=e.state.field(Du,!1);if(t&&t.panel){let i=Wu(e);if(i&&i!=e.root.activeElement){let r=Fu(e.state,t.query.spec);r.valid&&e.dispatch({effects:Ru.of(r)}),i.focus(),i.select()}}else e.dispatch({effects:[Eu.of(!0),t?Ru.of(Fu(e.state,t.query.spec)):me.appendConfig.of(Zu)]});return!0},zu=e=>{let t=e.state.field(Du,!1);if(!t||!t.panel)return!1;let i=yo(e,Hu);return i&&i.dom.contains(e.root.activeElement)&&e.focus(),e.dispatch({effects:Eu.of(!1)}),!0},Uu=[{key:"Mod-f",run:$u,scope:"editor search-panel"},{key:"F3",run:Pu,shift:Bu,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Pu,shift:Bu,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:zu,scope:"editor search-panel"},{key:"Mod-Shift-l",run:({state:e,dispatch:t})=>{let i=e.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:r,to:s}=i.main,n=[],o=0;for(let t=new Yh(e.doc,e.sliceDoc(r,s));!t.next().done;){if(n.length>1e3)return!1;t.value.from==r&&(o=n.length),n.push(W.range(t.value.from,t.value.to))}return t(e.update({selection:W.create(n,o),userEvent:"select.search.matches"})),!0}},{key:"Mod-Alt-g",run:e=>{let t=yo(e,nu);if(!t){let i=[ou.of(!0)];null==e.state.field(au,!1)&&i.push(me.appendConfig.of([au,lu])),e.dispatch({effects:i}),t=yo(e,nu)}return t&&t.dom.querySelector("input").select(),!0}},{key:"Mod-d",run:({state:e,dispatch:t})=>{let{ranges:i}=e.selection;if(i.some((e=>e.from===e.to)))return(({state:e,dispatch:t})=>{let{selection:i}=e,r=W.create(i.ranges.map((t=>e.wordAt(t.head)||W.cursor(t.head))),i.mainIndex);return!r.eq(i)&&(t(e.update({selection:r})),!0)})({state:e,dispatch:t});let r=e.sliceDoc(i[0].from,i[0].to);if(e.selection.ranges.some((t=>e.sliceDoc(t.from,t.to)!=r)))return!1;let s=function(e,t){let{main:i,ranges:r}=e.selection,s=e.wordAt(i.head),n=s&&s.from==i.from&&s.to==i.to;for(let i=!1,s=new Yh(e.doc,t,r[r.length-1].to);;){if(s.next(),!s.done){if(i&&r.some((e=>e.from==s.value.from)))continue;if(n){let t=e.wordAt(s.value.from);if(!t||t.from!=s.value.from||t.to!=s.value.to)continue}return s.value}if(i)return null;s=new Yh(e.doc,t,0,Math.max(0,r[r.length-1].from-1)),i=!0}}(e,r);return!!s&&(t(e.update({selection:e.selection.addRange(W.range(s.from,s.to),!1),effects:rn.scrollIntoView(s.to)})),!0)},preventDefault:!0}];class Vu{constructor(e){this.view=e;let t=this.query=e.state.field(Du).query.spec;function i(e,t,i){return Gh("button",{class:"cm-button",name:e,onclick:t,type:"button"},i)}this.commit=this.commit.bind(this),this.searchField=Gh("input",{value:t.search,placeholder:Ku(e,"Find"),"aria-label":Ku(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Gh("input",{value:t.replace,placeholder:Ku(e,"Replace"),"aria-label":Ku(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=Gh("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=Gh("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=Gh("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit}),this.dom=Gh("div",{onkeydown:e=>this.keydown(e),class:"cm-search"},[this.searchField,i("next",(()=>Pu(e)),[Ku(e,"next")]),i("prev",(()=>Bu(e)),[Ku(e,"previous")]),i("select",(()=>Iu(e)),[Ku(e,"all")]),Gh("label",null,[this.caseField,Ku(e,"match case")]),Gh("label",null,[this.reField,Ku(e,"regexp")]),Gh("label",null,[this.wordField,Ku(e,"by word")]),...e.state.readOnly?[]:[Gh("br"),this.replaceField,i("replace",(()=>Nu(e)),[Ku(e,"replace")]),i("replaceAll",(()=>qu(e)),[Ku(e,"replace all")])],Gh("button",{name:"close",onclick:()=>zu(e),"aria-label":Ku(e,"close"),type:"button"},[""])])}commit(){let e=new _u({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:Ru.of(e)}))}keydown(e){var t,i;i=e,vn(fn((t=this.view).state),i,t,"search-panel")?e.preventDefault():13==e.keyCode&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Bu:Pu)(this.view)):13==e.keyCode&&e.target==this.replaceField&&(e.preventDefault(),Nu(this.view))}update(e){for(let t of e.transactions)for(let e of t.effects)e.is(Ru)&&!e.value.eq(this.query)&&this.setQuery(e.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(vu).top}}function Ku(e,t){return e.state.phrase(t)}const Gu=30,Ju=/[\s\.,:;?!]/;function Xu(e,{from:t,to:i}){let r=e.state.doc.lineAt(t),s=e.state.doc.lineAt(i).to,n=Math.max(r.from,t-Gu),o=Math.min(s,i+Gu),a=e.state.sliceDoc(n,o);if(n!=r.from)for(let e=0;e<Gu;e++)if(!Ju.test(a[e+1])&&Ju.test(a[e])){a=a.slice(e);break}if(o!=s)for(let e=a.length-1;e>a.length-Gu;e--)if(!Ju.test(a[e-1])&&Ju.test(a[e])){a=a.slice(0,e);break}return rn.announce.of(`${e.state.phrase("current match")}. ${a} ${e.state.phrase("on line")} ${r.number}.`)}const Yu=rn.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Zu=[Du,Q.low(Ou),Yu];class Qu{constructor(e,t,i,r){this.state=e,this.pos=t,this.explicit=i,this.view=r,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=il(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),r=t.text.slice(i-t.from,this.pos-t.from),s=r.search(rd(e,!1));return s<0?null:{from:i+s,to:this.pos,text:r.slice(s)}}get aborted(){return null==this.abortListeners}addEventListener(e,t,i){"abort"==e&&this.abortListeners&&(this.abortListeners.push(t),i&&i.onDocChange&&(this.abortOnDocChange=!0))}}function ed(e){let t=Object.keys(e).join(""),i=/\w/.test(t);return i&&(t=t.replace(/\w/g,"")),`[${i?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}class td{constructor(e,t,i,r){this.completion=e,this.source=t,this.match=i,this.score=r}}function id(e){return e.selection.main.from}function rd(e,t){var i;let{source:r}=e,s=t&&"^"!=r[0],n="$"!=r[r.length-1];return s||n?new RegExp(`${s?"^":""}(?:${r})${n?"$":""}`,null!==(i=e.flags)&&void 0!==i?i:e.ignoreCase?"i":""):e}const sd=fe.define();function nd(e,t,i,r){let{main:s}=e.selection,n=i-s.from,o=r-s.from;return Object.assign(Object.assign({},e.changeByRange((a=>{if(a!=s&&i!=r&&e.sliceDoc(a.from+n,a.from+o)!=e.sliceDoc(i,r))return{range:a};let l=e.toText(t);return{changes:{from:a.from+n,to:r==s.from?a.to:a.from+o,insert:l},range:W.cursor(a.from+n+l.length)}}))),{scrollIntoView:!0,userEvent:"input.complete"})}const od=new WeakMap;function ad(e){if(!Array.isArray(e))return e;let t=od.get(e);return t||od.set(e,t=function(e){let t=e.map((e=>"string"==typeof e?{label:e}:e)),[i,r]=t.every((e=>/^\w+$/.test(e.label)))?[/\w*$/,/\w+$/]:function(e){let t=Object.create(null),i=Object.create(null);for(let{label:r}of e){t[r[0]]=!0;for(let e=1;e<r.length;e++)i[r[e]]=!0}let r=ed(t)+ed(i)+"*$";return[new RegExp("^"+r),new RegExp(r)]}(t);return e=>{let s=e.matchBefore(r);return s||e.explicit?{from:s?s.from:e.pos,options:t,validFor:i}:null}}(e)),t}const ld=me.define(),cd=me.define();class hd{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let i=E(e,t),r=T(i);this.chars.push(i);let s=e.slice(t,t+r),n=s.toUpperCase();this.folded.push(E(n==s?s.toLowerCase():n,0)),t+=r}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(0==this.pattern.length)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:r,precise:s,byWord:n}=this;if(1==t.length){let r=E(e,0),s=T(r),n=s==e.length?0:-100;if(r==t[0]);else{if(r!=i[0])return null;n+=-200}return this.ret(n,[0,s])}let o=e.indexOf(this.pattern);if(0==o)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=t.length,l=0;if(o<0){for(let s=0,n=Math.min(e.length,200);s<n&&l<a;){let n=E(e,s);n!=t[l]&&n!=i[l]||(r[l++]=s),s+=T(n)}if(l<a)return null}let c=0,h=0,u=!1,d=0,f=-1,p=-1,g=/[a-z]/.test(e),m=!0;for(let r=0,l=Math.min(e.length,200),v=0;r<l&&h<a;){let l=E(e,r);o<0&&(c<a&&l==t[c]&&(s[c++]=r),d<a&&(l==t[d]||l==i[d]?(0==d&&(f=r),p=r+1,d++):d=0));let _,y=l<255?l>=48&&l<=57||l>=97&&l<=122?2:l>=65&&l<=90?1:0:(_=D(l))!=_.toLowerCase()?1:_!=_.toUpperCase()?2:0;(!r||1==y&&g||0==v&&0!=y)&&(t[h]==l||i[h]==l&&(u=!0)?n[h++]=r:n.length&&(m=!1)),v=y,r+=T(l)}return h==a&&0==n[0]&&m?this.result((u?-200:0)-100,n,e):d==a&&0==f?this.ret(-200-e.length+(p==e.length?0:-100),[0,p]):o>-1?this.ret(-700-e.length,[o,o+this.pattern.length]):d==a?this.ret(-900-e.length,[f,p]):h==a?this.result((u?-200:0)-100-700+(m?0:-1100),n,e):2==t.length?null:this.result((r[0]?-700:0)-200-1100,r,e)}result(e,t,i){let r=[],s=0;for(let e of t){let t=e+(this.astral?T(E(i,e)):1);s&&r[s-1]==e?r[s-1]=t:(r[s++]=e,r[s++]=t)}return this.ret(e-i.length,r)}}class ud{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),i=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return null==i?null:(this.matched=[0,t.length],this.score=i+(e.length==this.pattern.length?0:-100),this)}}const dd=z.define({combine:e=>De(e,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:pd,filterStrict:!1,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>i=>fd(e(i),t(i)),optionClass:(e,t)=>i=>fd(e(i),t(i)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})});function fd(e,t){return e?t?e+" "+t:e:t}function pd(e,t,i,r,s,n){let o,a,l=e.textDirection==yi.RTL,c=l,h=!1,u="top",d=t.left-s.left,f=s.right-t.right,p=r.right-r.left,g=r.bottom-r.top;if(c&&d<Math.min(p,f)?c=!1:!c&&f<Math.min(p,d)&&(c=!0),p<=(c?d:f))o=Math.max(s.top,Math.min(i.top,s.bottom-g))-t.top,a=Math.min(400,c?d:f);else{h=!0,a=Math.min(400,(l?t.right:s.right-t.left)-30);let e=s.bottom-t.bottom;e>=g||e>t.top?o=i.bottom-t.top:(u="bottom",o=t.bottom-i.top)}return{style:`${u}: ${o/((t.bottom-t.top)/n.offsetHeight)}px; max-width: ${a/((t.right-t.left)/n.offsetWidth)}px`,class:"cm-completionInfo-"+(h?l?"left-narrow":"right-narrow":c?"left":"right")}}function gd(e,t,i){if(e<=i)return{from:0,to:e};if(t<0&&(t=0),t<=e>>1){let e=Math.floor(t/i);return{from:e*i,to:(e+1)*i}}let r=Math.floor((e-t)/i);return{from:e-(r+1)*i,to:e-r*i}}class md{constructor(e,t,i){this.view=e,this.stateField=t,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:e=>this.placeInfo(e),key:this},this.space=null,this.currentClass="";let r=e.state.field(t),{options:s,selected:n}=r.open,o=e.state.facet(dd);this.optionContent=function(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(e){let t=document.createElement("div");return t.classList.add("cm-completionIcon"),e.type&&t.classList.add(...e.type.split(/\s+/g).map((e=>"cm-completionIcon-"+e))),t.setAttribute("aria-hidden","true"),t},position:20}),t.push({render(e,t,i,r){let s=document.createElement("span");s.className="cm-completionLabel";let n=e.displayLabel||e.label,o=0;for(let e=0;e<r.length;){let t=r[e++],i=r[e++];t>o&&s.appendChild(document.createTextNode(n.slice(o,t)));let a=s.appendChild(document.createElement("span"));a.appendChild(document.createTextNode(n.slice(t,i))),a.className="cm-completionMatchedText",o=i}return o<n.length&&s.appendChild(document.createTextNode(n.slice(o))),s},position:50},{render(e){if(!e.detail)return null;let t=document.createElement("span");return t.className="cm-completionDetail",t.textContent=e.detail,t},position:80}),t.sort(((e,t)=>e.position-t.position)).map((e=>e.render))}(o),this.optionClass=o.optionClass,this.tooltipClass=o.tooltipClass,this.range=gd(s.length,n,o.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",(i=>{let{options:r}=e.state.field(t).open;for(let t,s=i.target;s&&s!=this.dom;s=s.parentNode)if("LI"==s.nodeName&&(t=/-(\d+)$/.exec(s.id))&&+t[1]<r.length)return this.applyCompletion(e,r[+t[1]]),void i.preventDefault()})),this.dom.addEventListener("focusout",(t=>{let i=e.state.field(this.stateField,!1);i&&i.tooltip&&e.state.facet(dd).closeOnBlur&&t.relatedTarget!=e.contentDOM&&e.dispatch({effects:cd.of(null)})})),this.showOptions(s,r.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)}))}update(e){var t;let i=e.state.field(this.stateField),r=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),i!=r){let{options:s,selected:n,disabled:o}=i.open;r.open&&r.open.options==s||(this.range=gd(s.length,n,e.state.facet(dd).maxRenderedOptions),this.showOptions(s,i.id)),this.updateSel(),o!=(null===(t=r.open)||void 0===t?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!o)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let e of this.currentClass.split(" "))e&&this.dom.classList.remove(e);for(let e of t.split(" "))e&&this.dom.classList.add(e);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=gd(t.options.length,t.selected,this.view.state.facet(dd).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:i}=t.options[t.selected],{info:r}=i;if(!r)return;let s="string"==typeof r?document.createTextNode(r):r(i);if(!s)return;"then"in s?s.then((t=>{t&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(t,i)})).catch((e=>Qi(this.view.state,e,"completion info"))):this.addInfoPane(s,i)}}addInfoPane(e,t){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",null!=e.nodeType)i.appendChild(e),this.infoDestroy=null;else{let{dom:t,destroy:r}=e;i.appendChild(t),this.infoDestroy=r||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,r=this.range.from;i;i=i.nextSibling,r++)"LI"==i.nodeName&&i.id?r==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected"):r--;return t&&function(e,t){let i=e.getBoundingClientRect(),r=t.getBoundingClientRect(),s=i.height/e.offsetHeight;r.top<i.top?e.scrollTop-=(i.top-r.top)/s:r.bottom>i.bottom&&(e.scrollTop+=(r.bottom-i.bottom)/s)}(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),r=e.getBoundingClientRect(),s=this.space;if(!s){let e=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:e.clientWidth,bottom:e.clientHeight}}return r.top>Math.min(s.bottom,t.bottom)-10||r.bottom<Math.max(s.top,t.top)+10?null:this.view.state.facet(dd).positionInfo(this.view,t,r,i,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,i){const r=document.createElement("ul");r.id=t,r.setAttribute("role","listbox"),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-label",this.view.state.phrase("Completions")),r.addEventListener("mousedown",(e=>{e.target==r&&e.preventDefault()}));let s=null;for(let n=i.from;n<i.to;n++){let{completion:o,match:a}=e[n],{section:l}=o;if(l){let e="string"==typeof l?l:l.name;e!=s&&(n>i.from||0==i.from)&&(s=e,"string"!=typeof l&&l.header?r.appendChild(l.header(l)):r.appendChild(document.createElement("completion-section")).textContent=e)}const c=r.appendChild(document.createElement("li"));c.id=t+"-"+n,c.setAttribute("role","option");let h=this.optionClass(o);h&&(c.className=h);for(let e of this.optionContent){let t=e(o,this.view.state,this.view,a);t&&c.appendChild(t)}}return i.from&&r.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&r.classList.add("cm-completionListIncompleteBottom"),r}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function vd(e,t){return i=>new md(i,e,t)}function _d(e){return 100*(e.boost||0)+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}class yd{constructor(e,t,i,r,s,n){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=r,this.selected=s,this.disabled=n}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new yd(this.options,Cd(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,i,r,s,n){if(r&&!n&&e.some((e=>e.isPending)))return r.setDisabled();let o=function(e,t){let i=[],r=null,s=e=>{i.push(e);let{section:t}=e.completion;if(t){r||(r=[]);let e="string"==typeof t?t:t.name;r.some((t=>t.name==e))||r.push("string"==typeof t?{name:e}:t)}},n=t.facet(dd);for(let r of e)if(r.hasResult()){let e=r.result.getMatch;if(!1===r.result.filter)for(let t of r.result.options)s(new td(t,r.source,e?e(t):[],1e9-i.length));else{let i,o=t.sliceDoc(r.from,r.to),a=n.filterStrict?new ud(o):new hd(o);for(let t of r.result.options)if(i=a.match(t.label)){let n=t.displayLabel?e?e(t,i.matched):[]:i.matched;s(new td(t,r.source,n,i.score+(t.boost||0)))}}}if(r){let e=Object.create(null),t=0,s=(e,t)=>{var i,r;return(null!==(i=e.rank)&&void 0!==i?i:1e9)-(null!==(r=t.rank)&&void 0!==r?r:1e9)||(e.name<t.name?-1:1)};for(let i of r.sort(s))t-=1e5,e[i.name]=t;for(let t of i){let{section:i}=t.completion;i&&(t.score+=e["string"==typeof i?i:i.name])}}let o=[],a=null,l=n.compareCompletions;for(let e of i.sort(((e,t)=>t.score-e.score||l(e.completion,t.completion)))){let t=e.completion;!a||a.label!=t.label||a.detail!=t.detail||null!=a.type&&null!=t.type&&a.type!=t.type||a.apply!=t.apply||a.boost!=t.boost?o.push(e):_d(e.completion)>_d(a)&&(o[o.length-1]=e),a=e.completion}return o}(e,t);if(!o.length)return r&&e.some((e=>e.isPending))?r.setDisabled():null;let a=t.facet(dd).selectOnOpen?0:-1;if(r&&r.selected!=a&&-1!=r.selected){let e=r.options[r.selected].completion;for(let t=0;t<o.length;t++)if(o[t].completion==e){a=t;break}}return new yd(o,Cd(i,a),{pos:e.reduce(((e,t)=>t.hasResult()?Math.min(e,t.from):e),1e8),create:Od,above:s.aboveCursor},r?r.timestamp:Date.now(),a,!1)}map(e){return new yd(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}setDisabled(){return new yd(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class bd{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new bd(kd,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(e){let{state:t}=e,i=t.facet(dd),r=(i.override||t.languageDataAt("autocomplete",id(t)).map(ad)).map((t=>(this.active.find((e=>e.source==t))||new Rd(t,this.active.some((e=>0!=e.state))?1:0)).update(e,i)));r.length==this.active.length&&r.every(((e,t)=>e==this.active[t]))&&(r=this.active);let s=this.open,n=e.effects.some((e=>e.is(Dd)));s&&e.docChanged&&(s=s.map(e.changes)),e.selection||r.some((t=>t.hasResult()&&e.changes.touchesRange(t.from,t.to)))||!function(e,t){if(e==t)return!0;for(let i=0,r=0;;){for(;i<e.length&&!e[i].hasResult();)i++;for(;r<t.length&&!t[r].hasResult();)r++;let s=i==e.length,n=r==t.length;if(s||n)return s==n;if(e[i++].result!=t[r++].result)return!1}}(r,this.active)||n?s=yd.build(r,t,this.id,s,i,n):s&&s.disabled&&!r.some((e=>e.isPending))&&(s=null),!s&&r.every((e=>!e.isPending))&&r.some((e=>e.hasResult()))&&(r=r.map((e=>e.hasResult()?new Rd(e.source,0):e)));for(let t of e.effects)t.is(Td)&&(s=s&&s.setSelected(t.value,this.id));return r==this.active&&s==this.open?this:new bd(r,this.id,s)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?wd:Sd}}const wd={"aria-autocomplete":"list"},Sd={};function Cd(e,t){let i={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":e};return t>-1&&(i["aria-activedescendant"]=e+"-"+t),i}const kd=[];function xd(e,t){if(e.isUserEvent("input.complete")){let i=e.annotation(sd);if(i&&t.activateOnCompletion(i))return 12}let i=e.isUserEvent("input.type");return i&&t.activateOnTyping?5:i?1:e.isUserEvent("delete.backward")?2:e.selection?8:e.docChanged?16:0}class Rd{constructor(e,t,i=!1){this.source=e,this.state=t,this.explicit=i}hasResult(){return!1}get isPending(){return 1==this.state}update(e,t){let i=xd(e,t),r=this;(8&i||16&i&&this.touches(e))&&(r=new Rd(r.source,0)),4&i&&0==r.state&&(r=new Rd(this.source,1)),r=r.updateFor(e,i);for(let t of e.effects)if(t.is(ld))r=new Rd(r.source,1,t.value);else if(t.is(cd))r=new Rd(r.source,0);else if(t.is(Dd))for(let e of t.value)e.source==r.source&&(r=e);return r}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(id(e.state))}}class Ed extends Rd{constructor(e,t,i,r,s,n){super(e,3,t),this.limit=i,this.result=r,this.from=s,this.to=n}hasResult(){return!0}updateFor(e,t){var i;if(!(3&t))return this.map(e.changes);let r=this.result;r.map&&!e.changes.empty&&(r=r.map(r,e.changes));let s=e.changes.mapPos(this.from),n=e.changes.mapPos(this.to,1),o=id(e.state);if(o>n||!r||2&t&&(id(e.startState)==this.from||o<this.limit))return new Rd(this.source,4&t?1:0);let a=e.changes.mapPos(this.limit);return function(e,t,i,r){if(!e)return!1;let s=t.sliceDoc(i,r);return"function"==typeof e?e(s,i,r,t):rd(e,!0).test(s)}(r.validFor,e.state,s,n)?new Ed(this.source,this.explicit,a,r,s,n):r.update&&(r=r.update(r,s,n,new Qu(e.state,o,!1)))?new Ed(this.source,this.explicit,a,r,r.from,null!==(i=r.to)&&void 0!==i?i:id(e.state)):new Rd(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new Ed(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new Rd(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}const Dd=me.define({map:(e,t)=>e.map((e=>e.map(t)))}),Td=me.define(),Md=Y.define({create:()=>bd.start(),update:(e,t)=>e.update(t),provide:e=>[lo.from(e,(e=>e.tooltip)),rn.contentAttributes.from(e,(e=>e.attrs))]});function Ad(e,t){const i=t.completion.apply||t.completion.label;let r=e.state.field(Md).active.find((e=>e.source==t.source));return r instanceof Ed&&("string"==typeof i?e.dispatch(Object.assign(Object.assign({},nd(e.state,i,r.from,r.to)),{annotations:sd.of(t.completion)})):i(e,t.completion,r.from,r.to),!0)}const Od=vd(Md,Ad);function Ld(e,t="option"){return i=>{let r=i.state.field(Md,!1);if(!r||!r.open||r.open.disabled||Date.now()-r.open.timestamp<i.state.facet(dd).interactionDelay)return!1;let s,n=1;"page"==t&&(s=mo(i,r.open.tooltip))&&(n=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:o}=r.open.options,a=r.open.selected>-1?r.open.selected+n*(e?1:-1):e?0:o-1;return a<0?a="page"==t?0:o-1:a>=o&&(a="page"==t?o-1:0),i.dispatch({effects:Td.of(a)}),!0}}const Pd=e=>!!e.state.field(Md,!1)&&(e.dispatch({effects:ld.of(!0)}),!0);class Bd{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const Id=rr.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of e.state.field(Md).active)t.isPending&&this.startQuery(t)}update(e){let t=e.state.field(Md),i=e.state.facet(dd);if(!e.selectionSet&&!e.docChanged&&e.startState.field(Md)==t)return;let r=e.transactions.some((e=>{let t=xd(e,i);return 8&t||(e.selection||e.docChanged)&&!(3&t)}));for(let t=0;t<this.running.length;t++){let i=this.running[t];if(r||i.context.abortOnDocChange&&e.docChanged||i.updates.length+e.transactions.length>50&&Date.now()-i.time>1e3){for(let e of i.context.abortListeners)try{e()}catch(e){Qi(this.view.state,e)}i.context.abortListeners=null,this.running.splice(t--,1)}else i.updates.push(...e.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),e.transactions.some((e=>e.effects.some((e=>e.is(ld)))))&&(this.pendingStart=!0);let s=this.pendingStart?50:i.activateOnTypingDelay;if(this.debounceUpdate=t.active.some((e=>e.isPending&&!this.running.some((t=>t.active.source==e.source))))?setTimeout((()=>this.startUpdate()),s):-1,0!=this.composing)for(let t of e.transactions)t.isUserEvent("input.type")?this.composing=2:2==this.composing&&t.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:e}=this.view,t=e.field(Md);for(let e of t.active)e.isPending&&!this.running.some((t=>t.active.source==e.source))&&this.startQuery(e);this.running.length&&t.open&&t.open.disabled&&(this.debounceAccept=setTimeout((()=>this.accept()),this.view.state.facet(dd).updateSyncTime))}startQuery(e){let{state:t}=this.view,i=id(t),r=new Qu(t,i,e.explicit,this.view),s=new Bd(e,r);this.running.push(s),Promise.resolve(e.source(r)).then((e=>{s.context.aborted||(s.done=e||null,this.scheduleAccept())}),(e=>{this.view.dispatch({effects:cd.of(null)}),Qi(this.view.state,e)}))}scheduleAccept(){this.running.every((e=>void 0!==e.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),this.view.state.facet(dd).updateSyncTime))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],i=this.view.state.facet(dd),r=this.view.state.field(Md);for(let s=0;s<this.running.length;s++){let n=this.running[s];if(void 0===n.done)continue;if(this.running.splice(s--,1),n.done){let r=id(n.updates.length?n.updates[0].startState:this.view.state),s=Math.min(r,n.done.from+(n.active.explicit?0:1)),o=new Ed(n.active.source,n.active.explicit,s,n.done,n.done.from,null!==(e=n.done.to)&&void 0!==e?e:r);for(let e of n.updates)o=o.update(e,i);if(o.hasResult()){t.push(o);continue}}let o=r.active.find((e=>e.source==n.active.source));if(o&&o.isPending)if(null==n.done){let e=new Rd(n.active.source,0);for(let t of n.updates)e=e.update(t,i);e.isPending||t.push(e)}else this.startQuery(o)}(t.length||r.open&&r.open.disabled)&&this.view.dispatch({effects:Dd.of(t)})}},{eventHandlers:{blur(e){let t=this.view.state.field(Md,!1);if(t&&t.tooltip&&this.view.state.facet(dd).closeOnBlur){let i=t.open&&mo(this.view,t.open.tooltip);i&&i.dom.contains(e.relatedTarget)||setTimeout((()=>this.view.dispatch({effects:cd.of(null)})),10)}},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:ld.of(!1)})),20),this.composing=0}}}),Nd="object"==typeof navigator&&/Win/.test(navigator.platform),qd=Q.highest(rn.domEventHandlers({keydown(e,t){let i=t.state.field(Md,!1);if(!i||!i.open||i.open.disabled||i.open.selected<0||e.key.length>1||e.ctrlKey&&(!Nd||!e.altKey)||e.metaKey)return!1;let r=i.open.options[i.open.selected],s=i.active.find((e=>e.source==r.source)),n=r.completion.commitCharacters||s.result.commitCharacters;return n&&n.indexOf(e.key)>-1&&Ad(t,r),!1}})),Hd=rn.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'""',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"''"}},".cm-completionIcon-class":{"&:after":{content:"''"}},".cm-completionIcon-interface":{"&:after":{content:"''"}},".cm-completionIcon-variable":{"&:after":{content:"''"}},".cm-completionIcon-constant":{"&:after":{content:"''"}},".cm-completionIcon-type":{"&:after":{content:"''"}},".cm-completionIcon-enum":{"&:after":{content:"''"}},".cm-completionIcon-property":{"&:after":{content:"''"}},".cm-completionIcon-keyword":{"&:after":{content:"''"}},".cm-completionIcon-namespace":{"&:after":{content:"''"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class Fd{constructor(e,t,i,r){this.field=e,this.line=t,this.from=i,this.to=r}}class Wd{constructor(e,t,i){this.field=e,this.from=t,this.to=i}map(e){let t=e.mapPos(this.from,-1,A.TrackDel),i=e.mapPos(this.to,1,A.TrackDel);return null==t||null==i?null:new Wd(this.field,t,i)}}class jd{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let i=[],r=[t],s=e.doc.lineAt(t),n=/^\s*/.exec(s.text)[0];for(let s of this.lines){if(i.length){let i=n,o=/^\t*/.exec(s)[0].length;for(let t=0;t<o;t++)i+=e.facet(fl);r.push(t+i.length-o),s=i+s.slice(o)}i.push(s),t+=s.length+1}let o=this.fieldPositions.map((e=>new Wd(e.field,r[e.line]+e.from,r[e.line]+e.to)));return{text:i,ranges:o}}static parse(e){let t,i=[],r=[],s=[];for(let n of e.split(/\r\n?|\n/)){for(;t=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(n);){let e=t[1]?+t[1]:null,o=t[2]||t[3]||"",a=-1,l=o.replace(/\\[{}]/g,(e=>e[1]));for(let t=0;t<i.length;t++)(null!=e?i[t].seq==e:l&&i[t].name==l)&&(a=t);if(a<0){let t=0;for(;t<i.length&&(null==e||null!=i[t].seq&&i[t].seq<e);)t++;i.splice(t,0,{seq:e,name:l}),a=t;for(let e of s)e.field>=a&&e.field++}s.push(new Fd(a,r.length,t.index,t.index+l.length)),n=n.slice(0,t.index)+o+n.slice(t.index+t[0].length)}n=n.replace(/\\([{}])/g,((e,t,i)=>{for(let e of s)e.line==r.length&&e.from>i&&(e.from--,e.to--);return t})),r.push(n)}return new jd(r,s)}}let $d=ai.widget({widget:new class extends ni{toDOM(){let e=document.createElement("span");return e.className="cm-snippetFieldPosition",e}ignoreEvent(){return!1}}}),zd=ai.mark({class:"cm-snippetField"});class Ud{constructor(e,t){this.ranges=e,this.active=t,this.deco=ai.set(e.map((e=>(e.from==e.to?$d:zd).range(e.from,e.to))))}map(e){let t=[];for(let i of this.ranges){let r=i.map(e);if(!r)return null;t.push(r)}return new Ud(t,this.active)}selectionInsideField(e){return e.ranges.every((e=>this.ranges.some((t=>t.field==this.active&&t.from<=e.from&&t.to>=e.to))))}}const Vd=me.define({map:(e,t)=>e&&e.map(t)}),Kd=me.define(),Gd=Y.define({create:()=>null,update(e,t){for(let i of t.effects){if(i.is(Vd))return i.value;if(i.is(Kd)&&e)return new Ud(e.ranges,i.value)}return e&&t.docChanged&&(e=e.map(t.changes)),e&&t.selection&&!e.selectionInsideField(t.selection)&&(e=null),e},provide:e=>rn.decorations.from(e,(e=>e?e.deco:ai.none))});function Jd(e,t){return W.create(e.filter((e=>e.field==t)).map((e=>W.range(e.from,e.to))))}function Xd(e){return({state:t,dispatch:i})=>{let r=t.field(Gd,!1);if(!r||e<0&&0==r.active)return!1;let s=r.active+e,n=e>0&&!r.ranges.some((t=>t.field==s+e));return i(t.update({selection:Jd(r.ranges,s),effects:Vd.of(n?null:new Ud(r.ranges,s)),scrollIntoView:!0})),!0}}const Yd=[{key:"Tab",run:Xd(1),shift:Xd(-1)},{key:"Escape",run:({state:e,dispatch:t})=>!!e.field(Gd,!1)&&(t(e.update({effects:Vd.of(null)})),!0)}],Zd=z.define({combine:e=>e.length?e[0]:Yd}),Qd=Q.highest(un.compute([Zd],(e=>e.facet(Zd)))),ef=rn.domEventHandlers({mousedown(e,t){let i,r=t.state.field(Gd,!1);if(!r||null==(i=t.posAtCoords({x:e.clientX,y:e.clientY})))return!1;let s=r.ranges.find((e=>e.from<=i&&e.to>=i));return!(!s||s.field==r.active||(t.dispatch({selection:Jd(r.ranges,s.field),effects:Vd.of(r.ranges.some((e=>e.field>s.field))?new Ud(r.ranges,s.field):null),scrollIntoView:!0}),0))}}),tf={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},rf=me.define({map(e,t){let i=t.mapPos(e,-1,A.TrackAfter);return null==i?void 0:i}}),sf=new class extends Te{};sf.startSide=1,sf.endSide=-1;const nf=Y.define({create:()=>Le.empty,update(e,t){if(e=e.map(t.changes),t.selection){let i=t.state.doc.lineAt(t.selection.main.head);e=e.update({filter:e=>e>=i.from&&e<=i.to})}for(let i of t.effects)i.is(rf)&&(e=e.update({add:[sf.range(i.value,i.value+1)]}));return e}}),of="()[]{}<>";function af(e){for(let t=0;t<16;t+=2)if(of.charCodeAt(t)==e)return of.charAt(t+1);return D(e<128?e:e+1)}function lf(e,t){return e.languageDataAt("closeBrackets",t)[0]||tf}const cf="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),hf=rn.inputHandler.of(((e,t,i,r)=>{if((cf?e.composing:e.compositionStarted)||e.state.readOnly)return!1;let s=e.state.selection.main;if(r.length>2||2==r.length&&1==T(E(r,0))||t!=s.from||i!=s.to)return!1;let n=function(e,t){let i=lf(e,e.selection.main.head),r=i.brackets||tf.brackets;for(let s of r){let n=af(E(s,0));if(t==s)return n==s?mf(e,s,r.indexOf(s+s+s)>-1,i):pf(e,s,n,i.before||tf.before);if(t==n&&df(e,e.selection.main.from))return gf(e,0,n)}return null}(e.state,r);return!!n&&(e.dispatch(n),!0)})),uf=[{key:"Backspace",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=lf(e,e.selection.main.head).brackets||tf.brackets,r=null,s=e.changeByRange((t=>{if(t.empty){let r=function(e,t){let i=e.sliceString(t-2,t);return T(E(i,0))==i.length?i:i.slice(1)}(e.doc,t.head);for(let s of i)if(s==r&&ff(e.doc,t.head)==af(E(s,0)))return{changes:{from:t.head-s.length,to:t.head+s.length},range:W.cursor(t.head-s.length)}}return{range:r=t}}));return r||t(e.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!r}}];function df(e,t){let i=!1;return e.field(nf).between(0,e.doc.length,(e=>{e==t&&(i=!0)})),i}function ff(e,t){let i=e.sliceString(t,t+2);return i.slice(0,T(E(i,0)))}function pf(e,t,i,r){let s=null,n=e.changeByRange((n=>{if(!n.empty)return{changes:[{insert:t,from:n.from},{insert:i,from:n.to}],effects:rf.of(n.to+t.length),range:W.range(n.anchor+t.length,n.head+t.length)};let o=ff(e.doc,n.head);return!o||/\s/.test(o)||r.indexOf(o)>-1?{changes:{insert:t+i,from:n.head},effects:rf.of(n.head+t.length),range:W.cursor(n.head+t.length)}:{range:s=n}}));return s?null:e.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function gf(e,t,i){let r=null,s=e.changeByRange((t=>t.empty&&ff(e.doc,t.head)==i?{changes:{from:t.head,to:t.head+i.length,insert:i},range:W.cursor(t.head+i.length)}:r={range:t}));return r?null:e.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function mf(e,t,i,r){let s=r.stringPrefixes||tf.stringPrefixes,n=null,o=e.changeByRange((r=>{if(!r.empty)return{changes:[{insert:t,from:r.from},{insert:t,from:r.to}],effects:rf.of(r.to+t.length),range:W.range(r.anchor+t.length,r.head+t.length)};let o,a=r.head,l=ff(e.doc,a);if(l==t){if(vf(e,a))return{changes:{insert:t+t,from:a},effects:rf.of(a+t.length),range:W.cursor(a+t.length)};if(df(e,a)){let r=i&&e.sliceDoc(a,a+3*t.length)==t+t+t?t+t+t:t;return{changes:{from:a,to:a+r.length,insert:r},range:W.cursor(a+r.length)}}}else{if(i&&e.sliceDoc(a-2*t.length,a)==t+t&&(o=_f(e,a-2*t.length,s))>-1&&vf(e,o))return{changes:{insert:t+t+t+t,from:a},effects:rf.of(a+t.length),range:W.cursor(a+t.length)};if(e.charCategorizer(a)(l)!=ke.Word&&_f(e,a,s)>-1&&!function(e,t,i,r){let s=il(e).resolveInner(t,-1),n=r.reduce(((e,t)=>Math.max(e,t.length)),0);for(let o=0;o<5;o++){let o=e.sliceDoc(s.from,Math.min(s.to,s.from+i.length+n)),a=o.indexOf(i);if(!a||a>-1&&r.indexOf(o.slice(0,a))>-1){let t=s.firstChild;for(;t&&t.from==s.from&&t.to-t.from>i.length+a;){if(e.sliceDoc(t.to-i.length,t.to)==i)return!1;t=t.firstChild}return!0}let l=s.to==t&&s.parent;if(!l)break;s=l}return!1}(e,a,t,s))return{changes:{insert:t+t,from:a},effects:rf.of(a+t.length),range:W.cursor(a+t.length)}}return{range:n=r}}));return n?null:e.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function vf(e,t){let i=il(e).resolveInner(t+1);return i.parent&&i.from==t}function _f(e,t,i){let r=e.charCategorizer(t);if(r(e.sliceDoc(t-1,t))!=ke.Word)return t;for(let s of i){let i=t-s.length;if(e.sliceDoc(i,t)==s&&r(e.sliceDoc(i-1,i))!=ke.Word)return i}return-1}function yf(e={}){return[qd,Md,dd.of(e),Id,wf,Hd]}const bf=[{key:"Ctrl-Space",run:Pd},{mac:"Alt-`",run:Pd},{key:"Escape",run:e=>{let t=e.state.field(Md,!1);return!(!t||!t.active.some((e=>0!=e.state))||(e.dispatch({effects:cd.of(null)}),0))}},{key:"ArrowDown",run:Ld(!0)},{key:"ArrowUp",run:Ld(!1)},{key:"PageDown",run:Ld(!0,"page")},{key:"PageUp",run:Ld(!1,"page")},{key:"Enter",run:e=>{let t=e.state.field(Md,!1);return!(e.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<e.state.facet(dd).interactionDelay)&&Ad(e,t.open.options[t.open.selected])}}],wf=Q.highest(un.computeN([dd],(e=>e.facet(dd).defaultKeymap?[bf]:[])));class Sf{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class Cf{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let r=i.facet(If).markerFilter;r&&(e=r(e,i));let s=e.slice().sort(((e,t)=>e.from-t.from||e.to-t.to)),n=new Pe,o=[],a=0;for(let e=0;;){let t,r,l=e==s.length?null:s[e];if(!l&&!o.length)break;for(o.length?(t=a,r=o.reduce(((e,t)=>Math.min(e,t.to)),l&&l.from>t?l.from:1e8)):(t=l.from,r=l.to,o.push(l),e++);e<s.length;){let i=s[e];if(i.from!=t||!(i.to>i.from||i.to==t)){r=Math.min(i.from,r);break}o.push(i),e++,r=Math.min(i.to,r)}let c=Uf(o);if(o.some((e=>e.from==e.to||e.from==e.to-1&&i.doc.lineAt(e.from).to==e.from)))n.add(t,t,ai.widget({widget:new Hf(c),diagnostics:o.slice()}));else{let e=o.reduce(((e,t)=>t.markClass?e+" "+t.markClass:e),"");n.add(t,r,ai.mark({class:"cm-lintRange cm-lintRange-"+c+e,diagnostics:o.slice(),inclusiveEnd:o.some((e=>e.to>r))}))}a=r;for(let e=0;e<o.length;e++)o[e].to<=a&&o.splice(e--,1)}let l=n.finish();return new Cf(l,t,kf(l))}}function kf(e,t=null,i=0){let r=null;return e.between(i,1e9,((e,i,{spec:s})=>{if(!(t&&s.diagnostics.indexOf(t)<0))if(r){if(s.diagnostics.indexOf(r.diagnostic)<0)return!1;r=new Sf(r.from,i,r.diagnostic)}else r=new Sf(e,i,t||s.diagnostics[0])})),r}function xf(e,t){return e.field(Mf,!1)?t:t.concat(me.appendConfig.of(Vf))}function Rf(e,t){return{effects:xf(e,[Ef.of(t)])}}const Ef=me.define(),Df=me.define(),Tf=me.define(),Mf=Y.define({create:()=>new Cf(ai.none,null,null),update(e,t){if(t.docChanged&&e.diagnostics.size){let i=e.diagnostics.map(t.changes),r=null,s=e.panel;if(e.selected){let s=t.changes.mapPos(e.selected.from,1);r=kf(i,e.selected.diagnostic,s)||kf(i,null,s)}!i.size&&s&&t.state.facet(If).autoPanel&&(s=null),e=new Cf(i,s,r)}for(let i of t.effects)if(i.is(Ef)){let r=t.state.facet(If).autoPanel?i.value.length?Wf.open:null:e.panel;e=Cf.init(i.value,r,t.state)}else i.is(Df)?e=new Cf(e.diagnostics,i.value?Wf.open:null,e.selected):i.is(Tf)&&(e=new Cf(e.diagnostics,e.panel,i.value));return e},provide:e=>[Co.from(e,(e=>e.panel)),rn.decorations.from(e,(e=>e.diagnostics))]}),Af=ai.mark({class:"cm-lintRange cm-lintRange-active"});function Of(e,t,i){let r,{diagnostics:s}=e.state.field(Mf),n=-1,o=-1;s.between(t-(i<0?1:0),t+(i>0?1:0),((e,s,{spec:a})=>{if(t>=e&&t<=s&&(e==s||(t>e||i>0)&&(t<s||i<0)))return r=a.diagnostics,n=e,o=s,!1}));let a=e.state.facet(If).tooltipFilter;return r&&a&&(r=a(r,e.state)),r?{pos:n,end:o,above:e.state.doc.lineAt(n).to<o,create:()=>({dom:Lf(e,r)})}:null}function Lf(e,t){return Gh("ul",{class:"cm-tooltip-lint"},t.map((t=>qf(e,t,!1))))}const Pf=e=>{let t=e.state.field(Mf,!1);return!(!t||!t.panel||(e.dispatch({effects:Df.of(!1)}),0))},Bf=[{key:"Mod-Shift-m",run:e=>{let t=e.state.field(Mf,!1);t&&t.panel||e.dispatch({effects:xf(e.state,[Df.of(!0)])});let i=yo(e,Wf.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0},preventDefault:!0},{key:"F8",run:e=>{let t=e.state.field(Mf,!1);if(!t)return!1;let i=e.state.selection.main,r=t.diagnostics.iter(i.to+1);return!(!r.value&&(r=t.diagnostics.iter(0),!r.value||r.from==i.from&&r.to==i.to)||(e.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0}),0))}}],If=z.define({combine:e=>Object.assign({sources:e.map((e=>e.source)).filter((e=>null!=e))},De(e.map((e=>e.config)),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(e,t)=>e?t?i=>e(i)||t(i):e:t}))});function Nf(e){let t=[];if(e)e:for(let{name:i}of e){for(let e=0;e<i.length;e++){let r=i[e];if(/[a-zA-Z]/.test(r)&&!t.some((e=>e.toLowerCase()==r.toLowerCase()))){t.push(r);continue e}}t.push("")}return t}function qf(e,t,i){var r;let s=i?Nf(t.actions):[];return Gh("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},Gh("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage(e):t.message),null===(r=t.actions)||void 0===r?void 0:r.map(((i,r)=>{let n=!1,o=r=>{if(r.preventDefault(),n)return;n=!0;let s=kf(e.state.field(Mf).diagnostics,t);s&&i.apply(e,s.from,s.to)},{name:a}=i,l=s[r]?a.indexOf(s[r]):-1,c=l<0?a:[a.slice(0,l),Gh("u",a.slice(l,l+1)),a.slice(l+1)];return Gh("button",{type:"button",class:"cm-diagnosticAction",onclick:o,onmousedown:o,"aria-label":` Action: ${a}${l<0?"":` (access key "${s[r]})"`}.`},c)})),t.source&&Gh("div",{class:"cm-diagnosticSource"},t.source))}class Hf extends ni{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return Gh("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class Ff{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=qf(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Wf{constructor(e){this.view=e,this.items=[],this.list=Gh("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t=>{if(27==t.keyCode)Pf(this.view),this.view.focus();else if(38==t.keyCode||33==t.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==t.keyCode||34==t.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==t.keyCode)this.moveSelection(0);else if(35==t.keyCode)this.moveSelection(this.items.length-1);else if(13==t.keyCode)this.view.focus();else{if(!(t.keyCode>=65&&t.keyCode<=90&&this.selectedIndex>=0))return;{let{diagnostic:i}=this.items[this.selectedIndex],r=Nf(i.actions);for(let s=0;s<r.length;s++)if(r[s].toUpperCase().charCodeAt(0)==t.keyCode){let t=kf(this.view.state.field(Mf).diagnostics,i);t&&i.actions[s].apply(e,t.from,t.to)}}}t.preventDefault()},onclick:e=>{for(let t=0;t<this.items.length;t++)this.items[t].dom.contains(e.target)&&this.moveSelection(t)}}),this.dom=Gh("div",{class:"cm-panel-lint"},this.list,Gh("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Pf(this.view)},"")),this.update()}get selectedIndex(){let e=this.view.state.field(Mf).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(Mf),i=0,r=!1,s=null,n=new Set;for(e.between(0,this.view.state.doc.length,((e,o,{spec:a})=>{for(let e of a.diagnostics){if(n.has(e))continue;n.add(e);let o,a=-1;for(let t=i;t<this.items.length;t++)if(this.items[t].diagnostic==e){a=t;break}a<0?(o=new Ff(this.view,e),this.items.splice(i,0,o),r=!0):(o=this.items[a],a>i&&(this.items.splice(i,a-i),r=!0)),t&&o.diagnostic==t.diagnostic?o.dom.hasAttribute("aria-selected")||(o.dom.setAttribute("aria-selected","true"),s=o):o.dom.hasAttribute("aria-selected")&&o.dom.removeAttribute("aria-selected"),i++}}));i<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)r=!0,this.items.pop();0==this.items.length&&(this.items.push(new Ff(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),r=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:e,panel:t})=>{let i=t.height/this.list.offsetHeight;e.top<t.top?this.list.scrollTop-=(t.top-e.top)/i:e.bottom>t.bottom&&(this.list.scrollTop+=(e.bottom-t.bottom)/i)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),r&&this.sync()}sync(){let e=this.list.firstChild;function t(){let t=e;e=t.nextSibling,t.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=kf(this.view.state.field(Mf).diagnostics,this.items[e].diagnostic);t&&this.view.dispatch({selection:{anchor:t.from,head:t.to},scrollIntoView:!0,effects:Tf.of(t)})}static open(e){return new Wf(e)}}function jf(e){return function(e,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(e)}</svg>')`}(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${e}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const $f=rn.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:jf("#d11")},".cm-lintRange-warning":{backgroundImage:jf("orange")},".cm-lintRange-info":{backgroundImage:jf("#999")},".cm-lintRange-hint":{backgroundImage:jf("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function zf(e){return"error"==e?4:"warning"==e?3:"info"==e?2:1}function Uf(e){let t="hint",i=1;for(let r of e){let e=zf(r.severity);e>i&&(i=e,t=r.severity)}return t}const Vf=[Mf,rn.decorations.compute([Mf],(e=>{let{selected:t,panel:i}=e.field(Mf);return t&&i&&t.from!=t.to?ai.set([Af.range(t.from,t.to)]):ai.none})),go(Of,{hideOn:function(e,t){let i=t.pos,r=t.end||i,s=e.state.facet(If).hideOn(e,i,r);if(null!=s)return s;let n=e.startState.doc.lineAt(t.pos);return!(!e.effects.some((e=>e.is(Ef)))&&!e.changes.touchesRange(n.from,Math.max(n.to,r)))}}),$f],Kf=(()=>[zo(),Ko,Wn(),Ic(),Vl(),xn(),[On,Ln],Ee.allowMultipleSelections.of(!0),Ee.transactionFilter.of((e=>{if(!e.docChanged||!e.isUserEvent("input.type")&&!e.isUserEvent("input.complete"))return e;let t=e.startState.languageDataAt("indentOnInput",e.startState.selection.main.head);if(!t.length)return e;let i=e.newDoc,{head:r}=e.newSelection.main,s=i.lineAt(r);if(r>s.from+200)return e;let n=i.sliceString(s.from,r);if(!t.some((e=>e.test(n))))return e;let{state:o}=e,a=-1,l=[];for(let{head:e}of o.selection.ranges){let t=o.doc.lineAt(e);if(t.from==a)continue;a=t.from;let i=ml(o,t.from);if(null==i)continue;let r=/^\s*/.exec(t.text)[0],s=gl(o,i);r!=s&&l.push({from:t.from,to:t.from+r.length,insert:s})}return l.length?[e,{changes:l,sequential:!0}]:e})),Zl(tc,{fallback:!0}),hc(),[hf,nf],yf(),Jn(),Zn(),Vn,uu(),un.of([...uf,...Kh,...Uu,...Qc,...Nl,...bf,...Bf])])();var Gf=i(1924),Jf=i(4512);function Xf(e){const t=new Proxy({},{get(){throw new Error(e)}});return function(e){return e.at(-1)??t}}const Yf=z.define({combine:Xf("No document URI provided. Either pass a one into the extension or use documentUri.of().")}),Zf=z.define({combine:Xf("No language ID provided. Either pass a one into the extension or use languageId.of().")});var Qf={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function ep(e){Qf=e}var tp={exec:()=>null};function ip(e,t=""){let i="string"==typeof e?e:e.source;const r={replace:(e,t)=>{let s="string"==typeof t?t:t.source;return s=s.replace(rp.caret,"$1"),i=i.replace(e,s),r},getRegex:()=>new RegExp(i,t)};return r}var rp={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},sp=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,np=/(?:[*+-]|\d{1,9}[.)])/,op=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,ap=ip(op).replace(/bull/g,np).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),lp=ip(op).replace(/bull/g,np).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),cp=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,hp=/(?!\s*\])(?:\\.|[^\[\]\\])+/,up=ip(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",hp).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),dp=ip(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,np).getRegex(),fp="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",pp=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,gp=ip("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",pp).replace("tag",fp).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),mp=ip(cp).replace("hr",sp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",fp).getRegex(),vp={blockquote:ip(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",mp).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:up,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:sp,html:gp,lheading:ap,list:dp,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:mp,table:tp,text:/^[^\n]+/},_p=ip("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",sp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",fp).getRegex(),yp={...vp,lheading:lp,table:_p,paragraph:ip(cp).replace("hr",sp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",_p).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",fp).getRegex()},bp={...vp,html:ip("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",pp).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:tp,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:ip(cp).replace("hr",sp).replace("heading"," *#{1,6} *[^\n]").replace("lheading",ap).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},wp=/^( {2,}|\\)\n(?!\s*$)/,Sp=/[\p{P}\p{S}]/u,Cp=/[\s\p{P}\p{S}]/u,kp=/[^\s\p{P}\p{S}]/u,xp=ip(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Cp).getRegex(),Rp=/(?!~)[\p{P}\p{S}]/u,Ep=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Dp=ip(Ep,"u").replace(/punct/g,Sp).getRegex(),Tp=ip(Ep,"u").replace(/punct/g,Rp).getRegex(),Mp="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Ap=ip(Mp,"gu").replace(/notPunctSpace/g,kp).replace(/punctSpace/g,Cp).replace(/punct/g,Sp).getRegex(),Op=ip(Mp,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,Rp).getRegex(),Lp=ip("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,kp).replace(/punctSpace/g,Cp).replace(/punct/g,Sp).getRegex(),Pp=ip(/\\(punct)/,"gu").replace(/punct/g,Sp).getRegex(),Bp=ip(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ip=ip(pp).replace("(?:--\x3e|$)","--\x3e").getRegex(),Np=ip("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ip).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),qp=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Hp=ip(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",qp).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Fp=ip(/^!?\[(label)\]\[(ref)\]/).replace("label",qp).replace("ref",hp).getRegex(),Wp=ip(/^!?\[(ref)\](?:\[\])?/).replace("ref",hp).getRegex(),jp={_backpedal:tp,anyPunctuation:Pp,autolink:Bp,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:wp,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:tp,emStrongLDelim:Dp,emStrongRDelimAst:Ap,emStrongRDelimUnd:Lp,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:Hp,nolink:Wp,punctuation:xp,reflink:Fp,reflinkSearch:ip("reflink|nolink(?!\\()","g").replace("reflink",Fp).replace("nolink",Wp).getRegex(),tag:Np,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:tp},$p={...jp,link:ip(/^!?\[(label)\]\((.*?)\)/).replace("label",qp).getRegex(),reflink:ip(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",qp).getRegex()},zp={...jp,emStrongRDelimAst:Op,emStrongLDelim:Tp,url:ip(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Up={...zp,br:ip(wp).replace("{2,}","*").getRegex(),text:ip(zp.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Vp={normal:vp,gfm:yp,pedantic:bp},Kp={normal:jp,gfm:zp,breaks:Up,pedantic:$p},Gp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Jp=e=>Gp[e];function Xp(e,t){if(t){if(rp.escapeTest.test(e))return e.replace(rp.escapeReplace,Jp)}else if(rp.escapeTestNoEncode.test(e))return e.replace(rp.escapeReplaceNoEncode,Jp);return e}function Yp(e){try{e=encodeURI(e).replace(rp.percentDecode,"%")}catch{return null}return e}function Zp(e,t){const i=e.replace(rp.findPipe,((e,t,i)=>{let r=!1,s=t;for(;--s>=0&&"\\"===i[s];)r=!r;return r?"|":" |"})).split(rp.splitPipe);let r=0;if(i[0].trim()||i.shift(),i.length>0&&!i.at(-1)?.trim()&&i.pop(),t)if(i.length>t)i.splice(t);else for(;i.length<t;)i.push("");for(;r<i.length;r++)i[r]=i[r].trim().replace(rp.slashPipe,"|");return i}function Qp(e,t,i){const r=e.length;if(0===r)return"";let s=0;for(;s<r;){const n=e.charAt(r-s-1);if(n!==t||i){if(n===t||!i)break;s++}else s++}return e.slice(0,r-s)}function eg(e,t,i,r,s){const n=t.href,o=t.title||null,a=e[1].replace(s.other.outputLinkReplace,"$1");r.state.inLink=!0;const l={type:"!"===e[0].charAt(0)?"image":"link",raw:i,href:n,title:o,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,l}var tg=class{options;rules;lexer;constructor(e){this.options=e||Qf}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:Qp(e,"\n")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],i=function(e,t,i){const r=e.match(i.other.indentCodeCompensation);if(null===r)return t;const s=r[1];return t.split("\n").map((e=>{const t=e.match(i.other.beginningSpace);if(null===t)return e;const[r]=t;return r.length>=s.length?e.slice(s.length):e})).join("\n")}(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){const t=Qp(e,"#");this.options.pedantic?e=t.trim():t&&!this.rules.other.endingSpaceChar.test(t)||(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Qp(t[0],"\n")}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let e=Qp(t[0],"\n").split("\n"),i="",r="";const s=[];for(;e.length>0;){let t=!1;const n=[];let o;for(o=0;o<e.length;o++)if(this.rules.other.blockquoteStart.test(e[o]))n.push(e[o]),t=!0;else{if(t)break;n.push(e[o])}e=e.slice(o);const a=n.join("\n"),l=a.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}\n${a}`:a,r=r?`${r}\n${l}`:l;const c=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(l,s,!0),this.lexer.state.top=c,0===e.length)break;const h=s.at(-1);if("code"===h?.type)break;if("blockquote"===h?.type){const t=h,n=t.raw+"\n"+e.join("\n"),o=this.blockquote(n);s[s.length-1]=o,i=i.substring(0,i.length-t.raw.length)+o.raw,r=r.substring(0,r.length-t.text.length)+o.text;break}if("list"!==h?.type);else{const t=h,n=t.raw+"\n"+e.join("\n"),o=this.list(n);s[s.length-1]=o,i=i.substring(0,i.length-h.raw.length)+o.raw,r=r.substring(0,r.length-t.raw.length)+o.raw,e=n.substring(s.at(-1).raw.length).split("\n")}}return{type:"blockquote",raw:i,tokens:s,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let i=t[1].trim();const r=i.length>1,s={type:"list",raw:"",ordered:r,start:r?+i.slice(0,-1):"",loose:!1,items:[]};i=r?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=r?i:"[*+-]");const n=this.rules.other.listItemRegex(i);let o=!1;for(;e;){let i=!1,r="",a="";if(!(t=n.exec(e)))break;if(this.rules.block.hr.test(e))break;r=t[0],e=e.substring(r.length);let l=t[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,(e=>" ".repeat(3*e.length))),c=e.split("\n",1)[0],h=!l.trim(),u=0;if(this.options.pedantic?(u=2,a=l.trimStart()):h?u=t[1].length+1:(u=t[2].search(this.rules.other.nonSpaceChar),u=u>4?1:u,a=l.slice(u),u+=t[1].length),h&&this.rules.other.blankLine.test(c)&&(r+=c+"\n",e=e.substring(c.length+1),i=!0),!i){const t=this.rules.other.nextBulletRegex(u),i=this.rules.other.hrRegex(u),s=this.rules.other.fencesBeginRegex(u),n=this.rules.other.headingBeginRegex(u),o=this.rules.other.htmlBeginRegex(u);for(;e;){const d=e.split("\n",1)[0];let f;if(c=d,this.options.pedantic?(c=c.replace(this.rules.other.listReplaceNesting,"  "),f=c):f=c.replace(this.rules.other.tabCharGlobal,"    "),s.test(c))break;if(n.test(c))break;if(o.test(c))break;if(t.test(c))break;if(i.test(c))break;if(f.search(this.rules.other.nonSpaceChar)>=u||!c.trim())a+="\n"+f.slice(u);else{if(h)break;if(l.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(s.test(l))break;if(n.test(l))break;if(i.test(l))break;a+="\n"+c}h||c.trim()||(h=!0),r+=d+"\n",e=e.substring(d.length+1),l=f.slice(u)}}s.loose||(o?s.loose=!0:this.rules.other.doubleBlankLine.test(r)&&(o=!0));let d,f=null;this.options.gfm&&(f=this.rules.other.listIsTask.exec(a),f&&(d="[ ] "!==f[0],a=a.replace(this.rules.other.listReplaceTask,""))),s.items.push({type:"list_item",raw:r,task:!!f,checked:d,loose:!1,text:a,tokens:[]}),s.raw+=r}const a=s.items.at(-1);if(!a)return;a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd(),s.raw=s.raw.trimEnd();for(let e=0;e<s.items.length;e++)if(this.lexer.state.top=!1,s.items[e].tokens=this.lexer.blockTokens(s.items[e].text,[]),!s.loose){const t=s.items[e].tokens.filter((e=>"space"===e.type)),i=t.length>0&&t.some((e=>this.rules.other.anyLine.test(e.raw)));s.loose=i}if(s.loose)for(let e=0;e<s.items.length;e++)s.items[e].loose=!0;return s}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:i,title:r}}}table(e){const t=this.rules.block.table.exec(e);if(!t)return;if(!this.rules.other.tableDelimiter.test(t[2]))return;const i=Zp(t[1]),r=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],n={type:"table",raw:t[0],header:[],align:[],rows:[]};if(i.length===r.length){for(const e of r)this.rules.other.tableAlignRight.test(e)?n.align.push("right"):this.rules.other.tableAlignCenter.test(e)?n.align.push("center"):this.rules.other.tableAlignLeft.test(e)?n.align.push("left"):n.align.push(null);for(let e=0;e<i.length;e++)n.header.push({text:i[e],tokens:this.lexer.inline(i[e]),header:!0,align:n.align[e]});for(const e of s)n.rows.push(Zp(e,n.header.length).map(((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:n.align[t]}))));return n}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;const t=Qp(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{const e=function(e,t){if(-1===e.indexOf(t[1]))return-1;let i=0;for(let r=0;r<e.length;r++)if("\\"===e[r])r++;else if(e[r]===t[0])i++;else if(e[r]===t[1]&&(i--,i<0))return r;return i>0?-2:-1}(t[2],"()");if(-2===e)return;if(e>-1){const i=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,i).trim(),t[3]=""}}let i=t[2],r="";if(this.options.pedantic){const e=this.rules.other.pedanticHrefTitle.exec(i);e&&(i=e[1],r=e[3])}else r=t[3]?t[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(i=this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?i.slice(1):i.slice(1,-1)),eg(t,{href:i?i.replace(this.rules.inline.anyPunctuation,"$1"):i,title:r?r.replace(this.rules.inline.anyPunctuation,"$1"):r},t[0],this.lexer,this.rules)}}reflink(e,t){let i;if((i=this.rules.inline.reflink.exec(e))||(i=this.rules.inline.nolink.exec(e))){const e=t[(i[2]||i[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!e){const e=i[0].charAt(0);return{type:"text",raw:e,text:e}}return eg(i,e,i[0],this.lexer,this.rules)}}emStrong(e,t,i=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(r&&(!r[3]||!i.match(this.rules.other.unicodeAlphaNumeric))&&(!r[1]&&!r[2]||!i||this.rules.inline.punctuation.exec(i))){const i=[...r[0]].length-1;let s,n,o=i,a=0;const l="*"===r[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+i);null!=(r=l.exec(t));){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(n=[...s].length,r[3]||r[4]){o+=n;continue}if((r[5]||r[6])&&i%3&&!((i+n)%3)){a+=n;continue}if(o-=n,o>0)continue;n=Math.min(n,n+o+a);const t=[...r[0]][0].length,l=e.slice(0,i+r.index+t+n);if(Math.min(i,n)%2){const e=l.slice(1,-1);return{type:"em",raw:l,text:e,tokens:this.lexer.inlineTokens(e)}}const c=l.slice(2,-2);return{type:"strong",raw:l,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," ");const i=this.rules.other.nonSpaceChar.test(e),r=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return i&&r&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let e,i;return"@"===t[2]?(e=t[1],i="mailto:"+e):(e=t[1],i=e),{type:"link",raw:t[0],text:e,href:i,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,i;if("@"===t[2])e=t[0],i="mailto:"+e;else{let r;do{r=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??""}while(r!==t[0]);e=t[0],i="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:i,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}},ig=class e{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Qf,this.options.tokenizer=this.options.tokenizer||new tg,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:rp,block:Vp.normal,inline:Kp.normal};this.options.pedantic?(t.block=Vp.pedantic,t.inline=Kp.pedantic):this.options.gfm&&(t.block=Vp.gfm,this.options.breaks?t.inline=Kp.breaks:t.inline=Kp.gfm),this.tokenizer.rules=t}static get rules(){return{block:Vp,inline:Kp}}static lex(t,i){return new e(i).lex(t)}static lexInline(t,i){return new e(i).inlineTokens(t)}lex(e){e=e.replace(rp.carriageReturn,"\n"),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],i=!1){for(this.options.pedantic&&(e=e.replace(rp.tabCharGlobal,"    ").replace(rp.spaceLine,""));e;){let r;if(this.options.extensions?.block?.some((i=>!!(r=i.call({lexer:this},e,t))&&(e=e.substring(r.raw.length),t.push(r),!0))))continue;if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length);const i=t.at(-1);1===r.raw.length&&void 0!==i?i.raw+="\n":t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length);const i=t.at(-1);"paragraph"===i?.type||"text"===i?.type?(i.raw+="\n"+r.raw,i.text+="\n"+r.text,this.inlineQueue.at(-1).src=i.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length);const i=t.at(-1);"paragraph"===i?.type||"text"===i?.type?(i.raw+="\n"+r.raw,i.text+="\n"+r.raw,this.inlineQueue.at(-1).src=i.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}let s=e;if(this.options.extensions?.startBlock){let t=1/0;const i=e.slice(1);let r;this.options.extensions.startBlock.forEach((e=>{r=e.call({lexer:this},i),"number"==typeof r&&r>=0&&(t=Math.min(t,r))})),t<1/0&&t>=0&&(s=e.substring(0,t+1))}if(this.state.top&&(r=this.tokenizer.paragraph(s))){const n=t.at(-1);i&&"paragraph"===n?.type?(n.raw+="\n"+r.raw,n.text+="\n"+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=n.text):t.push(r),i=s.length!==e.length,e=e.substring(r.raw.length)}else if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length);const i=t.at(-1);"text"===i?.type?(i.raw+="\n"+r.raw,i.text+="\n"+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):t.push(r)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let i=e,r=null;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(r=this.tokenizer.rules.inline.reflinkSearch.exec(i));)e.includes(r[0].slice(r[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(r=this.tokenizer.rules.inline.anyPunctuation.exec(i));)i=i.slice(0,r.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;null!=(r=this.tokenizer.rules.inline.blockSkip.exec(i));)i=i.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let s=!1,n="";for(;e;){let r;if(s||(n=""),s=!1,this.options.extensions?.inline?.some((i=>!!(r=i.call({lexer:this},e,t))&&(e=e.substring(r.raw.length),t.push(r),!0))))continue;if(r=this.tokenizer.escape(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.tag(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.link(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(r.raw.length);const i=t.at(-1);"text"===r.type&&"text"===i?.type?(i.raw+=r.raw,i.text+=r.text):t.push(r);continue}if(r=this.tokenizer.emStrong(e,i,n)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.codespan(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.br(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.del(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.autolink(e)){e=e.substring(r.raw.length),t.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(e))){e=e.substring(r.raw.length),t.push(r);continue}let o=e;if(this.options.extensions?.startInline){let t=1/0;const i=e.slice(1);let r;this.options.extensions.startInline.forEach((e=>{r=e.call({lexer:this},i),"number"==typeof r&&r>=0&&(t=Math.min(t,r))})),t<1/0&&t>=0&&(o=e.substring(0,t+1))}if(r=this.tokenizer.inlineText(o)){e=e.substring(r.raw.length),"_"!==r.raw.slice(-1)&&(n=r.raw.slice(-1)),s=!0;const i=t.at(-1);"text"===i?.type?(i.raw+=r.raw,i.text+=r.text):t.push(r)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return t}},rg=class{options;parser;constructor(e){this.options=e||Qf}space(e){return""}code({text:e,lang:t,escaped:i}){const r=(t||"").match(rp.notSpaceStart)?.[0],s=e.replace(rp.endingNewline,"")+"\n";return r?'<pre><code class="language-'+Xp(r)+'">'+(i?s:Xp(s,!0))+"</code></pre>\n":"<pre><code>"+(i?s:Xp(s,!0))+"</code></pre>\n"}blockquote({tokens:e}){return`<blockquote>\n${this.parser.parse(e)}</blockquote>\n`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>\n`}hr(e){return"<hr>\n"}list(e){const t=e.ordered,i=e.start;let r="";for(let t=0;t<e.items.length;t++){const i=e.items[t];r+=this.listitem(i)}const s=t?"ol":"ul";return"<"+s+(t&&1!==i?' start="'+i+'"':"")+">\n"+r+"</"+s+">\n"}listitem(e){let t="";if(e.task){const i=this.checkbox({checked:!!e.checked});e.loose?"paragraph"===e.tokens[0]?.type?(e.tokens[0].text=i+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&"text"===e.tokens[0].tokens[0].type&&(e.tokens[0].tokens[0].text=i+" "+Xp(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:i+" ",text:i+" ",escaped:!0}):t+=i+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>\n`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>\n`}table(e){let t="",i="";for(let t=0;t<e.header.length;t++)i+=this.tablecell(e.header[t]);t+=this.tablerow({text:i});let r="";for(let t=0;t<e.rows.length;t++){const s=e.rows[t];i="";for(let e=0;e<s.length;e++)i+=this.tablecell(s[e]);r+=this.tablerow({text:i})}return r&&(r=`<tbody>${r}</tbody>`),"<table>\n<thead>\n"+t+"</thead>\n"+r+"</table>\n"}tablerow({text:e}){return`<tr>\n${e}</tr>\n`}tablecell(e){const t=this.parser.parseInline(e.tokens),i=e.header?"th":"td";return(e.align?`<${i} align="${e.align}">`:`<${i}>`)+t+`</${i}>\n`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Xp(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:i}){const r=this.parser.parseInline(i),s=Yp(e);if(null===s)return r;let n='<a href="'+(e=s)+'"';return t&&(n+=' title="'+Xp(t)+'"'),n+=">"+r+"</a>",n}image({href:e,title:t,text:i,tokens:r}){r&&(i=this.parser.parseInline(r,this.parser.textRenderer));const s=Yp(e);if(null===s)return Xp(i);let n=`<img src="${e=s}" alt="${i}"`;return t&&(n+=` title="${Xp(t)}"`),n+=">",n}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Xp(e.text)}},sg=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},ng=class e{options;renderer;textRenderer;constructor(e){this.options=e||Qf,this.options.renderer=this.options.renderer||new rg,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new sg}static parse(t,i){return new e(i).parse(t)}static parseInline(t,i){return new e(i).parseInline(t)}parse(e,t=!0){let i="";for(let r=0;r<e.length;r++){const s=e[r];if(this.options.extensions?.renderers?.[s.type]){const e=s,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){i+=t||"";continue}}const n=s;switch(n.type){case"space":i+=this.renderer.space(n);continue;case"hr":i+=this.renderer.hr(n);continue;case"heading":i+=this.renderer.heading(n);continue;case"code":i+=this.renderer.code(n);continue;case"table":i+=this.renderer.table(n);continue;case"blockquote":i+=this.renderer.blockquote(n);continue;case"list":i+=this.renderer.list(n);continue;case"html":i+=this.renderer.html(n);continue;case"paragraph":i+=this.renderer.paragraph(n);continue;case"text":{let s=n,o=this.renderer.text(s);for(;r+1<e.length&&"text"===e[r+1].type;)s=e[++r],o+="\n"+this.renderer.text(s);i+=t?this.renderer.paragraph({type:"paragraph",raw:o,text:o,tokens:[{type:"text",raw:o,text:o,escaped:!0}]}):o;continue}default:{const e='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return i}parseInline(e,t=this.renderer){let i="";for(let r=0;r<e.length;r++){const s=e[r];if(this.options.extensions?.renderers?.[s.type]){const e=this.options.extensions.renderers[s.type].call({parser:this},s);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){i+=e||"";continue}}const n=s;switch(n.type){case"escape":case"text":i+=t.text(n);break;case"html":i+=t.html(n);break;case"link":i+=t.link(n);break;case"image":i+=t.image(n);break;case"strong":i+=t.strong(n);break;case"em":i+=t.em(n);break;case"codespan":i+=t.codespan(n);break;case"br":i+=t.br(n);break;case"del":i+=t.del(n);break;default:{const e='Token with "'+n.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return i}},og=class{options;block;constructor(e){this.options=e||Qf}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?ig.lex:ig.lexInline}provideParser(){return this.block?ng.parse:ng.parseInline}},ag=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=ng;Renderer=rg;TextRenderer=sg;Lexer=ig;Tokenizer=tg;Hooks=og;constructor(...e){this.use(...e)}walkTokens(e,t){let i=[];for(const r of e)switch(i=i.concat(t.call(this,r)),r.type){case"table":{const e=r;for(const r of e.header)i=i.concat(this.walkTokens(r.tokens,t));for(const r of e.rows)for(const e of r)i=i.concat(this.walkTokens(e.tokens,t));break}case"list":{const e=r;i=i.concat(this.walkTokens(e.items,t));break}default:{const e=r;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach((r=>{const s=e[r].flat(1/0);i=i.concat(this.walkTokens(s,t))})):e.tokens&&(i=i.concat(this.walkTokens(e.tokens,t)))}}return i}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach((e=>{const i={...e};if(i.async=this.defaults.async||i.async||!1,e.extensions&&(e.extensions.forEach((e=>{if(!e.name)throw new Error("extension name required");if("renderer"in e){const i=t.renderers[e.name];t.renderers[e.name]=i?function(...t){let r=e.renderer.apply(this,t);return!1===r&&(r=i.apply(this,t)),r}:e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");const i=t[e.level];i?i.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)})),i.extensions=t),e.renderer){const t=this.defaults.renderer||new rg(this.defaults);for(const i in e.renderer){if(!(i in t))throw new Error(`renderer '${i}' does not exist`);if(["options","parser"].includes(i))continue;const r=i,s=e.renderer[r],n=t[r];t[r]=(...e)=>{let i=s.apply(t,e);return!1===i&&(i=n.apply(t,e)),i||""}}i.renderer=t}if(e.tokenizer){const t=this.defaults.tokenizer||new tg(this.defaults);for(const i in e.tokenizer){if(!(i in t))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;const r=i,s=e.tokenizer[r],n=t[r];t[r]=(...e)=>{let i=s.apply(t,e);return!1===i&&(i=n.apply(t,e)),i}}i.tokenizer=t}if(e.hooks){const t=this.defaults.hooks||new og;for(const i in e.hooks){if(!(i in t))throw new Error(`hook '${i}' does not exist`);if(["options","block"].includes(i))continue;const r=i,s=e.hooks[r],n=t[r];og.passThroughHooks.has(i)?t[r]=e=>{if(this.defaults.async)return Promise.resolve(s.call(t,e)).then((e=>n.call(t,e)));const i=s.call(t,e);return n.call(t,i)}:t[r]=(...e)=>{let i=s.apply(t,e);return!1===i&&(i=n.apply(t,e)),i}}i.hooks=t}if(e.walkTokens){const t=this.defaults.walkTokens,r=e.walkTokens;i.walkTokens=function(e){let i=[];return i.push(r.call(this,e)),t&&(i=i.concat(t.call(this,e))),i}}this.defaults={...this.defaults,...i}})),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return ig.lex(e,t??this.defaults)}parser(e,t){return ng.parse(e,t??this.defaults)}parseMarkdown(e){return(t,i)=>{const r={...i},s={...this.defaults,...r},n=this.onError(!!s.silent,!!s.async);if(!0===this.defaults.async&&!1===r.async)return n(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==t)return n(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return n(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));s.hooks&&(s.hooks.options=s,s.hooks.block=e);const o=s.hooks?s.hooks.provideLexer():e?ig.lex:ig.lexInline,a=s.hooks?s.hooks.provideParser():e?ng.parse:ng.parseInline;if(s.async)return Promise.resolve(s.hooks?s.hooks.preprocess(t):t).then((e=>o(e,s))).then((e=>s.hooks?s.hooks.processAllTokens(e):e)).then((e=>s.walkTokens?Promise.all(this.walkTokens(e,s.walkTokens)).then((()=>e)):e)).then((e=>a(e,s))).then((e=>s.hooks?s.hooks.postprocess(e):e)).catch(n);try{s.hooks&&(t=s.hooks.preprocess(t));let e=o(t,s);s.hooks&&(e=s.hooks.processAllTokens(e)),s.walkTokens&&this.walkTokens(e,s.walkTokens);let i=a(e,s);return s.hooks&&(i=s.hooks.postprocess(i)),i}catch(e){return n(e)}}}onError(e,t){return i=>{if(i.message+="\nPlease report this to https://github.com/markedjs/marked.",e){const e="<p>An error occurred:</p><pre>"+Xp(i.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(i);throw i}}};function lg(e,t){return ag.parse(e,t)}function cg(e,t){if(t.line>=e.lines)return 0===t.character?e.length:void 0;const i=e.line(t.line+1).from+t.character;return i>e.length?void 0:i}function hg(e,t){return cg(e,t)||0}function ug(e,t){const i=e.lineAt(t);return{character:t-i.from,line:i.number-1}}lg.options=lg.setOptions=function(e){return ag.setOptions(e),lg.defaults=ag.defaults,ep(lg.defaults),lg},lg.getDefaults=function(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}},lg.defaults=Qf,lg.use=function(...e){return ag.use(...e),lg.defaults=ag.defaults,ep(lg.defaults),lg},lg.walkTokens=function(e,t){return ag.walkTokens(e,t)},lg.parseInline=ag.parseInline,lg.Parser=ng,lg.parser=ng.parse,lg.Renderer=rg,lg.TextRenderer=sg,lg.Lexer=ig,lg.lexer=ig.lex,lg.Tokenizer=tg,lg.Hooks=og,lg.parse=lg,lg.options,lg.setOptions,lg.use,lg.walkTokens,lg.parseInline,ng.parse,ig.lex;const dg=new lg.Renderer,fg=dg.code;function pg(e){return lg(e,{async:!1,gfm:!0,breaks:!0,renderer:dg})}function gg(e){if(!e)return"";if(function(e){return void 0!==e.kind}(e)){let t=e.value;return"markdown"===e.kind&&(t=pg(t.trim())),t}return Array.isArray(e)?e.map((e=>gg(e))).filter(Boolean).join("\n\n"):"string"==typeof e?e:""}function mg(e,t){const i=document.createElement("div");i.className="cm-error-message",i.style.cssText="\n  position: absolute;\n  padding: 8px;\n  background: #fee;\n  border: 1px solid #fcc;\n  border-radius: 4px;\n  color: #c00;\n  font-size: 14px;\n  z-index: 100;\n  max-width: 300px;\n  box-shadow: 0 2px 8px rgba(0,0,0,.15);\n",i.textContent=t;const r=e.coordsAtPos(e.state.selection.main.head);r&&(i.style.left=`${r.left}px`,i.style.top=`${r.bottom+5}px`),document.body.appendChild(i),setTimeout((()=>{i.style.opacity="0",i.style.transition="opacity 0.2s",setTimeout((()=>i.remove()),200)}),3e3)}function vg(e){if(null==e)return!0;if(Array.isArray(e))return 0===e.length||e.every(vg);if("string"==typeof e)return _g(e);const t=e.value;return"string"==typeof t&&_g(t)}function _g(e){return null==e||"string"==typeof e&&(""===e.trim()||/^[\s\n`]*$/.test(e))}dg.code=e=>e.text.trim()?fg.call(dg,e):"";const yg=Object.fromEntries(Object.entries(Jf.CompletionItemKind).map((([e,t])=>[t,e])));var bg;function wg(e,t){const i=e.sortText??e.label,r=t.sortText??t.label;return i.localeCompare(r)}function Sg(e,t){const i=e.label.endsWith("="),r=t.label.endsWith("=");return i&&!r?-1:!i&&r?1:0}!function(e){e.PlainText=1,e.Snippet=2}(bg||(bg={}));const Cg=console.log;class kg{ready;capabilities;initializePromise;rootUri;workspaceFolders;autoClose;timeout;transport;requestManager;client;initializationOptions;clientCapabilities;plugins;constructor({rootUri:e,workspaceFolders:t,transport:i,autoClose:r,initializationOptions:s,capabilities:n,timeout:o=1e4}){this.rootUri=e,this.workspaceFolders=t,this.transport=i,this.autoClose=r,this.initializationOptions=s,this.clientCapabilities=n,this.timeout=o,this.ready=!1,this.capabilities=null,this.plugins=[],this.requestManager=new Gf.RequestManager([this.transport]),this.client=new Gf.Client(this.requestManager),this.client.onNotification((e=>{this.processNotification(e)}));const a=this.transport;a?.connection&&a.connection.addEventListener("message",(e=>{const t=JSON.parse(e.data);t.method&&t.id&&a.connection.send(JSON.stringify({jsonrpc:"2.0",id:t.id,result:null}))})),this.initializePromise=this.initialize()}getInitializationOptions(){const e={textDocument:{hover:{dynamicRegistration:!0,contentFormat:["markdown","plaintext"]},moniker:{},synchronization:{dynamicRegistration:!0,willSave:!1,didSave:!1,willSaveWaitUntil:!1},codeAction:{dynamicRegistration:!0,codeActionLiteralSupport:{codeActionKind:{valueSet:["","quickfix","refactor","refactor.extract","refactor.inline","refactor.rewrite","source","source.organizeImports"]}},resolveSupport:{properties:["edit"]}},completion:{dynamicRegistration:!0,completionItem:{snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:["markdown","plaintext"],deprecatedSupport:!1,preselectSupport:!1},contextSupport:!1},signatureHelp:{dynamicRegistration:!0,signatureInformation:{documentationFormat:["markdown","plaintext"]}},declaration:{dynamicRegistration:!0,linkSupport:!0},definition:{dynamicRegistration:!0,linkSupport:!0},typeDefinition:{dynamicRegistration:!0,linkSupport:!0},implementation:{dynamicRegistration:!0,linkSupport:!0},rename:{dynamicRegistration:!0,prepareSupport:!0}},workspace:{didChangeConfiguration:{dynamicRegistration:!0}}};return{capabilities:this.clientCapabilities?"function"==typeof this.clientCapabilities?this.clientCapabilities(e):this.clientCapabilities:e,initializationOptions:this.initializationOptions,processId:null,rootUri:this.rootUri,workspaceFolders:this.workspaceFolders}}async initialize(){const{capabilities:e}=await this.request("initialize",this.getInitializationOptions(),3*this.timeout);this.capabilities=e,this.notify("initialized",{}),this.ready=!0}close(){this.client.close()}textDocumentDidOpen(e){return this.notify("textDocument/didOpen",e)}textDocumentDidChange(e){return this.notify("textDocument/didChange",e)}async textDocumentHover(e){return await this.request("textDocument/hover",e,this.timeout)}async textDocumentCompletion(e){return await this.request("textDocument/completion",e,this.timeout)}async completionItemResolve(e){return await this.request("completionItem/resolve",e,this.timeout)}async textDocumentDefinition(e){return await this.request("textDocument/definition",e,this.timeout)}async textDocumentCodeAction(e){return await this.request("textDocument/codeAction",e,this.timeout)}async textDocumentRename(e){return await this.request("textDocument/rename",e,this.timeout)}async textDocumentPrepareRename(e){return await this.request("textDocument/prepareRename",e,this.timeout)}async textDocumentSignatureHelp(e){return await this.request("textDocument/signatureHelp",e,this.timeout)}attachPlugin(e){this.plugins.push(e)}detachPlugin(e){const t=this.plugins.indexOf(e);-1!==t&&(this.plugins.splice(t,1),this.autoClose&&this.close())}request(e,t,i){return this.client.request({method:e,params:t},i)}notify(e,t){return this.client.notify({method:e,params:t})}processNotification(e){for(const t of this.plugins)t.processNotification(e)}}class xg{documentVersion;client;documentUri;languageId;view;allowHTMLContent=!1;sendIncrementalChanges;featureOptions;onGoToDefinition;constructor(e,t,i,r,s,n=!0,o=!1,a){this.documentVersion=0,this.client=e,this.documentUri=t,this.languageId=i,this.view=r,this.allowHTMLContent=o,this.sendIncrementalChanges=n,this.featureOptions=s,this.onGoToDefinition=a,this.client.attachPlugin(this),this.initialize({documentText:this.view.state.doc.toString()})}update({state:e,docChanged:t,startState:{doc:i},changes:r}){t&&(this.sendIncrementalChanges?this.sendChanges(function(e,t){const i=[];return t.iterChanges(((t,r,s,n,o)=>{const a=o.toString();if(0===t&&r===e.length)return void i.push({text:a});const l=ug(e,t),c=ug(e,r);i.push({range:{start:l,end:c},text:a})})),i.sort(((e,t)=>e.range.start.line!==t.range.start.line?t.range.start.line-e.range.start.line:t.range.start.character-e.range.start.character)),i}(i,r)):this.sendChanges([{text:e.doc.toString()}]))}destroy(){this.client.detachPlugin(this)}async initialize({documentText:e}){this.client.initializePromise&&await this.client.initializePromise,await this.client.textDocumentDidOpen({textDocument:{uri:this.documentUri,languageId:this.languageId,text:e,version:this.documentVersion}})}async sendChanges(e){if(this.client.ready)try{await this.client.textDocumentDidChange({textDocument:{uri:this.documentUri,version:++this.documentVersion},contentChanges:e})}catch(e){console.error(e)}}requestDiagnostics(e){this.sendChanges([{text:e.state.doc.toString()}])}async requestHoverTooltip(e,{line:t,character:i}){if(!this.featureOptions.hoverEnabled)return null;if(!this.client.ready||!this.client.capabilities?.hoverProvider)return null;const r=await this.client.textDocumentHover({textDocument:{uri:this.documentUri},position:{line:t,character:i}});if(!r)return null;const{contents:s,range:n}=r;let o,a=cg(e.state.doc,{line:t,character:i});if(n&&(a=cg(e.state.doc,n.start),o=cg(e.state.doc,n.end)),null==a)return null;if(vg(s))return null;const l=document.createElement("div");return l.classList.add("documentation"),this.allowHTMLContent?l.innerHTML=gg(s):l.textContent=gg(s),{pos:a,end:o,create:e=>({dom:l}),above:!0}}async requestCompletion(e,{line:t,character:i},{triggerKind:r,triggerCharacter:s}){if(!this.featureOptions.completionEnabled)return null;if(!this.client.ready||!this.client.capabilities?.completionProvider)return null;const n=await this.client.textDocumentCompletion({textDocument:{uri:this.documentUri},position:{line:t,character:i},context:{triggerKind:r,triggerCharacter:s}});if(!n)return null;const o="items"in n?n.items:n,a=function(e){if(0===e.length)return;const t=function(e){if(0===e.length)return"";if(1===e.length)return e[0]||"";e.sort();const t=e[0]||"",i=e[e.length-1]||"";let r=0;for(;r<t.length&&t[r]===i[r];)r++;return t.substring(0,r)}(e.map((e=>e.textEdit?.newText||e.label)));if(""===t)return;const i=[];for(let e=0;e<t.length;e++){const r=t.slice(0,e+1);if(r.length>0){const e=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");i.push(e)}}const r=i.join("|");return new RegExp(`(${r})$`)}(o),l=a?e.matchBefore(a):e.matchBefore(/[a-zA-Z0-9]+/);let{pos:c}=e;const h=function(e,t,i){const r=[t?(s=t,(e,t)=>{const i=e.sortText??e.label,r=t.sortText??t.label;switch(!0){case i.startsWith(s)&&!r.startsWith(s):return-1;case!i.startsWith(s)&&r.startsWith(s):return 1}return i.localeCompare(r)}):wg,"python"===i?Sg:void 0].filter(Boolean);var s;let n=e;if(t){const e=t.toLowerCase();/^\w+$/.test(e)&&(n=n.filter((({label:t,filterText:i})=>(i??t).toLowerCase().startsWith(e))))}for(const e of r)n.sort(e);return n}(o,l?.text,this.languageId);l&&(c=l.from);const u=h.map((e=>function(e,t){const{detail:i,labelDetails:r,label:s,kind:n,textEdit:o,insertText:a,documentation:l,additionalTextEdits:c,insertTextFormat:h}=e,u={label:s,detail:r?.detail||i,apply(e,t,i,r){if(o&&function(e){return void 0!==e?.range}(o))e.dispatch(nd(e.state,o.newText,hg(e.state.doc,o.range.start),hg(e.state.doc,o.range.end)));else if(a&&h===bg.Snippet){const t=function(e){let t=jd.parse(e);return(e,i,r,s)=>{let{text:n,ranges:o}=t.instantiate(e.state,r),{main:a}=e.state.selection,l={changes:{from:r,to:s==a.from?a.to:s,insert:m.of(n)},scrollIntoView:!0,annotations:i?[sd.of(i),ve.userEvent.of("input.complete")]:void 0};if(o.length&&(l.selection=Jd(o,0)),o.some((e=>e.field>0))){let t=new Ud(o,0),i=l.effects=[Vd.of(t)];void 0===e.state.field(Gd,!1)&&i.push(me.appendConfig.of([Gd,Qd,ef,Hd]))}e.dispatch(e.state.update(l))}}(function(e){return e.replaceAll(/\\\\/g,"").replaceAll(/(\$(\d+))/g,((e,t,i)=>"${"+i+"}"))}(a));t(e,null,i,r)}else e.dispatch(nd(e.state,s,i,r));if(!c)return;const n=c.sort((({range:{end:t}},{range:{end:i}})=>hg(e.state.doc,t)<hg(e.state.doc,i)?1:hg(e.state.doc,t)>hg(e.state.doc,i)?-1:0));for(const t of n)e.dispatch(e.state.update({changes:{from:hg(e.state.doc,t.range.start),to:cg(e.state.doc,t.range.end),insert:t.newText}}))},type:n&&yg[n].toLowerCase()};return t.hasResolveProvider&&t.resolveItem?u.info=async()=>{try{const i=await(t.resolveItem?.(e)),r=document.createElement("div");r.classList.add("documentation");const s=i?.documentation||l;return s?vg(s)?null:(t.allowHTMLContent?r.innerHTML=gg(s):r.textContent=gg(s),r):null}catch(e){if(console.error("Failed to resolve completion item:",e),vg(l))return null;if(l){const e=document.createElement("div");return e.classList.add("documentation"),t.allowHTMLContent?e.innerHTML=gg(l):e.textContent=gg(l),e}return null}}:l&&(u.info=()=>{const e=document.createElement("div");return e.classList.add("documentation"),t.allowHTMLContent?e.innerHTML=gg(l):e.textContent=gg(l),e}),u}(e,{allowHTMLContent:this.allowHTMLContent,hasResolveProvider:this.client.capabilities?.completionProvider?.resolveProvider??!1,resolveItem:this.client.completionItemResolve.bind(this.client)})));return{from:c,options:u,filter:!1}}async requestDefinition(e,{line:t,character:i}){if(!this.featureOptions.definitionEnabled)return;if(!this.client.ready||!this.client.capabilities?.definitionProvider)return;const r=await this.client.textDocumentDefinition({textDocument:{uri:this.documentUri},position:{line:t,character:i}});if(!r)return;const s=Array.isArray(r)?r:[r];if(0===s.length)return;const n=s[0];if(!n)return;const o="uri"in n?n.uri:n.targetUri,a="range"in n?n.range:n.targetRange,l=o!==this.documentUri,c={uri:o,range:a,isExternalDocument:l};return l||e.dispatch(e.state.update({selection:{anchor:hg(e.state.doc,a.start),head:cg(e.state.doc,a.end)}})),this.onGoToDefinition&&this.onGoToDefinition(c),c}processNotification(e){try{"textDocument/publishDiagnostics"===e.method&&this.processDiagnostics(e.params)}catch(e){Cg(e)}}async processDiagnostics(e){if(e.uri!==this.documentUri)return;if(!this.featureOptions.diagnosticsEnabled)return void this.view.dispatch(Rf(this.view.state,[]));const t={[Jf.DiagnosticSeverity.Error]:"error",[Jf.DiagnosticSeverity.Warning]:"warning",[Jf.DiagnosticSeverity.Information]:"info",[Jf.DiagnosticSeverity.Hint]:"info"},i=e.diagnostics.map((async({range:e,message:i,severity:r,code:s})=>{const n=await this.requestCodeActions(e,[s]),o=n?.map((e=>({name:"command"in e&&"object"==typeof e.command&&e.command?.title||e.title,apply:async()=>{if("edit"in e&&e.edit?.changes){const t=e.edit.changes[this.documentUri];if(!t)return;for(const e of t)this.view.dispatch(this.view.state.update({changes:{from:hg(this.view.state.doc,e.range.start),to:cg(this.view.state.doc,e.range.end),insert:e.newText}}))}"command"in e&&e.command&&Cg("Executing command:",e.command)}})));return{from:hg(this.view.state.doc,e.start),to:hg(this.view.state.doc,e.end),severity:t[r??Jf.DiagnosticSeverity.Error],message:i,renderMessage:()=>{const e=document.createElement("div");return e.innerHTML=pg(i),e},source:this.languageId,actions:o}})),r=await Promise.all(i);this.view.dispatch(Rf(this.view.state,r))}async requestCodeActions(e,t){return this.featureOptions.codeActionsEnabled&&this.client.ready&&this.client.capabilities?.codeActionProvider?await this.client.textDocumentCodeAction({textDocument:{uri:this.documentUri},range:e,context:{diagnostics:[{range:e,code:t[0],source:this.languageId,message:""}]}}):null}async requestRename(e,{line:t,character:i}){if(this.featureOptions.renameEnabled)if(this.client.ready)if(this.client.capabilities?.renameProvider)try{const r=await this.client.textDocumentPrepareRename({textDocument:{uri:this.documentUri},position:{line:t,character:i}}).catch((()=>this.prepareRenameFallback(e,{line:t,character:i})));if(!r||"defaultBehavior"in r)return void mg(e,"Cannot rename this symbol");const s=document.createElement("div");s.className="cm-rename-popup",s.style.cssText="position: absolute; padding: 4px; background: white; border: 1px solid #ddd; box-shadow: 0 2px 8px rgba(0,0,0,.15); z-index: 99;";const n=document.createElement("input");n.type="text",n.style.cssText="width: 200px; padding: 4px; border: 1px solid #ddd;";const o="range"in r?r.range:r,a=cg(e.state.doc,o.start);if(null==a)return;const l=cg(e.state.doc,o.end);n.value=e.state.doc.sliceString(a,l),s.appendChild(n);const c=e.coordsAtPos(a);if(!c)return;s.style.left=`${c.left}px`,s.style.top=`${c.bottom+5}px`;const h=async()=>{const r=n.value.trim();if(!r)return mg(e,"New name cannot be empty"),void s.remove();if(r!==n.defaultValue)try{const s=await this.client.textDocumentRename({textDocument:{uri:this.documentUri},position:{line:t,character:i},newName:r});await this.applyRenameEdit(e,s)}catch(t){mg(e,`Rename failed: ${t instanceof Error?t.message:"Unknown error"}`)}finally{s.remove()}else s.remove()};n.addEventListener("keydown",(e=>{"Enter"===e.key?h():"Escape"===e.key&&s.remove(),e.stopPropagation()}));const u=e=>{s.contains(e.target)||(s.remove(),document.removeEventListener("mousedown",u))};document.addEventListener("mousedown",u),document.body.appendChild(s),n.focus(),n.select()}catch(t){mg(e,`Rename failed: ${t instanceof Error?t.message:"Unknown error"}`)}else mg(e,"Rename not supported by language server");else mg(e,"Language server not ready")}async requestSignatureHelp(e,{line:t,character:i},r=void 0){if(!(this.featureOptions.signatureHelpEnabled&&this.client.ready&&this.client.capabilities?.signatureHelpProvider))return null;try{const s=await this.client.textDocumentSignatureHelp({textDocument:{uri:this.documentUri},position:{line:t,character:i},context:{isRetrigger:!1,triggerKind:1,triggerCharacter:r}});if(!s?.signatures||0===s.signatures.length)return null;const n=this.createTooltipContainer(),o=s.activeSignature??0,a=s.signatures[o]||s.signatures[0];if(!a)return null;const l=s.activeParameter??a.activeParameter??0,c=this.createSignatureElement(a,l);n.appendChild(c),a.documentation&&n.appendChild(this.createDocumentationElement(a.documentation));const h=a.parameters?.[l];h?.documentation&&n.appendChild(this.createParameterDocElement(h.documentation));const u=cg(e.state.doc,{line:t,character:i});return null==u?null:{pos:u,end:u,create:e=>({dom:n}),above:!1}}catch(e){return console.error("Signature help error:",e),null}}async showSignatureHelpTooltip(e,t,i){const r=await this.requestSignatureHelp(e,ug(e.state.doc,t),i);if(r){const{pos:t,create:i}=r,s=i(e),n=document.createElement("div");n.className="cm-tooltip cm-signature-tooltip",n.style.position="absolute",n.appendChild(s.dom);const o=e.coordsAtPos(t);if(o){n.style.left=`${o.left}px`,n.style.top=`${o.bottom+5}px`,document.body.appendChild(n),setTimeout((()=>{n.remove()}),1e4);const t=()=>{n.remove(),e.dom.removeEventListener("keydown",t),e.dom.removeEventListener("mousedown",t)};e.dom.addEventListener("keydown",t),e.dom.addEventListener("mousedown",t)}}}createTooltipContainer(){const e=document.createElement("div");return e.classList.add("cm-signature-help"),e.style.cssText="padding: 6px; max-width: 400px;",e}createSignatureElement(e,t){const i=document.createElement("div");if(i.classList.add("cm-signature"),i.style.cssText="font-family: monospace; margin-bottom: 4px;",!e.label||"string"!=typeof e.label)return i.textContent="Signature information unavailable",i;const r=e.label,s=e.parameters||[];if(0===s.length||!s[t])return i.textContent=r,i;const n=s[t].label;return"string"==typeof n?this.allowHTMLContent?i.innerHTML=r.replace(n,`<strong class="cm-signature-active-param">${n}</strong>`):i.textContent=r.replace(n,`${n}`):Array.isArray(n)&&2===n.length?this.applyRangeHighlighting(i,r,n[0],n[1]):i.textContent=r,i}applyRangeHighlighting(e,t,i,r){e.textContent="";const s=t.substring(0,i),n=t.substring(i,r),o=t.substring(r);e.appendChild(document.createTextNode(s));const a=document.createElement("span");a.classList.add("cm-signature-active-param"),a.style.cssText="font-weight: bold; text-decoration: underline;",a.textContent=n,e.appendChild(a),e.appendChild(document.createTextNode(o))}createDocumentationElement(e){const t=document.createElement("div");t.classList.add("cm-signature-docs"),t.style.cssText="margin-top: 4px; color: #666;";const i=gg(e);return this.allowHTMLContent?t.innerHTML=i:t.textContent=i,t}createParameterDocElement(e){const t=document.createElement("div");t.classList.add("cm-parameter-docs"),t.style.cssText="margin-top: 4px; font-style: italic; border-top: 1px solid #eee; padding-top: 4px;";const i=gg(e);return this.allowHTMLContent?t.innerHTML=i:t.textContent=i,t}prepareRenameFallback(e,{line:t,character:i}){const r=e.state.doc.line(t+1).text,s=/\w+/g;let n,o=i,a=i;for(;null!==(n=s.exec(r));){const e=n.index,t=n.index+n[0].length;if(i>=e&&i<=t){o=e,a=t;break}}return o===i&&a===i?null:{range:{start:{line:t,character:o},end:{line:t,character:a}},placeholder:r.slice(o,a)}}async applyRenameEdit(e,t){if(!t)return mg(e,"No edit returned from language server"),!1;const i=t.changes??{},r=t.documentChanges??[];if(0===Object.keys(i).length&&0===r.length)return mg(e,"No changes to apply"),!1;if(r.length>0)for(const t of r){if("textDocument"in t){if(t.textDocument.uri!==this.documentUri){mg(e,"Multi-file rename not supported yet");continue}const i=t.edits.sort(((t,i)=>{const r=cg(e.state.doc,t.range.start);return(cg(e.state.doc,i.range.start)??0)-(r??0)})).map((t=>({from:cg(e.state.doc,t.range.start)??0,to:cg(e.state.doc,t.range.end)??0,insert:t.newText})));return e.dispatch(e.state.update({changes:i})),!0}return mg(e,"File creation, deletion, or renaming operations not supported yet"),!1}else if(Object.keys(i).length>0)for(const[t,r]of Object.entries(i)){if(t!==this.documentUri){mg(e,"Multi-file rename not supported yet");continue}const i=r.sort(((t,i)=>{const r=cg(e.state.doc,t.range.start);return(cg(e.state.doc,i.range.start)??0)-(r??0)})).map((t=>({from:cg(e.state.doc,t.range.start)??0,to:cg(e.state.doc,t.range.end)??0,insert:t.newText})));e.dispatch(e.state.update({changes:i}))}return!1}}function Rg(e){const{serverUri:t,...i}=e;return function(e){let t=null;const i={rename:"F2",goToDefinition:"F12",signatureHelp:"Mod-Shift-Space",...e.keyboardShortcuts},r=e.client,s={diagnosticsEnabled:!0,hoverEnabled:!0,completionEnabled:!0,definitionEnabled:!0,renameEnabled:!0,codeActionsEnabled:!0,signatureHelpEnabled:!0,signatureActivateOnTyping:!1,...e},n=[rr.define((i=>(t=new xg(r,e.documentUri??i.state.facet(Yf),e.languageId??i.state.facet(Zf),i,s,e.sendIncrementalChanges??!0,e.allowHTMLContent??!1,e.onGoToDefinition),t)))];return n.push(un.of([{key:i.signatureHelp,run:e=>{if(!t||!s.signatureHelpEnabled)return!1;const i=e.state.selection.main.head;return t.showSignatureHelpTooltip(e,i),!0}},{key:i.rename,run:e=>{if(!t||!s.renameEnabled)return!1;const i=e.state.selection.main.head;return t.requestRename(e,ug(e.state.doc,i)),!0}},{key:i.goToDefinition,run:e=>{if(!t||!s.definitionEnabled)return!1;const i=e.state.selection.main.head;return t.requestDefinition(e,ug(e.state.doc,i)).catch((t=>mg(e,`Go to definition failed: ${t instanceof Error?t.message:"Unknown error"}`))),!0}}])),s.hoverEnabled&&n.push(go(((e,i)=>null==t?null:t.requestHoverTooltip(e,ug(e.state.doc,i))),e.hoverConfig)),s.signatureHelpEnabled&&n.push(rn.updateListener.of((async e=>{if(!t||!e.docChanged)return;if(!t.client.capabilities?.signatureHelpProvider)return;if(!s.signatureActivateOnTyping)return;const i=t.client.capabilities.signatureHelpProvider.triggerCharacters||["(",","];let r;const n=e.changes;let o=!1,a=-1;n.iterChanges(((e,t,s,n,l)=>{if(o)return;const c=l.toString();if(c)for(const e of i)if(c.includes(e)){o=!0,a=n,r=e;break}})),o&&a>=0&&t.showSignatureHelpTooltip(e.view,a,r)}))),s.completionEnabled&&n.push(yf({...e.completionConfig,override:[async i=>{if(null==t)return null;const{state:r,pos:s}=i,n=function(e,t,i){const{state:r,pos:s,explicit:n}=e,o=r.doc.lineAt(s);let a,l=Jf.CompletionTriggerKind.Invoked;const c=o.text[s-o.from-1]||"",h=t?.includes(c);return!n&&h&&(l=Jf.CompletionTriggerKind.TriggerCharacter,a=c),l!==Jf.CompletionTriggerKind.Invoked||e.matchBefore(i||/(\w+|\w+\.|\/|,)$/)?{triggerKind:l,triggerCharacter:a}:null}(i,t.client.capabilities?.completionProvider?.triggerCharacters??[],e.completionMatchBefore);return null==n?null:await t.requestCompletion(i,ug(r.doc,s),n)}]})),n.push(rn.domEventHandlers({click:(e,r)=>{if(s.definitionEnabled&&"ctrlcmd"===i.goToDefinition&&(e.ctrlKey||e.metaKey)){const i=r.posAtCoords({x:e.clientX,y:e.clientY});i&&t&&(t.requestDefinition(r,ug(r.state.doc,i)).catch((e=>mg(r,`Go to definition failed: ${e instanceof Error?e.message:"Unknown error"}`))),e.preventDefault())}}})),n}({...i,client:new kg({...e,transport:new Gf.WebSocketTransport(t),autoClose:!0})})}})(),window.JsDeps=r})();